Available online at www.sciencedirect.com


Electronic Notes in Theoretical Computer Science 319 (2015) 239–253
www.elsevier.com/locate/entcs

An Effect-Theoretic Account of Lebesgue Integration
Bart Jacobs and Bram Westerbaan
Institute for Computing and Information Sciences (iCIS), Radboud University Nijmegen, The Netherlands.
www. cs. ru. nl/ B. Jacobs	www. cs. ru. nl/ A. A. Westerbaan

Abstract
Effect algebras have been introduced in the 1990s in the study of the foundations of quantum mechanics, as part of a quantum-theoretic version of probability theory. This paper is part of that programme and gives a systematic account of Lebesgue integration for [0, 1]-valued functions in terms of effect algebras and effect modules. The starting point is the ‘indicator’ function for a measurable subset. It gives a homomorphism from the effect algebra of measurable subsets to the effect module of [0, 1]-valued measurable functions which preserves countable joins.
It is shown that the indicator is free among these maps: any such homomorphism from the effect algebra of measurable subsets can be thought of as a generalised probability measure and can be extended uniquely to a homomorphism from the effect module of [0, 1]-valued measurable functions which preserves joins of countable chains. The extension is the Lebesgue integral associated to this probability measure. The preservation of joins by it is the monotone convergence theorem.
Keywords: Effect algebra, effect module, Lebesgue integration


Introduction
Integration is a fundamental mathematical technique developed to compute quan- tities such as lengths of curves, areas of surfaces, volumes of solids, averages of distributions, Fourier transforms of functions, solutions to differential equations, and so on. Roughly speaking, the integral assigns to a function the area under its graph (counting the area under the x-axis negatively). The notation ∫f (x) dx
elongated “s”) of uncountably many rectangles f (x) dx of infinitesimal width dx. While this makes for an elegant picture, a formal definition of the integral requires a different approach: for instance, by approximating f by basic functions for which the integral is easily determined.

1 bart@cs.ru.nl and bram.westerbaan@cs.ru.nl

http://dx.doi.org/10.1016/j.entcs.2015.12.015 1571-0661/© 2015 Published by Elsevier B.V.
This is an open access article under the CC BY-NC-ND license (http://creativecommons.org/licenses/by-nc-nd/4.0/).

In probability theory, integration is used for calculating probabilities of events and expected values of random variables (among many other things). In the theory of continuous probabilistic computation, integration is used for sequential compo- sition (of Markov kernels, or coalgebras of the Giry monad), see e.g. [18,20]. Inte- gration is also used for calculation weakest preconditions of quantitative predicates (random values), see e.g. [15].
This paper gives an elementary account of Lebesgue integration, using basic measure theory. It is restricted to measurable functions X → [0, 1] to the unit interval, which may be understood as fuzzy predicates. What distinguishes our account from the traditional one is that it makes systematic use of the notions of effect algebra and effect module, where an effect module is an effect algebra with scalar multiplication, where scalars are taken from [0, 1]. These effect structures emerged in the foundations of quantum mechanics, as part of a quantum-theoretic version of probability theory (see [7] for an overview). It turns out that the basic notions of Lebesgue integration can be formulated very naturally in terms of ω- (complete)effect algebras and ω-effect modules. For instance, for a measurable space X, with set ΣX of measurable subsets,
the σ-algebra ΣX of measurable subsets is an ω-effect algebra;
the set Meas(X, [0, 1]) of measurable functions X → [0, 1] is an ω-effect mod- ule;
the indicator function gives a map 1(−) : ΣX → Meas(X, [0, 1]) which is a homomorphism of ω-effect algebras — where 1M (x)=1 if x ∈ M and 1M (x)= 0 if x /∈ M ;
moreover, this indicator map is free in the following sense: for every ω-complete effect module E, and for each probability measure (homomorphism of ω-effect algebras) φ : ΣX → E, there is a unique homomorphism of effect modules φ : Meas(X, [0, 1]) → E with φ ◦ 1(−) = φ. This free extension φ precisely is Lebesgue integration! It sends p ∈ Meas(X, [0, 1]) to the integral φ(p) = 
p dφ ∈ E.
These bullet points summarise the main contributions of the paper. The definition of the integral p dφ ∈ E proceeds in two stages, as usual, namely first for step functions (using the effect module structure of E), and then for any measurable p function by writing p as an ω-join  of an ascending chain of step functions (using the ω-completeness of E). Much of the work of the paper goes into verifying that the usual arguments can be adapted to the setting of ω-effect modules.
In the end one may wonder how much of a restriction our use of [0, 1]-valued functions is. These functions form an effect module. In [17] it is shown that the category of effect modules is equivalent to the category of order unit spaces, via a process called totalisation. By applying such totalisation one obtains the bounded R-valued functions from the [0, 1]-valued ones. In this way one can extend integra- tion from [0, 1]-valued functions to bounded R-valued functions.

Effect algebras and effect modules
Effect algebras have been introduced in mathematical physics [9] (and also [4,11]), in the investigation of quantum probability, see [7] for an overview. An effect al- gebra is a partial commutative monoid (M, 0, ❽) with an orthocomplement (−)⊥. One writes x ⊥ y if x ❽ y is defined. The formulation of the commutativity and associativity requirements are a bit involved, but essentially straightforward. The orthocomplement satisfies x⊥⊥ = x and x ❽ x⊥ = 1, where 1= 0⊥. There is always a partial order, given by x ≤ y iff x ❽ z = y, for some z. Then: x ⊥ y iff x ≤ y⊥. The main example is the unit interval [0, 1] ⊆ R, where addition + is obviously par- tial, commutative, associative, and has 0 as unit; moreover, the orthocomplement is r⊥ =1 − r. An ω-effect algebra (also called σ-effect algebra) additionally has joins n xn of countable ascending chains x1 ≤ x2 ≤ ··· . We write EA for the category of effect algebras, with as morphisms maps preserving ❽ and 1 — and thus all other structure. The morphisms in the subcategory ω-EA ‹→ EA of ω-effect algebras are
those that preserve joins of ω-chains.
For each set X, the set [0, 1]X of fuzzy predicates on X is an ω-effect algebra, with pointwise operations. Each Boolean algebra B is an effect algebra with x ⊥ y iff x∧y = ⊥; then x❽y = x∨y. In a quantum setting, the main example is the set of effects Ef (H ) ona Hilbert space H (that is, bounded linear operators A : H → H with 0 ≤ A ≤ I, see e.g [7,14]).
An effect module is an ‘effect’ version of a vector space. It involves an effect algebra E with a scalar multiplication s · x ∈ E, where s ∈ [0, 1] and x ∈ E. This scalar multiplication must preserve 0, ❽ in each variable separately. The sets [0, 1]X and Ef (H ) are clearly such effect modules. In the subcategory EMod ‹→ EA of effect modules, maps additionally commute with scalar multiplication. We use ω-EMod ‹→ EMod for the subcategory of ω-complete effect modules, with effect module maps that preserve joins of ω-chains.
We need the following results about effect modules.
Lemma 2.1 For elements x, y in an effect module, and for scalars r, s ∈ [0, 1],
(i) (r · x)⊥ = (r⊥ · x) ❽ x⊥;
(ii) x ⊥ y implies r · x ⊥ s · y.
Proof We obtain (r · x)⊥ = r⊥ · x ❽ x⊥ by uniqueness of orthocomplements:
r · x ❽ r⊥ · x ❽ x⊥ = (r ❽ r⊥) · x ❽ x⊥ = 1 · x ❽ x⊥ = x ❽ x⊥ = 1.

Next, if x ⊥ y, then x ≤ y⊥, and thus r · x ≤ x ≤ y⊥. Taking complements, we see that s · y ≤ y ≤ (r · x)⊥. This means r · x ⊥ s · y.
Measurable spaces and functions
A measurable space (X, ΣX ) (or simply X) is a pair consisting of a set X and a
σ-algebra ΣX ⊆ P(X). The latter is a collection of measurable subsets closed under

∅, complements (negation), and countable unions. The measurable subsets form a Boolean algebra in which countable joins exist — so ΣX is an ω-effect algebra.
A function f : X → Y between measurable spaces — that is, from (X, ΣX ) to (Y, ΣY ) — is called measurable if f−1(M ) ∈ ΣX for each M ∈ ΣY . This yields a category Meas, which comes with a functor Σ(−) : Meas → ω-EAop. With each topological space X one associates the least σ-algebra containing all open subsets, called the Borel algebra/space on X. In particular the unit interval [0, 1] forms a measurable space. Its measurable subsets are generated by the intervals (q, 1], where q is a rational number in [0, 1].
Measurable functions have more order structure than continuous ones: they are closed under countable joins.
Lemma 3.1 Let X be a measurable space, and Y a topological space.
The set Meas(X, [0, 1]) of measurable functions X → [0, 1] is an ω-effect mod- ule. In particular, it is closed under joins of ascending ω-chains.
The set Top(Y, [0, 1]) of continuous functions Y → [0, 1] is an effect module, but not always an ω-effect module: some ascending ω-chains of continuous functions have no join.
These mappings X '→ Meas(X, [0, 1]) and Y '→ Top(Y, [0, 1]) yield functors:
Meas	/ω-¸EModop	Top	/E¸Modop	(1)
Proof The measurable functions X → [0, 1] form an effect module, using point- wise the effect module structure from the unit interval [0, 1]. To show that they are closed under joins let p1 ≤ p2 ≤ p3 ≤ · · · be measurable functions pn : X → [0, 1]. We must show that the (pointwise) join p =  n pn in [0, 1]X is again measurable. Since subsets of the form (r, 1] with r ∈ [0, 1] generate the Borel σ-algebra on [0, 1] it suffices to show that p−1( (r, 1] ) is measurable. Note
is n with pn(x) > r. Thus p−1( (r, 1] ) =   p−1( (r, 1] ). Since each p−1( (r, 1] ) is
measurable, so is p−1( (r, 1] ], and the join p =  n pn is measurable.
We thus get a functor Meas(−, [0, 1]): Meas → ω-EModop. The ω-effect module structure is preserved by pre-composition, since it is defined pointwise.
The set Top(Y, [0, 1]) of continuous functions Y → [0, 1] is an effect module, but in general has no ω-joins. Take for instance Y = [0, 2], and consider the continuous functions f1 ≤ f2 ≤ · · ·≤ f : [0, 2] → [0, 1] defined by:


fn(y) = 
1 − yn	if y ∈ [0, 1)
0	if y ∈ [1, 2]
and	f (y) = 
1	if y ∈ [0, 1)
0	if x ∈ [1, 2]



Since lim
n→∞
yn = 0 for y ∈ [0, 1) we see that f is the pointwise join of f1, f2,... .

Clearly, this join f is not continuous, and so it cannot be the join of f1, f2,... 
in Top(Y, [0, 1]). Even more: we claim there is no least continuous function above f . Thus f1, f2,... has no join at all in Top(Y, [0, 1]).

Indeed, if g : [0, 2] → [0, 1] is continuous and g ≥ f , then g2 ≥ f 2 = f as well (where f 2 = f because f is {0, 1}-valued). On the other hand g is not {0, 1}-valued because g is continuous at 1. Thus g2 < g. Hence g is not the least continuous function above f , and thus g is not the join of f1, f2,... .	 
For each measurable space (X, Σ) there is the ‘indicator’ function 1(—) : Σ → Meas(X, [0, 1]), given by 1M (x)=1 if x ∈ M and 1M (x)=0 if x /∈ M where M ∈ ΣX . Then 1(—) is a homomorphism of ω-effect algebras.
The next result neatly organises the situation so far. It turns out that this situa- tion has an additional freeness property that is the essence of Lebesgue integration. This will be elaborated in the next section (see Theorem 4.12).
Lemma 3.2 Sending a measurable subset M to its indicator function 1M is a nat- ural transformation in:
op
 ,,¸

Σ(−)
1(−)
⇐=
Meas
U Meas(—,[0,1])

where U : ω-EMod → ω-EA is the forgetful functor. The (possibly unexpected) direction of the arrow ⇐ is explained by the (−)op.
Proof Let (X, ΣX ) be a measurable space. We show that the mapping M '→ 1M is a homomorphism of ω-effect algebras 1(—) : ΣX → Meas(X, [0, 1]), and leave naturality to the reader. Clearly, the unit is preserved, since 1X is the constant function x '→ 1. Also, if M ⊥ Mj in ΣX , that is, M ∩ Mj = ∅, then 1M❽M′ = 1M∪M′ = 1M + 1M′ = 1M ❽ 1M′ . It is easy to see that ω-joins are preserved: n 1Mn = 1Sn Mn .	 
Lemma 3.3 Hom-ing into [0, 1] yields an adjunction between ω-effect modules and measurable spaces:

Hom(—,[0,1])
ω-EModop	T

¸ 
Hom(—,[0,1])
Meas

Proof In order to do this, we first need to provide the homset ω-EMod(E, [0, 1]) with a σ-algebra. We take the least σ-algebra that makes for each e ∈ E the evaluation map eve : ω-EMod(E, [0, 1]) → [0, 1], given by eve(ω) = ω(e), mea- surable.  This is functorial, since for f : E → D in ω-EMod, the map (−) ◦ f : ω-EMod(D, [0, 1]) → ω-EMod(E, [0, 1]) is measurable.
We get an adjunction since there is a natural bijective correspondence:
E	f	/M¸eas(X, [0, 1])	in ω-EMod
=====================
X	g  /ω-¸EMod(E, [0, 1])	in Meas
This is done via a simple swapping of arguments.	 

Later on, in Corollary 4.14, we shall see that the monad on the category Meas
induced by this adjunction is the well-known Giry monad [10].
Lebesgue integration in ω-effect modules
Our approach to integration is on the one hand more restricted than usual, and on the other hand more general. The restriction lies in the fact that we define integration for [0, 1]-valued functions, and not for more general functions. The extension involves using probability measures φ : Σ → E into an ω-effect module E, instead of into [0, 1] as is commonly done.
Traditionally, a measure space consists of a measurable space (X, ΣX ) with a function φ : ΣX → [0, ∞] which satisfies φ(∅) = 0 and is countably additive:
φ ❽n∈N Mn =	n∈N φ(Mn) =	n∈N	i≤n φ(Mi),	(2)
for each pairwise disjoint, countable collection of measurable Mn ∈ ΣX . Here we use ❽ for disjoint union, where ΣX is understood as an effect algebra. Such a measure φ is called a probability measure if φ(X) = 1, so that φ can be restricted to a function ΣX → [0, 1].
Below is a well-known observation (see e.g. [22, Thm. 4.4]) that justifies our generalisation of probability measures to other codomains than [0, 1].
Lemma 4.1 Let X be a measurable space, with a function φ : ΣX → [0, 1]. The following points are then equivalent:
φ is a probability measure, that is, φ(∅)=0 and φ(X)=1 and φ is countably additive as in (2);
φ is a homomorphism of ω-effect algebras ΣX → [0, 1].	 
Definition 4.2 Let X be a measurable space, and E a ω-effect module. An E- valued probability measure, or simply an E-probability measure is a map φ : ΣX → U (E) in the category ω-EA of ω-effect algebras — where U : ω-EMod → ω-EA is the forgetful functor.
For each element x ∈ X we write η(x): ΣX → E for the probability measure given by η(x)(M )=1 if x ∈ M and η(x)(M )=0 if x /∈ M .
Examples of probability measures with values in an ω-effect module are POVMs: Positive Operator-Valued Measures, see e.g. [14, Defn. 3.5]. Such a POVM is a map of ω-effect algebras ΣX → Ef (H ) with the effects of a Hilbert space H as codomain. We will return to POVMs in Example 4.15 below.
Remark 4.3 While ΣX and [0, 1] are MV-algebras (see [5]), a probability measure φ : ΣX → [0, 1] need not be an homomorphism of MV-algebras, that is, preserve binary joins ∨.
Indeed, since in an MV-algebra we have the identity x ∨ y = x + (y⊥ + x)⊥ a homomorphism of MV-algebras preserves finite joins. (In fact, a homomorphism of effect algebras between MV-algebras is a homomorphism of MV-algebras precisely

when it preserves finite joins.) The standard probability measure μ on [0, 1] does not preserve finite joins μ([0, 1 ] ∪ [ 1 , 1]) = 1 /= 1 = max{ μ([0, 1 ]), μ([ 1 , 1]) } and is
2	2	2	2	2
thus not a homomorphism of MV-algebras.
The probability measures φ : ΣX → [0, 1] which preserve joins are in fact quite special. Indeed, for such φ we have φ(A∪B)= max{φ(A), φ(B)} for all A, B ∈ ΣX , and also φ(A∩B)= min{φ(A), φ(B)}. Taking B = A⊥, we see that either φ(A)=1 (and φ(A⊥) = 0) or φ(A⊥) = 1 (and φ(A) = 0). Thus {A ∈ ΣX : φ(A) = 1} is an ultrafilter on ΣX .
Extending measure to integral is done in two parts, first for step functions, and then for all measurable functions, as joins of ω-chains of step functions.
Definition 4.4 Let X be a measurable space.
A step function X → [0, 1] is a function that can be written as finite linear combination r1 ·1M1 +···+rk ·1Mk = ❽i ri ·1Mi ∈ Meas(X, [0, 1]) of indicator functions 1Mi and scalars ri ∈ [0, 1], where the Mi ∈ ΣX are pairwise disjoint measurable subsets satisfying ❽i Mi = X.
Let φ : ΣX → E be a probability measure. The interpretation of s dφ for a step function s = ❽i ri1Mi is
∫ s dφ = ❽i ri · φ(Mi) ∈ E.	(3) (There is no ambiguity, see Lemma 4.5 below.)
Since these Mi form a partition, they are k-test in the effect algebra ΣX . Also, the set of step functions can be described as tensor product ΣX ⊗ U (E), where ⊗ is the tensor of effect algebras, see [16].
In the second point we use the property that in an effect module x ⊥ y implies
r · x ⊥ t · y for all scalars r, t ∈ [0, 1], see Lemma 2.1.
We will first show that the integral s dφ in (3) is independent of the represen- tation of the step function s, see e.g. [22, Lemma 9.1]. We elaborate the details in order to show that this works in effect modules too.
Lemma 4.5 Let X be a measurable space, and φ : ΣX → E a probability measure. Consider two step functions ❽i ri · 1Mi  ≤ ❽j sj · 1Nj in Meas(X, [0, 1]). Then
❽i ri · φ(Mi) ≤ ❽j sj · φ(Nj) in E.
Proof Since ❽i Mi = X = ❽j Nj by Definition 4.4 we have Mi = ❽j Mi ∩ Nj
and Nj = ❽i Nj ∩ Mi. Thus:
Σi riφ(Mi) = Σi riφ ❽j Mi ∩ Nj = Σi,j riφ Mi ∩ Nj 
= Σj sjφ ❽i Mi ∩ Nj = Σj sjφ(Nj).
We used the fact that riφ(Mi ∩ Nj) ≤ sjφ(Mi ∩ Nj) for all i and j. Indeed, this

inequality holds when Mi ∩ Nj = ∅. Otherwise, we have for x ∈ Mi ∩ Nj,
ri =  ❽i ri1Mi (x) ≤  ❽j sj1Nj (x) = sj.
Thus riφ(Mi ∩ Nj) ≤ sjφ(Mi ∩ Nj).	 
A basic observation is that each measurable predicate can be described as join of an ascending ω-chain of step functions (see e.g. [22, Thm. 8.8]).
Lemma 4.6 For each measurable function p : X → [0, 1] there is an ω-chain s ≤
s2 ≤ · · · of step functions sn ≤ p with p =  sn.	 

function in Meas(X, [0, 1]). Indeed, we shall have	p =  n	sn when s1 ≤ s2 ≤ · · ·
a de∫finition we must check that there is no ambiguity by proving that  n	sn =
	tn whenever t1 ≤ t2 ≤ · · · and s1 ≤ s2 ≤ · · · are step functions with  n sn =
Definition 4.7 Let φ be an E-valued probability measure on a measurable space X. An elementary extension of φ is a map Φ: S → E defined on a collection of measurable functions S ⊆ Meas(X, [0, 1]) such that:
1M ∈ S and Φ(1M )= φ(M ) for all M ∈ ΣX ;
S is a sub-effect module of Meas(X, [0, 1]), and Φ: S → Meas(X, [0, 1]) is a homomorphism of effect modules.
s · 1M ∈ S for all M ∈ ΣX and s ∈ [0, 1].
The integral (−) dφ, defined on the sub-effect module of step functions is an elementary extension of φ. But also integration on all measurable maps will be an elementary extension. This abstraction allows us to apply the following result both to integration of step functions and of all measurable functions.
Proposition 4.8 Let Φ: S → E be an elementary extension of an E-valued prob- ability measure φ on a measurable space X.
Let s and t1 ≤ t2 ≤ · · · be from S with s ≤  tn. Then Φ(s) ≤   Φ(tn).
Let s1 ≤ s2 ≤ ··· and t1 ≤ t2 ≤ ··· be from S. Then  sn ≤  tn implies

Proof We will only prove point (i) since point (ii) is an easy consequence.
Writing am = 1−  1 ∈ [0, 1] for m ≥ 1 we have  m am = 1. Thus to prove Φ(s) ≤
1 · Φ(s)= ( m am) · Φ(s)=	m am · Φ(s) ≤	n Φ(tn).
Let m be given. The trick is to consider the sets
Mn = { x ∈ X | am · s(x) ≤ tn(x) }.

It is not difficult to prove that: (1) each subset Mn ⊆ X is measurable (since s, t1, t2,... are measurable functions); that (2) the Mn form an ascending chain with   M  = X (since a  · s(x) < s(x) ≤  t (x) for each x ∈ X); and that
(3) a  ·(s·1  ) ≤ t  for all n. The latter implies a  ·  Φ(s·1  ) ≤   Φ(t ) in E. So it suffices to prove that Φ(s)=  Φ(s·1  ), or in other words,  Φ(s·1  )= 
Since s · 1   ≤ 1   for all n we have   Φ(s · 1  ) ≤   Φ(1  ) =
 n φ(¬Mn)=  n 1−φ(Mn)= 1− n φ(Mn)= 1−φ( n Mn)= 1−φ(X)= 1−1= 0.

We can now define the (Lebesgue) integral taking its values in an ω-effect algebra, for measurable predicates.
Definition 4.9 Let φ be an E-valued probability measure on a measurable space X. For measurable function p : X → [0, 1] we define the integral by
∫ p dφ =  ∫ sn dφ ∈ E,	(4)
where s1 ≤ s2 ≤ · · · is a chain of step functions with n sn = p. Sucha chain exists by Lemma 4.6 and there is no ambiguity by Proposition 4.8.
We list some basic well-known properties of integration, formulated here in effect- theoretic terms.
Proposition 4.10 Let X be a measurable space, together with a probability measure
φ : ΣX → E in an ω-effect module E.
∫ (−) dφ on Meas(X, [0∫, 1]) is an elementary extension of φ.	In par-

(‘Levi’s Theorem’) For all p1 ≤ p2 ≤ · · · in Meas(X, [0, 1]),
∫   pn dφ =   ∫ pn dφ.

The latter two points say that	(−) dφ is a morphism Meas(X, [0, 1]) → E in the category ω-EMod of ω-effect modules.
For maps f : X → Y in Meas and g : E → D in ω-EMod,
∫ (q ◦ f ) dφ = ∫ q d(φ ◦ f—1)	g ∫ p dφ  = ∫ p d(U (g) ◦ φ),

where U : ω-EMod → ω-EA is the forgetful functor.
For each x ∈ X and p ∈ Meas(X, [0, 1]) one has:
∫ p dη(x) = p(x),

where η(x): ΣX → E is as described in Deﬁnition 4.2.

Proof (i) We only show∫ that ∫ (−) dφ is a homomorphism of effect modules. The
tion 4.7) are either trivial to verify or follow immediately from the fact that the integral on step functions is an elementary extension of φ.
Since 1X is a step function, and	(−) dφ extends the integral on step functions, and we already know that that the integral on step functions is a homomorphism

of effect modules, we get	1 dφ = 1.
Let p, q ∈ Meas(X, [0, 1]) with p ⊥ q. We must show that ∫
p ❽ q dφ = ∫ p dφ ❽

∫ q dφ. By Lemma 4.6 there are step functio∫ns s0 ≤ s1 ≤∫
· · · and t1 ≤ t2 ≤

··· ∫such that p =  sn and q =  tn. Then	p dφ =  n	sn dφ and	q dφ =
 ∫ n	tn dφ by De∫finition 4.9. Then sn ⊥ tn for all n and p ❽ q =  n sn ❽ tn so
p ❽∫q dφ =  n	sn ❽ tn dφ. Since sn and tn are step functions, we already know


=  n  ∫ sn dφ ❽ ∫ tn dφ  =  n ∫ (sn ❽ tn) dφ = ∫ p ❽ q dφ.
By a similar reasoning using that scalar multiplication preserves suprema of ω-joins we get  r · p dφ = r ·  p dφ for all p ∈ Meas(X, [0, 1]), r ∈ [0, 1]. Thus (−) dφ is a homomorphism of effect modules.
This is a consequence of Proposition 4.8 since (−) dφ is an elementary extension of φ.
For measurable f : X → Y and step function s = ❽i ri1Ni in Meas(Y, [0, 1]) we have:
∫ (s ◦ f ) dφ = ∫  ❽i ri1f−1(Ni) dφ	by naturality of 1(—), see Lemma 3.2
=	❽ ri1N	d(φ ◦ f—1)
= ∫ s d(φ ◦ f—1).

The required result for an arbitrary predicate p ∈ Meas(X, [0, 1]) now follows like in (i) using that (−) ◦ f preserves suprema of ω-chains.
The second equation is also first obtained for step functions.
For a step function s = ❽i ri1Mi we have:
∫ s dη(x) = ❽i riη(x)(Mi) = Σi ri1Mi (x) = s(x).
Hence for a join p =  n sn of step functions sn we get:
p dη(x) =	n	sn dη(x) =	n sn(x) = p(x).	 
Remark 4.11 Let φ : ΣX → E be a probability measure on a measurable space X where E is an ω-effect module. Many optional features of φ carry over to the integral φ = (−) dφ. We give two examples.



If E is an MV-algebra and φ is a homomorphism of MV-algebras, then φ = (−) dφ : Meas(ΣX, [0, 1]) → E is a homomorphism of MV-modules. We sketch a proof, but leave the details to the reader.
Note that φ is a homomorphism of MV-algebras iff it preserves binary meets. Given a step function s ≡ ❽i si1Mi the sets Mi are pairwise disjoint and so s = s 1 . Thus, by distributivity of ∧ over ∨, we see that for step functions s ≡ ❽i si1Mi and t ≡ ❽j tj1Nj we have s∧t =  i,j (si ∧tj)1Mi∩Nj =
❽i,j (si ∧tj)1Mi∩Nj . To see that the integral on step functions preserves binary
meets, integrate, use the fact that φ preserves binary meets, and rewrite.
To see that  (−) dφ preserves binary meets, note that for step functions s1 ≤ s2 ≤ · · · and t1 ≤ t2 ≤ · · · we have ( n sn) ∧ ( m tm) =  n sn ∧ tn. Now, integrate, use that the integral on step functions preserves binary meets, rewrite, and finish the proof with an appeal to Lemma 4.6.
If E is endowed with a suitable product ⊙ and φ preserves ‘products’ (that is, φ(A ∩ B) = φ(A) ⊙ φ(B) for all A, B ∈ ΣX ), then φ = (−) dφ preserves products. We leave the proof to the reader.
By a suitable product, we mean an associative map ⊙ : E × E → E such that for every a ∈ E the maps a ⊙ (−) and (−) ⊙ a preserve sum ❽, scalar multiplication, and countable joins, and 1 ⊙ a = a = a ⊙ 1.
(Hint for the proof: 1M · 1N = 1M∩N for all M, N ∈ ΣX .)
As will be explained in Remark 4.13 below, the core of the following result occurs as [12, Theorem 6.8], where integration is described via a tensor product with scalars, and thus as a free effect module.
Theorem 4.12 Let X be a measurable space and E be an ω-effect module.
For every ω-effect algebra homomorphism φ : ΣX → E (that is, E- probability measure on X) there is a unique ω-effect module homomorphism φ : Meas(X, [0, 1]) → E such that φ ◦ 1(—) = φ. In a diagram:
Σ 	1(−)	/M¸eas(X, [0, 1])

∃!φ
z ˛ 

There is a bijective correspondence between:
ΣX	φ  /U¸(E)	in ω-EA
===================
Meas(X, [0, 1])	/¸	in ω-EMod
This correspondence is natural in X and in E.
The natural transformation 1(—) : Σ(—) ⇒ U Meas(−, [0, 1]) from Lemma 3.2 is universal, in the following sense.  For each functor F : Meas → ω-EMod with a natural transformation τ : Σ(—) ⇒ UF, there is a unique

τ : Meas(−, [0, 1]) ⇒ F with Uτ ◦ 1(—) = τ, in:


Σ		1(−)	 zU Meas(−, [0, 1])

Uτ
z  z
Meas(−, [0, 1])
τ =, (—) dφ
  z

UF	F
Proo∫f (i) Take φ = ∫ (−) dφ; it is a homomorphism of ω-effect modules
For uniqueness, let ξ : Meas(X, [0, 1]) → E be a homomorphism of ω-effect modules such that ξ(1M ) = φ(M ) for all M ∈ ΣX . Let p ∈ Meas(X, [0, 1]) be given. We must show that ξ(p)= p dφ.
We prove this first for step functions.  If p = ❽i ri1Mi  then we have that

ξ(p)= ❽i riξ(1Mi )= ❽i riφ(Mi)=	p dφ.
Now, for arbitrary p there are step functions s1 ≤ s2 ≤ ··· with p =
Lemma 4.6 and so we have ξ(p)=	n ξ(sn)=	n	sn dφ =	p dφ.
n sn by

This follows categorically from point (i), see [19, Thm. IV.1.2 (ii)].
Define τ X = τX , given by τX (p)= ∫ p dτX as in point (i).	 

Remark 4.13 Theorem 4.12 says that for a measurable space (X, ΣX ), the predi- cates Meas(X, [0, 1]) form the free ω-effect module on the ω-effect algebra ΣX . In essence, for [0, 1]-valued functions, Lebesgue integration is thus the extension of a map of ω-effect algebras ΣX → E to a map of ω-effect modules Meas(X, [0, 1]) → E. Such free modules are obtained by tensoring [0, 1]⊗(−) with the scalars involved.
This description is used by Gudder in [12, Theorem 6.8]. He proves an isomorphism [0, 1] ⊗ ΣX ∼= Meas(X, [0, 1]), which implies that the predicates Meas(X, [0, 1]) form the free ω-effect module on ΣX . There are a few more things to say.
Gudder does not use ω-effect modules, only ω-effect algebras. He proves that there is a suitable bihomomorphism of ω-effect algebras [0, 1] × ΣX → Meas(X, [0, 1]). He does not prove the existence of tensors of ω-effect al- gebras in general. He only shows the existence of this particular one in [0, 1] ⊗ ΣX ∼= Meas(X, [0, 1]).
Gudder does not use categorical language, and so the formulation of integration as free construction (as in Theorem 4.12) does not occur in [12].
The most common instance of the ω-effect module E in Theorem 4.12 uses E = [0, 1]. But as we shall see later, we can also use the effects of a Hilbert space or of a von Neumann algebra. Thus, the generality of using E-valued probability measures ΣX → E pays off.

Corollary 4.14 The monad X '→ ω-EMod Meas(X, [0, 1]), [0, 1] on the category Meas of measureable spaces induced by the adjunction ω-EModop  Meas from Lemma 3.3 is (isomorphic to) the Giry monad G (from [10]).

Proof Since by Theorem 4.12, with E = [0, 1] we have:

G(X) d=efn ω-EA ΣX, [0, 1] ∼= ω-EMod Meas(X, [0, 1]), [0, 1] .	 


(A relation between integration and the Giry monad has been described before in a different language, see e.g. [1].)

Example 4.15 One application of the general mechanism of Theorem 4.12 is the formulation of the spectral theorem for effects on a Hilbert space H . Recall that a bounded self-adjoint linear map A on H is called an effect when 0 ≤ ⟨Ax, x⟩≤ 1 for all x ∈ H . These effects form an ω-effect module, which we denote by Ef (H ). Let A ∈ Ef (H ) be an effect.  The spectrum σA of A (i.e. all λ ∈ C such that A − λ · I is not invertible) inherits the topology of C. Since A is an effect, we get σA ⊆ [0, 1]. Endow σA with the σ-algebra of Borel measurable subsets of C, so
that σA becomes a measurable space.
Recall that an ω-effect algebra homomorphism φ : ΣσA → Ef (H ) is called a POVM (positive operator valued measure). We are interested in POVMs φ : ΣσA → Ef (H ) such that φ(M ) is a projection for all M ∈ ΣσA . Such a φ is called a spectral measure on σA, and by Theorem 4.12, it has a unique extension to an ω-effect module homomorphism (−) dφ : Meas(σ , [0, 1]) → Ef (H ).
(Note that while φ is projection-valued the integral	(−) dφ is not:	1 1X dφ =
1 I is not a projection. Also, the set of projections does not form an ω-effect module.)
The spectral theorem states that there is a unique spectral measure φ on σA
which satisfies the following requirements (see [13, §43 and §39]).
A = id dφ where id: σA → [0, 1] is given by id(x)= x for x ∈ σA. This means that the effect A has a ‘spectral decomposition’ as an integral over projections.
For any open subset G of σA with φ(G)=0 we have G = ∅.
In fact, we may replace the latter requirement by the following weaker form.
(iij) The complement of {G | G ⊆ [0, 1] open and φ(G)= 0} in [0, 1] is compact. Moreover, such a spectral measure φ has the following properties.
( f dφ) · ( g dφ) = f · g dφ for all f, g ∈ Meas(σA, [0, 1]), see [13, §37, Thm. 3].
Let B be a bounded linear operator on H ; then B commutes with A if and only if B commutes with φ(M ) ∈ Ef (H ) for all M ∈ ΣσA , via a combination of Theorem 2 from §41 and Theorem 4 from §37 of [13].
The spectral theorem is one of the great achievements of 20th century mathe- matics. It reveals that effects behave somewhat like measurable functions to [0, 1]; the integral  (−) dφ provides the translation from measurable functions to effects.

Perspectives and future work
By Theorem 4.12 an E-probability measure can be extended to an integral. But how does one obtain an E-probability measure? Carath´eodory’s extension theorem guarantees that given a measurable space (X, ΣX ) any homomorphism of effect algebras μ : S → [0, 1] defined on a Boolean subalgebra S of a σ-algebra ΣX on a set X can be extended uniquely to a probability measure μ˜ : ΣX → [0, 1] provided that μ( n An)=  n μ(An) for all A1 ⊆ A2 ⊆ · · · from ΣX with  n An ∈ ΣX
We do not know if a similar theorem holds for E-valued homomorphisms μ
where E is an arbitrary ω-effect module. Our attempts to generalise existing proofs are blocked by the potential lack of a complete metric on E, which leads us to the following problem.
Problem 5.1 Let E be an Archimedean ω-effect module. Is the metric on E com- plete? (See [17], Equation (10) for the deﬁnition of the metric on E.)
Other questions remain: for example, can we fit Fubini (integration over product spaces) in our general framework?
Of the numerous generalisations of the formal definition of integral given by Riemann our work is perhaps most similar in setup and breadth to the vector valued variations on the Lebesgue integral studied by Bochner [3] and Pettis [21]. Their integrals takes values from a Banach space while our integral takes values from an ω-effect module. They exploit the uniform structure on a Banach space, while we use the order structure of an ω-effect module. An order-theoretic approach to integration has also been considered by Alfsen (for real-valued lattice valuations, see [2]), the second author (for lattice valuations taking their values from a suitable lattice-ordered abelian group, see [24]), and others [6,23].
Traditionally, countable chains take centre stage in the theory of measure and integral as opposed to the directed sets of domain theory. To see why, note that the Lebesgue measure on [0, 1] does not preserve joins of directed sets as any (measur- able) set is the union of the directed set of its finite (and thus negligible) subsets. Nevertheless, there are connections between integration and domain theory. For example, the measurable subsets on [0, 1] modulo negligibility form a complete lat- tice, and the real-valued Riemann integration of continuous functions on a compact metric space can be related to the probabilistic power domain (see [8]).

References
T. Avery Codensity and the Giry monad. arXiv:1410.4432, 2014.
E.M. Alfsen. Order theoretic foundations of integration. Mathematische Annalen, 149(5):419–461, 1963.
S. Bochner. Integration von funktionen, deren werte die elemente eines vektorraumes sind. Fundamenta Mathematicae, 20(1):262–176, 1933.
F. Chovanec and F. Kˆopka. D-posets. In K. Engesser, Dov M. Gabbai, and D. Lehmann, editors, Handbook of Quantum Logic and Quantum Structures: Quantum Structures, pages 367–428. North Holland, Elsevier, Computer Science Press, 2007.


R. Cignoli, I D’Ottaviano, and D. Mundici. Algebraic Foundations of Many-Valued Reasoning, volume 7 of Trends in Logic. Springer, 2000.
Th. Coquand and B. Spitters. Integrals and valuations. Journ. of Logic and Analysis, 1(3):1–22, 2009.
A. Dvureˇcenskij and S. Pulmannov´a. New Trends in Quantum Structures. Kluwer Acad. Publ., Dordrecht, 2000.
A. Edalat. Domain theory and integration. Theor. Comp. Sci., 151:163–193, 1995.
D. J. Foulis and M.K. Bennett. Effect algebras and unsharp quantum logics. Found. Physics, 24(10):1331–1352, 1994.
M. Giry. A categorical approach to probability theory. In B. Banaschewski, editor, Categorical Aspects of Topology and Analysis, number 915 in Lect. Notes Math., pages 68–85. Springer, Berlin, 1982.
R. Giuntini and H. Greuling. Toward a formal language for unsharp properties. Found. Physics, 19:769–780, 1994.
S. Gudder. Morphisms, tensor products and σ-effect algebras. Reports on Math. Phys., 42:321–346, 1998.
P. Halmos. Introduction to Hilbert Space and the Theory of spectral Multiplicity. Chelsea Publ. Comp., New York, 2nd edition, 1957.
T. Heinosaari and M. Ziman. The Mathematical Language of Quantum Theory. From Uncertainty to Entanglement. Cambridge Univ. Press, 2012.
B. Jacobs. Measurable spaces and their effect logic. In Logic in Computer Science. IEEE, 2013.
B. Jacobs and J. Mandemaker. Coreflections in algebraic quantum logic. Found. of Physics, 42(7):932– 958, 2012.
B. Jacobs and J. Mandemaker. The expectation monad in quantum foundations. In B. Jacobs,
P. Selinger, and B. Spitters, editors, Quantum Physics and Logic (QPL) 2011, volume 95 of Elect. Proc. in Theor. Comp. Sci., pages 143–182, 2012.
D. Kozen. Semantics of probabilistic programs. Journ. Comp. Syst. Sci, 22(3):328–350, 1981.
S. Mac Lane. Categories for the working mathematician. Springer, 1978.
P. Panangaden. Labelled Markov Processes. Imperial College Press, 2009.
B.J. Pettis. On integration in vector spaces. Transactions of the American Mathematical Society, 44(2):277–304, 1938.
R. Schilling. Measures, Integrals and Martingales. Cambridge Univ. Press, 2006.
S. Vickers. A monad of valuation locales. Unpublished note, 2011.
A.A. Westerbaan. Lattice valuations: A generalisation of measure and integral. Master’s thesis, Radboud University, 2012.
