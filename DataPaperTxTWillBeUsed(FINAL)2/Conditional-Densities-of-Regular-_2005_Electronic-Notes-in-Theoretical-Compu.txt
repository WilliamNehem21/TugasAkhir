Electronic Notes in Theoretical Computer Science 140 (2005) 67–79	
www.elsevier.com/locate/entcs

Conditional Densities of Regular Languages
Jakub Kozik 1
Jagiellonian University, Institute of Computer Science ul. Nawojki 11, 30-072 Krako´w, Poland

Abstract
We define a density of a given language S in a given language L as an asymptotic probability that a randomly and uniformly chosen word of length n from L belongs to S. There are languages for which densities do not exist. We show that a problem of checking whether one regular language has a density in another regular language is decidable.
Keywords: asymptotic evaluation, probabilistic density, regular language


Introduction
It is known that it is impossible to define an uniformly distributed probabilistic measure on a set of words over a finite alphabet. Instead, we can consider a density of a given language L over a finite alphabet Σ as
Card(L ∩ Σn)

d(L) = lim
n→∞
,
Card(Σn)

which denotes an asymptotic probability that a randomly and uniformly cho- sen word of length n belongs to L. Simple example of a language without a density is ((a + b)2)∗ (over the alphabet Σ = {a, b}). It is easy to observe that a density is always nonnegative providing it exists and that d(Σ∗)= 1. More- over, if disjoint languages L1, L2 have densities, then d(L1 ∪ L2) = d(L1)+ d(L2). A density is not countably additive on disjoint sets. A notion of a density presented above was studied in [1] and [4] using formal power series. Another approach, based on the Markov chains theory, was presented in [2].

1 email:jkozik@ii.uj.edu.pl


1571-0661 © 2005 Elsevier B.V. Open access under CC BY-NC-ND license.
doi:10.1016/j.entcs.2005.06.023

Given two languages S ⊂ L such that L contains words of almost every length, we define a (conditional) density of the language S in the language L as

d(S|L) = lim
Card(S ∩ Σn)
n .

n→∞ Card(L ∩ Σ )
In the present paper we investigate conditional densities for regular languages.

Example 1.1 Let us represent the positive integer numbers as words over the binary alphabet {1, 0}. Then the language of all positive numbers will be L = 1(1 + 0)∗, and the language of even numbers will be S = 1(1 + 0)∗0. The conditional density of S in L gives us the density of the odd numbers in all numbers, which is 1 as one would expect.
In the example above, the language L has a positive density in the full language.
Example 1.2 If L = (a + bb)∗ and S = a(a + bb)∗, then we get d(L)= 0 and

d(S|L)= √5−1 .
In our paper, we focus on the problem of deciding if, for given regular languages S ⊂ L such that L contains words of almost every length, a density of S in L exists, and – in positive case – whether it is positive. The assump- tion that S ⊂ L is not essential, since regular languages are closed under intersection.

Preliminary definitions
Let Σ be a finite fixed alphabet and let ε denote the empty word. For any language L ⊂ Σ∗ let L(n) denote a number of words from L of length n. We will say that a language S has a (positive) density in a bigger language L ⊃ S whenever the limn→∞ S(n) exists (and is positive). We will consider the situation where both languages are regular.
Definition 2.1 A complex analytic function l(x) is a generating function of the length distribution of L (a generating function for L), if l(x)=  n∞=0 L(n)· xn for every x for which this series converges. The radius of convergence of
n∞=0 L(n) · x is denoted by λL.
Let us note that λL ≥   1  , since L ⊂ Σ∗.
Definition 2.2 A deterministic ﬁnite automaton (DFA) is a tuple (Q, E, i, T ), where Q is a ﬁnite set of states, E : Q × Σ → Q is a transition function (can

be considered as a set of labeled edges), i ∈ Q is a distinguished initial state and T ⊂ Q is a set of terminal states.
The function E can be extended in an unambiguous way to a function from
Q × Σ∗ such that
E(q, x · ω)= E(E(q, x), ω) for q ∈ Q, x ∈ Σ, ω ∈ Σ∗
E(q, ε)= q for q ∈ Q.
The language accepted (recognized) by DFA A (denoted by L(A)) is a set of all words ω such that E(i, ω) ∈ T . In other words, it is a set of words determined by all paths from i to T in the graph (Q, E).
Definition 2.3 A language L ⊂ Σ∗ is regular if and only if there exists a DFA A, such that L = L(A).
Our approach to computing conditional densities is based on generating func- tions. An introduction to the generating functions theory can be found in [6]. All the functions that we consider are complex functions of one complex variable. A function is rational, if it is a quotient of polynomials with integral coefficients. The proposition below is well-known (see [4], [3]).
Proposition 2.4 Generating functions for regular languages are rational.
Let us note that the poles of a rational function are the roots of its de- nominator (we will always assume that the denominator of a rational function has no common roots with its numerator). A pole has multiplicity k, if it isa root of multiplicity k of the denominator.
It is easy to observe, that for every regular language L the radius of con- vergence of the series  n∞=0 L(n) · xn is equal to the least positive real pole of its (rational) generating function.
It is not true that every rational function is a generating function for some regular language. We will cite a characterization of such functions according to [4], which is based on the localization of their poles.
Definition 2.5 A rational function has a dominating root if it is a polynomial or if it has a real positive pole which is strictly smaller than modulus of any other pole.
Definition 2.6 For a positive integer k a rational function has k-dominating root if has a real positive pole of multiplicity k, and any other pole has strictly greater modulus or equal modulus but strictly smaller multiplicity.
The theorem of Soittola (see [4]) characterizes rational functions which are generating functions for regular languages.
Theorem 2.7 (Soittola) A rational function f is a generating function for

some regular language if and only if one of the following cases holds:
f has a dominating root
there exist an integer ν > 1 and rational functions f0, .., fν−1 with domi- nating roots such that
ν−1
f (x)=	xi · fi(xν).
i=0
In the following sections we measure the density of a regular language S in a regular language L. Without loss of generality we assume that S ⊂ L ⊂ Σ∗.

A density in the full language
In this section we assume that the set Σ has two elements. Let us start with a simple case when the bigger language is Σ∗. Its generating function is  1 

and it has exactly one pole in 1.
Let S ⊂ Σ∗ be regular and let s(x)= ps(x)
s
1−2x

be the generating function for

S.
Suppose that λS (the radius of convergence of series of length distribution

of S) is strictly greater than 1. It means that the series Σ∞
S(n)
converges

and we obtain
2

lim
n→∞

S(n)
2n	= 0.
n=0 2n

Assume that λS = 1. The function s(x) can not have a pole of multiplicity greater than 1 on the circle of radius 1, since this would imply that S(n) > 2n for sufficiently large n (compare Section 5). We consider two cases.
Suppose first, that s(x) has a single pole of multiplicity 1 in 1. Thus s(x)

decomposes as follows:
s(x)=   Qs	 + p¯s(x) ,

1 − 2x	q¯s(x)
where p¯s(x) is bounded in the closed disc |x|≤ 1 . It implies that

q¯s(x)
2
S(n)= Qs2n + o(2n)

and that the density of the language S is equal to Qs. Let us note that Qs can be also determined by computing

lim
x→ 1
s(x)


 1  1−2x
1
= s¯(  ), 2

where s¯ is obtained by eliminating the factor 1 − 2x from the denominator of
s.

In the second case s(x) has many poles of multiplicity 1 on the radius

of 1. We will show that S(n)
diverges. Soittolla’s theorem provides us with

2	2n
s0, .., sν−1 with dominating roots and such that
ν−1
(1)	s(x)=	si(xν) · xi.
i=0
Let us assume, for a contradiction, that S has a density. Then
(2)	S(n)= QS2n + o(2n).
Therefore for each i = 0, .., ν − 1 we have

(3)
lim
Si(k) = Q .

k→∞ 2k·ν+i
We can deduce that each si(y) factorizes as
	Qi	
s (y)=	+ v (y),
i	1 − 2ν · y	i

where vi(y) is bounded for y ≤  1
not have dominating root). Then
(if vi(y) were not bounded than si(y) would


and from (2) we obtain Therefore
S(k · ν + i)= Qi · 2k·ν + o(2k·ν+i) Qi = QS · 2i.
QS · 2i
si(y)= 1 − 2ν · y + vi(y)

and substituting to (1) we obtain
ν−1


ν−1	i

i
i=0

i=0
Σν−1(2x)i



ν−1

1 − (2x)ν	i


  QS	
=	+ v(x),
1 − 2x

has at most one pole on the radius 1, contradiction.
We can summarize the above observations in the following proposition:
Proposition 3.1 If s(x) is a generating function for some regular language
S over a binary alphabet, then exactly one of the following is true:

s(x) has no poles on the radius 1
and the density of S is 0;

s(x) has a pole in 1 , and no other pole in the closed disc of the radius of
2 and S has a positive density equal to limx→ 1 s(x) · (1 − 2x);

s(x) has more than one pole on the radius of 1
and S has no density.

Let us note that the proposition above solves a problem of finding a condi- tional density if the bigger language has a positive density in the full language.

A language L has a dominating root
Let us assume that the bigger language L has a dominating root. As usual, let λL denote the radius of convergence of the series of the length distribution of L. This case is very similar to the one tackled in Section 3.
Proposition 4.1 Let L be a regular language, l(x) be a generating function for L with dominating root λL. Let S ⊂ L be a regular language and s(x) a generating function for S. Exactly one of the following is true:
s(x) has no poles on the radius λL and the density of S in L is 0;
s(x) has a pole in λL, and no other pole in the closed disc of radius λL
and S has a positive density in L equal to limx→λ s(x);
s(x) has more than one pole on the radius of λL and S has no density in
L.
Proof. The cases (i) and (iii) are analogous to the cases form Proposition 3.1 (substituting 1 with λL).
In the case (ii) s(x) decomposes as:
s(x)= 	QS	 + p¯s(x) ,
1 − λL−1x	q¯s(x)
where p¯s(x) is bounded for |x|≤ λL. Analogously
l(x)= 	QL	 + p¯l(x) .


We immediately obtain
1 − λL−1x	q¯l(x)

S(n)= QS · λn + o(λn).
L	L
Finally
L(n)= QL · λn + o(λn).

Therefore
L	L

d(S|L)= QS
QL



and

  ęS	 + p¯s(x)

−1	p¯s(x)

lim
s(x)


= lim
−1
1−λL x
q¯s(x)
= lim
QS + (1 − λL x) · q¯ (x)	S
=	.

x→λL  l(x)
x→λL
  ęL	 + p¯l(x)
x→λL Q
+ (1 − λ−1x) · p¯l(x)	QL

−1
1−λL x
q¯l(x)
L	L	q¯l(x)

The last equality holds since
p¯l(x) and p¯s(x) are bounded for |x| < λL.	 

q¯l(x)	q¯s(x)

A language L has k-dominating root
Let L be a regular language and l(x) be a (rational) generating function for
L. Let us assume that l(x) has a k-dominating root λL. We know that λL is a root of the denominator of multiplicity k, therefore

l(x)= 
C


(λL − x)k
C · λ−k
+ v(x)=	L	 + v(x),
(1 − λL−1 · x)k

k
where limx→λL v(x)·(λL−x)  = 0 (i.e. v(x) does not have a pole of multiplicity
k on the radius λL). Hence

(4)
∞
k
L
n=0
n + k − 1	n		n L
k − 1

C · λ−k
=
(k − 1)!
∞


n=0
nk−1


n L

· xn +
Σn=0
w(n)


n L

· xn

+ v(x),

where w(n) is a polynomial of degree strictly smaller than k − 1. Therefore

nk−1

−n	k−1

(5)
where QL =



C· −k


(k−1)!
L(n)= QL
n  + o(λL  · n	),
L

Proposition 5.1 Fix arbitrary regular languages S ⊂ L. If the generating function for L has a k-dominating root, then one of the following is true:
the radius of convergence of s(x) is strictly greater than the radius of convergence of l(x) and the density of S in L is 0;
both radia are equal, but s(x) does not have a pole of multiplicity k on the radius λL and the density of S in L is 0.
both radia are equal, and s has k-dominating root and S has a positive density in L;
s has many poles of multiplicity k on the radius λL and S does not have

a density (i.e. the sequence S(n)
diverges).

Proof. The case (i) is analogous to the case (i) from Proposition 4.1 . In the case ii, when s(x) does not have a pole on the radius λL of multiplicity k, we

'	'	'
nk−2	−n

can find S
such that S (n) ≥ S(n) (for all n) and S (n) = QS'
n  + o(λL  ·
L

nk−2). Hence the density of L in S is 0.
Let us consider case (iii) when s has a dominating root of multiplicity k
which is equal to the L’s dominating root. Analogously to (5) we have

nk−1

−n	k−1

S(n)= QS
n  + o(λL  · n	)
L

and therefore the sequence S(n)
converges to ęS .
L

In the case (iv) when s has many roots of multiplicity k on the radius λ, we
will show that the sequence S(n) diverges. Let us assume, for a contradiction, that there exists QS such that

(6)
lim
S(n) = QS .


It means that
n→∞ L(n)

nk−1
QL



k−1	−n

(7)
S(n)= QS ·
n  + o(n
L
· λL  ).

According to Soittola’s Theorem (2.7) there are functions s0, .., sν−1 such that
ν−1
s(x)=	si(xν ) · xi
i=0
and each si(x) has exactly one pole on its radius of convergence.  If some

function si(x) does not have a pole in λν , it would mean that S(n)
diverges

L	L(n)
(because at least one has a pole in λν ). If all radia are greater than λν , then
L	L
the function s(x) does not have a pole in λL.
Let us assume that the all the radia are equal to λν . Therefore, analogously

to (4), we obtain

s (xν)= 	Si	 + v (xν)

i	(λν − xν )k	i

	Si	
= (k − 1)! · λν·k (
Σn=0
nk−1 λn·ν

· xn·ν
+
n=0
wi(n) λn·ν

· xn·ν
)+ vi(xν),

where wi is a polynomial of degree strictly smaller than k − 1, and Si is a nonnegative real number. Then

i	ν	Si
 Σ∞


nk−1



n·ν+i	Σ
wi(n)




n·ν+i	ν	i



Si · λi
= (k − 1)! · λν·k · νk−1
∞


n=0
(νn)k−1


λn·ν+i

xn·ν+i +
Σn=0
wi(n) λn·ν+i

xn·ν+i
+ vi(xν ) · xi

for some polynomial wi(n)= wi(n) · νk−1. Hence, because (ν · n)k−1 = (ν · n + i)k−1 − vi(n) for some polynomial vi such that deg(vi) < k − 1, the following equality holds:


Si · λi


(k − 1)! · λν·k · νk−1


∞


n=0
xi · si(xν)= (νn + i)k−1 n·ν+i
L


Σn=0


wi(n) λn·ν+i



xn·ν+i


+ vi(xν),

where wi(n)= wi(n) · νk−1 − vi(n) and hence its degree is strictly smaller than
k − 1. Therefore



	Si · λi
·
S(ν · n + i)= (ν · n + i)k−1
+ o(λ	· (ν · n + i)	).

(k − 1)! · λν·k · νk−1
Comparing to (7) we obtain

λn·ν+i	L

(8)	Si = QS · λν·k−i · νk−1 · (k − 1)!
Since every si(x) has a dominating root, we have
ν−1
s(x)=	xi ·	+ v(x),
(λν − xν )k
i=0	L
where v(x) does not have a pole of multiplicity k on the radius λ and its radius of convergence is not smaller than λ. Then, from (8), we have

s(x)= QS · λν·(k−1) · νk−1 · (k − 1)! ·
ν−1

i=0
xi · λν−i


(λν − xν )k

+ v(x)

= Q  · λν·(k−1) · νk−1 · (k − 1)! ·   λL	 ·	1
+ v(x),

L − x	(λν − xν )k−1
which shows that there is exactly one pole of multiplicity k on the radius λL, a contradiction.	 

L has many poles of multiplicity k on the radius of convergence
Let us consider the case when L has many poles of maximal multiplicity (denoted by k) on its radius of convergence λL. Let l0, .., lν−1 be functions



with dominating roots such that


ν−1

l(x)=	xi · li(xν).
i=0
For a regular language S ⊂ L, we decompose s(x) to functions s0, .., sν−1 such that:
ν−1
s(x)=	xi · si(xν).
i=0
For each function li we decide whether Li(n) converges according to the result
i
of previous sections. This is a necessary condition for the language S to have
a density in L. If this condition holds following situations can occur:

every Si(n)
i
converges to 0 and then d(S|L)=0 

there exist i, j such that limn
Si(n)
→∞ Li(n)
= 0 and lim
Sj(n)
n∈N Lj (n)
/=0 - in this

case there S has no density in L
for all i limn∈N Li(n) /= 0.
The cases (i) and (ii) are trivial. In the third case we have to compare the
limits limn∈N Li(n) (which will be called partial densities). S has a density in
L if all the limits are equal.

Decidability
We present a procedure of deciding whether a regular generating function has a dominating root of multiplicity 1. The theorem below is a consequence of the Tarski theorem [5] on the quantifier elimination in the ordered field of real numbers.
Theorem 7.1 The ﬁrst order theory of the ordered ﬁeld of real numbers is decidable.
Let f (x)= p(x) be the generating function for some regular language (p(x) and q(x) are polynomials with rational coefficients). We can assume that the polynomials p(x) and q(x) have no common roots. Roots of q(x) are poles of f . The function f has a dominating root of multiplicity 1 if and only if q has a real positive root which is strictly smaller than the modulus of every other root. That can be formulated in the first order language over the field of complex numbers in the following way:
Ex(q(x)= 0 Λ q'(x) /=0 Λ 6y((q(y)=0 Λ |y|≤ |x|) ⇒ y = x)).

Theorem 2.7 guarantees that such x is a real number. The problem whether the above formula is true for the polynomial q is decidable by the Tarski theorem (we can translate the formula above to an equivalent formula over the reals).

Analogously, for the function f (x) = p(x)
the property of having a domi-

nating root of multiplicity d can be formulated as follows:
Ex[q(x)= 0 Λ q'(x)= 0 Λ .. Λ q(d) /= 0Λ
Λ6y((q(x)= 0 Λ q'(x)= 0 Λ .. Λ q(d) /=0 Λ |y|≤ |x|) ⇒ y = x)].
Since the multiplicity of a dominating root is bounded by a degree of the polynomial q(x), the property of having dominating root of any multiplicity is decidable, and in the positive case it is possible to find that multiplicity. Let us note that for two functions with dominating roots of the same multiplicity it is possible to write a formula which compares those roots.
Using the methods sketched above we can distinguish all the cases from propositions 3.1, 4.1, 5.1 and the cases (i) and (ii) from Section 6. In the remaining case (iii) in Section 6 we have to compare partial limits to decide whether the language S has a density in L. We present a procedure of com- paring partial limits that answers this question.
Given two pairs of rational functions with dominating roots (l1, s1), (l2, s2),

we have to check whether lim
L1(n)
n→∞ S1(n)
L2(n) . Without loss of gen-

erality we can assume that both limits are not 0. Let l1(x) =
ps(x)
	pl (x)
ql (x)(λ1−x)k1

(respectively s (x)= 	1	 ) such that k is multiplicity of the dominat-
1	qs(x)(λ1−x)k1	1

ing root λ1 of l1. Let us note that
L1(n)
l1(x)
ps(λ1) · ql (λ1)

lim
n→∞ S1(n)
= lim
x→λ1 s1(x)
=  1	1	
pl (λ1) · qs(λ1)

and the function g (x) = ps (x)·ql (x)
can be computed by eliminating com-

1	pl (x)·qs(x)
mon roots from the numerator and the denominator of s1(x) . Let l (x) =

pl (x)
ps(x)
l1(x)	2

	2	
ql (x)(λ2−x)k2
(resp. g1(x) = 	2	 ). Analogously we compute the ratio-
qs(x)(λ2−x)k2

nal function g2(x) for (l2, s2). We can define an equality of partial densities
as:
Eλ1 Eλ2 : [λ1 is a dominating root of multiplicity k1 of l1 Λ
λ2 is a dominating root of multiplicity k2 of l2 Λ
g1(λ1)= g2(λ2)].
So that equality of all partial densities is decidable as well.

As a result we can distinguish all the cases of the classification described in Sections 4-6 and hence
Theorem 7.2 It is decidable whether, given two regular languages S ⊂ L, S
has a density in L, and in positive case whether that density is 0.

Complexity
We assume that languages are given by DFAs. The procedure sketched above can be easily improved to have a complexity of verifying validity of a first order formula in the ordered field of real numbers. Best known algorithms for that problem work in a double exponential time. However, using simpler methods (like the Sturm series) we can solve simple cases (i.e. all except the one when L has many poles of maximal multiplicity on the radius of convergence) in a polynomial time.

Balanced densities
In the definitions above we use length to measure the complexity of words. We can generalize it by adding a weight to each letter. Let Σ = {a, b} and Qa and Qb denote weights of the letters. For each word ω ∈ Σ∗ let |ω|x denote the number of occurrences of a letter x in ω. We define a balanced complexity of the word ω as
cę(ω)= Qa · |ω|a + Qb · |ω|b.
We define a balanced density of L ⊂ Σ∗ as
Card(L ∩ cę−1(n))

dę(L) = lim
n→∞
.
Card(cę−1(n))

It is reasonable to choose weights for the letters in such a way that they have no common divisor, to avoid infinitely many fractions of kind 0. To illustrate that the balanced density can be not equivalent to the density, let us consider the language ((a + b)2)∗, which does not have a density, but when we assign the following weights to the letters Qa = 1, Qb = 2 it has a balanced density 1. The problem of deciding whether a regular language S has a (positive) balanced density in a regular language L is not harder than the one for a density. We can construct languages S' and L' by substituting each occurrence of each letter x in the languages by xęx (languages S' and L' are still regular).
Then we have:
dę(S|L)= d(S'|L').

Conclusions
We proved that the problem whether one regular language has a (positive) density in other regular language is decidable and can be solved in a double exponential time, provided that the languages are given by a deterministic finite automata. That computational complexity is determined by the com- plexity of general procedure of quantifier elimination in the ordered field of real numbers. On the other hand, the formulae that are produced by the algorithm presented in this paper are of the special kind and it seems that a better complexity bound can be obtained. However, we anticipate that in general the problem cannot be solved in polynomial time.
In further work we want to focus on densities of unambiguous context-free languages for which generating functions are algebraic.

References
Berstel J., Sur la densite de langages formels, ICALP, 1972, 345-358.
Bodirsky M., and G¨artner T., and von Oertzen T., and Schwinghammer J., Efficiently Computing the Density of Regular Languages, Proceedings of Latin American INformatics (LATIN’04), 262-270.
Flajolet	P.,	and	R.	Sedgewick,	“Analytic	Combinatorics”,	URL:
http://algo.inria.fr/flajolet/Publications/AnaCombi1to9.pdf.
Salomaa A., and M. Soittola, “Automata: Theoretic Aspects of Formal Power Series”, Springer- Verlag, Berlin, 1978.
Tarski A., A decision method for elementary algebra and geometry, 2nd edition, Univ. Calif. Press, Berkeley, 1951.
Wilf H., “generatingfunctionology”, second edition. New York: Academic Press, 1993.
