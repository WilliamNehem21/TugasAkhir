The engineering of systems that are acceptably correct is a hard problem. On the one hand, semi-formal modelling approaches that are used in practical, large-scale system development, such as the UML, are not amenable to formal analysis and consistency checking. On the other hand, formal modelling and analysis re- quires a level of competence and expertise that is not common in commercial development communities, and formal approaches are not well integrated with the rest of the development process. This paper advocates an approach to building engineering environments (or frameworks) for rigorous model-driven development

Mainstream software engineering uses semi-formal techniques for MDD. 4 These are based on diagrammatic notations, which are used to describe different aspects of systems. It is their graphical nature and their pragmatic approach to development that makes them popular. In fact, semi-formal notations are intuitive and provide easy to read sketches of different aspects of systems. Furthermore, some semi-formal notations, such as UML and entity-relationship diagrams, are de facto modelling idioms among software engineers. However, it is in the details that we find their weaknesses. Semi-Formal notations lack a formal semantics, thus: models are likely to be ambiguous, inconsistent and not amenable to mechanical semantic analysis. The semantics issue is aggravated by the fact that semi-formal notations have many semantic interpretations: the choice of semantics becomes a matter of convenience, developers use one semantics or the other depending on the kind of problem at hand. Moreover, not all properties of systems can be expressed with diagrams; usually, developers resort to textual notations to describe detailed system constraints.

To tackle these problems, in [2] we draw on the ideas of pattern-based devel- opment [10] and problem-driven methods [11] to advocate an approach based on frameworks for rigorous, but practical MDD. Our MDD frameworks are environ- ments for engineers to construct, analyse and refine models of software systems that are designed to address the needs of a specific problem domain. They use diagrams and formal modelling languages, with the diagrams acting as a graphi- cal interface for the formality that lies beneath. The aim is to hide the formality completely, but this is not always possible.

This paper gives an overview of the general approach to build generative frame- works advocated in [2] and the UML + Z framework in particular, also developed in [2]. It illustrates a generative model development with the UML + Z framework, where the Z model is generated from templates of the UML + Z catalogue. The paper shows how published results related to the research reported here can be used in the wider context of the UML + Z framework. In particular, it shows how the language FTL developed in [2,6] can be used to build a catalogue of templates and meta-theorems for UML + Z , how the catalogue can be used to generate a Z model with the object-oriented (OO) style developed in [2,3] by applying UML + Z to a simpler version of the case study developed in [4], and how the resulting UML + Z model can be formally analysed by using the snapshot analysis technique developed in [2,5].

The following starts by giving a brief overview of FTL and its meta-proof ap- proach. Then, it gives an overview of the method proposed to build frameworks in general and the UML + Z framework in particular. Next, it illustrates the UML + Z framework by applying it to a simple problem. Finally, it discusses the results of the research presented here, compares it with related work, and makes the conclusions.

Any formal sentence or sentences of some formal language (here Z) can be rep- resented as templates expressed in FTL. Is it possible to reason (or do proof) with these template representations? If it were possible, that would have substantial practical value. It would mean that reuse could be brought to the level of proofs: meta-theorems for certain templates would be proved once, but could be applicable every time those templates are instantiated. This approach of proof with templates is called meta-proof. First, the practical value of meta-proof is motivated with an example.

The argument outlined in this meta-proof is rigorous and valid, but it is not formal. To follow a formal approach towards meta-proof, a formal semantics has been given to FTL [6]. This allows the definition of proof rules for Z template expressions, which are proved by appeal to the semantics of FTL [6].

In the UML + Z framework [2], there is a Z semantic domain to express OO models [3] so that every diagram of a UML+Z model is represented in this semantic domain. There is also a catalogue of templates and meta-theorems related to model consistency, which capture the structure of the Z semantic domain; every Z sentence of a UML + Z model is generated by instantiating one of the templates of the catalogue. The formal definition of the semantic mapping of UML + Z is left for future work; currently it is performed by hand.

This technique is based on drawing snapshots (object diagrams). A snapshot describe one state of the modelled system. Snapshots can be used in pairs to describe the effects of an operation upon the state of the system: one snapshot describes the before state, the other the after state. The analysis consists of representing snapshots in the Z semantic domain, and then proving, in the Z world, that the snapshot or snapshot pair is satisfied by the model of the system. In the examples used here, these proofs are performed using the Z/Eves theorem prover [16].

The refinement component of UML + Z is left for future work. The aim is to define a strategy to refine UML + Z models, based on the theory of refinement for Z [20], and some example model transformations. The idea is to use FTL to capture refactorings and to explore meta-proof to reduce the proof overhead associated with these refactorings. The process is similar to the one followed in modelling: (a) refactorings and associated correctness conjectures are captured with templates;

This section illustrates the UML + Z framework with a use case of a trivial system to track orders that are placed on products. This use case is a simpler version of the one modelled in [4]. For reasons of space, only illustrative parts of the model are given. Further details about a model for this case study can be found in [4]. First, we build a model of the system, and then we analyse it with snapshots.

The following presents a partial Z model of the ordering system for each view of the OO Z style (structural, intensional, extensional and relational; see [3,2] for fur- ther details). The Z model is generated from templates of the UML + Z catalogue, by instantiating them with information coming from the diagrams and extra infor- mation coming from the user. Appendix B presents the templates used to generate the Z presented here. The templates use Z generics from the UML + Z toolkit (the ones used here are given in Appendix A).

This view defines the system as a whole. The state space and initialisation of the system is generated from template T9. In this case, as there are no global constraints, this is fully generated. There is a schema representing all the system constraints, as there are no global constraints this includes just the association link schema:

Our pattern-based approach, based on FTL and meta-proof, contributes to make formal methods more practical. FTL allows the representation of structural pat- terns, so that they can be reused (or adapted to a context) by instantiation. Meta- Proof allows reasoning at the level of patterns to establish meta-theorems so that the same reasoning effort can be reused. In UML + Z , all Z is generated by template instantiation, and the proof effort associated with consistency-checking is reduced by applying meta-theorems.

Tool support would bring MDD frameworks into full bloom. Currently, tem- plates are instantiated by hand and users need to switch from the UML tools to Z tools. However, we envisage a tool that could automate most of the process, minimising the exposure of developers to Z tools.

Our approach differs from these works in that it is fully formal. Our frameworks are designed to integrate formal and semi-formal modelling languages for the pur- pose of rigorous development. UML + Z for instance is designed for the combined use of UML and Z. Another key feature is that our approach is based on FTL, a formal language to express patterns, which is used to build a catalogue of templates for a a framework. Such a catalogue has been illustrated above in the context of UML + Z .

