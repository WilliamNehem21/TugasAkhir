[2] and, therefore, our approach is to provide an approximation of associativity for up to 3 elements. On the other hand, note that this confusion appears only when two sessions of the protocol are executed at the same time, i.e., the message

Strands communicate between them via the intruder, i.e., by sending a message m to the intruder who will send it back to another strand. When the intruder receives a message, then it learns it, i.e., a message m is learned in a transition

Another important aspect of our framework is that everything the intruder can learn must be learned through strands, i.e., the intruder knows nothing in an initial state. However, this is not a limitation, since we can write strands [ M + ] for any message M the intruder is able to know at an initial state.

Rule Generation. In the rule generation stage, the Maude-NPA looks at the re- maining paths, and generates a new set of grammar rules according to a set of heuristics. We have four heuristics H1,H2a, H2b, H3 that are used according to two global strategies S1 and S2.

(H2b) This heuristic detects also that some partial data might be learned by the intruder and also excludes them from the language. For the narrow- ing step (M1; M2) ~[M1/(X;Y ),M2 /Z],s4 X, (Y ; Z), we introduce the constraint (M1; M2) ((X; Y ); Z), where X, Y, Z are variables of sort Elm. The use of H2a and H2b is explained below.

After the rule generation stage, the Maude-NPA reiterates the three stages until either all paths are eliminated in the rule verification stage, in which case it has successfully defined a language, or it can define no new language rules in the rule generation stage, in which case it has failed to define a language. It can also conceiv- ably fail to terminate adding new rules forever. See [10] for examples of grammars that fail to define a language or fail to terminate.

variable of sort Msg, N is a variable of sort Nonce, and K is a variable representing the intruder knowledge. Note that M , being of sort Msg instead of sort Nonce, is the key fact for the confusion attack, see Footnote 5. The intruder knowledge is essential in the backwards reachability process and thus variable K will be appropriately instantiated; see [10] for details. Our tool is able to find the following initial state of the protocol:

