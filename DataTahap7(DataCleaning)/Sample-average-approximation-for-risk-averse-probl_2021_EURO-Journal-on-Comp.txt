the optimal operation and electricity market involvement of virtual power plants(vpps) is currently an active field of research. vpp refers to an aggregation of distributed energy resources(der) that interacts with the electricity market as a single entity. these ders involve generators with small capacities or that face significant trading risks if operating by themselves. for example, a wind farm trading in an electricity market is subject to uncertain wind speeds, electricity prices, and imbalance costs, which may involve high risk. aggregating multiple and diverse generators into a vpp creates an entity with a single power generation profile and a larger power capacity than the constituting units. a vpp has flexibility due to the complementarity of its diverse resources, and capacity to develop market intelligence to optimize its participation in the electricity market(through offers in the pool and by signing forwards contracts). however, to define a single power output profile, a self-scheduling problem considering all constituting generators, their interactions, and their



the term sample average approximation is used in the literature to refer to a problem that approximates a stochastic optimization one(shapiro and homem-de-mello, 2000), but it is also used to indicate a methodology where the solution of that approximate problem is performed multiple times and increasingly accurate solutions are obtained. the repetition enables the calculation of confidence intervals of the optimal objective function value, and also the assessment of the solution.



the detailed characterization and statistical properties of the saa methodology, namely consistency and rates of convergence to optimal objective function values and solution, have been studied by mak et al.(1999), shapiro and homem-de-mello(2000), kleywegt et al.(2001), and reviewed in detail in shapiro(2009) and homem-de mello and bayraksan(2014). in these works, expressions for the convergence to the optimal value and solution are developed and ex2015; moghaddam et al., 2013; tajeddini et al., 2014), robust optimization, and recently, a hybrid approach based on stochastic programming and robust optimization(baringo and baringo, 2017).



more complex to solve than risk-neutral stochastic programming; therefore, the impact of the sample size and the length of the time horizon on the computing time of risk-averse problems are comparatively more critical. some works propose an out-of-sample analysis that provides an additional characterization of the solution resulting from the stochastic programming model(baringo and baringo, 2017). compared to an out-of-sample analysis that performs a study for a single solution, the saa methodology includes a first stage with multiple optimization replications using different samples to generate alternative solutions and to provide a point estimate of the upper bound on the true objective function value(for a maximization problem). the work



an saa methodology to solve these problems that is based on methods from linderoth et al.(2006). specifically, a distinct class of risk-averse problems from those considered in linderoth et al.(2006) is addressed, and thus, insights that are not found in linderoth et al.(2006) and verweij et al.(2003) are analyzed and discussed.



the paper is organized as follows. in section 2, the problem statement and a description of the vpp studied are presented. the stochastic models with a focus on the objective functions are described in section 3. the saa approach and the implementation of two solution procedures are presented in section 4, while the sampling techniques are shown in section 5. the computational results are discussed in section 6 and conclusions are summarized in section 7. in a supplementary document, appendices with the deterministic model of the vpp, flow diagrams of the solution procedures used, and additional extensive computational results are made available.



and sold in each period; and c) the electricity bought or sold through contracts. from the decision-maker perspective, the optimal first-stage variables are the most relevant. these decisions are implemented and fixed during the time horizon, whereas the optimal second-stage variables for the 168 periods represent recourse actions based on the realizations of the uncertain parameters. in practice, during the week, the vpp needs to solve additional decision problems to define the bidding strategy for the specific electricity market pool(day-ahead market, intra-day market, balancing market). these problems have a shorter horizon and use updated information for wind speed and electricity prices.



the thermal unit has lower and upper bounds on the power generation, minimum up-time and down-time, start-up and shutdown and power-up and power-down ramp rate limits. regarding costs, this unit has fixed and variable generation costs, hot and cold start costs. the state of the thermal unit before the beginning of the time horizon is known. the hydro plant has lower and upper limits on the volume of water of the upper reservoir, and an upper bound on the pumped flow of water.



in this section, the main characteristics of the risk-averse stochastic programming formulations for the vpp problem are described. the deterministic version of the vpp optimization problem is described in appendix a, where the objective function, constraints, variables, and input data are presented. below, we focus on building a general riskaverse stochastic programming formulation that will be used in the saa methodology outlined in section 4.



rences. these results do not support a clear-cut decision on the best solution to choose. obviously, the variance of these results is due to the size of the sample used for the optimization. however, with a small sample and the methodologies presented in this work, it is possible to provide a set of inference statistics and to assess the solutions. this information can help the selection of first-stage solutions.



and bound estimation stage. in line 3 of procedures 1 and 2, a riskneutral or a risk-averse stochastic programming problem is solved. each of these problems can be solved directly using an milp solver or by decomposition. we adopt the latter and use the l-shaped method proposed in the seminal work of van slyke and wets(1969). this choice



the initialization mentioned in line 2 is active from the first replication. the initialization step entails that in the first iteration of the l-shaped method, the best first-stage solution is assigned to the first-stage solution, instead of finding a solution using the master problem. with this initialization step, the initial lower bound of the l-shaped method, calculated after solving the lp subproblems, is generally better than the one calculated using the solution of the master problem in the first iteration. note that the corresponding computational gain is multiplied by the number of optimization replications.



4.4 are evaluated using the first-stage solutions and the objective function values obtained from the optimization stage. in procedure 1, the lower bound estimation is computationally more demanding than the upper bound estimation. therefore, we implement another important time saving strategy: the lower bound estimation is only carried out for



we generate the samples for the electricity prices from an arima model that is fitted to an electricity price time series. specifically, the samples are drawn by sampling the error term of the arima model; see conejo et al.(2010) for a discussion on this type of approach. specific details for the data used are given in section 6.1.1.



the first and second objectives above are related to the first contribution of this work and the third and fourth objectives to the second contribution. in terms of the organization of the results, we discuss the computational performance of procedure 1 in section in 6.2, the objective function values in section 6.3, the first-stage solutions in section 6.4, and the maximum gaps obtained in section 6.5.



the raw data for the wind speed for a specific wind farm location consists of a wind speed ensemble with 51 members obtained from the european centre for medium range weather forecasts(ecmwf). we use the wind speed ensemble and the kle to generate additional samples of the wind speed for the saa methodology. the electricity prices are considered independent of the wind speed available at the location of the considered vpp, due to the small capacity of the vpp in each case study, which has no market power to influence the electricity prices.



imum number of iterations of 5000. note that this gap is related to the bounds on the objective function value within the l-shaped method for a given sample. these bounds are not related to the bounds described in sections 4.2 and 4.3.



a workstation with 40 intel xeon cpu e5-2680 v2@ 2.80 ghz processors, and 125.8 gb of ram was used and the solution of the lp subproblems was distributed among the 40 cpus. the milp and lp problems were solved with cplex 12.7.1.0 using the gams/grid/guss capabilities to distribute the solution of the lp subproblems.



we adopt the l-shaped variant that provided the best performance in lima et al.(2018), i.e., algorithm 1, which corresponds to using a single optimality cut for each of the expectation and cvar operators and calculating var based on the solution of the subproblems, rather than solution over the replications, and thus, one solution from one replication is not necessarily a good initial solution for another replication. for the remaining risk metrics, there is convergence for the first-stage variables, and therefore, the initialization has a positive impact on computing time. this is further discussed in section 6.2.4.



of the thermal plant; see also additional results available in the supplementary document. this difference suggests that the thermal plant is prone to shutdown and startup to follow the lowest electricity price observation. the samples with more elements have a higher likelihood of lower electricity prices, which from one sample to the other may occur at different hours of the week. therefore, distinct first-stage solutions emerge among the optimization replications.



future work can evolve in two directions: 1) a comparison between risk-averse stochastic programming and robust optimization; and 2) the study of alternative risk metrics. regarding the comparison, the firststage solutions and point estimates of the expected profit and the cvar of the profit obtained in this work can be contrasted with the solutions from a robust optimization approach. additionally, it would be relevant to explore alternative risk metrics, such as stochastic dominance(escudero and monge, 2018), and to assess the quality of the solutions and the overall saa methodology performance with alternative risk metrics.



