food crop production faces impending challenges in feeding the global population, including increasing population, reduction in agricul- tural inputs, and global climate change. these challenges have led to global problems in food security. around 85 million more people were facing a severe food crisis in 2021 compared to what was reported in 2016, which resulted in around 193 million people facing severe hunger across 36 countries (fao, 2022). this crisis has been worsened recently both by human made and natural phenomena such as domestic food price inflation, war and pandemic (fao, 2022; world bank group, 2022; un world food programme, 2022; kakaei et al., 2022). to address this problem, we need to produce more food with the limited resources available by creating improved varieties of crops that can perform well in different environments.



a genotype of a crop organism is its complete set of genetic makeup that influence its traits. however, a genotype often refers to genes that have different alleles. thus to avoid confusion, we will refer genotypes as lines in the rest of the article. to create a new variety from lines with improved traits, we need to consider a line's genetics and its inter- action with the environment where it is sown (washburn et al., 2021; lin et al., 2020). this phenomenon is known as genotype by environ- ment interaction (gxe), which refers to the fact that even if a variety produces the desired values of quantitative traits in one environment, it may not provide us with the same outcome in another environment (lenz et al., 2017). thus, any tools that are developed to aid in crop breeding need to replicate the impact of gxe within the model by incor- porating genetic and environmental information. in this work, we aim to build such computational tools that estimate a trait even before sow- ing the crop.



et al., 2019). the main building blocks of deep learning models are arti- ficial neural networks, such as fully connected neural networks (linear layers), recurrent neural networks and convolutional neural networks. each deep learning model has at least one input layer, more than two hidden layers of neural networks and an output layer. the input and output of the neural networks are the neurons, where the input layer neurons are the input features such as genetic marker data or environ- ment variables. the input to the hidden neural networks are the features from the previous layer and produce a learned feature repre- sentation as the output by applying some functions, based on the type of employed neural network. finally, the output layer takes the output of the last hidden layer as the input and employs the neural network functions to make the final prediction. in this work, all our proposed frameworks employ fully connected neural networks where each neu- ron in a hidden layer is the linear function of all neurons of the previous layer. thus each neuron of the current layer represents summarized in- formation of all previous neurons.



the weather data for each site-year is collected from the cimmyt dataverse from 1990 to 2018 containing all locations of international wheat improvement network (iwin). the weather data contains 769 locations along with nine weather variables of each location such as the hourly average amount of precipitation, maximum relative humid- ity, minimum relative humidity, shortwave radiation (mj/m2/d), max- imum and minimum temperature (c), maximum vapour pressure deficit (kpa), 2 m wind speed (m/s) and 10 m wind speed (m/s). although the sowing date of crops are recorded in entirety, there are many missing values for when the crops are harvested; hence, we con- sider nine months of environmental data as the input to the machine learning model. the nine months period starts at least two months before the sowing date to capture the environmental effect on the soil before sowing (as the sowing date is available), and the following seven months are considered as the growing season. a monthly average of all the weather variables for each of the nine months variety of information. data also differs from trial cycle to trial cycle. this data contains information such as how much and which fertilizer is applied, disease development information, number of irrigations be- fore sowing, moisture available before sowing, major weed species, soil aluminum toxicity and many more. though our aim was to collect information before sowing, we are unable to verify that all the informa- tion in this data is taken before sowing.



for each previously created partitions, we also randomly sample some locations with 85% probability that the location will be in the training set and 15% probability that the location is in the test set. in this scenario, if the location is in the test set, we did not include any of the site-year data for that location in the training set or validation set. although most of the lines in the test set were sown in other site- years, the training set also does not contain the 15% lines separated for testing in the previous step. thus there may be some lines in the test set that are not present in the training data. as the model did not observe the test locations in training data, we will refer this test case as environment unobserved scenario or test scenario two. finally, the training-test partitioning strategy creates two test scenarios for each partition: i) no lines in the training set are also in the test set, but the test set and training set may contain different lines grown in the same environment, and ii) the training data and the test data do not contain any locations in common, but the training set may contain information on how some lines performed in other site-years.



research shows that some markers contribute towards yield irre- spective of the environment (lenz et al., 2017). also, some specific markers contribute more in a specific condition. for instance, lenz et al. (lenz et al., 2017) demonstrated that selecting the top 250 previ- ously known important markers of black spruce results in the same correlation coefficient score obtained by randomly selecting 4993 markers. they also observed that selecting fewer than 500 markers randomly decreases the correlation score between the predicted traits and the true traits. when the important markers are not known, previous research shows that feature selection methods were able to identify biologically and statistically significant markers for yield prediction (jubair et al., 2021). thus by applying feature selection, we aim to identify important markers irrespective of any environment (global marker set) as well as markers that play an essential role in a specific condition (local marker set).



in our proposed architecture, we first learn representations of geno- typed data and environmental variables separately. these two models are optimized to predict the average yield over environments and geno- types, respectively. we then concatenate these two representations and predict the environment-specific yield for a specific line assuming that markers and environments work as two groups and one group has an effect on another group for environment specific yield prediction of each line.



ii) optimized for predicting average yield over all lines for an environ- ment (environment-specific average yield). the first step for predicting line-specific average yield is to identify the global marker set by apply- ing the procedure described in section 2.4. after obtaining the global marker set, a neural network model is trained with this marker set as features to predict the line-specific average yield. the last layer before



the input to the second representation learning model optimized for predicting environment-specific average yield is nine months of envi- ronmental variables for each site-year. this model produces a represen- tation of a 54-dimensional vector for each input for the environmental variables. after training and testing these two models, for each site- year, the representation vectors of these two models are concatenated, which serve as the input to the deep regression model that predicts yield for each site-year. this framework will be referred to as f2. now, we describe the architecture of each of the models of f2 individually.



model (rezayi et al., 2022) is employed to obtain a representation of soil and environment-related text. a 768-dimensional representation is obtained for all texts and then an average representation is calculated for each site-year. the length of all individual notes are <256 tokens. as the maximum length of texts of the agribert model is 512 tokens, it can obtain the representation of the full note. this 768-dimensional vector is also concatenated with the output of two representation learning models and provided as the input to the shallow model.



we experimented with three deep learning models in deep learning framework 1 (f1m1, f1m2 and f1m3), where these models differ pri- marily on how the environment and genotype interactions are cap- tured within the model. in the f1m1, the assumption was that all genomic and environmental factors interact with each other at the same time. on the other hand, in the f1m2, the assumption is that each marker separately interacts with the environment first, and the resulting outcome then affects yield. finally, in the f1m3, the re- lationship between markers is first taken into account, and then the environment interacts with the combined marker relationship to es- timate yield.



before sowing crops. in the third month, maximum vapour pressure contributes more than any other environmental variables for predicting average yield. we observe this trend for maximum vapour pressure for the rest of the months of the growing cycle except the fifth month, where shortwave radiation contributes more than the vapour pressure. the effect of shortwave radiation increases significantly in the fourth and fifth months, and then goes down gradually. in the third month, the importance of precipitation and maximum vapour pressure in- creases as we enter the months when seeds are sown. the maximum temperature has a continuous positive effect from the fifth month to the end of the growing cycle. both wind speed variables have little to no impact from the third month to the end.



on the other hand, only 6.2% observations (6961 observations) are from hrwyt nurseries, where the crop gets rainfall during the cropping cycle. since the environmental condition of the wycyt nursery is mixed, we can not verify the amount of rainfall those nurseries received. however, wycyt nurseries are only contributing to about 3.8% of the data.



predicting line specific average yield and environment specific average yield and then combines these two representations to estimate environment-specific yield for a specific line, is slightly better than the others. this framework shows 1.95 to 1.75 times better performance, depending on the test scenario, than some existing deep learning models. later, we extend the f2 framework by integrating text data from field notes.



in this dataset, we do not have any information on the soil. as some research shows that soil plays a vital role in yield (washburn et al., 2021), adding soil information to the model may help estimate yield more accurately. we showed that our f2 framework could easily be ex- tended by adding new information as we extended the f2 framework by adding field notes. while devising these frameworks, we assumed that the weather of the growing season can be predicted ahead of time. thus our models focus on only estimating the traits of the crops by using a representation of the weather during the growing season. fu- ture work should incorporate weather prediction for the growing sea- son from historical weather. while obtaining the representation of the weather variable, the input to the model was the monthly average of weather variables. future work should also try to determine the effect of incorporating weekly or daily weather variables as the input to the model.



finally, our f2 framework performs well in two test scenarios where the first test scenario is more straightforward to predict than the second one. in the first test scenario, we predicted yield in a scenario where en- vironments are observed, but lines are not observed in any of the envi- ronments during the training of the model. in the second scenario, locations in test sets are not observed but the model may observe lines during training. all the models have better performance in the first test scenario compared to the second one. the result is understand- able as the attribution score obtained by employing deeplift shows that weather variables play a significant role in estimating yield.



