[34] is a data preparation package developed as part of the melloddy project. its main features are: (i) smiles standardization based on rd- kit v2020.09.1.0 [35]; (ii) binary molecular fingerprint calculation (in this work extended-connectivity fingerprints; ecfp6, folded to 32k bits)



[36] through the getmorganfingerprint function in rdkit; (iii) replicate aggregation according to assay type; (iv) filtering of tasks that do not meet the task size or fold distribution quora for inclusion in training and evaluation datasets; (v) splitting of the dataset in folds according to a se- lected folding scheme, in this case based on the scaffold network [37] as implemented in rdkit [38]. this approach enables different partners in the federated learning exercise to assign compounds to folds consistently without having to exchange any sensitive structural information [39]. five folds were created, out of which three were used for training, one for validation, and one as test fold. to avoid possible bias in evaluation, acyclic and phenylic compounds were assigned to the training set; (vi) binarization of the activity values and addition of auxiliary tasks with shifted thresholds compared to the main task of interest, while still al- lowing for user-defined expert values. from any single assay, at most five tasks were derived by varying the threshold resulting in different class balances. to avoid any dominance of assays with a higher number of derived tasks during training, melloddy-tuner produces a task weighting file for further machine learning which assigns 1/n weights to all tasks, with n being the number of derived tasks from that assay [40]. full details on the data preparation are described elsewhere [20].



els was through grid search with different hyperparameters, such as a higher network size to accommodate the increase of data compared to the single-partner setting. for both the single-partner and multipartner models, the same datafiles outputted by melloddy-tuner were used. the network architecture was a feedforward multilayer perceptron us- ing sparsechem v0.8.2 [41] and minimizing the binary cross entropy as loss function through stochastic gradient descent. the implementation on the federated platform is described elsewhere [21]. the test set was partitioned into two subsets of distinct scaffolds and comparable size, with one of the two selected as calibration set, and the other as evalu- ation set. platt scaling [42] was performed in a post-processing step by fitting a logistic regression, as implemented in scikit-learn [43], to the logits and true labels. predictive probabilities p(y|x) were transformed to predictive information entropies h by:



a size quorum of minimally 25 actives and inactives in the calibration set was imposed. for phase 1 models this corresponded to the valida- tion fold, while for phase 2 models this corresponded to approximately half of the test fold. in addition, tasks meeting this quorum but failing to achieve an auc roc of 0.6 or higher on the calibration set were dropped from the analysis. only tasks of main interest were consid- ered. any auxiliary tasks, including those resulting from thresholding



multipartner and single-partner model is associated with uncertainty reduction. inductive mondrian cp is applied, where the prediction for each class is estimated separately using an individual calibration set per class [26,30,44,45]. the code is based on an implementation from toccaceli [46].



while there may be some degree of overlap with the internal mel- loddy datasets for these unlabeled datasets (e.g., publicly available compounds may be part of the internal library or may even belong to the training or validation set), this was not expected to contribute signif- icantly to the results due to the small overlap expected between public and proprietary datasets and the sparsity of the labeled activity ma- trix (far below 1%). indeed, predictions on the unlabeled datasets are dense, i.e. across all tasks, while the predictions on the labeled datasets are sparse, since a prediction is only generated where there is an ac- tual label available. the degree of identical overlap of the unlabeled datasets with the internal melloddy datasets in the 32k bit descriptor space was investigated by three pharma partners, and the findings were in line with expectations: (i) the fda-approved small-molecule drugs were clearly most highly overlapping with the internal library, suppos- edly due to their use as reference compounds; (ii) the virtual libraries (scubidoo, drugspacex) had very low overlap (but nonzero); and (iii) the other external datasets were in-between these two extremes.



both labeled and unlabeled space, reflecting higher uncertainty. it then dropped sharply with increasing layer sizes, indicating very low uncer- tainty. regarding the training set size, larger training sets presumably extend the chemical space covered by the model, resulting in a lower uncertainty on a common test set. however, such an effect was not observed for the uncalibrated entropy. for the largest networks, only the smallest training set of 100 training samples displayed somewhat higher entropy values compared to the other training set sizes. apply- ing calibration to the predictive probabilities through platt scaling did effectively address this overconfidence. also, the platt-scaled entropy favorably did not display a strong dependency on the degree of regular- ization through the hidden layer size, and when more training data was involved, a lower uncertainty is observed, aligned with expectations.



first, the test set can be similar to the training and validation set due to limitations related to splitting an internal dataset into five folds. the underlying idea of the scaffold-based splitting approach is to separate distinct areas of chemical space and to assign them to different folds thus avoiding overconfident predictive performance estimates. while scaffold-network-based splitting achieves far better separation of similar molecules into different folds than random splitting, some structurally very similar compounds might still be assigned to different folds due to not sharing the same scaffold [39]. switching to other splitting schemes such as sphere exclusion clustering was not expected to fundamentally alter the picture based on its limited performance gain over scaffold- network-based splitting [39]. while scaffold-based splitting challenges



bosc n, felix e, arcila r, mendez d, saunders mr, green dvs, ochoada j, shelat aa, martin ej, iyer p, engkvist o, verras a, duffy j, burrows j, gardner jmf, leach ar. maip: a web service for predicting blood-stage malaria inhibitors. j cheminform 2021;13:13. doi:10.1186/s13321-021-00487-2.



