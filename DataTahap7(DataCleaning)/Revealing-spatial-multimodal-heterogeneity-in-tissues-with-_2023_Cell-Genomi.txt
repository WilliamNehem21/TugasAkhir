single-cell multi-omics methods have improved our ability to profile diverse cell features. however, tissue dissociation leads to the loss of spatial information. to address this, we introduce spatrio, a tool that integrates multi-omics and spatial data to map single cells, explore multimodal tissue landscapes, and study gene regulation and cell communication. spatrio was validated using simulations and real data from different tissues, providing spatial insights at the cellular level.



spatrio takes in single-cell multi-omics data and st data as input(left). using the optimal transport algorithm and considering the gene expression, spatial graph, and modal graph constructed by k-nn, spatrio calculates a probabilistic alignment between cells and spots. this alignment allows spatrio to build the spatial multi-omics data(middle), achieving the deconvolution of spots and reconstruction of the multi-omics patterns. moreover, through its downstream analysis functions, spatrio can perform spatial gene regulation analysis and multi-omics cell-cell communication inference(right).



data, a modal graph was constructed with a low-dimensional representation of the modality assay, and for st data, a spatial graph was constructed using spatial coordinates. employing the fused gromov-wasserstein optimal transport,22 spatrio computes an optimal probabilistic alignment between cells in single-cell multiomics data and spots in st data, which minimizes both the transcriptional dissimilarity between two datasets and the difference in graph distance between pairs of aligned cells/spots from the same data. finally, spatrio assigns the expected number of cells to each spot according to the alignment results and corrects the cell coordinates based on the transcriptional similarity between the mapped cells and the surrounding spots.



during the alignment, hyperparameter a controls the relative weight of transcriptional dissimilarity and graph distances. when a= 0, the spatial alignment only considers transcript information and ignores graph information, whereas the spatial alignment is calculated only based on graph information when a= 1. the optimal probabilistic alignment is a one-to-many match between the cells and the spots in the two datasets, corresponding to a spot containing several cell types. the flexible tuning of hyperparameters in spatrio enables the consideration of multiple modalities and location information during alignment, leading to more accurate reconstruction results. this approach is particularly well suited to account for the co-existence of spatial heterogeneity and modality differences in cells.



in addition, spatrio offers the capability to explore the spatial co-expression distribution of various molecules via its spatial feature module analysis functionality. to achieve this, spatrio applies the k-nn algorithm to smooth molecular expression, calculating the spatial-weighted expression matrix using a spatial kernel. the feature modules were identified using a consensus clustering(cc) algorithm. the scores of the modules determined from the identified modules can be utilized for further analysis of spatial regulation and inference of cell-cell interactions based on multi-omics data.



spatrio demonstrates superior performance compared to the other tools. the rmse of the deconvolved cell-type proportions was calculated by comparing them with the ground truth. for simulated data, a pseudocount of 5 was set, while for biological datasets, a pseudocount of 0 was used. in the boxplots, the range



activity score of motif modules in atac clusters. boxplots depict the median and interquartile range, spanning the 25th to 75th percentile. the whiskers extend to a distance of 1.5 times the interquartile range from the box. p values were calculated using the wilcoxon test.****p% 0.0001.



interaction pairs as an example, gdf5 is a signaling protein that regulates cell growth, differentiation, and survival. the ligand acvr2a activated by gdf5 is a transmembrane receptor protein that regulates hepatic fibrosis.43 col1a2, col4a4, col4a1, and col1a1 encode different types of collagen, which are components of the ecm in the liver, and their receptor itgav, which is part of an essential pathway that regulates the fibrotic liver.44 in addition, the itgal receptor in protein-protein interactions is associated with immune responses in the ecm and fibrosis in the liver.45 our multimodal cell-cell interaction analysis revealed that the portal vein influences the fibrosis of cells in the peripheral area through intercellular communication involving multiple modalities.



sults indicate that the spatial arrangement of cells based only on transcriptome similarity should be treated with caution. the topological features of slices and the local geometry of omics can help produce more reliable results. in comparison with other integration tools, spatrio shows superior performance. in biological datasets, spatrio can also refine the spatial patterns of irregularly distributed cell populations and preserve the gradient distribution characteristics of various biomolecules among tissue regions. we demonstrated that spatrio could maintain cell alignment in real complex tissue structure scenarios.



spatrio is then applied to several real datasets. spatrio accurately identified the cortical layers in the mouse cerebral cortex data and revealed the gene regulatory relationships of different modes at a spatial resolution. moreover, spatrio resolved high-resolution substructures of cell populations and modalityspecific spatial heterogeneity. in mouse liver data, spatrio accurately mapped major cell types and subdivided hepatocyte classifications through the spatial detection of gene modules. analysis of the interaction between the portal and periportal regions revealed gene and protein interactions between them under steatotic conditions. in human breast cancer data, spatrio analyzed the differences in cell composition among pathological regions and highlighted the higher immune activity of t cells in the invasive cancer+ lymphocytes area. further analysis of this region revealed the multimodal communication preferences of immune and other cell types in the tumor microenvironment.



because the e matrix is derived from the embedding space after dimensionality reduction, the distance between the cells represents the similarity of the cells in the low-dimensional embedding space. the z matrix is derived from the spatial position in tissue; thus, the distances between the cells are the actual coordinate distances. we extract the spatial coordinates of each point from the spatial transcriptome data and obtain dimensionally reduced low-dimensional embedding representations of atac/protein assay from the single-cell multi-omics data. the embedding matrix is then normalized to ensure that features of different dimensions have the same weight when computing distances. next, we construct two k-nn graphs using the spatial coordinates and low-dimensional embedding matrix. the k-nn graphs ensure that both types of distances operate at the same scale, providing important neighborhood information for data integration and alignment. we compute the shortest path distance between each pair of nodes and set the distance of any unconnected node to its maximum in the graph. moreover, we added a type-aware mechanism. specifically, if the types/regions of two cells/spots differed, their distance is artificially enlarged. then, the resulting matrix is rescaled by dividing and spots, taking into account the pairwise mapping weights. the parameter a controls the trade-off between gene expression similarity and pairwise distance similarity. a higher value of a emphasizes the importance of matching pairwise distances, while a lower value focuses more on aligning gene expression profiles.75



in addition, spatrio adjusts the coordinates of the cells so that the centroid of the cells within each spot overlaps with the central coordinates of the spot, making them more scattered within the scope of each spot to better simulate the spatial distribution of cells. the resulting cell locations reflect the similarity of gene expression to surrounding spots and do not extend beyond the boundaries of the spots. in some cases, the number of neighboring spots of spot j may be insufficient. for this, we added a pseudo-spot jpseudo, which shares gene expression with spot j, and its spatial coordinates conformed to the following calculation: molecular expression state of cells in space may have insufficient continuity, affecting spatial module recognition. therefore, we first smoothed the characteristic intensity of the cells on the k-nn graph, which was calculated using a low-dimensional embedded representation. the spatial distance matrix between cells is transformed into a spatial kernel matrix w using radial basis functions(rbf), the smoothed feature expression matrix x is normalized, and the covariance of the expression matrix x and kernel matrix w is calculated. next, the covariance was divided by the square root of the diagonal elements to obtain a spatially weighted correlation matrix. using the spatially weighted correlation matrix, we used consensus clustering(cc)68 to detect the feature expression modules. the cc function was implemented using the consensusclusterplus package(v1.62.0). after the feature clusters were obtained, the identified features were filtered based on the level of consensus and correlation. the activity score of the identified module



we employed different analytical strategies for cellular communication involving different modalities. for transcriptome-based cell interaction analysis, the gene expression counts matrix, two-dimensional coordinates, and cell classification information of all assigned cells to the spatalk69 package(v1.0) for analysis. interactions between all input cell types were calculated and included specific ligand-receptor pairs and strengths of interactions.



for the proteome-based analysis of cellular communication, we utilized the results of the modular analysis. we calculated the protein module scores for each cell using the seurat(v4.3.0) addmodulescore and divided them into two groups based on the cell-type specificity of the scores. if the specificity was high, the protein in the module was a specific protein of the corresponding cell type. if the specificity was low, the proteins in all the modules were treated as spatially differential proteins. if a spatially differentially expressed protein was highly expressed in a cell group, it was a specific protein. after specific proteins were identified in each cell population, protein interaction scores were calculated based on expressed protein abundance. for example, the specific protein a of cell population i is a ligand, and the average expression is xai, the specific protein b of cell population j is a receptor, expressed as xbj, and the corresponding cell interaction score s is calculated by the following formula:



before spatrio mapped the cells to spots, we added a step to the st data to add a controllable degree of noise to affect the heterogeneity of the transcriptome data. we generated new transcript counts based on the negative binomial distribution of total counts at each spot and then on the multinomial distribution of individual gene counts. this process is controlled by the pseudocount parameter d, which perturbs the count of each transcript. intuitively, the higher the value of d, the more noisy the simulated gene expression counts are and, therefore, the less informative. in addition, we randomly rotated the slice before alignment. the objective was to eliminate the influence of the slice angle.



the omics data of the mapped spots were obtained by adding the single-cell omics data. we calculated the pcc and scc of the transcriptome before and after mapping each spot. it measured the accuracy of spatrio deconvolution of the spot. in addition, we calculated the ari between the cell type of the ground truth and the mapped results and the rmse between the deconvolution and the proportion of accurate labels for each spot in the st dataset using the following formula:



when comparing the impact of using rna and atac graphs, we generated new simulated data based on pattern 1. in this scenario, we introduced pseudocounts to the cell type 2 and cell type 3 populations, effectively eliminating the transcriptome differences between these two groups of cells, treating them as a single cell population. this allowed us to examine the effect of utilizing different graph construction methods while controlling for potential transcriptome heterogeneity within these specific cell types.



mouse liver data(10x visium with highly multiplexed protein) consisted of a slice, containing 1659 spots annotated with liver zonations, 16555 genes, and 91 proteins. we divided the slice into two parts of different sizes, both containing four zonations of the liver. the spots located in the larger part were selected to be input as single-cell multi-omics data, and the spots located in the smaller were selected to be input as st data. in this way, we constructed single-cell data of 1398 cells and st data of 261 spots. in the mapping process, we used the scaled expression matrix, which only contains the differential genes shared by the two datasets, and used the regional information to affect the calculation of the graph distance. as mentioned before, the mapped spot data is merged from the assigned cell data. in addition, we calculate the average abundance of the cell type-specific proteins in each region and scaled them as the signal intensity of the corresponding cell type.



we performed peak calling analysis on the atac data using macs2, and estimated transcription factor activity using the runchromvar feature within signac66(v1.9.0). the positional weight matrix used in the process was obtained from the jaspar202073 database. fold changes in transcription factor activity and gene expression were computed using the findmarkers function, with a false discovery rate(fdr) of less than 0.05. we then used the pccs of the fold-change of the transcription factor and the corresponding gene as the correlation between the two modalities. transcription factors were classified into three groups based on the correlation between transcription factor activity and expression:(1) transcription factors whose motif activity was with high positively correlated with gene expression,(2) transcription factors that showed a negative correlation, and(3) transcription factors that showed an insignificant correlation. we hypothesized that transcription factors with a positive correlation act as transcriptional activators within differentially accessible chromatin regions(dar), whereas those with a negative correlation act as transcriptional repressors.



