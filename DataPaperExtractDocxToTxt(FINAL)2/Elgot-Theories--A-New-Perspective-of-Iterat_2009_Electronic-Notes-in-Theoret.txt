

Electronic Notes in Theoretical Computer Science 249 (2009) 407–427
www.elsevier.com/locate/entcs
Elgot Theories:
A New Perspective of Iteration Theories (Extended Abstract)*
Jiˇr´ı Ad´ameka,2 Stefan Miliusa,2 Jiˇr´ı Velebilb,1
a Institut fu¨r Theoretische Informatik, Technische Universita¨t Braunschweig, Germany
b Faculty of Electrical Engineering, Czech Technical University of Prague, Czech Republic

Abstract
The concept of iteration theory of Bloom and E´sik summarizes all equational properties that iteration has in usual applications, e.g., in Domain Theory where to every system of recursive equations the least solution is assigned. However, this assignment in Domain Theory is also functorial. Yet, functoriality is not included in the definition of iteration theory. Pity: functorial iteration theories have a particularly simple axiomatization, and most of examples of iteration theories are functorial.
The reason for excluding functoriality was the view that this property cannot be called equational. This is true from the perspective of the category Sgn of signatures as the base category: whereas iteration theories are monadic (thus, equationally presentable) over Sgn, functorial iteration theories are not. In the present paper we propose to change the perspective and work, in lieu of Sgn, in the category of sets in context (the presheaf category of finite sets and functions). We prove that Elgot theories, which is our name for functorial iteration theories, are monadic over sets in context. Shortly: from the new perspective functoriality is equational.
Keywords: iteration theory, Elgot theory, iterative algebra, rational monad

Introduction
In Domain Theory one works in a continuous theory and one uses iteration expressed by the fact that for every equation-morphism e : n   zn,+ k there exists the least solution e† : n    zk,. This dagger operation e    ze,† enjoys a number of equational properties, e.g., the fact that e† is a solution of e is the equation e† = [e†, idk]·e. The aim of the concept of iteration theory of Stephen Bloom and Zoltan E´sik was to collect all equational properties of the dagger operation in Domain Theory (and in a substantial number of other applications where iteration

٨ The full version of this paper can be found at http://www.stefan-milius.eu.
1 Supported by the grant MSM 6840770014 of the Ministry of Edutcation of the Czech Republic.
2 Supported by the German Research Foundation (DFG) under the project “Rekursion in der koalgebrais- chen Semantik”.

1571-0661 © 2009 Elsevier B.V. Open access under CC BY-NC-ND license.
doi:10.1016/j.entcs.2009.07.100

is used, see the fundamental monograph [12]). The function e   ze†,in Domain Theory is also functorial, that is, for every given k we obtain a functor (−)† from the category of all equation morphisms e : n    zn,+ k to the slice category of k. This important property of functoriality is studied in various contexts, e.g., Alex Simpson and Gordon Plotkin call it parametrized uniformity in [22], and they say in their introduction that this is “a convenient tool for establishing that the equations of an iteration operator are satisfied”. Larry Moss observed in [21] that functorial iteration theories allow for a particularly simple axiomatization. Functoriality is, however, not a part of the definition of iteration theory; this property is called “functorial dagger implication” in the monograph [12]. The name and the non- inclusion into the definition both indicate that Bloom and E´sik do not consider functoriality an equational property. The aim of the present paper is to demonstrate that from a new perspective functoriality is equational. Thus Elgot theories which is our name for functorial iteration theories, form an important class of equationally specified algebraic theories. They are, as proved by Martin Hyland and by Masahito Hasegawa [18], precisely those theories that are traced cocartesian categories where the trace operation is uniform for all base morphisms.
Recall that for every signature Σ the free continuous theory on Σ is the the- ory TΣ⊥ of Σ⊥-trees: one adds to Σ a new nullary symbol ⊥, forming a new signa- ture Σ⊥, and the morphisms from 1 to n in TΣ⊥ are all Σ⊥-trees (finite and infinite) on n variables. As proved by Bloom and E´sik, the free iterative theory on Σ is the subtheory RΣ⊥ of all rational Σ⊥-trees, that is, trees with finitely many subtrees up to isomorphism. This defines a monad Rat on the category Sgn of signatures:
Rat(Σ) = the signature of rational Σ⊥-trees.
We have proved recently that the Eilenberg-Moore algebras for this monad Rat are precisely the iteration theories, see [6]. It then follows from a general theory of equational presentations due to Max Kelly and John Power [19], recalled briefly in the Appendix below, that iteration theories are equationally presentable over Sgn. And the corresponding equations for dagger are precisely those that hold in Domain Theory since they are precisely those that hold in the theories TΣ⊥ or RΣ⊥ . In contrast, Elgot theories are not monadic over the category of signatures.
However, free iteration theories exist not only on all signatures, but also on all sets in context, as we proved in [4]. The latter means objects of the functor category SetF where F is the category of natural numbers and all functions between them. Thus, a set in context X assigns (like a signature) to every n ∈ N a set X(n) which we can consider as the set of all “formulas of type X in n variables”. And (unlike a signature) it assigns to every function ϕ : n   zm,“changing variable names” a function Xϕ : X(n)    zX,(m) of the corresponding “renaming of free variables” in formulas. See for example the semantics of λ-calculus presented by M. Fiore et al. [15] where λ-formulas are treated as a set in context. It follows from our results in [4] that for every set in context, X ∈ SetF , a rational theory RX can be constructed analogously to the rational-tree theory for a signature (see also [3] for concrete descriptions of those theories RX). Moreover, in [7] we proved that

rational theories of the form RX+1 are Elgot theories. Here we prove that RX+1 is a free Elgot theory on X and that it is a quotient theory of the theory RΣ⊥ for some Σ. This gives a monad Rat on the category SetF . Our main result is that the Eilenberg-Moore algebras for this monad are precisely the Elgot theories. It then follows from the results of Kelly and Power [19] that Elgot theories are equationally presentable over SetF . And the corresponding equations for the dagger operation are precisely those that hold in Domain Theory because, once again, we only need to consider the free theories and they are quotients of the theories RΣ⊥ . The equational presentation of Elgot theories is particularly simple: the solution function e 	ze†, is requested to be functorial, and satisfy the Parameter Identity and the Beki´c Identity, see Definition 2.8.
The first step in the proof of our result is the fact that Elgot’s iterative theo- ries [13] (i. e., theories with unique solutions of all ideal equation morphisms) are Elgot theories, see [12], Theorem 4.4.5. Here we work in a more general category theoretic setting; in lieu of theories we consider finitary monads on a locally finitely presentable and hyper-extensive category, see Assumption 3.1. In [2] it was proved that every iterative monad on such a category has unique strict solutions of all equa- tion morphisms, and then we proved in [7] that the corresponding dagger operation satisfies all the axioms of Elgot theories.

Elgot Theories and Elgot Monads
Assumption 2.1 Throughout this section K denotes a locally ﬁnitely presentable category, see [16] or [10]. More detailed:
K has colimits, and
K has a small full subcategory F representing all ﬁnitely presentable objects such that every object of K is a ﬁltered colimit of objects of F.
An object n is called finitely presentable if K (n, −) preserves ﬁltered colimits. More generally: functors preserving ﬁltered colimits are called finitary.
Fact 2.2 A finitary functor H : K   zK, is, up to natural isomorphism, fully determined by its restriction H/F in K F . In fact, H is the left Kan extension of H/F along the inclusion F   zK,. Thus, we have an equivalence of categories

K F ∼= Fin(K )

where Fin(K ) is the category of finitary endofunctors and natural transformations.
Remark 2.3 (Monads and Theories)
Recall that a monad S = (S, η, μ) consists of an endofunctor S : K   zK, and natural transformations η : Id   zS,and μ : S·S   zS,such that μ·ηS = idS = μ·Sη and μ·Sμ = μ·μS. The monad is called ﬁnitary if S is a finitary functor.

The Kleisli category KS of S has the same objects as K and its morphisms
f : X   ◦ zY,
are the morphisms f : X 	zS,Y of K . They compose as follows: given g : Y
 ◦ zZ,the composite g·f in the Kleisli category is the K -morphism

X	f  zS,Y	Sg zS,SZ	μZ  zZ,.

There is the canonical functor J : K 	zK,S which assigns to f : X 	zY, the morphism Jf = ηY ·f : X 	zS,Y in KS; we will write f : X 	zY,for Jf : X  ◦ zY,and call f a base morphism.
The theory of S is denoted by
Th(S);
it is the category whose objects are the objects of F and morphisms are the Kleisli morphisms.
Th(S) has finite colimits formed on the level of the base category K . In particular, finite coproducts in K and in Th(S) are the same.
Example 2.4 If K = Set we can choose F to be the category of natural numbers and functions between them.
Every finitary monad S on Set is equationally presentable: there exists a signa- ture Σ and a set E of equations such that S is the monad of all free algebras in the variety Alg(Σ, E) presented by E. Then Th(S) is the category of natural numbers with hom-sets Th(S)(1, n) formed by terms in n variables of the variety Alg(Σ, E), and Th(S)(k, n) = Th(S)(1, n) k of k-tuples formed by such terms.
Definition 2.5 Let S be a finitary monad.
An equation morphism is a morphism e : n  ◦ zn,+ k in the theory of S. We refer to k as the object of parameters. (That is, an equation morphism with k as object of parameters is given by a finitely presentable object n and a morphism e : n   zS,(n + k).)
A solution of e is a morphism e† : n  ◦ zk,such that the triangle below com- mutes in Th(S):
e†	z,
n	 .k ,
   

e◦	 ◦ †
(1)

, 
n + k
[e ,k]

Example 2.6 For S as in Example 2.4 the morphism e : n 	zS,(n + k) can be viewed as n recursive equations
xi ≈ ti(x1,..., xn, y1,..., yk)	i = 1,...,n 

where ti is a (Σ, E)-term in n + k variables. A solution is then a substitution of terms x†(y1,..., yk) for variables xi making each of the formal equations an identity
x† = ti x† ,..., x† , y1,..., yk .
Remark 2.7 In the following definition we assume that every equation morphism e is given a solution e† “canonically”. This means that various “natural” equational properties are requested. It was observed by Larry Moss [21] that, for K = Set, this definition is equivalent to the definition of functorial iteration theory by Stephen Bloom and Zoltan E´sik [12]—we state this in our setting of finitary monads of K :
Definition 2.8 An Elgot monad is a finitary monad S together with an operation

e : n  ◦ zn,+ k e† : n   ◦  zk ,
satisfying the following axioms:
Solution: e† = [e†, k]·e.

(for all n, k ∈ F )

Functoriality : Given a “homomorphism of equations”, i. e., a base morphism v with
n	◦e	zn ,+ k

v	v+k
,	, 
m	◦	zm,+ k
f

then f† = e†·v.
Parameter Identity : Given u : k   ◦  zk',, then u·e† = (u • e)† where


◦e z,
 n+ u z, '

u • e = n
n + k
n + k .	(2)

Beki´c Identity : Given e : n  ◦ zn,+ m + k and f : m 	zn,+ m + k form
eR = [e†,m + k]·f : m   ◦  zm,+ k,	and	eL = n + [e† , k] ·e : n   ◦ zn,+ k

then [e, f ]† = [e† , e† ]: n + m   ◦ zk.,
L	R
Remark 2.9 An Elgot theory is the theory Th(S) of an Elgot monad S. Equiv- alently, Th(S) is a traced cocartesian category with the trace uniform for base morphisms; see [18].
Example 2.10 We present some examples of Elgot theories (or monads) in Set.
Partial-function theory. We consider the monad S with S = Id +1 (whose algebras are pointed sets). Its theory is Th(S) = Pfn the category of natural num- bers and partial functions. To every partial function e : n  ◦ zn,+ k we assign its iteration e† : n  ◦ zk,defined in an element x of n iff e(x), e(e(x)),..., ei(x) are defined and ei(x) lies in k; then e†(x) = ei(x).

Multifunction theory. Here we take the finite-power-set monad Pf (whose algebras are join semilattices with a least element). Its theory is

Th(Pf ) = Mfn

the category of natural numbers and multifunctions. For every multifunction a : n
 ◦ zn,denote by a∗ its iteration a∗ = idn ∪ a ∪ (a·a) ∪ · · · Then the dagger of e : n  ◦ zn,+ k is defined as follows: let a : n  ◦ zn,and b : n  ◦ zk,be the multifunctions with e = a ∪ b, then e† = b·a∗.
T he free-semigroup theory X   zX,+ is not an Elgot theory. But we can extend it by adding to X+ an absorbing element ⊥ (that is, the binary operation of concatenation is extended by w·⊥ = ⊥ = ⊥·w for all w ∈ X+). The resulting monad SX = X+ + {⊥} is iterative, see [8], thus yields an Elgot monad, as we show in Section 3.
Inﬁnite-tree theory. Let Σ be a signature and let TΣ(n) denote the Σ-algebra of all Σ-trees on n variables, that is, (rooted and ordered) trees with leaves labelled in n + Σ0 and nodes of k > 0 children labeled in Σk. This gives rise to a finitary monad TΣ. This was first observed by Eric Badouel [11]. Let us add one new nullary operation ⊥. We obtain a signature Σ⊥ = Σ + {⊥} for which TΣ⊥ is an Elgot monad.
Rational-tree theory. A tree is called rational (or regular) if it has up to isomorphism only finitely many subtrees, see [17]. We denote by RΣ the submonad of TΣ formed by all rational Σ-trees. As proved in [12], the theory of RΣ⊥ is the free iteration theory on the signature Σ. We will see below that this is also the free Elgot theory on Σ.
Definition 2.11 Let (S, †) and (T, ‡) be Elgot monads. An Elgot monad mor- phism α from (S, †) to (T, ‡) is a monad morphism α : S   zT,that is solution- preserving, in the sense that for every equation morphism e : n   zS,(n + k) we have
αk·e† = (αn+k·e)‡.
The category of Elgot monads and their morphisms is denoted by

EM(K ).

We denote its forgetful functor into K F by

U : EM(K ) 	zK,F .

It assigns to every Elgot monad (S, †) the restriction functor S/F in K F .
Remark 2.12
The aim of our paper is to prove that Elgot theories are monadic over sets in context, that is, if K = Set then U is a monadic functor.

We will prove a more general result: EM(K ) is monadic over K F for every locally finitely presentable category satisfying an additional assumption called hyper-extensivity.
Iterative Theories
In this section we prove the main technical result of our paper: free Elgot theories coincide with free iterative theories of Calvin Elgot [13]. This continues the category theoretic extension and generalization of the work of Elgot as presented in [4,5,3,2,7].
Assumption 3.1 Throughout this section we assume that K is a locally ﬁnitely presentable category which is hyper-extensive, that is, every object is a coproduct of connected objects A (where A is called connected if the hom-functor K (A, −) preserves coproducts). We also assume that a ﬁnitary monad S = (S, ηS, μS) is given. monad on
Example 3.2
The categories of sets, posets, graphs and unary algebras are hyper-extensive and locally finitely presentable.
If K  has both properties, so do all presheaf categories on K .	Thus,
SetF (equivalently, Fin(Set) is an example.
Definition 3.3 A finitary monad S is called ideal if there exists a subfunctor σ : S' z,zS,such that S = S' + Id with injections σ and ηS, and if μS has a restriction (μ')S : S'S   zS,with σ·(μ')S = μS·σS. An ideal monad is called iterative if every equation morphism e : n  zS,(n + k) which factorizes through σn+k (i. e., we have e = σn+k·e' for some e' : n   zS,'(n + k)) has a unique solution e†.
Example 3.4 The monads SX = X+ + {⊥}, TΣ and RΣ from Example 2.10 are iterative.
Remark 3.5 (i) A strict endofunctor is an endofunctor H with a chosen morphism
⊥ : 0   zH,1. Notice that every Elgot monad is strict w.r.t. the solution of e : 0 
 ◦ z0,+ 1. Also HΣ⊥ is strict, and for every endofunctor H the functor H +1 is strict.
(ii) A strict natural transformation between strict functors is a natural transfor- mation preserving ⊥ (in the obvious sense).
Theorem 3.6 (see [7]) Every strict iterative monad is an Elgot monad.
Notation 3.7 We denote by
IM⊥(K )
the full subcategory of all strict iterative monads in EM(K ). By abuse of notation, we write U : IM⊥(K ) 	zK,F for the forgetful functor as in Deﬁnition 2.11.
Remark 3.8 Observe that a slightly different category and forgetful functor was used in [4]: the category
IM(K )

of iterative monads and ideal monad morphisms, that is monad morphisms α : S
	zT,such that the natural transformation α : S' + Id 	zT,' + Id has the form
α = α' + Id for some natural transformation α' : S' 	zT,'.
We have the forgetful functor
U' : IM(K ) 	zK,F

assigning to every iterative monad S = (S' + Id, ηS, μS) the restriction of the sub- functor S' to F : U'(S) = S',F .
Theorem 3.9 (see [4]) The forgetful functor U' has a left adjoint assigning to every ﬁnitary endofunctor H of K the free iterative monad RH on H (called the rational monad of H).
Example 3.10 For a given signature Σ the associated polynomial endofunctor of Set is given by HΣX =  i∈N Xi × Σi. Its algebras are the classical Σ-algebras in Set. The functor HΣ is finitary, and its rational monad is the monad RΣ of
Example 2.10(v).
Remark 3.11 Monadic algebras for the rational monad RH were characterized in [5] as precisely those H-algebras equipped with an operation of taking solutions of “flat” equation morphisms which satisfies two “natural” axioms. Let us recall this concept that we called Elgot algebras.
Given an algebra a : HA   zA,for H, flat equation morphisms in A are the morphisms e : n   zH,n + A, n ∈ F , of K . For example, if H = HΣ then whereas general equation morphisms e : n  ◦ zn,+ k are systems of equations xi ≈ ti with right-hand sides ti being general terms, see Example 2.6, the flat equation morphisms
e : n 	z ,ni × Σi + A
i∈N
have right-hand sides either as elements of A, or as flat terms σ(x0,..., xi−1) for some σ ∈ Σi and some variables x0,..., xi−1 in n. However, each general system can be “flattened” by introducing new variables.
Definition 3.12 By an Elgot algebra for H is meant an algebra a : HA   zA,
together with a function

e : n 	zH,n + A e† : n 		zA,
such that the following axioms hold:
Solution:

(for all n ∈ F )

n	e†	zA,


e	[a,A]
,	, 
(3)

Hn + A
He†+A
zH,A + A



Functoriality: Given a “homomorphism of of flat equations”, i. e., a morphism v : n
	zm,with
n   e	zH,n + A






then f†·v = e†.
Compositionality: Given
v

m, 
f
Hv+A
, 
zH,m	A
(4)

e : n 	zH,n + k	and	f : k 	zH,k + A	(n, k ∈ F ) form the equation morphisms f† • e = (Hn + f†)·e and
 [e,inr] 	Hn+f	can +A
f e ≡ n	k	zH,n	k	zH,n	Hk	A	zH,n	k	A,
where can = [H inl,H inr] is the canonical morphism. Then we have


(f †•e)†
n
z.A,,


inl
(6)




Notation 3.13 We denote by
   
, 
n + k
(f  e)†

Elg(H)
the category of Elgot algebras and their homomorphisms, that is, those mor- phisms p : A   zB,that preserve solutions: for every flat equation morphism e : n    zH,n + A the corresponding equation morphism p • e = (Hn + p)·e : n
   zH,n + B fulfils
,,,, A,
,,,,,,,
n ¸¸¸	p
¸¸¸¸
(p•e)‡	¸¸¸ , 
 B 
Note that every solution-preserving morphism p from (A, a, †) to (B, b, ‡) is a ho- momorphism of H-algebras, i.e., p·a = b·Hp. We have the forgetful functor
U : Elg(H) 	zK,,	(A, a, †) 	zA,.
Theorem 3.14 (See [5].) The category of Elgot algebras for H is isomorphic to the category of Eilenberg-Moore algebras for the rational monad RH , shortly: U : Elg(H)    zK,is monadic with the associated monad RH .

Theorem 3.15 For every strict ﬁnitary endofunctor H the rational monad RH is the free Elgot monad on H. That is, for every Elgot monad S and every strict natural transformation λ : H   zS,there exists a unique Elgot monad morphism m : RH   zS,extending λ.
Sketch of proof. (1) The first step in our proof is the verification that for every object A of A the algebra μS ·λSA : H(SA)   zS,A is an Elgot algebra. Its op- eration e   ze†,is defined for e : n   zH,n + SA as follows: apply the solution operation of the Elgot monad S to the following equation morphism:
n  e  zH,n + SA  λn+SA	zSn,+ SA can zS(,n + A) .

The verification that we indeed have an Elgot algebra is non-trivial, and we must omit the details here.
Since ηA : A 	zR,H A is the free Elgot algebra on A, we obtain the unique
Elgot algebra morphism
mA : RH A 	zS,A	with	mA·ηA = ηS .

The next step is to prove that these morphisms mA form a natural trans- formation m : RH    zS,which is a monad morphism and, in fact, a morphism of Elgot monads. The proof is quite involved making use of the axioms of Elgot monads for RH and the way the dagger operation of RH is defined in several steps, see [7] and [2]. Due to space constraints we have to omit the details.
Finally, one needs to verify that m is the unique extension of λ.	 

The Monad Rat and its Algebras
Assumption 4.1 We still assume that K is a hyper-extensive, locally ﬁnitely pre- sentable category. Recall that F is its small, full subcategory representing all ﬁnitely presentable objects.
Proposition 4.2 The forgetful functor U : EM(K )   zK, F (see Deﬁni- tion 2.11) has a left adjoint
Φ: K F 	zE,M(K )
assigning to every X in K F the rational monad RX+1 of X + 1.
Proof. Recall that K F is equivalent to the category Fin(K ) of finitary endo- functors. Thus, we can work with the forgetful functor in the form U : EM(K )
	zF,in(K ), given by U (S) = S. This is a composite U = U ·W of the forgetful
functor W into the category Fin⊥(K ) of all strict finitary endofunctors and strict natural transformations and the functor U^ : Fin⊥(K ) 	zF,in(K ) forgetting ⊥.
From Theorem 3.15 and the fact that U^ has the left-adjoint X 	zX,+ 1 we
conclude that U has the left adjoint as stated.	 

Corollary 4.3 The forgetful functor U : IM⊥   zK,F of the category of strict iterative monads has a left adjoint.
In fact, the free Elgot monad RX+1 on the set in context X is a strict iterative monad.
Example 4.4 Here we consider K = Set.
The value of Φ at HΣ, see Example 3.10, is as follows: recall the notation Σ⊥ = Σ + {⊥} from the Introduction and observe that HΣ⊥ = HΣ + 1. Thus, Φ(HΣ⊥ ) = RΣ⊥ , the rational Σ⊥-tree monad.
The value of Φ at an arbitrary set in context X (considered as an endofunctor): express X as a quotient of HΣ for some Σ. For example, the signature Σn = X(n), for all n ∈ N, yields, by Yoneda Lemma, an epimorphism (that is, a natural transformation with surjective components) ε : HΣ   zzX,,.  We extend it to an epimorphism ε¯ = ε +1 : HΣ⊥   zzX,,+ 1. Since Φ, being a left adjoint, preserves epimorphisms, we see that Φ(X) = RX+1 is a quotient of RΣ⊥ via Φ(ε¯): RΣ⊥   zR,X+1. In fact, in [3] the monad RX+1 was described concretely: if ε is given by a set E of equations (between flat Σ-terms), then RX+1 is the quotient of RΣ⊥ modulo a potentially infinite application of the equations in E.
Definition 4.5 We denote by Rat the monad on K F given by the adjunction Φ E U above. Thus, on objects X we have Rat(X) = RX+1/F , where RX+1 is the underlying functor of the rational monad of X + 1.
Theorem 4.6 The forgetful functor U of the category of Elgot monads is monadic, with Rat as the corresponding monad.
Proof. We know from Proposition 4.2 that U has a left adjoint and the corre- sponding monad is Rat. Thus, we only need to prove that U creates coequalizers of U -split pairs, then monadicity follows from Beck’s Theorem, see [20]. In more detail, suppose we are given a pair of parallel Elgot monad morphisms α, β : (T, ‡)
   z(S,, †) and natural transformations
	α	s	ψ	



such that
T ,r τ
β
 S ,,r σ
zC ,
for C in Fin(K )

ψ·α = ψ·β,	ψ·σ = idC,	β·τ = idS,	and	σ·ψ = α·τ.	(7) We must prove that there exists a unique Elgot monad C on C such that ψ : S
	zC,is an Elgot monad morphism, and moreover, ψ is a coequalizer of α and β
in EM(K ).
It is a trivial application of Beck’s Theorem that for the category FM(K ) of finitary monads on K the forgetful functor V : FM(K )    zK,F given by V (S) = S/F is monadic. Consequently, V creates the coequalizer above, thus there

exists a unique structure C = (C, ηC, μC) of a finitary monad such that ψ is a monad morphism and a coequalizer of α and β in FM(K ).
Next, we prove that there exists at most one structure e  ze∗,of an Elgot monad on C for which ψ is solution-preserving. In fact, the equation ψk·f† = (ψn+k·f )∗ of Definition 2.11, where f : n   zS,(n + k), implies that e∗ must be defined, for every e : n    zC,(n + k), by

e∗ = ψk·(σn+k·e)†.

With this definition ψ preserves solutions: due to (7) we have

 ψ	·f ∗ = ψ ·(σ	·ψ	·f ) = ψ · α	·τ	·f † = ψ ·α · τ	·f ‡

since α is solution preserving. The last morphism is ψk·f† since (7) and the fact that β is solution-preserving yield
ψ ·α ·(τ	·f )‡ = ψ ·β · τ	·f ‡ = ψ · β	·τ	·f † = ψ ·f†

We will verify below that (−)∗ satisfies the axioms of Elgot monads. Then it is easy to prove that ψ is the coequalizer of α and β in EM(K ).
Proof of Solution. In the diagram


n ¸¸¸
e∗	zC,k

,,,
,
¸¸¸¸¸
¸¸(¸σ¸·e¸)
ss˛ ,¸
ψss

,,,,
¸¸¸¸¸¸¸¸¸¸¸	sssss

σ·e,,,,
e	,,,,
,,r˛
S(n + k)
ψ sssss
sssss
¸¸¸z s
 ¸
μS	μC

S[(σ·e)†,ηS ]  zSS,k¸¸¸
¸¸¸ψ¸∗ψ
¸¸¸¸¸

, s˛r
C(n + k)
C[e∗,ηC ]
r 
zC,Ck


all inner parts commute: this is clear for the right-hand square since ψ : S    zC,is a monad morphism, for the middle square due to Solution w.r.t. S, and the left-hand triangle follows from (7). The lower square is easy to verify.
Proof of Functoriality. Every homomorphism of equations v w.r.t. C yields one w.r.t. S by the naturality of σ:
n 	e	zC,(n + k) 	σ	zS(,n + k)


v	C(v+k)
S(v+k)

,' 		' ,	' , 
n	e'	C(n + k)	σ	S(n + k)

The desired triangle follows from Functoriality w.r.t. S:



n


(σ·e)†
e∗

 .,

zzC, (k)
ψk ,,,, ,

    
v	(σ·e')†
,,,,,,,
,,,,,,

,,,,, (e')∗
  ,,,,
n
Proof of Parameter Identity. Given e : n   zC,(n + k) and u : k  ◦ zk',, we first relate u • e : n    zC,(n + k') and (σk' ·u) • (σn+k·e): n    zS,(n + k') (recall the definition of • from (2)). In the following diagram we use (2) expressed in the base category K for the equation morphisms of interest; the commutativity of the diagram


	σ·e	
S(ηS +σ·u)
'	S can
'	μS	'

n ¸¸¸
¸¸¸¸¸
zS(,n + k)
zS(,Sn + Sk )
zSS,(n + k )
zS(,n + k )

e ¸¸¸¸
ψ	ψ∗(ψ+ψ)
ψ∗ψ	ψ

¸¸r, 
C(n + k)
zC,(Cn +,  ')
zC,C( ,+  ')
zC,(n +, ')

C(ηS +u)
C can	μC



implies

(u • e)∗ = ψ ' · (σu) • (σe) †.	(8)

To see that the Parameter Identity holds for (−)∗ we now verify that the following diagram commutes:

(u•e)∗


((σu)•(σe))†
 ¸
ψ	 ¸


σe

,	


S(σu)
z, '

μS

zs,  '

Sk	Su
e
SCk
Sσ	SSk¸¸¸
¸¸¸¸	μC

Sψ  ¸¸¸
ψ	r '
ψ∗ψ

SCk¸¸¸
¸¸¸¸¸

r,˛ 
¸¸¸r' ¸

Ck	Cu	zC,Ck

The upper part commutes by (8), the left-hand square by the Parameter Identity for S, for the inner and left-hand triangles use (7), and all other parts commute since ψ is a monad morphism.

Proof of Beki´c Identity. Given e : n 	zC,(n + m + k) and f : m 	z,
C(n + m + k) we form the morphisms eL and eR for e as in Definition 2.8 applied to C. And we also form, for σ·e and σ·f , the corresponding morphisms w.r.t. S and denote them by εL and εR, respectively. For εR we get the diagram (written in K once more)




m	f


¸¸¸¸¸
¸¸¸¸¸
εR





ψ





ψ∗ψ

zzS(, m + k)
μS

ψ

	f	¸¸¸¸
,		
, 
  μC		, 

m	 z C,¸(m + k)
eR
(9)
which clearly commutes (recall (7)). This implies, since ψ is solution-preserving,

∗ = ψk·ε† .	(10)

Analogously, for εL we have
n


e

C(n +


¸¸¸¸
¸¸¸¸¸
, 





ψ∗(ψ+ψ)
, 



μS·S can

+ k)
ψ
, 

C(n + m + k)
C(ηC +[e∗ ,ηC ])
zC,(Cn + Ck)
μC ·C can
zC,(n + k)
(11)

The commutativity of the middle square follows from

S(ηS +[e† ,ηS ])
S(n + m + k) 	R	zS(,Sn + Sk)


ψ
,	C(ηS +[e† ,ηS ])
ψ(S+S)
, 

C(n + m + k) 	R	zC,(Sn + Sk)
¸¸¸¸¸¸¸¸¸¸

C	∗ ¸¸¸¸¸¸¸
C(ψ+ψ)

C(η
+[eR,ηC ])
¸¸¸¸s , 

C(Cn + Ck)

The square is the naturality of ψ, the triangle is easy: delete C and consider the components separately using ψ·ηS = ηC (since ψ is a monad morphism) and (10). From (11) we derive (analogously to (10))

e∗ = ψk·ε∗ .	(12)
L	L

We now see that the Beki´c Identity for S implies that for C:


n,¸¸
inl	zn ,+ m ,r	inr	. m


,,¸¸¸¸¸	†	†	cc

,,,
,,
¸¸¸εL
¸¸

[σe,σf]†
εR....
.
ccc
cc

,,,
¸¸¸¸¸	.....
ccc

,,,	 , .˛r
ccc

L  ,,,,
,,,
,,
S(k)

ψ
ccc e∗
cccc
ccc

,,	cc
r, ˛ rc
C(k)

The upper triangles follow from σ·[e, f ] = [σ·e, σ·f ] using Beki´c Identity for S, and the lower ones follow from (10) and (12).	 
Remark 4.7 Notice that in the proof of Functoriality the naturality of σ : C 	zS, is essential, whereas it is not used in the proof of the other axioms. This accounts for the fact that Functoriality is not an axiom for iteration theories, where one works over the category Sgn of signatures, see [6]. But for Elgot theories Functoriality
is an equational axiom (or rather, an infinite set of axioms) since we are working over the category Fin(K ) of finitary endofunctors of K (or, equivalently, sets in context K F ). We shall further discuss this in the Appendix below.
Corollary 4.8 Elgot monads are precisely the monadic algebras for the monad Rat
on K F .
In fact, since U is monadic, we have an isomorphism between the categories of Elgot monads and of algebras for Rat:
EM(K ) ∼= K F Rat.
Corollary 4.9 The axioms of Elgot monads on Set precisely summarize all equa- tional properties that the assignment
e† = least solution of e
has in Domain Theory. More detailed:
If an equation over SetF holds for least solutions in all continuous theories, then that equation follows from the axioms of Elgot monads, and
Every axiom of Elgot monads holds in all continuous theories.
In fact, (ii) has been proved by Stephen Bloom and Zoltan E´sik in [12]. To see (i), apply the results of Max Kelly and John Power in the Appendix to the monad Rat. We know that the algebras for Rat form an equational class for some signature Γ on SetF . Every equation which holds in continuous theories holds in the Σ⊥-tree theories of Example 2.10(vi). Consequently, it holds in the theories RΣ⊥ of rational Σ⊥-trees, see Example 2.10(vii), since the definition of e† is the same

as in TΣ⊥ . For every free algebra for Rat the same equation must hold again since by Example 4.4(ii) these free algebras are quotients of RΣ⊥ . Consequently, the equation will hold in all algebras for Rat.
Conclusions
Stephen Bloom and Zoltan E´sik proved that their concept of iteration theory in [12] sums up all equational properties that the formation of the least solutions e† of a recursive equations e possesses in Domain Theory. This, however, assumes that the concept of “equational property” is related to the base category Sgn of signatures. In our paper we take SetF , the category of sets in context, as our base category.
It then turns out that the summation of equational properties of the above function e  ze†,in Domain Theory is given by Elgot theories—our abbreviation for the concept of iteration theory satisfying the functorial dagger implication from [12].
Elgot theories have a simpler definition than iteration theories, and they precisely correspond to cocartesian traced categories uniform w.r.t. base morphisms, see [18].

References
J. Ad´amek. Free algebras and automata realizations in the language categories. Comment. Math. Uni. carolinæ 15 (1974), 589–602.
J. Ad´amek, R. B¨orger, S. Milius and J. Velebil. Iterative algebras: How iterative are they?, Theory Appl. Categ. 19 (2008), 61–92.
J. Ad´amek and S. Milius. Terminal coalgebras and free iterative theories, Inform. Comput. 16 (2006), 1139–1172.
J. Ad´amek, S. Milius and J. Velebil, Iterative algebras at work, Math. Structures Comput. Sci. 16
(2006), 1085–1131.
J. Ad´amek, S. Milius and J. Velebil, Elgot algebras, Logic. Meth. Comput. Sci. 2 (2006), 1–31.
J. Ad´amek, S. Milius and J. Velebil, What are iteration theories?, Proc. MFCS 2007, Lect. Notes Comput. Sci. 4708 (L. Kuˇcera and A. Kuˇcera, Eds.), Springer 2007, 240–252.
J. Ad´amek, S. Milius and J. Velebil, Equational Properties of Iterative Monads, submitted.
J. Ad´amek, S. Milius and J. Velebil, Iterative reflections of monads, to appear in Math. Structures Comput. Sci.
J. Ad´amek, S. Milius and J. Velebil. Semantics of higher-order recursion schemes, submitted.
J. Ad´amek, and J. Rosicky´, Locally Presentable and Accessible Categories, Cambridge University Press, 1994.
E. Badouel, Terms and infinite trees as monads over a signature, Proc. TAPSOFT 1989, Lect. Notes Comput. Sci. 351, Springer 1989, 89–103.
S. L. Bloom and Z. E´sik. Iteration Theories: the equational logic of iterative processes, Springer-Verlag, 1993.
C. C. Elgot, Monadic computation and iterative algebraic theories, In Logic Colloquium 1973, Studies in Logic, J. C. Shepherdson, editor, 80 (1975), 174–250.
C. C. Elgot, S. L. Bloom and R. Tindell, On the algebraic structure of rooted trees, J. Comput. System Sci. 16 (1978), 362–399.
M. Fiore, G. Plotkin and D. Tiuri, Abstract syntax and variable binding, Proc. 14th Annual Symposium on Logic Computer Science 1999, 193–202.


P. Gabriel, and F. Ulmer, Lokal pra¨sentierbare Kategorien, Lect. Notes Math. 221, Springer-Verlag, Berlin, 1971.
S. Ginali, Regular trees and the free iterative theory, J. Comput. Syst. Sci. 18 (1979), 228–242.
M. Hasegawa, The uniformity principle on traced monoidal categories, Proc. CTCS 2002, Electron. Notes in Theoret. Comput. Sci. (2003).
G. M. Kelly, and A. J. Power. Adjunctions whose counits are coequalizers, and presentations of finitary enriched monads, J. Pure Appl. Algebra 89 (1993), 163–179.
S. Mac Lane, Categories for the working mathematician, 2nd edition, Springer Verlag, 1998.
L. S. Moss, Recursion and corecursion have the same equational logic, Theoret. Comput. Sci. 294
(2003), 233–267.
A. Simpson, and G. Plotkin, Complete axioms for categorical fixed-point operators, Proc. 15th Symposium on Logic in Computer Science LICS 2000, 30–44.

Appendix: The Kelly-Power Equational Presentations
In this appendix we just recall some concepts and results from [19].
Assumption A.1 Throughout the appendix A denotes a locally ﬁnitely presentable category and F (A ) its full subcategory representing all ﬁnitely presentable objects. The copower of M copies of an object K ∈ A is denoted by M • K.
Definition A.2 A signature Σ is a collection of objects of A indexed by F (A ); in symbols: Σ = (Σ(p))p∈F(A ).
Example A.3
In case A = Set we denote F (Set) by F . This is the category of natural numbers and functions. Definition A.2 is the usual concept of a (finitary, one- sorted) signature. Observe that a Σ-algebra can be viewed as a set A together with, for every p ∈ N, as assignment
p   a  zA,
Σ(p)  aˆ zA,
which to every p-tuple (a0,..., ap−1) assigns the map σ 	zσA,(a0,..., ap−1).
Or, more compactly, an algebra is a set A together with a morphism
α :   Ap × Σ(p) 	zA,.
p∈F
In the category
A = SetF
of sets in context the finitely presentable objects are, as proved in [9], precisely the super-ﬁnitary ones. That is, those sets in context X for which there exists a natural number n such that (a) X(n) and X(0) are finite, and (b) all elements of X(k), k ∈ N \ {0}, have the form Xf (t) for some f : n   zk ,and t ∈ X(n). Then F (SetF ) denotes a set of representatives of all super-finitary sets in context.
A signature in SetF is a collection Σ = (ΣX)X∈F (SetF ) of sets in context.

Definition A.4 By a Σ-algebra is meant an object A of A together with a mor- phism
α :		A (p, A) • Σ(p) 	zA,.
p∈F (A )
This is just an algebra for the endofunctor HΣ : A 	zA,defined by

HΣX =	 
p∈F (A )
A (p, X) • Σ(p).

Homomorphisms are the usual homomorphisms of algebras for HΣ.
Remark A.5 The forgetful functor Σ-Alg   zA,has a left adjoint which assigns to every object X ∈ A the free HΣ-algebra FΣ(X) on X. It is easy to see that HΣ is a finitary functor, in particular, it preserves colimits of ω-chains. Consequently, the standard construction of the free algebra, see [1], applies: FΣ(X) is the colimit of the chain
X  inl zX,+ H X  id +HΣ inl zX,+ H (X + H )	z· ·,· 

Observe that we have a canonical natural transformation κ : HΣ		zFΣ,given by the right-hand components of the colimit injections X + HΣX 	zFΣ,(X).
Definition A.6 By an equation for a signature Σ is meant a parallel pair of mor- phisms
u, u' : p 	zFΣ,(r)	for p, r ∈ F (A ).
A Σ-algebra A satisﬁes the equation provided that for every homomorphism
h : FΣ(r) 	zA,we have h·u = h·u'.
Notation A.7 Given a set E of equations, we denote by (Σ, E)-Alg the full sub- category of Σ-Alg formed by those Σ-algebras that satisfy every equation in E. And we denote the forgetful functor by
U(Σ,E) : (Σ, E)-Alg 	zA,.
Proposition A.8 (See [19].) The functor U(Σ,E) is ﬁnitary monadic. That is, there exists a ﬁnitary monad M on A such that for the forgetful functor UM : A M
   zA, of its Eilenberg-Moore category we have an equivalence functor Φ: A M

	z(Σ,, E)-Alg together with a natural isomorphism UM
  ∼= 
(Σ,E)
·Φ:

A M 	Φ	z(Σ,, E)-Alg

,,,
,,
∼=,, ˛,

U ,,,, ,,,

M	,,
U(Σ,E)

,r¸˛ r 
A
The main result for our purposes is the converse:

Theorem A.9 (See [19].) Every ﬁnitary monad M on A has an equational pre- sentation (Σ, E), that is, a signature Σ, a set E of equations and an equivalence functor Φ: A M    z(Σ,, E)-Alg with UM ~= U(Σ,E)·Φ.
Example A.10 The category of all finitary monads in Set (or, equivalently, the category of Lawvere theories and theory morphisms) is monadic over SetF , the category of sets in context—this is an easy application of Beck’s theorem. That is, there exists a signature Σ and a set E of equations describing finitary monads as Σ-algebras satisfying the equations from E. Recall that SetF is equivalent to the category Fin(Set) of finitary set functors. A finitary monad is given by (a) a functor A ∈ Fin(Set), (b) a natural transformation η : Id   zA,and (c) a natural transformation μ : AA   zA,satisfying certain axioms. The natural transformation μ can, since A is finitary, be substituted by the collections of assignments
f : m 	zA,
f' : m·m 	zA,
where m is an arbitrary finitely presentable object of Fin(Set), f an arbitrary natu- ral transformation and f' = μ·(f ∗ f ). This leads us to the following signature Σmon for a presentation of finitary monads: Σmon(m) = m·m for all m /= 0 (0 the initial object), and Σmon(0) = IdSet. Here a Σ-algebra consists of a finitary functor A, a map
0 	zA,
Id 	zA,
representing a natural transformation η : Id 	zA,, and transformation maps

m 	zA,


m·m 	zA,

(m /= 0 finitely presentable)

representing μ provided that some equational properties hold. The set Emon of equa- tions we need then guarantees that the above transformation maps represent a nat- ural transformation μ : AA    zA,and, together with η, satisfy the monad axioms. In other words, (Σmon, Emon)-Alg is the category of Lawvere theories (equivalently, finitary monads on Set).
Example A.11 Let us illustrate the equations needed to represent functoriality of iteration theories. We work here with the category A = (Σmon, Emon)-Alg of Lawvere theories of the preceding example as the base category. For every pair n, m of natural numbers we denote by Tg:n	zm ,the free Lawvere theory on one generator g representing a morphism from n to m. Notice that every theory morphism u : Tg zX,is uniquely determined by picking a morphism u(g) ∈ X(n, m). Clearly,
Tg:n  zm ,is a finitely presentable object of A .
Let Σ be the signature whose values are Σ(p) = 0 (the initial algebraic theory) except for p = Te: n	zn+,k where


Σ(Te: n	zn+,k) = Te† : n	zk ,
for all e : n 	zn,+ k.

Its polynomial functor assigns to every theory X the theory

HΣX = 
n,k∈N
= 
n,k∈N

A Te: n	zn+,k,X • Te† : n	zk ,

X(n, n + k) • Te† : n	zk.,

Its algebras are precisely the preiteration theories of Bloom and Lawvere theories X together with maps
e ∈ X(n, n + k) e† ∈ X(n, k)
E´sik [12], i.e.,

satisfying no axioms.
For every base morphism (function)
v : n 	zm,



in Set

we now formulate an equation in the above signature Σ expressing functoriality
w.r.t this morphism v: for all morphisms e : n 	zn,+ k and f : m 	zm,+ k
this equation ensures that

n 	e	zn ,+ k

n ¸¸¸¸ †
¸ 

v	v+id
,	, 
implies
v	...˛k ,
,....†

zm,+ k
f


Our equation uv, u'
: p 	zFΣ,(r) works with p free on one generator g : n 	zk,,
p = Tg:	zm ,

and with r given by the quotient
r = Te,f /≈
of the free theory on two generators e : n 	zn,+ k and f : m 	zm,+ k modulo the smallest congruence ≈ with




Before specifying uv, u'
f·v ≈ (v + id)·e
we observe that the congruence classes

[e] ∈ r(n, n + k)	and	[f ] ∈ r(m, m + k)
yield in
HΣ(r) =   r(i, i + j) • Th†:i	jz, i,j∈N

two coproduct injections


ine : Th†:n
kz,
zH,Σ(r)	and	inf : Th†:m
kz,
zH,Σ(r),

respectively. Hence, in the theory HΣ(r) we have the two parallel morphisms


ine(h†)
zk ,
v	inf (h†)
n	zm,	zk ,


(recall that v : n	zm,is a base morphism in every theory). Using the canonical morphism κr : HΣ(r)		zFΣ,(r) of A.5 we obtain two elements
κr(ine(h†)), κr(inf (h†)·v) ∈ FΣ(r)(n, k)


Our equation

uv, u'

: p = Tg 	zFΣ,(r)

is given by the above two elements. It is easy to see that a preiteration theory satisfies this equation iff the functoriality holds for the given base morphism v. The collection of all these equations indexed by all the base morphisms v yields the axiomatization of functoriality.
