Available online at www.sciencedirect.com


Electronic Notes in Theoretical Computer Science 322 (2016) 69–86
www.elsevier.com/locate/entcs

The Decision Problem for a Three-sorted Fragment of Set Theory with Restricted Quantification and Finite Enumerations ?
Domenico Cantone1  Marianna Nicolosi-Asmundo2
Dept. of Mathematics and Computer Science, University of Catania, Italy

Abstract
We solve the satisfiability problem for a three-sorted fragment of set theory (denoted 3LQSTR), which admits a restricted form of quantification over individual and set variables and the finite enumeration operator {-, -,.. ., -} over individual variables, by showing that it enjoys a small model property, i.e., any
satisfiable formula ψ of 3LQSTR has a finite model whose size depends solely on the length of ψ itself. Several set-theoretic constructs are expressible by 3LQSTR-formulae, such as some variants of the power
set operator and the unordered Cartesian product. In particular, concerning the latter construct, we show that when finite enumerations are allowed, the resulting formula is exponentially shorter than in their absence.
Keywords: Satisfiability problem, set theory, restricted quantification, finite enumerations.


Introduction
Computable set theory studies the decidability problem for specific collections of set-theoretic formulae (also called syllogistics). The main results in computable set theory up to 2001 have been collected in [7,13]. We also mention that the most efficient decision procedures for fragments of set theory form the inferential core of the proof verifier ÆtnaNova [17].
In this paper we present a decidability result for the satisfiability problem of the set-theoretic language 3LQSTR (Three-Level Quantified Syllogistic with finite enumeraTions and Restricted quantifiers), which is a three-sorted quantified syllo- gistic involving individual variables, set variables, and collection variables, ranging

٨ This work has been partially supported by the Polish National Science Centre research project DEC- 2011/02/A/HS1/00395.
1 Email: cantone@dmi.unict.it
2 Email: nicolosi@dmi.unict.it

http://dx.doi.org/10.1016/j.entcs.2016.03.006
1571-0661/© 2016 The Authors. Published by Elsevier B.V.
This is an open access article under the CC BY-NC-ND license (http://creativecommons.org/licenses/by-nc-nd/4.0/).

over the elements of a given nonempty universe D, the subsets of D, and the collec- tions of subsets of D, respectively. The language of 3LQSTR admits the predicate symbols = and ∈ and a restricted form of quantification over individual and set variables. The language 3LQSTR extends 3LQSR presented in [9] as it admits the finite enumeration operator {-, -,... , -} over individual variables. In spite of its sim- plicity, 3LQSTR allows one to express several constructs of set theory. Among them, the most comprehensive one is the set former, which in turn allows one to express other set-theoretic operators like some variants of the power set and the unordered Cartesian product. Concerning the latter, we will see that it can be expressed by 3LQSTR-formulae of linear length. On the other hand, if the finite enumeration operator is dropped, exponentially long 3LQSR-formulae are required to express it. Much as for 3LQSR, we will show that the fragment 3LQSTR enjoys a small model property. The proof is carried out by showing how to extract, out of a given model satisfying a 3LQSTR-formula ψ, another model of ψ but of bounded finite
cardinality.
The paper is organized as follows. In Section 2 we introduce some related work in computable set theory concerning multi-sorted stratified syllogistics. Then, in Section 3, we first present the syntax and semantics of a more general language, denoted 3LQST0, and then provide a decidable semantic restriction to characterize the fragment 3LQSTR of our interest. Subsequently, in Section 4, we show that several set-theoretic constructs are readily expressible by 3LQSTR-formulae. In Section 5, the machinery needed to prove our main decidability result is provided and, in Section 6, the small model property for 3LQSTR is sketched, thus solving the satisfiability problem for 3LQSTR. Then, in Section 7 we present two distinct representations of the unordered Cartesian product. The first one, using the finite enumeration operator, is linear in the length of the product, the second one, not involving the finite enumeration operator, is exponentially longer. Finally, in Section 8, we draw our conclusions.

Related work
Most of the decidability results established in computable set theory concern one- sorted multi-level syllogistics, namely collections of formulae involving variables of one type only, ranging over the von Neumann universe of sets. On the other hand, few decidability results have been proved for multi-sorted stratified syllogistics, ad- mitting variables of several types. This, despite of the fact that in many fields of computer science and mathematics often one deals with multi-sorted languages.
An efficient decision procedure for the satisfiability of the Two-Level Syllogistic language (2LS), a fragment admitting variables of two sorts (for individuals and for sets of individuals), the basic set-theoretic operators such as ∪, ∩, \, the relators =,
∈, ⊆, and propositional connectives, has been presented in [15]. The three-sorted language 3LSSPU (Three-Level Syllogistic with Singleton, Powerset, and general Union), allowing three types of variables, and the singleton, powerset, and general union operators, in addition to the operators and predicates already in 2LS, has

been proved decidable in [4].
More recently, in [9], the three-level quantified syllogistic 3LQSR, involving vari- ables of three sorts has been shown to have a decidable satisfiability problem. The decision algorithm for 3LQSR was inspired by the procedure presented in [4] to prove the decidability of 3LSSPU. In particular, the notion of relativized interpre- tation introduced in [9], can be seen as a variant of the notion of assignment of the small model defined in [4]. The language 3LQSR, as well as its extension 3LQSTR introduced in this paper, does not allow one to express the construct of general union. The latter construct, on the other hand, is a primitive operator of 3LSSPU. Later, in [10], the satisfiability problem for 4LQSR, a four-level quantified syllo- gistic admitting variables of four sorts, has been proved to be decidable. The latter result has been exploited in [8] to prove that the quite expressive description logic
DL⟨4LQSR⟩(D) has a decidable consistency problem for its knowledge bases.

The language 3LQST0 and its fragment 3LQSTR
We begin by defining the syntax and semantics of a more general three-level quan- tified language, denoted 3LQST0. Then, in Section 3.1, we characterize 3LQSTR-
formulae by suitably restricting the usage of quantifiers in 3LQST0-formulae.
The three-level quantified language 3LQST0 involves
a collection V0 of individual (or sort 0) variables, denoted by x, y, z,.. .;
a collection V1 of set (or sort 1) variables, denoted by X, Y, Z,.. .;
a collection V2 of collection (or sort 2) variables, denoted by A, B, C,.. ..
In addition to variables, 3LQST0 admits also terms of the form {x1,... , xk} (ﬁnite enumerations), where x1,... , xk are pairwise distinct individual variables with k ≥ 1.
3LQST0-quantiﬁer-free atomic formulae are classified as:
level 0: x = y, x ∈ X, X = {x1,... , xk}, {x1,... , xk}∈ A, where x, y, x1,... , xk ∈ V0, k ≥ 1, X ∈ V1, and A ∈ V2;
level 1: X = Y , X ∈ A, where X, Y ∈ V1 and A ∈ V2. 3LQST0 purely universal formulae are classified as:
level 0: (∀z1) ... (∀zn)ϕ0, with ϕ0 a propositional combination of level 0 quantifier- free atoms and z1,... , zn ∈ V0, where n ≥ 1; 3
level 1: (∀Z1) ... (∀Zm)ϕ1, with ϕ1 a propositional combination of quantifier- free atomic formulae of any level and of purely universal formulae of level 0, and Z1,... , Zm ∈ V1, where m ≥ 1.
Finally, the formulae of 3LQST0 are all the propositional combinations of quantifier- free atomic formulae and of purely universal formulae of levels 0 and 1.

3 The logical connectives admitted in propositional combinations are the usual ones: negation ¬, conjunc- tion ∧, disjunction ∨, implication →, and biimplication ↔.

To ease readability, we will write (∃z1) ... (∃zn)ϕ0 and (∃Z1) ... (∃Zm)ϕ1 as shorthands for ¬(∀z1) ... (∀zn)¬ϕ0 and ¬(∀Z1) ... (∀Zm)¬ϕ1, respectively.
A 3LQST0-interpretation is a pair M = (D, M ), where D is any nonempty collection of objects, called the domain or universe of M, and M is an assignment over the variables of 3LQST0 such that
Mx ∈ D, for each individual variable x ∈ V0;
MX ⊆ D, for each set variable X ∈ V1;
MA ⊆ pow(D), for all collection variables A ∈ V2; 4
M {x1,... , xk} = Def {Mx1,... ,Mxk}.
Next, let M = (D, M ) be a 3LQST0-interpretation, and let x1,... , xn ∈ V0,
X1,... , Xm ∈ V1, u1,... , un ∈ D, and U1,... , Um ∈ pow(D).
By M[z1/u1,... , zn/un, Z1/U1,... , Zm/Um] we denote the 3LQST0-interpretation Mj = (D, M j) such that M jzi = ui (for i = 1, ..., n), M jZj = Uj (for j = 1, ..., m), and which otherwise coincides with M on the remaining variables. In addition, for
any Vj ⊆ Vi (with i = 0, 1, 2), we set M Vj = Def {Mξ : ξ ∈ Vj}.
i	i	i
Throughout the paper we will use the abbreviations:


Mz =
M[z /u ,... ,z /u ],	MZ  =	M[Z /U ,... ,Z  /U  ],

Def	1	1	n	n	Def	1	1	m	m

where the variables zi and Zj, the individuals ui, and the subsets Uj are understood from the context.
Let ψ be a 3LQST0-formula and let M = (D, M ) be a 3LQST0-interpretation. The notion of satisﬁability for ψ with respect to M (denoted by M |= ψ) is defined recursively over the structure of ψ. The evaluation of quantifier-free atomic formulae is carried out according to the standard meaning of the predicates ‘∈’ and ‘=’ and of the finite enumeration operator. Purely universal formulae are interpreted as follows:
M |= (∀z1) ... (∀zn)ϕ0	iff	M[z1/u1,... , zn/un] |= ϕ0, for all u1,... , un ∈ D;
M |= (∀Z1) ... (∀Zm)ϕ1	iff	M[Z1/U1,... , Zm/Um] |= ϕ1, for all U1,... , Un ⊆ D.
Finally, compound formulae are evaluated according to the standard rules of propo- sitional logic.
Let ψ be a 3LQST0-formula. If M |= ψ (i.e., M satisﬁes ψ), then M is said to be a 3LQST0-model for ψ. A 3LQST0-formula is said to be satisﬁable if it has a 3LQST0-model. A 3LQST0-formula is valid if it is satisfied by all 3LQST0- interpretations.


4 We recall that pow(s) denotes the power set of s.

Characterizing the restricted fragment 3LQSTR
3LQSTR is the collection of all 3LQST0-formulae ψ such that, for every purely uni- versal formula (∀Z1) ... (∀Zm)ϕ1 of level 1 occurring in ψ and every purely universal formula (∀z1) ... (∀zn)ϕ0 of level 0 occurring in ϕ1, the condition
n  m
¬ϕ0 →	zi ∈ Zj	(1)
i=1 j=1
is a valid 3LQST0-formula (in which case we say that the purely universal formula (∀z1) ... (∀zn)ϕ0 is linked to the variables Z1,... , Zm).
Condition (1) guarantees that, if a given interpretation assigns to z1,... , zn elements of the domain that make ϕ0 false, then all such values must be contained as elements in the intersection of the sets assigned to Z1,... , Zm. This fact has been introduced for technical reasons and it is used in the proof of Lemma 5.7 (which can be found in the extended version of the present paper in [11]) to make sure that satisfiability is preserved in the finite model. Attempts of relaxing such a condition (still maintaining decidability) failed so far.
The following question arises: how can one establish whether a given 3LQST0- formula is a 3LQSTR-formula? Observe that neither quantification nor collection variables are involved in condition (1). Indeed, it turns out that (1) is a 2LS-formula and therefore its validity can be tested by the decision procedure in [15], as 3LQST0 is a conservative extension of 2LS. As we will see in the next section, in most cases of interest condition (1) is just an instance of the elementary propositional tautology
¬(p → q) → p. In such cases, the validity of (1) follows just by inspection.
Expressiveness of the language 3LQSTR
Several constructs of elementary set theory are easily expressible within the language 3LQSTR. In particular, it is possible to express with 3LQSTR-formulae a restricted
0	0
variant of the set former. This, in turn, allows one to express other significant set
operators such as binary union, intersection, set difference, set complementation, the powerset operator and some of its variants, and so on. More specifically, a set former of the form X = {z : ϕ(z)} can be expressed in 3LQSTR by the formula
(∀z)(z ∈ X ↔ ϕ(z))	(2)
(in which case it is called an admissible set former of level 0 for 3LQSTR), provided that after transforming it into prenex normal form, the resulting formula satisfies the syntactic constraints of 3LQSTR. This, in particular, is always the case whenever ϕ(z) is a quantifier-free formula of 3LQSTR.
In Table 1 some examples of formulae expressible by admissible set formers of level 0 for 3LQSTR are reported, where 0 and 1 stand respectively for the empty set and for the domain of the discourse, and · is the complementation operator with respect to the domain of the discourse. The formulae in the first column of Table 1



Table 1
Some literals expressible by admissible set formers of level 0 for 3LQSTR.

are the atoms allowed in the fragment 2LS (Two-Level Syllogistic) which has been proved decidable in [15]. Since X = {x1,... , xk} is a level 0 quantifier-free atomic formula in 3LQSTR, 2LS with finite enumerations turns out to be expressible by 3LQSTR-formulae.
In addition to the formulae in Table 1, the following literals
Z ⊆ X,  |Z| ≤ h,	|Z| < h +1 ,  |Z| ≥ h +1 ,	|Z| = h	(3)
are also expressible by 3LQSTR-formulae of level 0, where h stands for a nonnegative integer constant (cf. Table 2). In fact, it turns out that all literals (3) can be expressed by level 0 purely universal 3LQSTR-formulae which are linked to the variable Z, so that they can freely be used in the matrix ϕ(Z) of a level 1 universal formula of the form (∀Z)ϕ(Z). Let us consider, for instance, the formula


(∀z1) ... (∀zh+1)
1≤i≤h+1

zi ∈ Z →
1≤i<j≤h+1

zi = zj	(4)

which expresses the literal |Z| ≤ h. The linkedness condition for it, relative to the variable Z, is


¬
1≤i≤h+1
zi ∈ Z →
1≤i<j≤h+1
zi = zj	→
1≤i≤h+1
zi ∈ Z, 


which is plainly a valid 3LQSTR-formula since it is an instance of the propositional tautology ¬(p → q) → p, showing that (4) is linked to the variable Z. Similarly, one can show that the remaining formulae in (3) can also be expressed by level 0 purely universal 3LQSTR-formulae which are linked to the variable Z.
Similar remarks apply also to the set former of the form A = {Z : ϕ(Z)}. This can be expressed by the 3LQSTR-formula
(∀Z)(Z ∈ A ↔ ϕ(Z))	(5)
(in which case it is called an admissible set former of level 1 for 3LQSTR) provided that ϕ(Z) does not contain any quantifier over variables of sort 1, and all quantified variables of sort 0 in ϕ(Z) are linked to the variable Z according to condition (1).



Table 2
Further formulae expressible by 3LQSTR-formulae of level 0.

admissible set formers of level 1 for 3LQSTR
Table 3
Some literals expressible by admissible set formers of level 1 for 3LQSTR.

Some examples of formulae expressible by admissible set formers of level 1 for 3LQSTR are reported in Table 3. In this case the symbol 1 stands for the powerset of the domain of the discourse. The meaning of the overloaded symbol 1 can always be correctly disambiguated from the context. In view of the fact that, as already remarked, the literals (3) can be expressed by level 0 purely universal 3LQSTR- formulae which are linked to the variable Z, it follows that all set formers in Table 3 are indeed admissible.
Propositional combinations of the following literals

(6)

presented in the first column of Table 3 form a proper fragment of 3LSSPU (Three- Level Syllogistic with Singleton, Powerset, and Unionset) whose decision problem has been solved in [4]. We recall that in addition to the formulae in (6), 3LSSPU involves also unionset clauses of the form X =  A (with X a variable of sort 1 and A a variable of sort 2) which, however, are not expressible by 3LQSTR-formulae.
Besides the ordinary powerset operator, 3LQSTR-formulae allow one also to

express the variants pow≤h(X), pow=h(X), and pow≥h(X) reported in Table 3, which denote, respectively, the collection of all the subsets of X with at most h distinct elements, with exactly h elements, and with at least h distinct elements. We observe that the satisfiability problem for the propositional combination of literals of the forms x ∈ y, x = y ∪ z, x = y ∩ z, x = y \ z, with at most one literal of the form y = pow=1(x), has been proved decidable in [6], when set variables are interpreted in the von Neumann hierarchy of sets (cf. [16]).
A useful variant of the powerset is the pow∗ operator, introduced in the solution to the satisfiability problem for the extension of MLS with the powerset and single- ton operators (cf. [3,12]). We recall that given sets X1,... , Xk, pow∗(X1,... , Xk)
denotes the collection of all the subsets of	k	Xi which have nonempty intersection with each set Xi, for i = 1,... , k. In symbols,

pow∗(X1,... , Xk) =


Def
 Z : Z ⊆  k

Xi ∧  k
Z ∩ Xi /= ∅,

=	 Z : Z ⊆  k	Xi ∧  k	¬(Z ⊆ Xi), .

From the latter expression, it follows that the literal A = pow∗(X1,... , Xk) can be readily expressed by a 3LQSTR-formula.

Relativized interpretations
Small models of satisfiable 3LQSTR-formulae will be expressed in terms of relativized interpretations with respect to a suitable (small) domain.
Definition 5.1 (Relativized interpretation) Let M = (D, M ) bea 3LQST0-inter-
pretation and let D∗ ⊆ D, d∗ ∈ D∗, and Vj ⊆ V1. The relativized interpretation
Rel(M, D∗, d∗, Vj ) of M with respect to D∗, d∗, and Vj is the interpretation M∗ =
1	1
(D∗,M ∗) such that

M ∗x =
Mx,	if Mx ∈ D∗ d∗ ,	otherwise

M ∗X = MX ∩ D∗
M ∗A = MA ∩ pow(D∗) \ M ∗Vj  ∪ {M ∗X : X ∈ Vj , MX ∈ M A} .
For ease of notation, sometimes we will omit the reference to the element d∗ ∈ D∗
and write simply Rel(M, D∗, Vj ) in place of Rel(M, D∗, d∗, Vj ).	2
1	1
Our goal is to show that any satisfiable 3LQSTR-formula ψ is satisfied by a small model of the form Rel(M, D∗, Vj ), where M = (D, M ) is a model of ψ, D∗
is a subset of D of bounded finite size, and Vj ⊆ V1 is a suitable collection of set
variables of bounded size.
Example 5.2 Consider the formula
ψ ≡ (∀Z)(Z ∈ A ↔ (∃x1)(∃x2)(x1 ∈ X1 ∧ x2 ∈ X2 ∧ {x1, x2} = Z))
∧(∀z)(z ∈ X1 → z ∈/ X2).

ψ is satisfied by the 3LQST0-interpretation M = (D, M ) such that D = {0, 1,.. .} is the set of natural numbers, M X1 = {0, 2, 4,.. .} is the set of even natural numbers, M X2 = {1, 3, 5,.. .} is the set of odd natural numbers, and MA =
{{0, 1}, {2, 1}, {0, 3}, {2, 3},. . .} is the unordered Cartesian product of M X1 and
M X2.
Let D∗ = {0, 1, 2, 3, 4, 5}, d∗ any element of D∗, and Vj = {X1, X2}. Then, ac- cording to Definition 5.1, M∗ = Rel(M, D∗, d∗, Vj ) interprets the variables X1, X2,
and A as follows:
M ∗X1 = {0, 2, 4},
M ∗X2 = {1, 3, 5}, and
M ∗A = {{0, 1}, {0, 3}, {0, 5}, {2, 1}, {2, 3}, {2, 5}, {4, 1}, {4, 3}, {4, 5}}.
It is easy to check that M∗ |= ψ as well.
We start by stating a slightly stronger result for propositional combinations of quantifier-free atomic 3LQSTR-formulae of levels 0 and 1.
Lemma 5.3 Let M = (D, M ) and M∗ = Rel(M, D∗, d∗, Vj ) be, respectively, a 3LQST0-interpretation and the relativized interpretation of M with respect to
D∗ ⊆ D, d∗ ∈ D∗, and Vj ⊆ V1. Furthermore, let K be a ﬁxed positive number,
ψ0 a level 0 quantiﬁer-free atomic formula of the form x = y or x ∈ X, with

x, y ∈ V0 and X ∈ V1, ψj
a level 0 quantiﬁer-free atomic formula of the form

X = {x1,... , xk} or {x1,... , xk} ∈ A, with x1,... , xk ∈ V0, X ∈ V1, A ∈ V2, k ≤ K, and let ψ1 be a level 1 quantiﬁer-free atomic formula of the form X = Y or X ∈ A, with X, Y ∈ Vj , and A ∈ V2. Then we have:
if Mx ∈ D∗, for every x ∈ V0 in ψ0, then  M |= ψ0 iff M∗ |= ψ0;
if (b1) Mx ∈ D∗, for every x ∈ V0 in ψj , (b2) M ∗X = MX, if |MX| ≤ K, and |M ∗X| > K otherwise, for every X ∈ Vj , and (b3) M ∗X = MX, for
X ∈ V1 \ Vj occurring in ψj , then	M |= ψj iff M∗ |= ψj ;
1	0	0	0
if (c1) M ∗X = MX, if |MX| ≤ K, and |M ∗X| > K otherwise, for X ∈ Vj ,

and (c2) (MX Δ MY ) ∩ D∗ /= ∅, 5 for all X, Y ∈ Vj
such that MX /= MY ,

then M |= ψ1 iff M∗ |= ψ1.
The interested reader can find the proof of the preceding lemma in [11]. By propositional logic, Lemma 5.3 implies at once the following result.
Corollary 5.4 Let M = (D, M ) and M∗ = Rel(M, D∗, d∗, Vj ) be, respectively, a 3LQST0-interpretation and the relativized interpretation of M with respect to D∗ ⊆ D, d∗ ∈ D∗, and Vj ⊆ V1. Furthermore, let K ≥ 1 and let ψ be a propositional combination of quantiﬁer-free atomic formulae of the types
x = y, x ∈ X , X = {x1,... , xk} , {x1,... , xk}∈ A, X = Y , X ∈ A
such that

5 We recall that Δ denotes the symmetric difference operator defined by s Δ t = (s \ t) ∪ (t \ s).

Mx ∈ D∗, for every level 0 variable x in ψ;
k ≤ K;
X ∈ Vj , for every variable X of level 1 in quantiﬁer-free atomic formulae of level 1 (namely of the form X = Y or X ∈ A) occurring in ψ;
M ∗X = MX, if |MX| ≤ K, and |M ∗X| > K, otherwise, for every X ∈ Vj ;

(MX Δ MY ) ∩ D∗ /= ∅, for all X, Y ∈ Vj
such that MX /= MY ;

Then M |= ψ if and only if M∗ |= ψ.
The preceding corollary yields at once a small model property for the collection 3LST0 of propositional combinations of quantifier-free atomic formulae of the types
x = y, x ∈ X , X = {x1,... , xk} , {x1,... , xk}∈ A, X = Y , X ∈ A. 
Indeed, let ψ be a satisfiable 3LST0-formula and M = (D, M ) a model for it. Also, let Kψ be the maximal length of any finite enumeration {x1,... , xk} occurring in
ψ, and let Vψ and Vψ be the collections of variables of levels 0 and 1, respectively,
0	1
occurring in ψ.
We construct a small model for ψ as follows. Let D1 be a subset of D of cardinality not larger than (Kψ + 1) · |Vψ| and such that |J ∩ D1| ≥ min(Kψ + 1, |J|),
for every J ∈ M Vψ. For each pair of variables X, Y ∈ Vψ such that MX /= MY ,
1	1
select an element dXY ∈ MX Δ MY . Then we put
D∗ =	M Vψ ∪ {dXY : X, Y ∈ Vψ , MX /= MY }∪ D1 
and select an arbitrary element d∗ in D∗. Then, from Corollary 5.4 it follows that the relativized interpretation M∗ = Rel(M, D∗, Vψ) is a small model for ψ, as
|D∗| ≤ |Vψ| + (Kψ + 1) · |Vψ| + |Vψ|2. In fact, by suitably choosing the elements
0	1	1
dXY in MX Δ MY , we can enforce the bound |D∗| < |Vψ| + (Kψ + 2) · |Vψ| (see
0	1
[5]). Summing up, the following result holds:
Lemma 5.5 (Small model property for 3LST0-formulae) Let ψ be a 3LST0- formula, i.e., a propositional combination of quantiﬁer-free atomic formulae of the following types
x = y, x ∈ X , X = {x1,... , xk} , {x1,... , xk}∈ A, X = Y , X ∈ A. 
Also, let Kψ be the maximal length of any ﬁnite enumeration {x1,... , xk} occurring

in ψ, and let Vψ
and Vψ
be the collections of variables of sort 0 and of sort 1

occurring in ψ, respectively. Then ψ is satisﬁable if and only if it is satisﬁed by a
3LQST0-interpretation M = (D, M ) such that |D| < |Vψ| + (Kψ + 2) · |Vψ|.
0	1
Since the 3LQST0-interpretations over a bounded domain are finitely many and they can be effectively generated, the decidability of the satisfiability problem for 3LST0-formulae follows.

To state the main results for quantified formulae, namely that the relativized interpretation M∗ = Rel(M, D∗, d∗, Vj ) of a model M = (D, M ) for a purely universal 3LQSTR-formula ψ of level 0 or 1 also satisfies ψ, under suitable conditions on D∗ and Vj ⊆ V1 (see Lemmas 5.6 and 5.7 below), it is convenient to introduce the following abbreviations:

Mz,∗ =
M∗,z =

Def
Rel(Mz, D∗, d∗, Vj )
M∗[z /u ,... ,z /u ]

Def	1	1	n	n

MZ,∗  =

Def
Rel(MZ, D∗, d∗, Vj )

M∗,Z =
M∗[Z /U ,... ,Z  /U  ] .

Def	1	1	m	m
Lemma 5.6 Let M = (D, M ) be a 3LQST0-interpretation, K a ﬁxed positive

number, D∗ ⊆ D, d∗ ∈ D∗, Vj
⊆ V1, and let M∗ = Rel(M, D∗, d∗, Vj ) be such

that M ∗X = MX, if |MX| ≤ K, and |M ∗X| > K otherwise, for every X ∈ Vj . Furthermore, let (∀z1) ... (∀zn)ϕ0 be a purely universal 3LQSTR-formula of level 0
such that
Mx ∈ D∗, for every x ∈ V0 occurring free in it;
each enumeration term {x1,... , xk} in ψ has size at most K (i.e., k ≤ K);
M ∗X = MX, for every variable X in ψ such that X ∈ V1 \ Vj .
Then	M |= (∀z1) ... (∀zn)ϕ0 =⇒ M∗ |= (∀z1) ... (∀zn)ϕ0 .

Lemma 5.7 Let M = (D, M ) be a 3LQST0-interpretation, D∗ ⊆ D, d∗ ∈ D∗,
Vj ⊆ V1, M∗ = Rel(M, D∗, d∗, Vj ), K ≥ 1, and let (∀Z1) ... (∀Zm)ϕ1 be a purely
1	1
universal 3LQSTR-formula of level 1 such that
Z1,... , Zm ∈/ Vj ;
X ∈ Vj , for every variable X ∈ V1 occurring free in (∀Z1) ... (∀Zm)ϕ1;
Mx ∈ D∗, for every variable x ∈ V0 occurring free in (∀Z1) ... (∀Zm)ϕ1;
M ∗X = MX, if |MX| ≤ K, and |M ∗X| > K otherwise, for every X ∈ Vj ;

(MX Δ MY ) ∩ D∗ /= ∅, for all X, Y ∈ Vj
such that MX /= MY ;

each enumeration term {x1,... , xk} in ϕ1 has size at most K;
for every purely universal formula (∀z1) ... (∀zn)ϕ0 of level 0 occurring in ϕ1
and variables X1,... , Xm ∈ Vj such that M |= ((∀z1) ... (∀zn)ϕ0)Z1 ,...,Zm ,
there are u1,... , un ∈ D∗ such that M[z1/u1,... , zn/un] |= (ϕ0)Z1 ,...,Zm ; 6
Then	M |= (∀Z1) ... (∀Zm)ϕ1 =⇒ M∗ |= (∀Z1) ... (∀Zm)ϕ1 .

Proofs of Lemmas 5.6 and 5.7 can be found in [11].




6 Given a formula ψ and variables X1,.. ., Xm, Z1,. .., Zm, by ψZ1,...,Zm
we mean the formula obtained

by simultaneously substituting each occurrence of Zi in ψ with Xi for every i ∈ {1,.. ., m}.

The satisfiability problem for 3LQSTR-formulae
We will solve the satisfiability problem for 3LQSTR as follows:
firstly, we will reduce effectively the satisfiability problem for 3LQSTR-formulae to the same problem for normalized 3LQSTR-conjunctions (these will be de-
fined precisely below);
secondly, we will prove that the collection of normalized 3LQSTR-conjunctions
enjoys a small model property.
From (a) and (b), the solvability of the satisfiability problem for 3LQSTR will follow
immediately.

Normalized 3LQSTR-conjunctions
Let ψ be a formula of 3LQSTR and let ψDNF be a disjunctive normal form of ψ. We observe that the disjuncts of ψDNF are conjunctions of 3LQSTR-literals, namely quantifier-free atomic formulae of levels 0 and 1, or their negations, and of purely universal formulae of levels 0 and 1, or their negations, satisfying the linkedness condition (1).
By a suitable renaming of variables, we can assume that no bound variable can occur in more than one quantifier in the same disjunct of ψDNF and that no variable can have both bound and free occurrences in the same disjunct.
Without disrupting satisfiability, we replace negative literals of the form
¬(∀z1) ... (∀zn)ϕ0 and ¬(∀Z1) ... (∀Zm)ϕ1 occurring in ψDNF by their negated ma- trices ¬ϕ0 and ¬ϕ1, respectively, since for any given 3LQST0-interpretation M = (D, M ) one has M |= ¬(∀z1) ... (∀zn)ϕ0 if and only if M[z1/u1,... , zn/un] |= ¬ϕ0, for some u1,... , un ∈ D, and, likewise, M |= ¬(∀Z1) ... (∀Zm)ϕ1 if and only if M[Z1/U1,... , Zm/Um] |= ¬ϕ1, for some U1,... , Um ∈ pow(D). Then, if needed, we bring back the resulting formula into disjunctive normal form, eliminate as above the residual negative literals of the form ¬(∀z1) ... (∀zn)ϕ0 which might have been intro- duced by the previous elimination of negative literals of the form ¬(∀Z1) ... (∀Zm)ϕ1 from ψDNF, and transform again the resulting formula into disjunctive normal form.

Let ψj
be the formula so obtained. Observe that all the above steps preserve

satisfiability, so that our initial formula ψ is satisfiable if and only if so is ψj	.

In addition, the formula ψj
is satisfiable if and only if so is at least one of its

disjuncts.
It is an easy matter to check that each disjunct of ψj

is a conjunction of

3LQSTR-literals of the following types (I,II,III):


x = y,	x ∈ X,	X = {x1,... , xk} ,	{x1,... , xk}∈ A, 
¬(x = y) ,	¬(x ∈ X) ,	¬(X = {x1,... , xk}) ,	¬({x1,... , xk}∈ A) , X = Y ,		X ∈ A,		¬(X = Y ) ,		¬(X ∈ A) ,

(I)

where x, y, x1,... , xk ∈ u0, X, Y ∈ u1, and A ∈ u2;
(6z1) ... (6zn)ϕ0 ,	(II)
where n ≥ 1 and ϕ0 is a propositional combination of quantifier-free level 0 atoms; and
(6Z1) ... (6Zm)ϕ1 ,	(III)
where m ≥ 1 and ϕ1 is a propositional combination of quantifier-free atomic for- mulae of any level and of purely universal formulae of level 0, where the proposi- tional components in ϕ1 of type (6z1) ... (6zn)ϕ0 are linked to the bound variables Z1,... , Zm.
We call such formulae normalized 3LQSTR-conjunctions.
The above discussion can then be summarized in the following lemma.
Lemma 6.1 The satisﬁability problem for 3LQSTR-formulae can be effectively re- duced to the satisﬁability problem for 3LQSTR-conjunctions.

A small model property for normalized 3LQSTR-conjunctions
Let ψ be a normalized 3LQSTR-conjunction and assume that M = (D, M ) is a model for ψ. We show how to construct, out of M, a finite small 3LQST0- interpretation M∗ = (D∗,M ∗) which is a model of ψ. We proceed as follows. First we outline a procedure to build a nonempty finite universe D∗ ⊆ D whose size depends solely on ψ and can be computed a priori. Then, following Definition 5.1, we construct a relativized 3LQST0-interpretation M∗ = (D∗,M ∗) with respect to a suitable collection uj of variables, and show that it satisfies ψ.

Construction of the universe D∗
Let uψ, uψ, and uψ be the collections of the variables of sort 0, 1, and 2 occurring
0	1	2
in ψ, respectively, and let Kψ be smallest integer such that k ≤ Kψ, for every finite
enumeration term {x1,... , xk} occurring in ψ. We construct the domain D∗ by means of the procedure below.
Let ψ1,... , ψh be the conjuncts of ψ of the form (III). To each such conjunct ψi ≡ (6Zi1) ... (6Zimi )ϕi, we associate the collection ϕi1,... , ϕili of the purely universal atomic formulae of level 0 occurring in its matrix ϕi and call the variables Zi1,... , Zimi the arguments of ϕi1,... , ϕili . Then we put
Φψ = Def {ϕij :1 ≤ i ≤ h and 1 ≤ j ≤ li}.

By applying the procedure Distinguish described in [5] to the collection M uψ,
it is possible to construct a set D0 such that
MX ∩ D0 /= MY ∩ D0, for all X, Y ∈ uψ such that MX /= MY , and
|D0| ≤ |uψ|— 1.

Next, we construct a set D1 such that |J ∩ D1| ≥ min(Kψ + 1, |J|), for every
J ∈ M uψ. Plainly, we can assume that |D1| ≤ (Kψ + 1) · |uψ|.
1	1
Then, after initializing D∗ to the set M uψ ∪ (D0 ∪ D1), we insert in D∗ elements

u1,... , un ∈ D such that M[z1/u1,... , zn/un] |= (ϕ0)Z1 ,..., Zm
1	m
, for each ϕ ∈ Φψ

of the form (6z1) ... (6zn)ϕ0 having Z1,... , Zm as arguments and for each ordered
m-tuple (Xi ,... , Xi ) of variables in uψ such that M |= ϕZ1 ,..., Zm .

1	m	1
Xi1 ,...,Xim

The above construction yields easily that
|D∗| ≤ |uψ| + (lψ + 2) · |uψ|— 1+ Nψ · |uψ|Lψ · |Φψ| ,	(7)
0	1	1
where Lψ and Nψ are, respectively, the maximal number of quantifiers in any purely universal formula of level 1 in Φψ and the maximal number of quantifiers in purely universal formulae of level 0 occurring in any purely universal formula of level 1 in Φψ. Thus, in general, the size of the domain D∗ is exponential in the size of the input formula ψ.
Correctness of the relativization

Let M∗ =
Def
Rel(M, D∗, d∗, uψ). The next theorem, whose proof can be found in

[11], states that if M |= ψ, then M∗ |= ψ.
Theorem 6.2 Let M be a 3LQST0-interpretation satisfying a normalized 3LQSTR- conjunction ψ. Further, let M∗ = Rel(M, D∗, d∗, uψ) be the 3LQST0-interpretation deﬁned according to Deﬁnition 5.1, where D∗ is constructed as above and uψ is the
collection of variables of level 1 occurring in ψ. Then M∗ |= ψ.
The above reduction and relativization steps yield easily the following result:
Corollary 6.3 The fragment 3LQSTR enjoys a small model property (and therefore
its satisﬁability problem is solvable).

Much as in [10], it is possible to define a class of subtheories (3LQSTR)h of 3LQSTR, for h ≥ 2, having an NP-complete satisfiability problem. In addition to certain syntactic constraints (see [10]), all quantifier prefixes in (3LQSTR)h- formulae have length bounded by the constant h. It turns out that such subtheories are quite expressive: in fact, several set-theoretic constructs considered in Section 4 (such as, for instance, some variants of the powerset operator) can be expressed in them. Moreover, it can be shown that the modal logic S5 can be represented in (3LQSTR)3.

The unordered Cartesian product
Given sets X1,... , Xn, the unordered Cartesian product X1 ⊗ ... ⊗ Xn is the set
X1 ⊗ ... ⊗ Xn = Def {x1,... , xn} : x1 ∈ X1,... , xn ∈ Xn, .

Then, the literal

A = X1 ⊗ ... ⊗ Xn ,	(8)

where A is a variable of level 2 and X1,... , Xn are variables of level 1, can be expressed by the 3LQSTR-formula


(6Z) Z ∈ A →→ (∃x1) ... (∃xn)   n

xi ∈ Xi ∧ {x1,... , xn} = Z  .	(9)


One may wonder if it is possible to express the Cartesian product (8) without making use of the finite enumeration operator (hence, by a 3LQSR-formula). Since the atom {x1,... , xn} = Z can be expressed by the 3LQSR-formula
(6z)(z ∈ Z ↔  n	z = xi) ,	(10)
a straightforward attempt consists in replacing the occurrence of {x1,... , xn} = Z
in (9) with (10). The resulting formula:


(6Z) 

n
Z ∈ A →→ (∃x1) ... (∃xn)(6z)
i=1

xi ∈ Xi ∧ (z ∈ Z ↔



i =1

z = xi)  ,

however, is not in 3LQSR because the formula
  ^n	 
		

	
is not a purely universal formula of level 0, and the variables x1,... , xn are not linked to Z. As we will see below, in the general case we need 3LQSR-formulae of an exponential length in n, thus showing that the fragment 3LQSTR is strictly
more expressive than 3LQSR.
When the sets X1,... , Xn are pairwise disjoint or, on the opposite side, when they all coincide, we can express the literal (8) by a simple 3LQSR-formula. For instance, if the sets X1,... , Xn are pairwise disjoint, then Z ∈ X1 ⊗ ... ⊗ Xn if and only if
|Z| = n, and
there exist x1 ∈ X1,... , xn ∈ Xn such that x1 ∈ Z, . . . , xn ∈ Z .
The above conditions can be used to express the literal (8) by the following 3LQSR- formula
  ^n
 			


as is easy to check, where



|Z| = n  ≡ Def |Z| ≤ n ∧ |Z| ≥ n
|Z| ≤ n  ≡ Def (6x1) ... (6xn+1)	xi ∈ Z →



1≤i<j≤n+1

xi = xj 

|Z| ≥ n  ≡ Def ¬(|Z| ≤ n — 1)
(notice that |Z| ≤ n is linked to the variable Z).
When X1 = ... = Xn, then Z ∈ X1 ⊗.. .⊗Xn if and only if |Z| ≤ n and Z ⊆ X1.
Thus, in this particular case, the literal (8) can be expressed by the 3LQSR-formula
(6Z) Z ∈ A →→ |Z| ≤ n ∧ (6x)(x ∈ Z → x ∈ X1)  .

However, if we make no assumption on the sets X1,... , Xn, in order to char- acterize the sets Z belonging to X1 ⊗ ... ⊗ Xn by a 3LQSR-formula, we have to consider separately the cases in which |Z| = n, |Z| = n — 1, etc., listing explicitly, for each of them, all the allowed membership configurations of the members of Z. For instance, if n = 2, we have Z ∈ X1 ⊗ X2 if and only if
|Z| = 2 and there exist distinct x1 ∈ X1 and x2 ∈ X2 such that x1, x2 ∈ Z; or
|Z| = 1 and the intersection X1 ∩ X2 ∩ Z is nonempty.
Thus the following 3LQSR-formula expresses the literal A = X1 ⊗ X2:
^
 	 

∨ |Z| =1 ∧ (∃x1)(x1 ∈ X1 ∧ x1 ∈ X2 ∧ x1 ∈ Z) 
Likewise, in the case n = 3, we have Z ∈ X1 ⊗ X2 ⊗ X3 if and only if
|Z| = 3 and there exist pairwise distinct x1 ∈ X1, x2 ∈ X2, and x3 ∈ X3 such that x1, x2, x3 ∈ Z; or
|Z| = 2 and there exist distinct x1 and x2 such that either
x1 ∈ X1 ∩ X2 and x2 ∈ X3, or
x1 ∈ X1 ∩ X3 and x2 ∈ X2, or
x1 ∈ X2 ∩ X3 and x2 ∈ X1, and such that x1, x2 ∈ Z; or
|Z| = 1 and the intersection X1 ∩ X2 ∩ X3 ∩ Z is nonempty. More in general, we have the following lemma, proved in [11].
Lemma 7.1 Let X1,... , Xn be given sets. Then Z ∈ X1 ⊗ ... ⊗ Xn if and only there exists a partition P of the set {1,... , n} and a bijection σ : Z → P such that
if i ∈ σ(x), then x ∈ Xi, for x ∈ Z and i ∈ {1,... , n}.	(11) Let Pn be the collection of all partitions of the set {1,... , n}. For any partition
P ∈ Pn, we will assume that the blocks b1(P ),... , b|P |(P ) of P are ordered by a

total order ≺ in such a way that
bi(P ) ≺ bj(P )	if and only if	min bi(P ) < min bj(P ) .

Then, based on Lemma 7.1, the literal A = X1 ⊗ ... ⊗ Xn can be expressed by the following 3LQSR-formula

(6Z) Z ∈ A ↔ P ∈Pn |Z| = |P |∧ (∃z1) ... (∃z|P |)  1≤i<j≤|P | zi /= zj

∧  |P |  zi ∈ Z ∧ 

j∈bi(P )
zi ∈ Xj	(12)

The following bounds on the length ln of the formula (12) hold:
ln = Ω(nBn) ,	ln = O(n2Bn) ,	(13)


 	
0.792n
ln(n+1)
by Berend and Tassa (cf. [1]), the bounds (13) yield
e ln n

  n  n 

  0.792n  n 


Thus, the representation (12) of the unordered Cartesian product of n sets has exponential length in n.

Conclusions and future work
We have presented a three-sorted stratified set-theoretic fragment, 3LQSTR, and have shown that it has a decidable satisfiability problem. The fragment 3LQSTR turns out to be quite expressive as it allows to represent efficiently several set- theoretic constructs, such as variants of the powerset operator and the unordered Cartesian product.
Much as in [10], it is possible to single out a family {(3LQSTR)h}h≥2 of subfrag- ments of 3LQSTR (characterized by imposing suitable syntactic constraints) having an NP-complete satisfiability problem. It is not hard to see that the modal logic S5 can be formalized in (3LQSTR)3.
We intend to study the possibility of formalizing further non-classical logics into suitable extensions of the 3LQSTR fragment also in consideration of the fact that techniques to translate modal formulae in set-theoretic terms have already been proposed in [2], in the context of hyperset theory, and in [14] in the ambit of weak set theories not involving the axiom of extensionality and the axiom of foundation.
We also plan to extend the fragment 3LQSTR so as to express the set-theoretic construct of general union, thus subsuming the theory 3LSSPU.
Finally, another direction of future research concerns the investigation of the satisfiability problem for stratified set-theoretic fragments involving n levels, for any n > 4.

References
D. Berend and T. Tassa. Improved bounds on Bell numbers and on moments of sums of random variables. Probability and Mathematical Statistics, Vol. 30 (2010), pp. 185–205.
J. Barwise and L. Moss. Vicious circles. Vol. 60 of CSLI Lecture notes. CSLI, Stanford, CA, 1996.
D. Cantone. Decision procedures for elementary sublanguages of set theory: X. Multilevel syllogistic extended by the singleton and powerset operators. Journal of Automated Reasoning, volume 7, number 2, pages 193–230, Kluwer Academic Publishers, Hingham, MA, USA, 1991.
D. Cantone and V. Cutello. Decision procedures for stratified set-theoretic syllogistics. In Manuel Bronstein, editor, Proceedings of the 1993 International Symposium on Symbolic and Algebraic Computation, ISSAC’93 (Kiev, Ukraine, July 6-8, 1993), pages 105–110, New York, 1993. ACM Press.
D. Cantone and A. Ferro Techniques of computable set theory with applications to proof verification.
Comm. Pure Appl. Math., pages 901–945, vol. XLVIII, 1995. Wiley.
D. Cantone, A. Ferro, B. Micale, and G. Sorace. Decision procedures for elementary sublanguages of set theory. IV. Formulae involving a rank operator or one occurrence of Σ(x)= {{y}|y ∈ x}. Comm. Pure Appl. Math., XL:37–77, 1987.
D. Cantone, A. Ferro, and E.G. Omodeo. Computable set theory. Clarendon Press, New York, NY, USA, 1989.
D. Cantone, C. Longo, M. Nicolosi-Asmundo, D.F. Santamaria. Web ontology representation and reasoning via fragments of set theory. Proc. of the 9th International Conference on Web Reasoning and Rule Systems (RR 2015), Berlin, August 4-6, 2015. Vol. 9209 of Lecture Notes in Computer Science,
pp. 61–76, 2015.
D. Cantone and M. Nicolosi Asmundo. On the satisfiability problem for a 3-level quantified syllogistic. In Complexity, Expressibility, and Decidability in Automated Reasoning - CEDAR 2008, 10-15 August 2008, Sydney - Australia, pp. 31–46.
D. Cantone and M. Nicolosi Asmundo. On the satisfiability problem for a 4-level quantified syllogistic and some applications to modal logic. Fundamenta Informaticae, 124(4):427–448, 2013.
D. Cantone and M. Nicolosi Asmundo. The decision problem for a three-sorted fragment of set theory with restricted quantification and finite enumerations. CoRR abs/1506.01476 (2015).
D. Cantone, E.G. Omodeo, and P. Ursino. Formative processes with applications to the decision problem in set theory: I. Powerset and singleton operators. Information and Computation, 172(2):165– 201, January 2002.
D. Cantone, E.G. Omodeo, and A.Policriti. Set Theory for Computing - From decision procedures to declarative programming with sets. Springer-Verlag, Texts and Monographs in Computer Science, 2001.
G. D’Agostino, A. Montanari, and A. Policriti. A set-theoretic translation method for polymodal logics.
Journal of Automated Reasoning, 3(15): 317–337, 1995.
A. Ferro and E.G. Omodeo. An efficient validity test for formulae in extensional two-level syllogistic. Le Matematiche, 33:130–137, 1978.
T. Jech. Set Theory: The Third Millennium Edition, Revised and Expanded. Springer Monographs in Mathematics. Springer, 2003.
J.T. Schwartz, D. Cantone, and E.G. Omodeo. Computational Logic and Set Theory – Applying Formalized Logic to Analysis. Springer 2011, I-XVII, 1-416.
