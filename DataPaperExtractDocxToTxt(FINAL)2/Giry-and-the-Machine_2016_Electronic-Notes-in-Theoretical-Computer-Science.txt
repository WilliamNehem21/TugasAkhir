Available online at www.sciencedirect.com


Electronic Notes in Theoretical Computer Science 325 (2016) 85–110
www.elsevier.com/locate/entcs
Giry and the Machine
Fredrik Dahlqvist1 Vincent Danos2 Ilias Garnier3
University College London	Ecole Normale Sup´erieure	University of Edinburgh


Abstract
We present a general method - the Machine - to analyse and characterise in finitary terms natural transfor- mations between well-known functors in the category Pol of Polish spaces. The method relies on a detailed analysis of the structure of Pol and a small set of categorical conditions on the domain and codomain functors. We apply the Machine to transformations from the Giry and positive measures functors to com- binations of the Vietoris, multiset, Giry and positive measures functors. The multiset functor is shown to be defined in Pol and its properties established. We also show that for some combinations of these func- tors, there cannot exist more than one natural transformation between the functors, in particular the Giry monad has no natural transformations to itself apart from the identity. Finally we show how the Dirichlet and Poisson processes can be constructed with the Machine.
Keywords: probability, topology, category theory, monads

Introduction
Classical tools of probability theory are not geared towards compositionality, and especially not compositional approximation (Kozen, [13]). This has not prevented authors from developing powerful techniques (Chaput et al. [5], Kozen et al. [14]) based on structural approaches to probability theory (Giry, [9]). Here, we adopt a slightly different standpoint: we propose to tackle this tooling problem globally, by combining structural insights of Pol together with some classical tools of proba- bility theory and topology put in functorial form. The outcome is the Machine, an axiomatic reconstruction in category-theoretic terms of developments carried out in [7]. Thus, we get a simpler and more conceptual proof of our previous results. We also obtain a much more comprehensive picture and prove that natural transforma- tions between Giry-like functors are entirely characterised by their components on

This work was sponsored by the European Research Council (ERC) under the grant RULE (320823).
1 f.dahlqvist@ucl.ac.uk
2 vincent.danos@ens.fr
3 igarnier@inf.ed.ac.uk

http://dx.doi.org/10.1016/j.entcs.2016.09.033
1571-0661/© 2016 The Author(s). Published by Elsevier B.V.
This is an open access article under the CC BY license (http://creativecommons.org/licenses/by/4.0/).

finite spaces. For instance, the monadic data of the Giry functor are easily obtained from the finite case (which is completely elementary) and applying the Machine. But the construction is not limited to probability functors: we deal similarly with the multiset and the Vietoris (the topological powerdomain of compact subsets) func- tors. This allows one to consider transformations mixing probabilistic and ordinary non-determinism, in a way which is reminiscent of (Keimel et al., [12]). Another byproduct of our Machine is that we reconstruct from finitary data classical objects of probability theory and statistics, namely the Poisson and Dirichlet processes. It is worth noting that Poisson, Dirichlet (and many other similar constructions ob- tained by recombining the basic ingredients differently) are obtained as natural and continuous maps: naturality expresses the stability of the “behaviour” in a change of granularity, and as such is a fundamental property of consistency, but continuity (which to our knowledge is proved here for the first time) expresses a no less impor- tant property, namely the robustness of the behaviour in changes in “parameters”. This has potential implications in Bayesian learning.
The structure of the paper is as follows. In Sec. 3, we show that Pol is stratified into the subcategories Polf , Polcz Polz of finite, compact zero-dimensional and zero-dimensional Polish spaces respectively and show how these subcategories are related. In Sec. 4, the Machine is introduced: we identify a small set of categorical conditions on functors F, G that guarantee that any natural transformation from F to G in Polf can be extended step-by-step through the subcategories to a nat- ural transformation on Pol. In Sec. 5, we illustrate the workings of the Machine on natural transformations connecting the Giry and positive measure functors to combinations of the Vietoris, multiset, Giry and positive measure functors. As far as we know, the multiset functor is defined in Pol for the first time and its prop- erties are established. As a first application of the Machine, we develop in Sec. 6 general criteria under which there can exist at most one natural transformation from a functor F to the Giry functor. In particular, we show that there exists at most one natural transformation between the Vietoris, multiset, positive measure and Giry functor to the Giry functor. Lastly, we show in Sec. 7 how transformations of the type M+ ⇒ GH where M+ is the finite measure functor and H is either the multiset or the finite measure functor can be built in Polf from a single generating morphism M+(1) → GH(1) and give criteria for this transformation to be natural. In particular, we show that the Dirichlet and Poisson distributions satisfy these criteria and use the Machine to build Dirichlet and Poisson processes.

Notations
Most of our developments take place in the category Pol of Polish spaces and continuous maps. Pol is a full subcategory of the category Top of topological spaces and continuous maps. Pol has all countable limits and all countable coproducts (Bourbaki [4], IX). The functor mapping any space to the measurable space having the same underlying set and the Borel σ-algebra and interpreting continuous maps as measurable ones will be denoted by B : Pol → Meas, where Meas is the category

of measurable spaces and measurable maps. A countable codirected diagram (ccd for short) is given by a countable directed partial order I and a contravariant functor D : Iop → Pol such that for all i ≤Iop j, D(i ≤Iop j) is surjective. We moreover assume that ccd s range over non-empty spaces. With that assumption, the categorical limit of a ccd D, which we denote by lim D, is always non-empty.
The structure of Pol
Pol can be decomposed according to the following diagram of inclusions:
Pol ,˛Icz /P¸ol ,˛Iz /P¸ol ,˛Ip /P¸ol	(1)
Here, Polf is the full subcategory of finite (hence discrete) spaces, Polcz is the full subcategory of compact zero-dimensional spaces and Polz is the full subcategory of zero-dimensional spaces while Icz, Iz and Ip are the obvious inclusion functors. To this picture, we add categories of based spaces and base-preserving maps.
Definition 3.1 (Categories of based spaces) A based space is a pair (X, F) of X ∈ Obj(Pol) and of a countable base F of the topology of X. A base-preserving map from (X, F) to (Y, G) is a function f : X → Y such that f−1(G) ⊆F (it is there- fore continuous). One easily checks that this defines a category having based spaces as objects and base-preserving maps as morphisms. We denote this category by Polb. Similarly, a based zero-dimensional space is a pair (Z, F) where Z ∈ Obj(Polz) and F is a countable base of clopen sets which is also a boolean algebra. We denote by Polb the category of based zero-dimensional spaces and base-preserving maps.
Of course, there exists for each such based category a (faithful, but not full!) forgetful functor, that we will denote by resp. Uz and Up. The situation is summed up in the following commutative diagram in Cat:

˛ Ib


b z
,˛ Icz	/¸ ¸,
b ,
   z
p	/P¸olb

Polf
Polcz
Uz	Up

z˛ ,˛	/ 
Polz	Ip	P¸ol
In the remainder of this section, we will unravel further relationships between these categories.
Polf is a codense subcategory of Polcz. Objects of Polf are finite discrete spaces. Note that every subset of a discrete space is clopen; as a consequence, any map between two finite spaces is continuous. We will denote objects of Polf by their cardinality m, n. The objects of Polcz are the compact zero-dimensional (or proﬁnite) spaces, a prime example being the Cantor space 2N. These spaces are homeomorphic to limits of countable codirected diagrams (ccd s for short) taking values in Polf . This is exactly captured by the concept of codensity (see [15], X.6).

Proposition 3.2 Polf is codense in Polcz.
Proof. Let X be a compact zero-dimensional space, and consider the comma cat- egory X ↓ Icz. We denote by DX : (X ↓ Icz) → Polf the diagram correspond- ing to the base of this cone. It is enough to prove that for all X ∈ Obj(Polcz), X ∼= lim DX . Following (Mac Lane [15], IX.3), it is in turn enough to exhibit a di- agram D : Iop → Polf verifying X ∼= lim D and a cofinal (“initial” in [15]) functor c : Iop → (X ↓ Icz). Proposition 3.1 of [7] yields the existence of such a diagram D where I is the set of finite partitions of X taken in the boolean algebra of clopen sets of X (that we denote by Clo(X)), partially ordered by partition refinement and directed by partition intersection. Observe that any continuous map f : X → n induces a finite clopen partition of X by considering its fibres. Let us denote this partition by X/f . Let c be the functor mapping any finite partition n ∈ Iop seen as an object of Polf to the quotient map qn : X → n, and any refinement m ≤£op n to to the obvious map πmn such that qm = πmn ◦ qn. For any f : X → n the partition X/f is mapped to c(X/f ) : X → X/f , and there trivially exists a map π : c(X/f ) → f . For any two f, fj ∈ Obj(X ↓ Icz), one can easily exhibit a partition i ∈I of X such that there exists π : c(i) → f and πj : c(i) → fj.	2
Polcz is a reflective subcategory of Polb . Objects of Polz are zero-dimensional spaces, i.e. spaces whose topology admits a (countable) base of clopen sets. Discrete spaces (such as N) are always zero-dimensional. A less trivial example is the Baire space NN. The bridge between Polcz and Polz is provided by compactiﬁying zero- dimensional spaces, as explained in full length in ([7], Sec. 3). Let us recall the underpinnings of this compactification. Let Z be some zero-dimensional space and F be a countable base of clopens of Z. One easily verifies that the boolean algebra generated by F, that we denote by Bool(F), still generates the same topology and is still countable. Therefore, one can witout loss of generality assume that the base F of Z is a countable Boolean algebra of clopen sets. Let I7 be the directed partial order of finite partitions of Z taken in F and let D7 : Iop → Polf be the diagram
op	7
defined by D7 (i ∈ I7 )  i on objects (seeing finite partitions of Z as finite discrete spaces) and D7 (j ≤ op i)= qij where qij : j → i is the obvious quotient map.
F
Proposition 3.3 (Wallman compactification ([7], Prop. 3.12)) lim D7 is a zero-dimensional compactiﬁcation of Z that we denote by ω7 (Z). We denote by η7 : Z ‹→ ω7 (Z) the canonical embedding of Z into its compactiﬁcation.
Note that this compactification is not universal, in the sense that Polcz is not a reflective subcategory of Polz (see [15], IV.3 for a definition of reflective subcat- egory). However, we will show that Polcz is a reflective subcategory of Polb . In the following, recall that Clo(X) is the boolean algebra of clopen sets of a compact zero-dimensional space X.
Proposition 3.4 Let Ib be the operation that maps any compact zero-dimensional space X to the pair (X, Clo(X)) and which acts identically on maps between such spaces. Ib is a full and faithful functor from Polcz to Polb .
z	z

Proof. For any space X ∈ Obj(Polcz), its boolean algebra of clopen sets Clo(X) is countable and therefore, (X, Clo(X)) is a based zero-dimensional space. By con- tinuity, maps between such spaces are base-preserving. Functoriality, fullness and faithfulness are trivial.	2
Our compactification naturally lives in Polb :
Proposition 3.5 For any (Z, F) ∈ Obj(Polb ), the embedding η7 : (Z, F) →
Ib(ω7 (Z)) is base preserving.
Proof. By construction of ω7 (Z), any finite clopen partition of this space will induce through η7 a finite partition of Z taken in F. Therefore, η7 is base preserv- ing.	2
The following proposition states the functoriality of compactification in this new setting, and the fact that Polcz is a reflective subcategory of Polb .
Proposition 3.6 (ω as a reflector) (i) Let f : (Z, F) → (Zj, Fj) be a base- preserving map. There exists a unique ω77′ (f ) : ω7 (Z) → ω7′ (Zj) such that

ω77′ (f ) ◦ η7 = η7′ ◦ f. (ii) ω : Polb
→ Polcz is a functor deﬁned on ob-

jects by ω(Z, F)  ω7 (Z) and on base-preserving maps f : (Z, F) → (Zj, Fj) by

ω(f )  ω77′ (f ), and it is left adjoint to the inclusion functor Ib
(the unit being

given by η).
Proof. (i) This is Prop. 3.13 and Corollary 3.14 of [7]. Let us sketch the argument. As f is base-preserving, any finite clopen partition of Zj taken in Fj will induce a unique finite clopen partition of Z taken in F. Using the notations of Prop. 3.3, we deduce that D7′ is a sub-diagram of D7 . Therefore, there exists a unique mediating map (that we denote ω77′ (f )) from lim D7 to lim D7′ , i.e. from ω7 (Z) to ω7′ (Zj), such that η7′ ◦f = ω77′ (f ) ◦η7 . (ii) ω trivially preserves identities. For all f, fj, the equality W (fj ◦ f )= W (fj) ◦ W (f ) is a consequence of the uniqueness of factorisations in (i). According to (Mac Lane [15], IV.3), left adjointness of ω is a direct consequence of (i), as any map f : (Z, F) → Ib(X) will factor uniquely through η7 : (Z, F) → Ib(ω7 (Z)).	2
This reflection is summarised in the following diagram:
Id	b

Polz
(2)

Pol
b	z
z

Polb is a coreflective subcategory of Polb. The penultimate step in our struc-
tural analysis of Pol is to relate Polb and Polb. This is accomplished by associat-
ing zero-dimensional refinements to arbitrary spaces, in an operation called zero- dimensionalisation. Let us define this operation.

Proposition 3.7 (Zero-dimensionalisation ([7], Prop. 3.2)) Let X be a space with underlying set U (X) and let F be a countable base of X. The topological space z7 (X)  (U (X), ⟨Bool(F)⟩) having as underlying set U (X) and whose topology is generated by the boolean algebra Bool(F) veriﬁes the following properties:
z7 (X) is Polish;
z7 (X) is zero-dimensional.
measurable sets are preserved: B(X)= B(z7 (X)).
In a similar fashion to compactifications, this operation is better typed as a functor from Polb to Polb . Let us make zero-dimensionalisation into a functor:
Proposition 3.8 Let f : (X, F) → (Y, G) be a base-preserving map in Polb. Then
f : (z7 (X), Bool(F)) → (zG (Y ), Bool(G)) is base-preserving in Polb . We denote by

z : Polb → Polb
the functor deﬁned by z(X, F)= (z7 (X), Bool(F)) on objects and

acting identically on arrows.
Proof. It is sufficient to consider the case of an arbitrary finite union of literals

L = Aє1 ∪ ... ∪ Aєn ∈ Bool(G), where Ai ∈ G and Aєi denotes either Ac
or Ai.

1	n	i	i
We have f—1(L) = ∪n f—1(Ai)єi , since f is base-preserving in Polb we deduce

that f—1(L) ∈ Bool(F). Continuity of f in Polb
is a direct consequence of base

preservation. The fact that z is a functor is now trivial.	2
The following result now follows easily:
Proposition 3.9 (z as a coreflector) z is right adjoint to the inclusion functor
Ib, i.e. Polb is a coreflective subcategory of Polb.
p	z
Proof. Observe that for all (X, F) ∈ Obj(Polb), the identity function ϵ7  id : Ibz(X, F) → (X, F) is base-preserving. This indeed constitutes the counit of the coreflection: one easily verifies that for all f : Ib(Z, F) → (X, G) there exists a
unique fj : Ib(Z, F) → Ibz(X, G) such that f = ϵG ◦ fj (and fj is equal to f as a
p	p
function).	2

This coreflection is summarised in the following diagram:
IdPolb


zz



(3)

Polb	z  /P¸olb 	/P¸olb
z	b
p

Relating Polb and Pol. For all space X ∈ Obj(Pol), let us denote the set of countable bases of X, partially ordered by inclusion, by Bases(X). Observe that Bases(X) is directed by taking the union of the bases and closing under finite intersections. Accordingly, if F ⊆ G are two countable bases of X, the identity function id : (X, G) → (Y, F) is trivially base-preserving. This defines a codirected diagram BX : Bases(X)op → Polb mapping any base F to (X, F) and any pair

F ⊆ G to the identity function. Recall that Up : Polb → Pol is the base-forgetting functor. The next definition and proposition provide a universal characterisation of Polish spaces in terms of their zero-dimensionalisation.
Definition 3.10 (Diagram of zero-dimensionals) We define the diagram of zero-dimensionals of X:
ZX   UpIbzBX : Bases(X)op → Pol
that maps bases F ∈ Bases(X) to ZX (F)  z7 (X).
We state without proof the following result, which is a category-theoretic refor- mulation of ([7], Theorem 3.5):
Proposition 3.11 For all space X ∈ Obj(Pol), X ∼= colim ZX.
In more concrete terms, any space X has the final topology for the family of iden- tity functions {id : z7 (X) → X}7 where F ranges over Bases(X). Let us conclude this section by summarising our structural decomposition of Pol in the following diagram:

Pol ,˛Icz /P¸ol
c
Polb 
z
T	Polb

(4)

f	, cz¸

b z
   z ¸	¸ 
Uz	b	Up

 ,˛	/ 

Iz	˛P olz	Ip
P¸ol

The Machine
We will leverage the structural decomposition of Pol given in the previous section to characterise some “profinite” natural transformations, in the sense that their behaviour on arbitrary spaces is entirely determined by their behaviour on finite spaces. We proceed in a stepwise and modular fashion: the Machine is presented as a series of extension theorems giving sufficient conditions for a natural transformation to be uniquely extended from a subcategory to the ambient one (Theorems 4.2-4.11). These results are combined in Theorem 4.12.
From Polf to Polcz. One can completely characterise the subcategory of the functor category [Polcz; Pol] consisting of functors commuting with certain codi- rected limits in terms of [Polf ; Pol]. These functors are defined below.
Definition 4.1 (Polf -continuous functors) A functor F : Pol → Pol is Polf - continuous if for all ccd D : Iop → Polf , F (lim D) ∼= lim FD.
The key result is the following:
Theorem 4.2 Let F, G : Polcz ⇒ Pol be two functors. If G is Polf -continuous, then Nat(F|Polf , G|Polf ) ∼= Nat(F, G).
This isomorphism arises from the existence of a functor computing right Kan extension along Icz (see [15], X), denoted by RanIcz in the following:

Proposition 4.3 The functor RanIcz : [Polf ; Pol] → [Polcz; Pol] is full and faith- ful.
Proof. In the following, for any X ∈ Obj(Polcz), DX : (X ↓ Icz) → Polf stands for the diagram verifying X ∼= lim DX (see proof of Prop. 3.2). We first prove that any functor F : Polf → Pol admits a right Kan extension RanIcz F along Icz. Following (Mac Lane [15], X.3, Corollary 4) it is sufficient to prove that for all X ∈ Obj(Polcz), the diagram F ◦ DX : (X ↓ Icz) → Pol has a limit. By a cofinality argument similar to that used in the proof of Prop. 3.2, one can show that lim F ◦ DX ∼= lim F ◦ D for a countable diagram D and since Pol is countably complete this limit exists, therefore F admits a right Kan extension. Let us prove that the extension is full and faithful. Since Icz is full and faithful, the universal arrow ϵF : (RanIcz F )Icz ⇒ F is an iso. Given F, G : Polf → Polcz and α : F ⇒ G, there exists a unique σ : RanIcz F ⇒ RanIcz G such that α ◦ ϵF : (RanIcz F )Icz → G factors as α ◦ ϵF = ϵG ◦ σIcz. Therefore, RanIcz defines a functor from [Polf ; Pol] to [Polcz; Pol] which is full and faithful by the bijection Nat(RanIcz F, RanIcz G) ∼= Nat(F, G).	2
Proof. [Theorem 4.2] Prop. 4.3 and the universal property of Ran yields an isomorphism Nat(F|Polf , G|Polf ) ∼= Nat(F, RanIcz G|Polf ). Recall that RanIcz G|Polf (X) = lim G ◦ DX ∼= lim G ◦ D where DX and D are as in the proof of Prop. 4.3. By Polf -continuity of G, RanIcz G|Polf (X) ∼= G(lim D)= G(X).   2
From Polcz to Polb . As seen in Prop. 3.6, the Wallman compactification makes Polcz into a reflective subcategory of Polb . The extension of a natural transforma- tion from Polcz to Polb can be framed componentwise as a restriction of the natural transformation to a space embedded into its compactification, that we construct us- ing intersections.
Definition 4.4 (Intersections, preservation of intersections) If j1 : X ‹→ Z, j2 : Y ‹→ Z are two embeddings, we define the intersection X ∩ Y → Z as the pullback of j1 and j2 (Eq. 5). We say that an endofunctor G : Pol → Pol preserves intersections if the diagram in Eq. 6 is an intersection.

 p1	/¸
G(X ∩
G(p1) /G¸(X)
(6)

X ∩ Y

p2
 ,˛	
X˛z
j1
  
(5)

G(p2)
Y )

  ˛	
˛z
G(j1)
  

Y	/Z¸
j2
G(Y ),
G(j2)
/G¸(Z)

The following Lemma characterises the topology of intersections in Pol.
Lemma 4.5 X ∩ Y is the Set-theoretic intersection of X, Y together with the sub- space topology induced by Z.
Recall that if f : X → Y is a morphism in a category C, its cokernel pair (if it exists) is the pushout of f with itself (Mac Lane [15], III.3). In Top, there is a well-known characterisation of embeddings as limits of their coker- nel pair (see e.g. (Adamek et al. [1], 7.56-7.58)). In Pol, we have the following:

X,˛ f	/Y ¸
˛z	˛z
Proposition 4.6 Let X, Y be Polish and f : X ‹→ Y be an	f	j1

embedding. Then (i) the pushout object Y +X Y is Polish, (ii)
the cokernel arrows j1, j2 : Y → Y +X Y are embeddings and
(iii) the intersection of j1 and j2 is homeomorphic to X.
  		  
Y	/Y ¸+	Y
j2

The following Lemma ensures that the pushout object of an embedding with range in Polcz is still compact zero-dimensional.
Lemma 4.7 Let f : X ‹→ Y be an embedding in Pol such that Y ∈ Obj(Polcz). Then Y +X Y ∈ Obj(Polcz).
Proof. The proof that Y +X Y is Polish is routine. It thus remains to see that it is compact and zero-dimensional. Since finite unions of compacts are compact, the coproduct Y + Y is compact. By universality of coproducts, the cokernel maps j1, j2 : Y → Y +X Y define a unique continuous map j1+j2 : Y +Y → Y +X Y , which is easily seen to be surjective, and it follows that Y +X Y is the continuous image of a compact, i.e. is compact. To see that it is zero-dimensional, we use the fact that on compact Hausdorff spaces zero-dimensionality coincides with being totally disconnected. Let x ∈ Y +X Y and let Ux be a subset such that x ∈ Ux. We can assume w.l.o.g. that x is in the first copy of Y and that Ux is included in this copy. Since Y is totally disconnected, if Ux /= {x} it can be written as the union of two disjoint opens V1, V2 in the subspace topology induced by Y and and thus also by Y +X Y . It follows that if Ux /= {x} it cannot be connected in Y +X Y .	2
Theorem 4.8 Let F, G : Polb → Pol be a pair of functors such that G preserves embeddings and intersections. Then Nat(F, G) ∼= Nat(F|Polcz , G|Polcz ).
Proof. In the interest of readability, we will elude the inclusion Ib : Polcz → Polb .
z	z
Let α : F|Polcz ⇒ G|Polcz be a natural transformation. We prove that (i) for all
X ∈ Obj(Polb ), αc(X) : F (ω(X)) → G(ω(X)) restricts uniquely to a morphism αX : F (X) → G(X) such that αc(X) ◦ (Fη)X = (Gη)X ◦αX , and (ii) this restriction uniquely extends α to a natural transformation from F to G.
Consider, given X ∈ Obj(Polb ), the embedding ηX : X ‹→ ω(X). By Prop. 4.6, X is the intersection of the cokernel maps j1, j2 : ω(X) ‹→ ω(X) +X ω(X). Moreover by Lemma 4.7, there exists a component αcX+XcX . By functoriality and naturality of η, the diagram in Fig. 1 (ignoring αX ) commutes. Since G preserves embeddings and intersections, there exists a unique mediating map αX : F (X) → G(X) making the whole diagram commute.

Finally, we need to check that extending α to F|Polb
→ G|Polb
in this way

is natural. Let f : X → Y in Polb
and let ηX, ηY denote the embeddings of X

and Y in their respective zero-dimensional compactifications. The corresponding diagram is depicted in Fig. 2. The top, bottom, front, back and right-hand square commute, and it follows that (Gη)Y ◦ G(f ) ◦ αX = (Gη)Y ◦ αY ◦ F (f ). Since ηY is an embedding and since G preserves embeddings, (GηY ) is an embedding and in particular is injective, and it follows that i.e. G(f ) ◦ αX = αY ◦ F (f ) as desired.

F (ω(X)) 	F (j2) /F¸(ω(X)+ 
ω(X))
F (Y ) 	(Fy)Y	/F¸(ω(Y ))

(Fy)X

F (X) α
 ,

(Fy)X /F¸(ω(X))
   X


F (X)
 ,

(Fy)X/F¸(ω(X))
 ,
F (c(f ))
αc(Y )

c(X)
α
t(j )
c(X)+Xc(X)
αY
  ˛(ty)

αX
(ty)
G( ω(,X))
αc(X)
/G¸(ω(X  ) +X ω(X))
G(Y ),
t(f )
Y	/G¸(ω(Y ))
 ,

X
	(ty)X
t(j1)
αc(X)
  ˛ (ty)X 
   t(c(f ))

G(X)
/G¸(ω(X))
G(X),
/G¸(ω(X))

Fig. 1.	Fig. 2.



From Polb
2
to Pol. The last part of the Machine is a procedure to extend

natural transformations from Polb
to Pol. We have seen in Prop. 3.11 that Polish

spaces are the colimits of their “diagrams of zero-dimensionals”. We will require functors in the domain of natural transformations to commute with these colimits.
Definition 4.9 (Z-cocontinuous functors) A functor F : Pol → Pol is Z- cocontinuous if for all X ∈ Obj(Pol), F (X) ∼= colim F ZX where ZX is defined in Def. 3.10.
Moreover, we will require these functors to be Z-stable, which means that the underlying sets of the spaces in the range of the considered functors are invariant by zero-dimensionalisation. As we will prove later, this is for instance the case of the Giry, multiset and list functors.
Definition 4.10 (Z-stable functor) A functor F : Pol → Pol is Z-stable if
UFX = UFZX (F) for all F ∈ Bases(X).
Theorem 4.11 Let F, G : Pol → Pol be a pair of functors such that F is Z- cocontinuous and Z-stable. Then Nat(F, G) ∼= Nat(FUpIb, GUpIb).
p	p
Proof. Let α : FUpIb ⇒ GUpIb and X ∈ Obj(Pol) be given. By Z-cocontinuity,
p	p
F (X) is the colimiting object of the diagram F ZX = FUpIbzBX : Bases(X)op →
Pol (Def. 3.10). Applying α, we get a natural transformation αzBX : FZX ⇒

GZX . Composing with the counit ϵ : Ibz → Id
b yields a natural transformation

p	Pol
(GUpϵ)(αzBX ) : FZX ⇒ GUpIdPolb BX . Note that GUpIdPolb BX is equal to the
constant functor with value G(X). Therefore, we have constructed a cocone from
FZX to G(X). The situation above is summed up in the following diagram:
P olb 	Up	/P¸ol


Bases(X)op  BX	/P¸olb 	z	/P¸olb

α
  z
b 	/¸
v˛
 Po l

˛P ol
Up	Pol

By universality, there exists a unique map uX : F (X) → G(X) such that uX ◦ (FUpϵBX )7 = (GUpϵBX )7 ◦ (αzBX )7 . Let us prove naturality of {uX}X∈Obj(Pol). For all f : X → Y and for all base G of Y , there exists a base F of X such that f : (X, F) → (Y, G), is base-preserving, and by functoriality, so is z(f ): ZX (F) → ZY (G). We get the following diagram:


FZX
(F) 	(αzBX )F	/G¸Z

  uX 
(F)


Fz(f )
FX 
F (f )
  
GX
t(f )
/ 

tz(f )

¸F Y   uY
G¸Y ,¸


 	/¸ 

FZY (G)	(αzBY )G
GZY (G)

In the above diagram, the left and right cells commute by naturality of ϵ while the top and bottom cells commute by construction of the arrows uX, uY . Note that the arrow (FUpϵBX )7 is the image through F of the identity function ϵ7 = id : ZX (F) → X. Since F is Z-stable, this arrow is surjective. We conclude that the central square commute, and we extend α by setting for all X αX = uX as constructed above.	2
The Machine. Bringing the parts of the Machine together, we obtain:
Theorem 4.12 Let F, G : Pol → Pol be a pair of functors such that:
F is Z-cocontinuous and Z-stable,
G is Polf -continuous, preserves embeddings and intersections. Then one has Nat(F, G) ∼= Nat(F|Polf , G|Polf ).
Feeding the Machine
We now investigate the properties of some functors, with an eye on applying the Machine.
The Giry functor. For any space X, we denote by G(X) the space of Borel probability measures over X, endowed with the weak topology (Giry, [9]). This operation can be extended to a functor G : Pol → Pol which admits the Giry monad structure (G, δ, μ) (Giry, [9]). The action of G on maps f : X → Y is defined by G(f )(P ) P ◦ f—1. The unit is given by the Dirac delta: δX : X → G(X) while the multiplication is defined by averaging: μX : G2(X) → G(X)  P '→ t(X) p dP (p).
G is a rather well-behaved functor:
Proposition 5.1 (i) For all ccd D, G(lim D) ∼= lim G ◦D; (ii) G is Z-cocontinuous and Z-stable; (iii) G preserves injections and embeddings; (iv) G preserves intersec- tions.

Proof. (i) is the Bochner extension theorem in functorial form ([7], Theorem 2.5).
(ii) Z-cocontinuity is in ([7], Theorem 3.7); Z-stability stems from Prop. 3.7, (iii). For (iii), see e.g. ([7], Lemma 2.1). Now for (iv): let j1, j2 : A, B > X be two embeddings, let p1 : A ∩ B → A and p2 : A ∩ B > B be the corresponding embeddings and consider μ ∈ G(A),ν ∈ G(B) such that G(j1)(μ) = G(j2)(ν). It follows from (Kechris [11], Theorem 15.1) and the fact that p1 is injective that whenever U is a Borel set of A ∩ B, p1[U ] is a Borel set of A, and similarly for p2. We can therefore define λ ∈ G(A ∩ B) by λ(U )= μ(p1[U ]) = ν(p2[U ]). To see that the equality on the right holds, note that since j1 in injective p1[U ]= j—1(j1[p1[U ]]),
and thus
μ(p1[U ]) = μ(j—1(j1[p1[U ]])) = G(j1)(μ)(j1[p1[U ]]) = G(j2)(ν)(j1[p1[U ]])
= G(j2)(ν)(j2[p2[U ]]) = ν(p2[U ])
This assignment from pairs (μ, ν) such that Gj1(μ) = Gj2(ν) to λ ∈ G(A ∩ B) is clearly injective, and it follows that G(A∩ B) ∼= GA∩ GB as sets. Since G preserves embeddings, G(j1 ◦ p1)= G(j2 ◦ p2) is an embedding, and it follows that G(A ∩ B) and GA ∩ GB are in fact homeomorphic.	2
Example 5.2 Theorem 4.12 implies that the unit δ : Id → G of the Giry monad is entirely determined by its finite components. We do not yet know whether G2 is Z-cocontinuous, and thus whether the multiplication μ : G2 → G is determined by its finite components. However it follows from Theorem 4.8 that the restriction of μ to Polz is determined by its finite components. We conjecture that this result extends to the entire category Pol.
The non-zero finite measures functors. We will also consider functors closely related to G: we let M+ be the functor mapping any space X to the space of non- zero positive finite measures over X with the weak topology, and acting on maps similarly as G. The following is trivial (consider the normalisation of a finite non-zero measure):
Proposition 5.3 For all space X, we have the isomorphism M+(X) ∼= G(X)×R>0.
As a consequence, M+ verifies all the properties listed in Prop. 5.1. Note that

for all finite space n, M+(n) is also homeomorphic to Rn
\ {0}.

The multiset functor. We consider the multiset functor B : Pol → Pol. It is given explicitly by
B(X)	Xn/Sn
n∈N
where Xn/Sn is the quotient of Xn under the obvious action of Sn – the permuta- tion group on n elements – on tuples together with the quotient topology, i.e. the final topology for the quotient map q : Xn → Xn/Sn. See Appendix A for a proof that B(X) is Polish. Its action on maps is given by setting for any f : X → Y
and μ ∈ B(X), B(f )(μ)= y '→ Σx∈f−1(y) μ(x). This is easily shown to be continu-

ous. Observe also that for X finite, B(X) ∼= NX . The multiset functor verifies the following properties:
Proposition 5.4 (i) B is Polf -continuous; (ii) B preserves injections and embed- dings; (iii) B preserves intersections.
Proof. See Appendix B.	2
The Vietoris functor. As a non-probabilistic example, we will consider the Vi- etoris functor. We recall its definition.
Definition 5.5 We denote by V : Pol → Pol the functor mapping any space X to the space of compact subsets of X topologised with the Hausdorff distance, and mapping any continuous function f : X → Y to V(f )  K ∈ V(X) '→ f (K).
See (Kechris [11], 4.F) for a proof that V(X) is indeed Polish. V has the following properties:
Proposition 5.6 (i) V is Polf -continuous; (ii) V preserves injections and embed- dings; (iii) V preserves intersections.
Proof. (i) is in Appendix B. (ii) and (iii) are in Appendix B.	2
Example 5.7 An interesting example of transformation which is not natural in Pol, due to Michael Mislove, is provided by the support of a measure. Usually, the support of p ∈ G(X) is defined to be the smallest closed subset of measure 1. On finite spaces, for p ∈ G(n), we define suppn(p)  {x ∈ n | p(x) > 0}. Let us check that this is natural: for f : m → n, we have that supp(G(f )(p)) = supp(p ◦ f—1)= x ∈ n | f—1(x) ∩ supp(p) /= ∅ , i.e. supp(G(f )(p)) = f (supp(p)) = V(f )(supp(p)). However, this does not define a natural transformation in Pol: consider the sequence of measures (pn)n∈N on X = {0, 1} defined by pn = n—1 δ0+ 1 δ1. pn weakly converges
n	n
to δ0 as n → ∞ and for all n, supp(pn) = {0, 1} but supp(δ0) = {0}. Therefore,
supp is not continuous!
Rigidity
The results presented in Sec. 4 allow to construct natural transformations from finitary specifications. In this section, we apply these results to exhibit striking rigidity properties of G and related functors.
Definition 6.1 A pair of functors F, G : C → D is called rigid, if there exists at most one natural transformation η : F ⇒ G. In particular, we will say that an functor F : C → D is rigid if the identity natural transformation id : F ⇒ F is the only natural transformation that exists from F to itself.
For each finite space k and functor T : Pol → Pol, there exists a canonical action of Sk, the permutation group over k elements, given by:
α : Sk × T (k) → T (k), (π, x) '→ Tπ(x)

We will call this action the canonical action. We will call an element x ∈ T (k) stabilised by the entire group Sk under the canonical action an isotropic element. Isotropic elements will play a crucial role in our theorem.
Theorem 6.2 (Rigidity Theorem) Let H : Pol → Pol be a subfunctor of the Giry monad G satisfying the following conditions: (i) H(k)= G(k) for every ﬁnite Polish space k; (ii) H is Polf -continuous;(iii) H preserves injections. Let also T : Pol → Pol be a functor such that (iv) for each ﬁnite Polish space k there exists a dense subset Qk ⊆ T (k) with the property that if x ∈ Qk there exists a ﬁnite Polish space kj, a morphism f : kj → k and an isotropic element xj ∈ T (kj) such that T (f )(xj)= x. In these circumstances the pair (T, H) is rigid.
We prove this theorem in steps. But let us first show some example of functors satisfying the property above.
Example 6.3 Let us show that the Vietoris functor V satisfies the condition (iv). Note first that for every k, the full set k ∈ V(k) is isotropic: for any π ∈ Sk α(π, k) = Vπ(k) = k since π is bijective. Now take Qk = V(k) (which is trivially dense) and x = {x1,..., xn} ∈ V(k). Consider the full set n ∈ V(n) along with the map f : n → k, i '→ xi, it is clear that V(f (n)) = x, and n is isotropic.
Example 6.4 The Giry monad G satisfies all conditions of Theorem 6.2: it satisfies
(i) trivially, it satisfies (ii) and (iii) by Prop. 5.1. Let us show that it satisfies (iv) as well. Note first that the uniform probabilities are the isotropic elements: if 1 ,..., 1
α  π,  1 ,..., 1   = G(π)  1 ,..., 1  =  1 ,..., 1  ◦ π—1 =  1 ,..., 1 

Consider now Qk = Δk ∩ Qk, the rational probabilities on k elements. It is clearly
n	n
for a common denominator n. Now consider the projection map defined by
⎧1	if 1 ≤ i ≤ p1
p : n → k, i '→ ⎨2	if p1 +1 ≤ i ≤ p1 + p2

... 
⎪⎩k	if
Σk—1 pi +1 ≤ i ≤

	

i=1 pi

	

 1 ,..., 1  is isotropic.
n	n	n	n

Example 6.5 Let M+ : Pol → Pol be the finite non-zero positive measure functor. It follows easily from Prop. 5.3 that this functor satisfies condition (iv): the isotropic elements are those of the shape ((1/k,..., 1/k), λ) for λ ∈ R>0. A dense subset is provided by (Qk ∩ G(k)) × R>0 and the same argument as in Example 6.4 shows that every element ((p1/n,..., pk/n), λ) is the image of ((1/n,..., 1/n), λ) by G(p) × id with p defined as in Example 6.4.

Example 6.6 The multiset functor B also has the property (iv). B(k) has one isotropic element: the unordered list [(1,..., k)], and any [(x1,..., xk)] ∈ B(k) is the image of [(1,..., k)] under B(f ) for the map f : k → k, i '→ xi (which might very well not be injective).
Let us proceed to the proof of Theorem 6.2. The following settles the finite case:
Lemma 6.7 Let (T, H) be a pair of functors satisfying the conditions of Theorem 6.2, then (T, H) is rigid on Polf .
Proof. Let ν : T ⇒ H be a natural transformation. We first show that if x ∈ T (k) is isotropic then
ν (x)=  1 ,..., 1	(7)

where  1 ,..., 1  denotes the uniform probability distribution on k. Fix i ∈
{1,..., k}, and consider the permutations (ij) ∈ Sk, 1 ≤ j ≤ k sending i to j, j to i and leaving all other elements of k unchanged. We have
νk(x)(i)= νk(T (ij)(x))(i)	(x isotropic)
= H(ij)(νk(x))(i)	(By naturality)
= G(ij)(νk(x))(i)	(H = G on Polf )
= νk(x)(ij)—1(i)	(By def. of G)
= νk(x)(j)	(By def. of (ij))
Since this holds for every 1 ≤ j ≤ k we have Σk	νk(x)(j) = Σk	νk(x)(i) = 
kνk(x)(i) = 1 and thus νk(x)(i) = 1 for every 1 ≤ i ≤ k, i.e. νk(x) =  1 ,..., 1 .
Let us now consider an arbitrary x ∈ Qk, by assumption there exist f : kj → k and an isotropic element xj ∈ T (kj) such that T (f )(xj)= x. It follows that
νk(x)= νk(T (f )(xj))	(By assumption on T )
= H(f )(νk(xj))	(By naturality)
= G(f )(νk(xj))	(H = G on Polf )
= G(f )   1 ,...,  1	(xj is isotropic and (7))
Clearly, the same reasoning applies to any other natural transformation ρ : T ⇒ H. We have thus shown that for each finite Polish set k, νk is unique on a dense subset Qk of T (k). Since νk is a morphism in Pol it is continuous, and since Polish spaces are complete, it is in fact Cauchy-continuous. It follows that the restriction of νk to Qk has a unique extension to T (k). Since the restriction of νk to Qk is unique, it follows that νk is also unique.	2
Note that the entire group Sk was necessary to show Lemma 6.7, i.e. a weaker notion of isotropic element would not be sufficient.

Lemma 6.8 Let (T, H) be a pair of functors satisfying the conditions of Theorem 6.2, then (T, H) is rigid on Polcz.
Proof. Assume ν : T|Polf ⇒ H|Polf is given. By Lemma 6.7, ν is unique. Since H
is Polf -continuous, Theorem 4.2 applies and the proof is complete.	2
Lemma 6.9 Let (T, H) be a pair of functors satisfying the conditions of Theorem 6.2, then (T, H) is rigid on Polb .
Proof. It is enough to reuse the uniqueness part of the proof of Theorem 4.8.	2

We can finally prove Theorem 6.2.
Proof. (Theorem 6.2) Let α : T|Polb ⇒ H|Polb
be given. By Lemma 6.9, α is the

z	z
unique such transformation. Let β, βj : T ⇒ H be given, extending α. For all X and
F ∈ Bases(X), the identity function id : z7 (X) → X is continuous. By the rigidity

assumption, βzF
j
zF (X)
. Using this equation and naturality,

βX ◦ T (id)= H(id) ◦ βzF
(X) = H(id) ◦ βj
= βj
T (id)

Therefore β = βj.	2
Example 6.10 We have shown earlier that G satisfies all the conditions of Theorem
6.2. It follows that there can only exist a single natural transformation G ⇒ G, and since the identity transformation is natural, it follows that G is rigid.
Example 6.11 Let M+ : Pol → Pol be the finite positive measure functor. We can check that the following transformation is natural: define ν : M+ → G at a Polish

space X by νX (Q)  A '→ Q(A)
for A a Borel set of X. This is well defined since

0 < Q(X) < ∞. It is also natural: if f : X → Y is a map in Pol, then for each Q
in M+(X) and Borel set B of Y we have:


—1	Q(f—1(B))
Q(f—1(B))

G(f )(νX (Q))(B)= νX (Q)(f
(B)) =
Q(X)	= Q(f—1(Y ))

= νY (M+(f )(Q))(B)
Since M+ satisfies (iv), it follows from Theorem 6.2, that the normalisation trans- formation ν we have just defined is the only natural transformation M+ ⇒ G.
Applications
In previous work [7], we showed that a cornerstone of nonparametric Bayesian statis- tics, the Dirichlet process [8,10], is in fact a natural transformation from M+ to G2. This result hinged on a non-axiomatic version of the Machine of Sec. 4. In order to validate our new developments we first give a short construction of the Dirichlet process in axiomatic form. The value of our general framework is then illustrated by constructing the Poisson process as a natural transformation. At the heart of these constructions are families of distributions which are stable by convolution

(mistakenly taken to be infinitely divisible in [7]). Common examples include: the Γ distribution, the Gaussian distribution, the Poisson distribution, etc. What exam- ples such as Dirichlet or Poisson processes have in common is that they can all be represented by natural transformations of the shape M+ ⇒ GH where the functor H can be either B or M+. Since M+ is Z-cocontinuous, since G and H are Polf - continuous, preserve injections, embeddings and intersections (see Appendix B) we can define a natural transformation of this type by restricting ourselves to Polf and running the Machine.
In the cases which we have mentioned above, the natural transformation in Polf can in fact be defined by a single map! The fundamental property which makes this possible is that both M+ and B turn coproducts into products. When this is the case it is sometimes possible to define φ : M+ ⇒ GH on Polf from a map φ1 : M+(1) → GH(1). For this we need a fundamental result which holds very generally in the category Meas of measurable spaces and measurable maps. We define the product measure natural transformation between the bifunctors π : G − ×G− → G(−× −) at each pair of measurable spaces ((X, ΣX ), (Y, ΣY )) by π(X,Y )(p, q) '→ p × q where p × q is the product measure defined on the product σ-algebra (ΣX ⊗ ΣY ).


Theorem 7.1 The transformation π : G − ×G−→ G(−× −) is natural in both its arguments.


Let us now fix a continuous map φ1 : M+(1) → GH(1). For any n in Polf we use
the fact that n =  n	1 and the fact that M+ and H turn coproducts into products
to define φn : M+(n) → GH(n) by





φn

z˛
M+(n) ∼= M+(1)n 	1 /(G¸H(1))n   H1 /G(¸H1)n ∼= GH(n)


where  n	is the n-fold measure product at H(1). The maps φn define the com-
ponent of a transformation M+ ⇒ GH. But when is it natural? A simple criterion is given in the following result.


Theorem 7.2 A transformation φ : M+ → GH built as above is natural in Polf iff
the following diagrams commute:


M+(2) 	φ2	/GH¸(2)	M+(n) 	φn	/GH¸(n)

M+(e)
GH(e)
  
M+(ij)
GH(ij)
  

M+(1)
/GH¸(1)
φ1

(8)
M+(n)
/GH¸(n)
φn

(9)


M+(1) 	φ1	/GH¸(1)	M+(1) 	φ2	/GH¸(2)

M+(i1)
GH(i1)
  
M+(i2)
GH(i2)
  

M+(2)
/GH¸(2)
φ2

(10)
M+(2)
/GH¸(2)
φ1

(11)

where e :2 → 1 is the obvious unique epimorphism, (ij): n → n is any permutation of two elements of n, and i1, i2 :1 → 2 are the two injections of 1 into 2=1 + 1.
Proof. Any map f : m → n between finite sets can be written as a permutation π : n → n followed by a monotone surjection q : n → k followed by a monotone injection i : k > n. Since every permutation of n can be written asa composition of permutation of two elements, repeated usage of Diagram (9) shows that GHπ◦φn = φn ◦ M+π. Monotone surjections q : m → n can be written as a composition of maps of the shape
id1 + id1 + ... + e + id1 + ... + id : k → k − 1
For notational clarity let us consider the case e + id1 :3 → 2. The following square commutes:
N
M+(3) ∼= M+(2) × M+(1)	/GH¸(2) × GH(1)	/G(¸H(2) × H(1)) ∼= GH(3)

M+(e)×id1
GH(e)×id1
  
G(H(e)×id1)
  

M+(2) ∼= M+(1) × M+(1)
φ ×φ /GH¸(1) × GH(1) N /G(¸H(1) × H(1)) ∼= GH(2)

Indeed, the right-hand side square commutes by Theorem 7.1, whilst the left-hand side square commutes by assumption that Diagram 8 commutes. Monotone injec- tions are treated in a similar way.	2
We will call a family of probability distributions φn : M+(n) → GH(n) additive if (8) holds, exchangeable if (9) holds, and say that it admits zero parameters if (10) and (11) hold.
The Γ distribution Γ1 : M+(1) → GM+(1) maps any parameter λ ∈ M+(1) to a

probability with density x '→ xλ−1e−x
w.r.t. Lebesgue [3]. The family of probability

distributions Γn generated by Γ1 is clearly exchangeable; it is also additive [7] and one can easily adapt the definition so that it admits zero parameters. It follows from Theorem 7.2 that Γn : M+(n) → GM+(n) is a natural transformation on Polf which extends to Pol. The Dirichlet process is then simply defined as D : M+ ⇒ G2 

(Gν)Γ, where ν : M+ ⇒ G is the normalisation natural transformation (unique, by rigidity!).
Similarly, if we define Π : M+(1) → GB(1) ∼= G(N) by Π (λ)(k)= λke−λ , then
1	1	k!
it is well-known that the family Πn generated by Π1 (similarly to the previous case)
is additive. It is also clearly exchangeable. Finally to allow for zero parameters, we extend Π1 : M≥0(1) → G(N) by putting Π1(0) = δ0, the Dirac delta at 0. It is clear that for any test function f : N → R

kΣ=0

f (k)
λke—λ
= f (0)e—λ
k!

+
k=1

f (k)
λke—λ k!

→
−→	f (0) =

f (k)δ0
k

i.e. our extension is continuous for the weak topology. This fact is the exact analogue of Proposition 4.2 in [7]. The family Πn : M≥0(n) → GNn thus defines a natural transformation in Polf by Theorem 7.2, and by applying the Machine we produce

a natural transformation on Pol. The processes ΠX : M+
(X) → GB(X) (for X

in Pol) defined by this natural transformation are very well-known in probability theory, they are the (inhomogeneous) Poisson point processes on X parameterised by a measure on X.
Outlook
Our results allow the compositional and finitary approximation of a class of param- eterised “stochastic” processes seen as natural transformations between probability- like functors satisfying some general axioms. It is worth noting that all the conditions on endofunctors that we require for the codomain of natural transformatins are pre- served by composition (if we strengthen Polf -continuity to commutation with all limits of ccd s). Indeed, we are confident that compositionality can be pushed fur- ther: following coalgebraic practice, we will investigate whether functors in e.g. the polynomial closure of Giry can be fed to the Machine. For this to happen, parts of the Machine have yet to be better understood, in particular the special role played by the requirement of Z-cocontinuity (commutation with diagrams of zero- dimensional refinements). For instance, we ignore whether the Vietoris functor and the multiset functors are Z-cocontinuous, or whether Z-cocontinuity is preserved by composition.
Rigidity is an unexpected mathematical outcome of our structural decomposition of Pol. Where the Machine allows to prove existence of natural transformations, rigidity allows to prove unicity and is somewhat dual to the former. We expect that the notion of isotropic element will find applications beyond the scope of these developments.
On the applications side, we are confident that many processes beside Dirichlet and Poisson can be subject to the same treatment. Poisson-Dirichlet, Cox processes and some form of Gaussian processes seem to be easy targets. In the case of Dirich- let, we already know that the Machine allows to prove an asymptotic “learning” property. The work of (Culbertson et al, [6]) will provide a convenient setting where we will study how topological properties of Bayesian models such as continuity relate

to asymptotic properties of Bayesian update. The finitary handle provided by the Machine might also be useful in deriving new computability or complexity results in the field of probability.
Acknowledgment
We would like to thank the anonymous referees and Michael Mislove for their helpful remarks.

References
Jiri Adamek, Horst Herrlich, and George E. Strecker. Abstract and concrete categories : the joy of cats. Pure and applied mathematics. Wiley, New York, 1990. A Wiley-Interscience publication.
Charalambos D Aliprantis and Kim C Border. Infinite dimensional analysis. Springer, 1999.
N. Balakrishnan and V.B. Nevzorov. A Primer on Statistical Distributions. Wiley, 2004.
N. Bourbaki. Elements de math´ematique. Topologie G´en´erale. Springer, 1971.
Philippe Chaput, Vincent Danos, Prakash Panangaden, and Gordon Plotkin. Approximating Markov Processes by averaging. Journal of the ACM, 61(1), January 2014. 45 pages.
Jared Culbertson and Kirk Sturtz. A categorical foundation for Bayesian probability. Applied Categorical Structures, pages 1–16, 2012.
Vincent Danos and Ilias Garnier. Dirichlet is natural. Electronic Notes in Theoretical Computer Science, 319:137 – 164, 2015. MFPS XXXI.
Thomas S Ferguson. A Bayesian analysis of some nonparametric problems. The Annals of Statistics, pages 209–230, 1973.
M. Giry. A categorical approach to probability theory. In B. Banaschewski, editor, Categorical Aspects of Topology and Analysis, number 915 in LNM, pages 68–85. Springer-Verlag, 1981.
Amol Kapila, Bela Frigyik, and Maya R. Gupta. Introduction to the Dirichlet distribution and related processes. Technical Report UWEETR-2010-0006, University of Washington., 2010.
Alexander S Kechris. Classical descriptive set theory, volume 156 of Graduate Text in Mathematics. Springer, 1995.
Klaus Keimel and Gordon Plotkin. Mixed powerdomains for probability and nondeterminism. Logical Methods in Computer Science, 2015.
Dexter Kozen. Kolmogorov extension, martingale convergence, and compositionality of processes. Technical report, Computing and Information Science, Cornell University, December 2015.
Dexter Kozen, Kim G Larsen, Radu Mardare, and Prakash Panangaden. Stone duality for markov processes. In LICS 2013, pages 321–330, 2013.
Saunders Mac Lane. Categories for the Working Mathematician. Springer, 1998.

Construction of the multiset functor B
Proposition A.1 For X Polish, let B(X)  n∈N Xn/Sn, where Xn/Sn is the quotient of Xn under the obvious action of Sn on tuples with the quotient topology,
i.e. the ﬁnal topology for the quotient map q : Xn → Xn/Sn. B(X) is Polish.
Proof. We first shown that if Q is dense in X, then Qn/Sn is dense in Xn/Sn: let U be an open set of Xn/Sn, then q—1(U ) is open in Xn and intersects Qn,
i.e. there exists (r1,..., rn) ∈ Qn with (r1,..., rn) ∈ q—1(U ), but this means that q(r1,..., rn) ∈ U and q(r1,..., rn) ∈ Qn/Sn. To see that it is completely metrisable, let d be a complete metric for X,and consider the metric on Xn/Sn given by:
dq([x], [y]) = min dn(x, π(y))
π∈Sn
where [x], [y] represent the orbits of x, y ∈ Xn respectively, and dn is the product metric given by


dn((x1,..., xn), (y1,..., yn)) =
1

p
d(xi, yi)p
i

(A.1)

for some 0 < p < ∞ (any choice of p generates an equivalent topology on Xn). Note that dn is invariant under permutations of Sn, i.e. for any permutation π ∈ Sn, dn(x, y)= dn(π(x), π(y)) since this simply amounts to re-arranging the summands in Eq. (A.1). It is not immediately clear that dq is well-defined or that it defines a metric. To see that it is well defined let xj be another representative of [x], then by definition there exists ρ ∈ Sn such that ρ(x)= xj, and it follows that
min dn(xj, π(y)) = min dn(ρ(x), π(y)) = min dn(x, ρ—1π(y)) = min dn(x, π(y))

π∈Sn
π∈Sn
π∈Sn
π∈Sn

It follows that dq is well-defined. Let us now check that it is a metric. For any x, y we clearly have dq([x], [y]) ≥ 0 and dq([x], [y]) = 0 means that there exists π ∈ Sn such that dn(x, π(y)) = 0 i.e. x = π(y) since dn is a metric, and it follows that [x]= [y]. It is straightforward to verify symmetry condition:
dq([x], [y]) = min dn(x, π(y))
π∈Sn
= min dn(π—1(x), y)	dn invariant under π—1
π∈Sn
= min dn(y, π—1(x))	dn is symmetric
π∈Sn
= dq([y], [x])
Finally, we need to check the triangular inequality. Since dn satisfies the triangular inequality we have for any choice π1, π2 ∈ Sn that:
dn(x, π1(y)) ≤ dn(x, π2(z)) + dn(π2(z), π1(x))
≤ dn(x, π2(z)) + dn(z, π—1π1(x))	dn invariant under π—1
2	2

and it follows that dq([x], [y]) ≤ dq([x], [z]) + dq([z], [y]) since going through all the combinations π—1π1 will exhaust the entire group Sn. The fact that (Xn/Sn, dq) is complete follows from the fact that (Xn, dn) is. Let us prove that dq induces the topology of Xn/Sn. Let us take an open set U in Xn/Sn. By definition q—1(U ) is open in Xn, and can therefore be written as a union of open balls (for the metric dn) U = ∪iBdn (xi, ϵi). By definition q—1(U ) is invariant under permutation, so


q—1(U )=   π(q—1(U )) = 

π   Bdn (xi, ϵi)  = 

  π (Bdn (xi, ϵi))



=
i π∈Sn

		 
π (Bdn (xi, ϵi))

since direct images commute with unions. It follows from the fact that each
π is an homeomorphism that  π∈Sn π(Bdn (xi, ϵi)) is open in X . Moreover,
n




q—1(q(
π∈Sn
π(Bdn (xi, ϵi)))) =
π∈Sn
π(Bdn (xi, ϵi))

and therefore each q(  π∈Sn


π(Bdn (xi, ϵi)) is an open in Xn/Sn. We conclude by

q—1(Bd (q(xi), ϵi)) = q—1(q(    π(Bdn (xi, ϵi))) = 
π(Bdn (xi, ϵi))

π∈Sn	π∈Sn
is open in Xn. Therefore, the balls Bd (q(xi), ϵi) are open in Xn/Sn, and since direct
q	 
images commute with unions it is not difficult to see that U =	i Bdq (q(xi), ϵi) isa 
union of opens from the basis generated by the metric. Since each Xn/Sn is Polish
and since Pol has countable coproducts, B(X) is Polish.	2
Properties of the functors B and V
Proposition B.1 The multiset functor B preserves injections, embeddings and in- tersections.
Proof. Let i : B > X be a mono, i.e. an injective continuous map. Note first that B(i) is defined component-wise i.e. via Bn(i) : Bn/Sn > Xn/Sn injecting an equivalence class of n-tuples of element of B in Xn/Sn. The fact that B(i) is injective follows from the fact that every component Bn(i) is. Similarly, to show that if i is an embedding so is B(i), it is enough to show that each Bn(i) is an embedding. To see that this is the case we need to show that for every open U of Bn/Sn there exists an open V of Xn/Sn such that U = V ∩ Bn/Sn and conversely that every subset of this shape is open in Bn/Sn. We write pn : Bn → Bn/Sn and qn : Xn → Xn/Sn. For the first direction, let U be open in Bn/Sn, it follows that p—1(U ) is open in Bn, and thus that there exists an open V of Xn such that p—1(U )= Bn ∩ V . If we

can choose V to be closed under permutation we are done. Every permutation is a bijective isometry and thus a homeomorphism, and thus an open map, i.e. π(V ) is open for every π ∈ Sn. It follows that


V ∗ =
π∈Sn
π(V )

is open and closed under permutations (this procedure amounts to taking all the reflections of tuples along the diagonal). It follows that q—1(qn[V ∗]) = V ∗ and qn(V ∗) is thus open in Xn/Sn. Moreover since Bn ∩V is already closed under permutations Bn ∩ V = Bn ∩ V ∗, and therefore U = Bn/Sn ∩ qn(V ∗). For the opposite direction, let U be open in Xn/Sn and consider U ∩ Bn/Sn, it is clear that
p—1(U ∩ Bn/Sn)= p—1(U ) ∩ p—1(Bn/Sn)= (q—1(U ) ∩ B) ∩ B = q—1(U ) ∩ B
n	n	n	n	n
which is open in Bn since qn(U ) is open in Xn.
For intersections, we proceed as in Proposition 5.1. Let j1, j2 : A, B > X be two embeddings, let p1 : A ∩ B → A and p2 : A ∩ B > B be the corresponding embeddings and consider μ ∈ BA, ν ∈ BB such that Bj1(μ) = Bj2(ν). We define λ ∈ B(A ∩ B)
λ(x)= μ(p1(x)) = ν(p2(x))
We check that the last equality holds in exactly the same way as in the proof of Proposition 5.1, and the rest of the proof also follows identically.	2
Proposition B.2 The Vietoris functor V preserves monomorphisms, embeddings and intersections.
Proof. It is clear that V preserves injective maps. To see that it preserves embed- dings, consider an element of the basis of the topology on V(X), i.e. an element of the form (Kechris [11] I, 4.F)
W = {K ∈ V(X) | K ⊆ U0&K ∩ U1 /= ∅&	&K ∩ Un /= ∅}
for U0,..., Un opens in X. It follows that
W ∩ V(B)
= {K ∈ V(B) | K ⊆ (U0 ∩ B)&K ∩ (U1 ∩ B) /= ∅&	&K ∩ (Un ∩ B) /= ∅}
which is an element of the basis of the topology of V(B), since elements of the shape Ui ∩ B are precisely the opens of B. Conversely therefore, starting from an element Wj of this shape it is clear that by removing all the intersections with B we get an element W of the basis of the topology on V(X) such that W ∩ V(B)= Wj, and V thus preserves embeddings.
For intersections, let j1, j2 : A, B > X be two embeddings, let p1 : A ∩ B → A and p2 : A∩B > B be the corresponding embeddings and consider KA ∈ VA, KB ∈ VB such that Vj1(KA)= Vj2(KB), i.e. such that j1[KA]= j2[KB]. This means that K = KA = KB is a subset of A∩B. To see that it is compact in A∩B, let  i Ui ⊇ K

be an open cover: for each i either Ui is of the form p—1(Vi) for some Vi open in A, or it is of the form p—1(Vi) for some Vi open in B. In the latter case, since j2 is an embedding, there exists Wi open in C such that Ui = p—1(j—1(Wi)), but then Ui = p—1(j—1(Wi)), which means that we can assume without loss of generality that
1	1
for each i the element Ui of the cover is of the form p—1(Vi) for some Vi open in A. It is easy to see that Vi is an open cover of K in A, from which we can extract a finite sub-cover, whose inverse image under p1 will be an finite sub-cover of K in A ∩ B. It follows that VA ∩ VB  V(A ∩ B) as sets, and since V preserves embeddings, they are also homeomorphic.	2

Proposition B.3 B is Polf -continuous.
Proof. Let Xi,i ∈ I be a ccd of Polf objects. We show lim BXi = B(lim Xi). For this we need to show that the unique continuous map u : B(lim Xi) → lim BXi is a homeomorphism. To show this will show that it is bijective and open. We start by defining an inverse φ : lim BXi > B(lim Xi). Since the set underlying the limits are computed in Set, showing that φ exists and is an inverse as a function will be enough to prove that u is bijective. We can assume w.l.o.g. that the morphisms between the finite Polish spaces Xi are surjective.
Given a ‘thread’ (μi)i∈I ∈ lim BXi we need to define a finitely supported multiset on the threads (xi)i∈I ∈ lim Xi. For the thread (μi) consider the projective system of supports (supp(μi))i∈I together with the obvious restrictions fij T supp(μi) of the connecting maps fij : Xi → Xj which are also surjective. We claim that lim supp(μi) is finite and forms the support of the multiset φ((μi)i∈I ) on lim Xi . We make the following observation:
Each support is finite
The size of the support cannot increase by following the connecting arrows, since they are surjective.
The total mass k of μi,i ∈ I is constant throughout the thread because B
applied to a connecting morphism preserves the total mass of a multiset.
The cardinality of the set supp(μi) is bounded by k since we cannot assign a weight less than one to any element in the support.
There exists an i ∈ I after which the cardinality of supp(μi) remains constant,
i.e. such that |supp(μk)| = |supp(μj)| for each j > k. If this wasn’t the case it would contradict the previous points.
Thus let k be such that |supp(μk)| = |supp(μj)| for each j > k, we claim that pk : lim supp(μi) → supp(μk) is a bijection. It is surjective since the connecting morphisms in the diagram are surjective. If (xi)i∈I, (yi)i∈I are two threads such that pk(xi) = pk(yi) then xk = yk. Now take any kj ∈ I, by co-directedness there exists j > k, kj and by assumption on k, supp(μk) and supp(μj) have the same cardinality, i.e. the connecting morphism pjk is bijective. There therefore exists a unique xj ∈ supp(μj) such that pjk(xj)= xk = yk, and it follows that both thread must go through the same element at kj too, for any kj, which shows that pk is

injective. We define φ((μi)i∈I ) as the multiset on lim Xi defined by:


(xi)i∈I
'→	0	if (xi)i∈I ∈/ lim supp(μi)
μk(xk)	else (where k is defined as above)

We need to show that the definition is independent of the choice of k. Consider another index kj such that |supp(μk′ )| = |supp(μj)| for each j > kj. Again by co-directedness there exists j > k, kj. We now calculate:
μk(xk)= μk(fjk(xj)) = Bfjk(μj)(fjk(xj)) = μj(xj)= Bfjk′ (μj)(fjk′ (xj))
= μk′ (xk′ )
Let us now show that φ thus defined is a left and right inverse to u. Given a multiset μ ∈ B(lim Xi) on threads of lim Xi, u(μ) is the thread of multisets νi on Xi defined by νi(x)= μ[p—1({x})], i.e. the mass given by μ to the set of threads going through x ∈ Xi. This family forms a thread since for every fij : Xi → Xj and y ∈ Xi,
νj(y)= μ[p—1({y})] = μ[p—1(f—1(y)] = νi(f—1(y)) = Bfij(νi)(y)
j	i	ij	ij
For μ ∈ B(lim Xi), let u(μ) = (νi)i∈I . The support supp(νi) is given by the set Yi ⊆ Xi of points traversed by a thread in the support of μ, and it is therefore not hard to see that lim supp(νi) with the multiplicities defined by φ is precisely μ, i.e. φ ◦ u = idB(lim Xi). Conversely u ◦ φ = idlim Xi by universality of lim Xi.
Finally, we show that the unique u : B(lim Xi) → lim BXi is a homeomorphism. We already know that it is continuous and bijective, so it remains to be shown that it is open. For this we must look at the topologies on B(lim Xi) and lim BXi. In the former U is an open exactly when q—1(U ) is open in (lim Xi)n for each n where qn : (lim Xi)n → (lim Xi)n/Sn. Any subset U of B(lim Xi) can be written as an union of sets Un in (lim Xi)n/Sn, so it is sufficient to show that u maps opens
of (lim Xi)n/Sn (corresponding to sets of multisets of total mass n) to opens in lim BXi. It is not hard to check that U is open in (lim Xi)n/Sn iff there exists V
open in (lim Xi)n such that qn[V ∗] = U where V ∗ =  π∈S π[V ]. To check that
u(U ) is open it is therefore enough to check that u ◦ qn ◦ π[V ] is open for any open
V in (lim Xi)n and any π ∈ Sn; and since π is a homeomorphism this really means checking that u◦qn[V ] is open when V is. By the definition of the product topology and of the topology on lim Xi it is enough to check that u ◦ qn[Y j] is open for Y j
k	k
the set of n-tuples of threads of lim Xi whose jth component goes through Yk ⊆ Xk.
The morphism qn collapses such an n-tuple to a multiset on threads and qn[Y j] is the set of multisets of total mass n which assigns mass at least one to threads going through Yk.
To check that u sends these open sets to open sets we need to describe the topology on the codomain. Fortunately is it much simpler. Since each Xi is finite, Xn/Sn is finite, and must therefore have the discrete topology. Since B(Xi) =
n Xn/Sn is given the final topology for all the injections its topology must also
be discrete. The topology on lim B(Xi) is thus generated by the opens of the shape
p—1(Ui) where Ui is any subset of B(Xi) and pi is the canonical projection.

We can now check that u is open. Let us denote qn[Y j]= Y n the set of multisets
k	k
of total mass n which assigns mass at least one to threads going through Yk. It
gets mapped to a set B(pk(Y k)) of multisets on Xk, which in turns defines u(Y n)= 
n	k
p—1(B(pk(Y k))) which is indeed open.	2
k	n
Proposition B.4 Let (Xi)i∈I be a ccd of compact spaces. Then V(lim Xi) ∼= lim VXi
Proof. Let (Xi)i∈I be a ccd of compact Polish space; we must show that V lim Xi = lim VXi. Let us first show that there exists a bijection between these sets. We write pi : lim Xi → Xi for the canonical projections. We know that there exists a unique continuous map u : V lim Xi → lim VXi; it takes a compact K of lim Xi and maps it to the thread (pi[K])i∈I of lim VXi (since the continuous image of a compact is compact). Let K, Kj be two compacts of lim Xi such that pi[K]= pi[Kj] for every i ∈ I, for every thread (xi) in lim Xi it is clear that (xi) ∈ K iff pi(xi) ∈ pi[K] iff pi(xi) ∈ pi[Kj] iff (xi) ∈ Kj and thus u is injective.
We now define an inverse map φ : lim VXi → V lim Xi as follows. For each thread of compacts (Ki)i∈I in lim VXi, since each Xi is Hausdorff, each Ki is closed and thus p—1(Ki) is a closed subset of lim Xi. We define
φ((Ki)i∈I )=  p—1(Ki)
i
To see that this is well-defined, we need to show that φ((Ki)i∈I ) is compact. Since each p—1(Ki) is closed, their intersection φ((Ki)i∈I ) is closed. We also know that since each Xi is compact lim Xi is a closed subspace of the product  Xi which is compact by Tychonoff’s theorem. It follows that lim Xi is compact, and since V sends compacts to compacts (Kechris Theorem 4.26), V lim Xi is compact. Finally since φ((Ki)i∈I ) is closed in a compact it is itself compact.
To see that φ is a left inverse of u, start with K ∈ V lim Xi, u(K)= (pi[K])i∈I and
φ(u(K)) =  p—1(pi[K])
i
Let (xi) be a thread in K, then clearly pi((xi)) = xi ∈ pi[K] for all i, and thus
(xi) ∈ φ(u(K)). Conversely, let (xi) bea thread in φ(u(K)) then by definition of φ, pi((xi)) ∈ pi[K] for every i, i.e. xi ∈ pi[K] for every i, i.e. (xi) ∈ K, and it follows that φ ◦ u = idV lim Xi . Conversely, φ is a right inverse since u ◦ φ = idlim VXi by universality of u. We have thus established that u is bijective.
Finally, since u : V lim Xi → lim VXi is a continuous bijection with a compact domain and a Hausdorff codomain, it is a homeomorphism, which concludes the proof.	2
