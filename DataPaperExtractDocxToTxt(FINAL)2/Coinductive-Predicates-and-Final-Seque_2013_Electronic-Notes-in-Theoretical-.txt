Available online at www.sciencedirect.com


Electronic Notes in Theoretical Computer Science 298 (2013) 197–214
www.elsevier.com/locate/entcs

Coinductive Predicates and Final Sequences in a Fibration
Ichiro Hasuo	Kenta Cho	Toshiki Kataoka
Department of Computer Science, University of Tokyo, Japan
Bart Jacobs
ICIS, Radboud University Nijmegen, The Netherlands

Abstract
Coinductive predicates express persisting “safety” specifications of transition systems. Previous observa- tions by Hermida and Jacobs identify coinductive predicates as suitable final coalgebras in a fibration—a categorical abstraction of predicate logic. In this paper we follow the spirit of a seminal work by Worrell and study final sequences in a fibration. Our main contribution is to identify some categorical “size restriction” axioms that guarantee stabilization of final sequences after ω steps. In its course we develop a relevant categorical infrastructure that relates fibrations and locally presentable categories, a combination that does not seem to be studied a lot. The genericity of our fibrational framework can be exploited for: binary relations (i.e. the logic of “binary predicates”) for which a coinductive predicate is bisimilarity; constructive
logics (where interests are growing in coinductive predicates); and logics for name-passing processes.
Keywords: coalgebra; (co)recursive predicate; modal logic; fibration; locally presentable category

Introduction
Coinductive predicates postulate properties of state-based dynamic systems that persist after a succession of transitions. In computer science, safety properties of nonterminating, reactive systems are examples of paramount importance. This has led to an extensive study of specification languages in the form of fixed point logics and model-checking algorithms.
In this paper we follow [28,29] (further extended in [5,20]; see also [34, Chap. 6]) and take a categorical view on coinductive predicates. Here coalgebras represent transition systems; a fibration is a “predicate logic”; and a coinductive predicate is identified as a suitable coalgebra in a fibration. Our contribution is the study of final sequences—an iterative construction of final coalgebras that is studied notably in [2, 46]—in such a fibrational setting.

1571-0661 © 2013 Elsevier B.V. Open access under CC BY-NC-ND license.
http://dx.doi.org/10.1016/j.entcs.2013.09.014

Coalgebras have been successfully used as a categorical abstraction of transition systems (see e.g. [34, 43]): by varying base categories and functors, coalgebras bring general results that work for a variety of systems at once. Fixed point logics (or modal logics in general), too, have been actively studied coalgebraically: coalgebraic modal logic is a prolific research field (see [12]); their base category is typically Sets but works like [36] go beyond and use presheaf categories for processes in name- passing calculi; and literature including [11, 13, 45] studies coalgebraic fixed point logics.
Unlike most of these works, we follow [28, 29] and parametrize the underlying “predicate logic” too with the categorical notion of fibration. The conventional
Pred

setting of classical logic is represented by the fibration
↓
Sets
(see Appendix A.3 of

the extended version [24] for an introduction to fibrations).
However there are various other “logics” modeled as fibrations, and hence the fibra- tional language provides a uniform treatment of these different settings. An example is bi- nary relations (instead of unary predicates)
Rel

that form a fibration
↓
Sets
(see Appendix A.3 in [24]). In this case coinductive

predicates are bisimilarity (see the table, and Example 5.12 later).
Another example is predicates in constructive logics. They are modeled by the subobject fibration of a topos. In fact, coinductive predicates in constructive logics are an emerging research topic: coinduction is supported in the theorem prover Coq (based on the constructive calculus of constructions), see e.g. [6]; and, working in Coq, some interesting differences between classically equivalent (co)inductive predicates have been studied e.g. in [41].
Yet another example is modal logics for processes in various name-passing calculi. They are best modeled by the subobject fibration of a suitable (pre)sheaf category like SetsI and SetsF.

Coinductive Predicates and Their Construction, Conventionally
In order to illustrate our technical contributions (§3) we first present a special case, with classical logic and Kripke models. We first introduce syntax.
Definition 1.1 (Rudimentary logic Rν) This fragment of the µ-calculus allows only one greatest fixed-point operator at the outermost position.
Rνu ∋ α ::= a | a | □u | 3u | α ∧ α | α ∨ α ;    Rν ∋ β ::= νu. α .   (1)
Here a belongs to the set AP of atomic propositions; a stands for the negation of a; and u is the only fixed-point variable (with possibly multiple occurrences).
An Rν-formula can be thought of as a recursive definition of a coinductive predi- cate. Later we will model such a “definition” categorically as a predicate lifting.

A specification expressible in Rν is (may-) deadlock freedom (“there is an infinite path”). It is expressed by νu. 3u and is our recurring example.
An Rν-formula is interpreted in Kripke models. Let c = (X, →, V ) be a Kripke model, where X is a state space, → ⊆ X × X is a transition relation and V : X → P(AP) is a valuation. The conventional interpretation [νu.α]c of Rν-formulas in the Kripke model c is given as follows (see e.g. [9]). Firstly, we interpret α ∈ Rνu as a function [α]c : PX → PX. Concretely:
[a]c(P ) = {x | a ∈ V (x)}	[a]c(P ) = {x | a /∈ V (x)}
[□u]c(P ) = {x | ∀y ∈ X. (x → y implies y ∈ P )} [3u]c(P ) = {x | ∃y ∈ X. (x → y and y ∈ P )} [α ∧ α′]c(P ) = [α]P ∩ [α′]P	[α ∨ α′]c(P ) = [α]P ∪ [α′]P
This function [α]c is easily seen to be monotone, since u occurs only positively in α. Finally we define [νu.α]c ⊆ X to be the greatest fixed point of the monotone function [α]c : PX → PX.
The Knaster-Tarski theorem guarantees the existence of such a greatest fixed point [νu.α]c in a complete lattice PX. However its proof is highly nonconstructive. In contrast, a well-known construction [14] by Cousot and Cousot computes [νu.α]c as the limit of the following descending chain (see also [9]). Here ⊤ denotes the subset X ⊆ X.

⊤ ≥ [α]c⊤ ≥ [α]2⊤ ≥ · · ·	(2)
An issue now is the length of the chain. If [α]c preserves limits V
(which is the case with α ≡ □u), clearly ω steps are enough and yields


· · ·

Vi∈ω
([α]i ⊤) as the greatest fixed point. This is not the case with

α ≡ 3u. Indeed, for the Kripke model c1 on the right [νu. 3u]c1 /=

Vi∈ω
([3u]i
⊤): there is no infinite path from the root; but it satisfies [3u]i ⊤

(‘there is a path of length ≥ i’) for each i.
Yet the chain (2) eventually stabilizes, bounded by the size of the poset PX. Therefore the calculation of [νu.α]c is, in general, via transfinite induction. This is what we call a state space bound for (2).
Besides a state space bound, another (possibly better and seemingly less known) bound can be obtained from a behavioral view. One realizes that not only the size of the state space X but also the branching degree can be used to bound the length of the chain (2). For example, a result similar to [26, Thm. 2.1] states that the chain stabilizes after ω steps if the Kripke model c is finitely branching. This holds however large the state space X is; and also for any Rν-formula νu.α. Notice that the model c1 (depicted above) is not finitely branching.
Final Sequences in a Fibration
This paper is about putting the observations in §1.1 in general categorical terms. Our starting observation is that the chain (2) resembles a final sequence, a classic construction of a final coalgebra.
In the theory of coalgebra a final F-coalgebra is of prominent importance since it is a fully abstract domain with respect to the F-behavioral equivalence. Therefore a natural question is if a final F -coalgebra exists; the well-known Lambek lemma

prohibits e.g. a final P-coalgebra. What matters is the size of F : when it is suitably bounded, it is known that a final coalgebra can be constructed via the following final F-sequence.

1	!	F 1  F !
· · · F i−1 ! Fi1
Fi !
· · ·
(3)

Here 1 is a final object in C, and ! is the unique arrow. In particular, if F is finitary, a final coalgebra arises as a suitable quotient of the ω-limit of the final sequence (3). This construction in Sets is worked out in [46]; it is further extended to locally presentable categories (those are categories suited for speaking of “size”) with additional assumptions in [2].
Turning back to coinductive predicates, indeed, the fibrational view [28,29] iden- tifies coinductive predicates as final coalgebras in a fibration. This leads us to scrutinize final sequences in a fibration. Our main result (Thm. 3.7) is a categori- cal generalization of the behavioral ω-bound (§1.1)—more precisely we axiomatize categorical “size restrictions” for that bound to hold.
The conditions are formulated in the language of locally presentable categories (see e.g. [4]; also Appendix A.2 of [24]); and the combination of fibrations and locally presentable categories does not seem to have been studied a lot (an exception is [39, §5.3]). We therefore develop a relevant categorical infrastructure (§5.1). Our results there include a sufficient condition for the total category Sub(C) of a subobject fibration to be locally (finitely) presentable, and the same for a family fibration Fam(Ω) too. Via these results, in §5.2 we list some concrete examples of fibrations to which our results in §3 on the behavioral bounds apply. They include:

Pred
↓
Sets
(classical logic);
Rel
↓
Sets
(for bisimulation and bisimilarity);
Sub(C)
↓
C
for C that

is locally finitely presentable and locally Cartesian closed (a topos is a special case);
Fam(Ω)

and
↓
Sets
for a well-founded algebraic lattice Ω.

Summary and Future Work
To summarize, our contributions are: 1) combination of the mathematical observa- tions in [28,29] and [34, Chap. 6] for a general formulation of coinductive predicates;
2) categorical behavioral bounds for final sequences that approximate coinductive predicates; and 3) a categorical infrastructure that relates fibrations and locally presentable categories.
While our focus is on coinductive predicates, inductive ones are just as important in system verification; so are their combinations. Such mixture of induction and coinduction is studied fibrationally in [27], but over mixed inductive and coinductive data types, and not over a coalgebra. We have obtained some preliminary fibrational observations in this direction.
Search for useful coinduction proof principles is an active research topic (see e.g. [8, 30]). We are interested in the questions of whether these principles are sound in a general fibrational setting, and what novel proof principles a fibrational view can lead to.

Coalgebraic modal logic is more and more often introduced based on a Stone-like duality (see e.g. [36]). Fibrational presentation of such dualities will combine the benefits of duality-based modal logics and the current results. We are also interested in the relationship to coalgebraic infinite traces [10, 32].
Kozen’s metric coinduction [37] is a construction of coinductive predicates by the Banach fixed point theorem and is an alternative to the current paper’s order- theoretic one. Its fibrational formulation is an interesting future topic.
Practical applications of our categorical behavioral bounds shall be pursued, too. Our results’ precursor—the bounds for the final sequences in Sets [2,46]—have been used to bound execution of some algorithms e.g. for state minimization [3, 15, 16]. We aim at similar use. Finally, games are an extremely useful tool in fixed point logics (also in their coalgebraic generalization, see [11, 13, 45]; also [38]). We plan to investigate the use of games in the current (even more general) fibrational setting.


Organization of the Paper
In §2 we identify coinductive predicates as final coalgebras in a fibration, following the ideas of [28, 29, 34]. The main technical results are in §3, where we axiomatize size restrictions on fibrations and functors for a final sequence to stabilize after ω steps. These results are reorganized in §4 as a fibration of invariants. §5 is devoted to examples: first we develop a necessary categorical infrastructure then we discuss concrete examples.
The extended version [24] of this paper comes with two appendices. In Ap- pendix A we present minimal introductions to the theories of coalgebras, locally presentable categories and fibrations—the three topics that our technical develop- ments rely on. Most proofs are deferred to Appendix B there.

Coinductive Predicates as Final Coalgebras
In this section we follow the ideas in [28, 29, 34] and characterize coinductive pred- icates in various settings (for different behavior types, and in various underlying logics) in the language of fibration. An introduction to fibration is e.g. in [31]; see also Appendix A.3 in [24]. In this paper for simplicity we focus on poset fibrations. It should however not be hard to move to general fibrations.
Definition 2.1 (Fibration) We refer to poset fibrations (where each fiber is a poset rather than a category) simply as fibrations.
P

Definition 2.2 (Predicate lifting) Let  ↓p be a fibration and	P	ϕ
p
P
p  (4)

F be an endofunctor on C. A predicate lifting of F along p is a functor ϕ : P → P such that (ϕ, F ) is an endomap of
C
F

fibrations.  This means: that the diagram on the right commutes; and that ϕ

preserves Cartesian arrows, that is, ϕ(f ∗Q) = (Ff )∗(ϕQ). See below.

P	f ∗Q  f Q	Q	ϕ(f ∗Q) ϕ(f Q) ϕQ

p	(Ff )∗(ϕQ)  F f (ϕQ)

(5)

C	X	f	Y	FX	F f	FY
Pred

In the prototype example
↓
Sets
, the above definition coincides (see [34]) with

the one used in coalgebraic modal logic (see e.g. [12])—presented as a (monotone)

natural transformation 2() ϕ
2F () : Setsop → Sets.

We think of predicate liftings as (co)recursive definitions of coinductive pred- icates (see Example 2.4). On top of it, we identify coinductive predicates (and invariants) as coalgebras in a fiber.
Definition 2.3 (Invariant, coinductive predicate) Let ϕ be a predicate lifting
P

of F along
↓p ; and X →c
FX be a coalgebra in C. They together induce an

endofunctor (a monotone function) on the fiber PX
where ϕ restricts to PX → PF X because of (4).
, namely PX
ϕ
→	FX


→c	PX,

A ϕ-invariant in c is a (c∗ ◦ ϕ)-coalgebra in PX, that is, an object P ∈ PX
such that P ≤ c∗(ϕP ) in PX.
The ϕ-coinductive predicate in c is the final (c∗ ◦ ϕ)-coalgebra (if it exists). Its carrier shall be denoted by Jνϕ)c. It is therefore the largest ϕ-invariant in c; Lambek’s lemma yields that Jνϕ)c = (c∗ ◦ ϕ)(Jνϕ)c).
Example 2.4 (Rν) The conventional interpretation [νu.α]c (described in §1.1) of
Pred

Rν-formulas is a special case of Def. 2.3. Indeed, let us work in the fibration
Sets ,

and with the endofunctor FK
= P(AP) × P( ) on Sets. An FK
-coalgebra X →c

P(AP) × PX is precisely a Kripke model: c combines a valuation X → P(AP) and the map X → PX that carries a state to the set of its successors. To each formula α ∈ Rνu we associate a predicate lifting ϕα of FK. This is done inductively as follows.
ϕa(U ⊆ X) =  {V ∈ FKX | a ∈ π1(V )} ⊆ FKX  ϕa(U ⊆ X) =  {V | a /∈ π1(V )} ⊆ FKX 
ϕ□u(U ⊆ X) = {V | π2(V ) ⊆ U } ⊆ FKX	ϕ3u(U ⊆ X) = {V | ∃x ∈ U. x ∈ π2(V )} ⊆ FKX 
ϕα∧α′ (U ⊆ X) = (ϕαU ∩ ϕα′ U ) ⊆ FKX	ϕα∨α′ (U ⊆ X) = (ϕαU ∪ ϕα′ U ) ⊆ FKX 
(6)
In the above, π1 and π2 denote the projections from FKX = P(AP) × PX. Then it is easily seen by induction that Jνϕα)c in Def. 2.3 coincides with the conventional interpretation [νu.α]c described in §1.1.
In fact, the predicate liftings ϕα in (6) are the ones commonly used in coalgebraic modal logic (where they are presented as natural transformations).  We point out that the same definition of ϕα—they are written in the internal language of
Sub(C)

toposes—works for the subobject fibration
↓	of any topos C. Therefore the

categorical definition of coinductive predicates (Def. 2.3) allows us to interpret the

language Rν in constructive underlying logics. Suitable completeness of C ensures that a final (c∗ ◦ ϕ)-coalgebra in Def. 2.3 exists.


Proposition 2.5 Let ϕ be a predicate lifting of F along
P
↓p ; X →c

FX be a

coalgebra in C; and P ∈ PX. We have P ≤ Jνϕ)c if and only if there exists a
ϕ-invariant Q such that P ≤ Q.	□
The proposition is trivial but potentially useful. It says that an invariant can be used as a “witness” for a coinductive predicate. This is how bisimilarity is commonly established; and it can be used e.g. in [1, §6] as an alternative to the metric coinduction principle used there. 1
Remark 2.6 The coalgebraic modal logic literature exploits the fact that there can be many predicate liftings (in the form of natural transformations) of the same functor F . Different predicate liftings correspond to different modalities (such as
□ vs. 3 for the same functor P). This view of predicate liftings is also the current paper’s (see Example 2.4).
In contrast, in fibrational studies like [5, 20, 28, 29], use of predicate liftings has focused on the validity of the (co)induction proof principle. For such purposes it is necessary to choose a predicate lifting ϕ that is “comprehensive enough,” covering all the possible F -behaviors. In fact, it is common in these studies that “the” predicate lifting, denoted by Pred(F ), is assigned to a functor F . An exception is [33].

Final Sequences in a Fibration
Here we present our main technical result (Thm. 3.7). It generalizes known be- havioral ω-bounds (like [26, Thm. 2.1]; see §1.1); and claims that the chain (2) for a coinductive predicate stabilizes after ω steps, assuming that the behavior type
P

functor F and the underlying logic size restriction on ϕ).
↓p are “finitary” in a suitable sense (but no


Size Restrictions on a Fibration
We axiomatize finitariness conditions in the language of locally presentable cate- gories (see Appendix A.2 in [24] for a minimal introduction). Singling out these conditions lies at the heart of our technical contribution.
Definition 3.1 (LFP category) A category C is locally finitely presentable (LFP) if it is cocomplete and it has a (small) set F of finitely presentable (FP) objects such that every object is a directed colimit of objects in F.

1 To be precise: only if we take PE in [1] as an atomic proposition (and that is essentially what is done in the proofs in [1, §6]). Our future work on nested µ’s and ν’s will more adequately address the situation.

Definition 3.2 (Finitely determined fibration) A (poset) fibration
finitely determined if it satisfies the following.
C is LFP, with a set F of FP objects (as in Def. 3.1).
P
P
↓p is

↓p has fiberwise limits and colimits.
For arbitrary X ∈ C, let (XI )I∈I be the canonical diagram for X with respect
to F (i.e. I = (F ↓ X)), with a colimiting cocone (X  κ  X)	. Then for any

P, Q ∈ PX,
I →	I∈I

P ≤ Q	⇐⇒	κ∗P ≤ κ∗Q in PX for each I ∈ I.
I	I	I

The intuition of Cond. iii) is that a predicate P ∈ PX (over arbitrary X ∈ C) is determined by its restrictions (κ∗P )I∈I to FP objects XI . One convenient sufficient condition for Cond. iii) is that the total category P is itself LFP, with its FP objects above the FP objects in C (Cor. 5.3). We note that Cond. i) guarantees, since LFP implies completeness, an (ωop-)limit Fω1 of the final F -sequence (3). However this does not mean (nor we need for later) that Fω1 carries a final F -coalgebra (it fails for F = Pω; see [46]).
Definition 3.3 (Well-founded fibration) A well-founded fibration is a finitely determined fibration that further satisfies:
If X ∈ F (hence FP), the fiber PX is such that: the category Pop consists solely
of FP objects.
Since PX is complete, this is equivalent to: there is no (ωop-)chain P0 > P1 > · · · in PX that is strictly descending.
We note that the following stronger variant of the condition
(iv’) For any X ∈ C, there is no strictly descending ωop-chain in PX
Pred

rarely holds (it fails in
↓
Sets
). The original Cond. iv) holds in many examples (as

we will see later in §5) thanks to the restriction that X is FP.
The following trivial fact is written down for the record.
P
Lemma 3.4 A finitely determined fibration	↓p is well-founded if PX is a finite
category for each X ∈ F.	□

Final Sequences in a Fibration
The following result from [31, Prop. 9.2.1] is crucial in our development.
P
Lemma 3.5  Let	↓p be a fibration, with C being complete. Then p has fiberwise
limits if and only if P is complete and p : P → C preserves limits. If this is the case,

a limit of a small diagram (PI )I∈I in P can be given by
VI∈I(π∗PI )	over LimI∈I XI.

Here X := pP ; (Lim	X  πI  X )
is a limiting cone in C; and V
denotes

I	I	I∈I	I →
I I∈I
I∈I

the limit in the fiber PLimI XI .	□
P
Fig. 1 presents two sequences. Here we assume that	↓p is finitely determined
(Def. 3.2) and that ϕ is a predicate lifting of F . In the bottom diagram (in C), the
P	ϕω⊤1
⊤1	ϕ⊤1	· · ·	ϕi⊤1	· · ·	b′
ϕω+1⊤1

1	 b
1


Figure 1. Final sequences in a fibration
object 1 ∈ C is a final one (it exists since LFP implies completeness); F 1 →!

1 is

the unique map; Fω+11 := F (Fω1); and b is a unique mediating arrow to the limit
Fω1. In the top diagram (in P), the object ⊤1 is the final object in the fiber P1; by Lem. 3.5 this is precisely a final object in the total category P. Hence this diagram is nothing but a final sequence for the functor ϕ in P. A limit ϕω⊤1 of this final sequence exists, again by Lem. 3.5, and moreover it can be chosen above Fω1. We define ϕω+1⊤1 := ϕ(ϕω⊤1).

Lemma 3.6 (Key lemma) Let
P
↓p be a well-founded fibration; F : C → C be

finitary; and ϕ be a predicate lifting of F. Then the final ϕ-sequence stabilizes after
ω steps. More precisely: in Fig. 1, we have ϕω+1⊤1 = b∗(ϕω⊤1).
The object ϕω⊤1 is a “prototype” of ϕ-coinductive predicates in various coalgebras. This is one content of the following main theorem.

It is standard that a coalgebra X →c
FX in C induces a cone over the final

F -sequence, and hence a mediating arrow X → Fω1 (see below). Concretely, ci :
X → Fi1 is defined inductively by: X c0 1 is !; and c	is the composite X →c
i+1

FX Fci
i+1
The induced arrow to the limit F
ω 1 is denoted by cω.


1	cω	(7)


Theorem 3.7 (Main result) Let
P
↓p be a well-founded fibration; F : C → C be

a finitary functor; ϕ be a predicate lifting of F along p; and X →c
FX be a coalgebra

in C.
The ϕ-coinductive predicate Jνϕ)c in c (Def. 2.3) exists. It is obtained by the following reindexing of ϕω⊤1, where cω is the mediating map in (7).
Jνϕ)c = c∗ (ϕω⊤1)	(8)
Moreover, the predicate Jνϕ)c is the limit of the following ωop-chain in the fiber
PX
⊤X ≥ (c∗ ◦ ϕ)(⊤X ) ≥ (c∗ ◦ ϕ)2(⊤X ) ≥ · · · ,	(9)
that stabilizes after ω steps. That is, Jνϕ)c = Vi∈ω (c∗ ◦ ϕ)i(⊤X ).	□
Example 3.8 (Rν) We continue Example 2.4 and derive from Thm. 3.7 the be- havioral bound result described in §1.1: the chain (2) stabilizes after ω steps, for each α ∈ Rνu and each finitely branching Kripke model c.

Indeed, the latter is the same thing as a coalgebra X →c
FfbK
X, where FfbK =

P(AP) × Pω( ). Compared to FK in Example 2.4 the powerset functor is restricted from P to Pω; this makes FfbK a finitary functor. Still the same definition of ϕα defines a predicate lifting of FfbK. Thm. 3.7.ii can then be applied to the fibration Pred

↓
Sets
(easily seen to be well-founded, Example 5.11), the finitary functor FfbK

and the predicate lifting ϕα for each α. It is not hard to see that the function
[α]c : PX → PX in §1.1 coincides with c∗ ◦ ϕα : PredX → PredX (note that PredX ∼= 2X ∼= PX); thus the chain (2) coincides with (9) that stabilizes after ω steps by Thm. 3.7.
Remark 3.9 The ω-bound of the length of the chain (9) is sharp.

A (counter)example is given in the setting of Example 3.8, by the
predicate lifting ϕ3u and the coalgebra (i.e. Kripke structure) c2 on the right. There bi,i has no successors. Indeed, while Jνϕ3u)c  is
a0
b0,0		a1 b1,0		a2
.

∗	i	2	b1,1 b2,0 .

{ai | i ∈ ω}, its i-th approximant ((c2)i ◦ ϕ3u)(⊤X ) in (9) contains
bi,0 too.
b2,1 .

b2,2

Remark 3.10 It is notable that Thm. 3.7 imposes no size restrictions on ϕ : P → P. Being a predicate lifting is enough.
Final F -sequences are commonly used for the construction of a final F -coalgebra. It is not always the case, however, that the limit Fω1 is itself the carrier of a final coalgebra (even for finitary F ; see [46, §5]). One obtains a final coalgebra either by:
quotienting Fω1 by the behavioral equivalence (see e.g. [42]); or 2) continuing the final sequence till ω + ω steps. The latter construction is worked out in [46] (in Sets) and in [2] (in LFP C with additional assumptions). Its relevance to the current work is yet to be investigated.
Coalgebra morphisms are compatible with coinductive predicates. This fact, like Prop. 2.5, is potentially useful in establishing coinductive predicates.

Proposition 3.11 Let f : X → Y be a coalgebra morphism from X →c
FY to

Y →d
FY . In the setting of Lem. 3.6 and Thm. 3.7:

If Q ∈ PY is a ϕ-invariant in d, so is f ∗Q ∈ PX in c.
We have Jνϕ)c = f ∗ Jνϕ)d .	□

Remark 3.12 The current paper focuses on finitely presentable objects, finitary functors, etc.—i.e. the ω-presentable setting (see [4, §1.B]). This is for the simplicity of presentation: the results, as usual (as e.g. in [36]), can be easily generalized to the λ-presentable setting for an arbitrary regular cardinal λ. In such an extended setting we obtain a behavioral λ-bound.

A Fibration of Invariants
We organize the above observations in a more abstract fibered setting. The technical results are mostly standard; see e.g. [28, 29] and [34, Chap.6].
We write Coalg(F ) for the category of F -coalgebras.


Proposition 4.1 Let ϕ be a predicate lifting of F along
P
↓p . Then the fibration

P
↓p is lifted to a fibration
Coalg(ϕ)


↓p
Coalg(F )
, with two forgetful functors forming a map of

fibrations from the latter to the former.	□

The next observation explains the current section’s title.


Proposition 4.2 Let
Coalg(ϕ)


↓p
Coalg(F )
be the lifted fibration in Prop. 4.1. For each coal-

gebra X →c
FX, the fiber over c coincides with the poset of ϕ-invariants in c. That

Coalg(ϕ) c
∼=	Coalg(c∗
ϕ)

is:
X→FX	.	□
PX




Therefore Thm. 3.7.i) and Prop. 3.11.ii) state the fibration
Coalg(ϕ)


↓p
Coalg(F )
has fiberwise

final objects. (At least part of) this statement itself is shown quite easily using the
Knaster-Tarski theorem (each fiber is a complete lattice). Our contribution is its concrete construction as an ωop-limit (Thm. 3.7.ii).
The following is an immediate consequence of Lem. 3.5.


Corollary 4.3 Let ϕ be a predicate lifting of F along
F-coalgebra exists. The following are equivalent.
P
↓p ; and assume that a final

The coinductive predicate Jνϕ)c exists for each coalgebra c : X → FX. More- over they are preserved by reindexing (along coalgebra morphisms).
There exists a final ϕ-coalgebra that is above a final F-coalgebra.	□

Examples of Fibrations
Examples at Large
Here are several results that ensure a fibration to be finitely determined or well- founded, and hence enable us to apply Thm. 3.7. Some of them are well-known; others—especially those which relate fibrations and locally (finitely) presentable categories, including Lem. 5.4 and Cor. 5.7—seem to be new.
Lemma 5.1 [31, Prop. 5.4.7] An (elementary) topos is a locally Cartesian closed category (LCCC).	□
The following results provide sufficient conditions for a fibration to be finitely determined (Def. 3.2). Recall that a full subcategory F of P is said to be dense if each object P ∈ P is a colimit of a diagram in F.
P
Lemma 5.2  Let	↓p be a fibration with fiberwise limits and colimits. Assume
further that C is LFP with a set FC of FP objects (as in Def. 3.1). If the total category P has a dense subcategory FP such that every R ∈ FP is above FC (i.e. pR ∈ FC), then p is finitely determined.	□
P
Corollary 5.3  Let	↓p be a fibration with fiberwise limits and colimits, where C is
LFP with a set FC of FP objects (in Def. 3.1). If the total category P is also LFP, with a set FP of FP objects (as in Def. 3.1) chosen so that every R ∈ FP is above FC, then p is finitely determined.	□
The following is one of the results that are less trivial.
Lemma 5.4 Let C be an LFP category with F being a set of FP objects (as in Def. 3.1). Assume that C is at the same time an LCCC. Then the total category Sub(C) of the subobject fibration is LFP: the set FSub(C) := { (P ֌ X) | P, X ∈ F}
consists of FP objects in Sub(C); and every object (Q ֌ Y ) ∈ Sub(C) is a colimit of a directed diagram in FSub(C).	□
It follows from Lem. 5.1, 5.4, and Cor. 5.3 that the internal logic of a topos that is LFP is finitely determined.
Corollary 5.5 Let C be LFP and at the same time a topos (or more generally an
Sub(C)

LCCC). Then the subobject fibration
↓	is finitely determined.	□




We turn to the family fibration in [24]).
Fam(Ω)
↓
Sets

over a poset Ω (see Appendix A.3

Lemma 5.6 Let Ω be an algebraic lattice, i.e. a complete lattice in which each element is a join of compact elements. (Equivalently, Ω is LFP when considered as

a category.) Then the set
FFam(Ω) := , f : X → Ω | X is finite; for each x ∈ X, f (x) is compact in Ω ,	(10)
consists of finitely generated objects and is dense in Fam(Ω). Therefore by Lem. 5.2,
Fam(Ω)

↓
Sets
is finitely determined.	□

It is known that the existence of a dense set of FG objects (like FFam(Ω) in Lem. 5.6) ensures the category to be locally λ-presentable. This is however for some regular cardinal λ that is possibly bigger than ω. See [4, Thm. 1.70].
Corollary 5.7 Let Ω be an algebraic lattice. Then the total category Fam(Ω) of
Fam(Ω)

↓
Sets
is locally presentable.	□

We turn to the notion of well-founded fibration (Def. 3.3; see also Lem. 3.4).
Example 5.8 (Presheaf categories) Let A be small.  The presheaf category SetsA is LFP: the set F of finite colimits of representable presheaves yA, where yA = A(A,  ), satisfies the conditions of Def. 3.1.
The coming results are less trivial, too.
Lemma 5.9 Let A be small. For any X ∈ A, Sub(yX) is finite if and only if the
yf
subset {Im(yA → yX) | A ∈  , f : X → A} ⊆ Sub(yX) is finite.
As a special case, if every arrow f with domain X ∈ A factors f = m ◦ e as a split mono m followed by an epi e, then Sub(yX) is finite if and only if Quot(X) is finite. Here Quot(X) denotes the set of quotient objects of X.	□
A
Sub(Sets )

Corollary 5.10 If one of the conditions in Lem. 5.9 holds, the fibration
↓
A
Sets

is well-founded.	□

Concrete Examples


Example 5.11 (Pred) The fibration
Pred
↓
Sets

for the conventional setting of classi-
~

cal logic is easily seen to be well-founded. In particular, PredX = PX is finite if
X is FP (i.e. finite). Therefore to any finitary F and any predicate lifting ϕ, the results in §3 apply.
The (interpretations of the) formulas in Rν (see Example 3.8) are examples of
Pred

coinductive predicates in
↓
Sets
. Besides them, the study of coalgebraic modal logic

has identified many predicate liftings for many functors F (probabilistic systems,
neighborhood frames, strategy frames, weighted systems, etc.; see e.g. [12] and the references therein). These “modalities” all define coinductive predicates, to which the results in §3 may apply.

Example 5.12 (Rel) The fibration
Rel
↓
Sets

can be introduced from
Pred
↓
Sets

via

change-of-base; concretely, an object of Rel is a pair (X, R) of a set X and a
relation R ⊆ X × X; an arrow f : (X, R) → (Y, S) is a function f : X → Y such that xRx′ implies f (x)Sf (x′). See [31, p. 14].
This fibration is also easily seen to be well-founded; therefore to any finitary F
Rel

the results in §3 apply. A predicate lifting ϕ along
↓
Sets
is more commonly called

a relation lifting [29]; by choosing a suitable ϕ (a “sufficiently comprehensive” one)
like in [29], a ϕ-invariant is precisely a bisimulation relation, and the ϕ-coinductive predicate is bisimilarity. We expect that the ω-behavioral bound in Thm. 3.7 can be used to bound execution of bisimilarity checking algorithms by partition refinement (for many different functors F ).
In the following example, one can think of Ω as a Heyting algebra, and then the underlying logic becomes constructive.
Example 5.13 (Fam(Ω)) Let Ω be an algebraic lattice that has no strictly de-
Fam(Ω)

scending (ωop-)chains.	Then the family fibration
↓
Sets
is well-founded (see

Lem. 5.6). Therefore to any finitary F the results in §3 apply. It is not hard
to interpret the language Rν in this setting, by defining predicate liftings similar
Fam(Ω)

to (6). This gives examples of coinductive predicates in
↓	.
Sets

Presheaf Examples
Let F be the category of natural numbers as finite sets (i.e. n = {0, 1, . . . , n−1}) and all functions between them; F+ be its full subcategory of nonzero natural numbers; and I be the category of natural numbers and injective functions. Coalgebras in the presheaf categories SetsF, SetsF+ and SetsI are commonly used for modeling processes in various name-passing calculi. For the π-calculus SetsI has been found appropriate (see e.g. [17, 18]); while for the fusion calculus we do need non-injective functions in F or F+ (see [40, 44]).
Inspired by [36], we are interested in coinductive predicates for such processes. They are naturally modeled in the subobject fibration of a presheaf category. Here we find a distinction: the subobject fibrations of SetsF and SetsF+ are well- founded; but that of SetsI is not. In view of Cor. 5.5 and Example 5.8, the only condition to check is Cond. iv) in Def. 3.3.
Example 5.14 (Sub(SetsF), Sub(SetsF+ )) The    subobject    fibration
F+

Sub(Sets
↓
F
)
is well-founded: this is shown by Cor. 5.10.	An important fact

Sets +
here is that in Sets a mono with a nonempty domain splits.
F
Sub(Sets )

The subobject fibration
↓ F	is well-founded, too.	To show that
Sets

Sub(y0) is finite, we appeal to the first half of Lem. 5.9: we observe that the

set {Im yf | n ∈ F, f : 0 → n} is equal to the two-element set  Im(y(0 i→d0
0)), Im(y(0 →! 1)) } since 0 →! n and 0 →! m factor through each other, for each
n, m ≥ 1.
We turn to functors F and ϕ. In modeling processes of name-passing calculi as coalgebras in these categories, one typically uses endofunctors F that are con- structed from the following building blocks. Let N ∈ {F, F+, I}.
Constant functors, binary sum +, binary product ×, and exponentials ( )X . These are much like for polynomial functors on Sets. An important example of the first is the name presheaf N = Hom(1,  ) ∈ SetsN.
The abstraction functor δ : SetsN → SetsN given by δX = X( + 1).
The free semilattice functor Pf for finite branching. This captures Kuratowski finiteness and suitable in SetsI. See e.g. [17, 44].

In SetsF and SetsF+ , another choice of a “finite powerset functor” K˜
appropriate. See [40]; also [44, p. 4].
All such functors are known to be finitary (see e.g. [40]).
is more

Coinductive predicates in this setting can be introduced much like Rν in Ex- ample 2.4 (note that SetsN is a topos), for properties like deadlock freedom. Such a language can be extended further through the modalities proposed in [36]: they correspond to constructions specific to presheaves and include the modality ⟨a(b)⟩ for a binding ‘input’ operation. More examples will be worked out in our future paper.
Example 5.15 (Sub(Setsω), Sub(SetsI)) Consider the presheaf category Setsω
ω
Sub(Sets )

over the ordinal ω as a poset. The fibration
↓ ω	is finitely determined
Sets

but not well-founded. It fails to satisfy Cond. iv) in Def. 3.3: let Pn : ω → Sets be
the family of presheaves defined by
Pn(m) :=	 0 if m < n;	1 if n ≤ m 
for each n ∈ ω. Then P0 > P1 > · · · is a strictly descending chain in Sub(y0). The same counterexample works for Sub(SetsI).
In contrast, the subobject fibration for Setsωop is well-founded by Lem. 5.9.
Remark 5.16 Well-foundedness fails in Sub(Setsω), Sub(SetsI), and in Fam(Ω) for Ω that does have a strictly descending ωop-chain. This means the logics modeled by the fibrations are inherently “big.” Still, extensions of our results in §3 are possible from finitary (i.e. ω-presentable) to the λ-presentable setting for bigger λ, so that they apply to the (current) nonexamples.

Acknowledgment
Thanks are due to Kazuyuki Asada, Keisuke Nakano, Keiko Nakata, Ana Sokolova, and the participants of Dagstuhl Seminar 12411 “Coalgebraic Logics” (includ-

ing Samson Abramsky, Vincenzo Ciancia, Corina Cˆırstea, Ernst-Erich Doberkat, Clemens Kupke, Alexander Kurz, and Yde Venema) for useful discussions. We are grateful to the anonymous referees for their careful reading and useful sugges- tions, too. I.H., K.C. and T.K. are supported by Grants-in-Aid for Young Scientists
(A) No. 24680001 and Grants-in-Aid for Challenging Exploratory Research No. 23654033, JSPS, and by Aihara Innovative Mathematical Modeling Project, FIRST Program, JSPS/CSTP.

References
S. Abramsky and V. Winschel. Coalgebraic analysis of subgame-perfect equilibria in infinite games without discounting, 2012. ArXiv:1210.4537.
J. Ad´amek. On final coalgebras of continuous functors. Theor. Comp. Sci., 294:3–29, 2003.
J. Ad´amek, F. Bonchi, M. Hu¨lsbusch, B. K¨onig, S. Milius and A. Silva. A coalgebraic perspective on minimization and determinization. In Birkedal [7], pp. 58–73.
J. Ad´amek and J. Rosicky´. Locally Presentable and Accessible Categories, vol. 189 of London Math. Soc. Lect. Note Series. Cambridge Univ. Press, 1994.
R. Atkey, N. Ghani, B. Jacobs and P. Johann. Fibrational induction meets effects. In Birkedal [7], pp. 42–57.
Y. Bertot and E. Komendantskaya. Inductive and coinductive components of corecursive functions in Coq. Elect. Notes in Theor. Comp. Sci., 203(5):25–47, 2008.
L. Birkedal, editor. Foundations of Software Science and Computational Structures - 15th International Conference, FOSSACS 2012, Held as Part of the European Joint Conferences on Theory and Practice of Software, ETAPS 2012, Tallinn, Estonia, March 24 - April 1, 2012. Proceedings, vol. 7213 of Lect. Notes Comp. Sci. Springer, 2012.
F. Bonchi and D. Pous. Checking nfa equivalence with bisimulations up to congruence. In Giacobazzi and Cousot [22], pp. 457–468.
J. Bradfield and C. Stirling. Modal mu-calculi. In P. Blackburn, J. van Benthem and F. Wolter, editors,
Handbook of Modal Logic, vol. 3 of Studies in Logic and Practical Reasoning, chap. 12. Elsevier, 2006.
C. Cˆırstea. Maximal traces and path-based coalgebraic temporal logics. Theor. Comput. Sci., 412(38):5025–5042, 2011.
C. Cˆırstea, C. Kupke and D. Pattinson. Exptime tableaux for the coalgebraic µ-calculus. In E. Gr¨adel and R. Kahle, editors, CSL, vol. 5771 of Lecture Notes in Computer Science, pp. 179–193. Springer, 2009.
C. Cˆırstea, A. Kurz, D. Pattinson, L. Schr¨oder and Y. Venema. Modal logics are coalgebraic. Comput. J., 54(1):31–41, 2011.
C. Cˆırstea and M. Sadrzadeh. Modular games for coalgebraic fixed point logics. Electr. Notes Theor. Comput. Sci., 203(5):71–92, 2008.
P. Cousot and R. Cousot. Constructive versions of Tarski’s fixed point theorems. Pacific Journal of Mathematics, 82(1):43–57, 1979.
G.L. Ferrari, U. Montanari and M. Pistore. Minimizing transition systems for name passing calculi: A co-algebraic formulation. In M. Nielsen and U. Engberg, editors, FoSSaCS, vol. 2303 of Lect. Notes Comp. Sci., pp. 129–158. Springer, 2002.
G.L. Ferrari, U. Montanari and E. Tuosto. Coalgebraic minimization of hd-automata for the pi-calculus using polymorphic types. Theor. Comp. Sci., 331(2–3):325–365, 2005.
M. Fiore and D. Turi. Semantics of name and value passing. In Logic in Computer Science, pp. 93–104. IEEE, Computer Science Press, 2001.
M.P. Fiore and S. Staton. Comparing operational models of name-passing process calculi. Inf. & Comp., 204(4):524–560, 2006.

M.P. Fiore and S. Staton. A congruence rule format for name-passing process calculi. Inf. & Comp., 207(2):209–236, 2009.
C. Fumex, N. Ghani and P. Johann. Indexed induction and coinduction, fibrationally. In A. Corradini,
B. Klin and C. Cˆırstea, editors, CALCO, vol. 6859 of Lect. Notes Comp. Sci., pp. 176–191. Springer, 2011.
P. Gastin and F. Laroussinie, editors. CONCUR 2010, vol. 6269 of Lect. Notes Comp. Sci. Springer, 2010.
R. Giacobazzi and R. Cousot, editors. The 40th Annual ACM SIGPLAN-SIGACT Symposium on Principles of Programming Languages, POPL ’13, Rome, Italy - January 23 - 25, 2013. ACM, 2013.
I. Hasuo. Generic forward and backward simulations II: Probabilistic simulation. In Gastin and Laroussinie [21], pp. 447–461.
I. Hasuo, K. Cho, T. Kataoka and B. Jacobs. Coinductive predicates and final sequences in a fibration. Extended version with appendices, 2013.
www-mmm.is.s.u-tokyo.ac.jp/~ichiro/papers.html.
I. Hasuo, B. Jacobs and A. Sokolova. Generic trace semantics via coinduction. Logical Methods in Comp. Sci., 3(4:11), 2007.
M. Hennessy and R. Milner. Algebraic laws for nondeterminism and concurrency. Journ. ACM, 32(1):137–161, 1985.
U. Hensel and B. Jacobs. Proof principles for datatypes with iterated recursion. In E. Moggi and
G. Rosolini, editors, Category Theory and Computer Science, no. 1290 in Lect. Notes Comp. Sci., pp. 220–241. Springer, Berlin, 1997.
C. Hermida. Fibrations, Logical Predicates and Indeterminates. PhD thesis, Univ. Edinburgh, 1993. Techn. rep. LFCS-93-277.
C. Hermida and B. Jacobs. Structural induction and coinduction in a fibrational setting. Inf. & Comp., 145:107–152, 1998.
C.K. Hur, G. Neis, D. Dreyer and V. Vafeiadis. The power of parameterization in coinductive proof. In Giacobazzi and Cousot [22], pp. 193–206.
B. Jacobs. Categorical Logic and Type Theory. North Holland, Amsterdam, 1999.
B. Jacobs. Trace semantics for coalgebras. In J. Ad´amek and S. Milius, editors, Coalgebraic Methods in Computer Science, vol. 106 of Elect. Notes in Theor. Comp. Sci. Elsevier, Amsterdam, 2004.
B. Jacobs. Predicate logic for functors and monads, March 2010. Preprint.
B. Jacobs. Introduction to coalgebra. Towards mathematics of states and observations, 2012. Draft of a book (ver. 2.0), available online.
P. Johnstone. Sketches of an Elephant: A Topos Theory Compendium. Oxford Logic Guides. Clarendon Press, 2002.
B. Klin. Coalgebraic modal logic beyond Sets. In MFPS XXIII, vol. 173, pp. 177–201. Elsevier, Amsterdam, 2007.
D. Kozen and N. Ruozzi. Applications of metric coinduction. Logical Methods in Computer Science, 5(3), 2009.
C. Kupke. Terminal sequence induction via games. In P. Bosch, D. Gabelaia and J. Lang, editors,
TbiLLC, vol. 5422 of Lecture Notes in Computer Science, pp. 257–271. Springer, 2007.
M. Makkai and R. Par´e. Accessible categories: the foundations of categorical model theory. Contemp. Math., 104, 1989.
M. Miculan. A categorical model of the fusion calculus. Elect. Notes in Theor. Comp. Sci., 218:275–293, 2008.
K. Nakata, T. Uustalu and M. Bezem. A proof pearl with the fan theorem and bar induction—walking through infinite trees with mixed induction and coinduction. In H. Yang, editor, APLAS, vol. 7078 of Lecture Notes in Computer Science, pp. 353–368. Springer, 2011.
D. Pattinson. An introduction to the theory of coalgebras. Course notes for NASSLLI, 2003. Available online.
J.J.M.M. Rutten. Universal coalgebra: a theory of systems. Theor. Comp. Sci., 249:3–80, 2000.

S. Staton. Relating coalgebraic notions of bisimulation. Logical Methods in Comp. Sci., 7(1), 2011.
Y. Venema. Automata and fixed point logic: A coalgebraic perspective. Inf. Comput., 204(4):637–678, 2006.
J. Worrell. On the final sequence of a finitary set functor. Theor. Comp. Sci., 338(1–3):184–199, 2005.
