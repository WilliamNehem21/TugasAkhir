Engineering Science and Technology, an International Journal 48 (2023) 101557








Design and FPGA-in-loop based validation of predictive hierarchical control	 for islanded AC microgrid
Hussain Sarwar Khan âˆ—, Kimmo Kauhaniemi
School of Technology and Innovations, University of Vaasa, Finland


A R T I C L E  I N F O	A B S T R A C T

	

Keywords:
Decentralized control approach Distributed generation Dynamic loads
FPGA-in-loop
Model predictive control Islanded AC microgrid
This paper proposes a decentralized control approach for the flexible operation of an autonomous AC microgrid (MG). AC MG typically consists of two or more voltage source inverters (VSI), capable of simultaneously regulating the voltage at the point of common coupling (PCC) and meeting the local power demand. The classical linear control techniques attain these functions. However, they have many limitations, such as slow transient response, high sensitivity to the parameter variations, and inability to handle the system nonlinearities. This paper aims to address these issues by presenting an improved finite control set model predictive control (FCS-MPC) approach for inverter-based distributed generation (DG). The proposed scheme tracks the voltage trajectory using cost function (CF) over two-step prediction horizons. The proposed control method is employed for the AC MG having two parallel DGs. Droop control is responsible for the power- sharing between the parallel DGs regardless of impedance mismatch at the distribution level of AC MG. The decentralized secondary control is developed to eliminate the deviation in the voltage and frequency caused due to overlooking the primary control. The proposed control scheme has been validated through extensive simulations and real-time controller hardware in the loop tests using an FPGA ZYBO Z7 board. Moreover, the proposed methodology depicts the enhanced transient response, less computational burden than the classic MPC, and shows robustness to parametric uncertainties in terms of THD than hierarchical linear control. The simulations and experimental results visually represent research outcomes, exhibiting the THD of 0.98 % for different dynamic loads, which is within the limit of IEEE and IEC standards. Furthermore, the proposed controllerâ€™s mathematical stability is further supported by analysis based on the Lyapunov stability theory.





Introduction

Due to climate change and global warming, various countries in the world adopted the Paris Agreement to reduce the emission of greenhouse gases and also limit global warming below the 2 â—¦C [1]. Power generation through fossil fuels such as oil, coal, and natural gas is one of the primary causes of greenhouse gases emission. The world is looking for alternative ways of energy generation, which must be clean, reliable, and carbon-free. Therefore, power generation through renew- able energy sources has got the worldâ€™s attention. However, renewable energy resources (RES) are intermittent and produce energy in both AC and DC. Consequently, the concept of distributed generation (DG) is introduced in literature by the research community to integrate RES in conventional power systems and meet the load demand locally [2]. The DGs are connected to the grid through a power electronic inter- face (PEI). PEIs are responsible for regulating the voltage, current, and power. The high penetration and integration of RES in the power sys- tem originate high risks to the power systemâ€™s stability and reliability.
The microgrid (MG) concept is presented to mitigate the problems as mentioned [3,4]. MG is a small distribution power system with a cluster of loads, generation units, and energy storage systems, and it effectively controls each unit [5]. The MG can operate in two modes, i.e., grid- connected and islanded modes. In grid-connected mode, MG has the ability to import and export the power with the utility grid as per grid codes such as EN 50549-1 or EN 50549-2 [6]. In islanded mode, MG is disconnected from the main grid due to regular maintenance, low- quality power generation, or occurred faults. The autonomous MG is also developed for areas far from the power network, such as rural areas. Islanded MG is used in various applications such as avionic [7], marine [8] and automotive [9]. Sometimes, it is economical to dis- tribute the high power among the several DGs with lower current ratings. This mechanism also helps to maximize the systemâ€™s efficiency. The islanded MG generates power to meet the demand locally and also regulates the voltage at the point of common coupling. However, an energy management system is required to run and optimize the operation of an islanded MG.

âˆ— Corresponding author.
E-mail addresses: hussain.khan@uwasa.fi (H.S. Khan), kimmo.kauhaniemi@uwasa.fi (K. Kauhaniemi).

https://doi.org/10.1016/j.jestch.2023.101557
Received 3 April 2023; Received in revised form 16 June 2023; Accepted 19 October 2023
Available online 3 November 2023
2215-0986/Â© 2023 The Authors. Published by Elsevier B.V. on behalf of Karabuk University This is an open access article under the CC BY-NC-ND license (http://creativecommons.org/licenses/by-nc-nd/4.0/).




/ig. 1. Control layers typically utilized for hierarchical control of MGs.













The MG control approaches are categorized as distributed, decen- tralized, and centralized in literature [10]. Distributed and centralized control techniques require a communication network. The implementa- tion of centralized techniques reduces reliability and increases system complexity. However, the decentralized approach uses local measure- ments and does not require any communication infrastructure [11].
The hierarchical control of MG is vastly proposed in the literature and it is considered to be the best possible solution to regulate the MG operation. Fig. 1 explains the hierarchical control graphically for easy understanding. MG hierarchical control consists of three different levels, i.e., primary, secondary, and tertiary levels [12,13].
Primary control: It is further divided into inner control and outer droop control loops. The inner control loop regulates the output current and voltage of DERs. The outer droop control is responsible for accurate power-sharing among the DGs and also mitigates the circulating current.
Secondary control: This control level is responsible for mitigat- ing the MGâ€™s voltage and frequency deviation. The response of this level is slower than the primary controller.
Tertiary Control: This control level is at the highest level of the MG hierarchy, and its response is slower than the secondary con- trol loop. It is responsible for scheduling and optimizing power generation references for DGs and the techno-economic operation of MG and remains in contact with DSO and TSO.
As aforementioned that tertiary control focuses on economic dis- patch and operation scheduling. It is also characterized as coordination between multiple MG, which are interconnected. In [14] tertiary con- trol is implemented to adjust the DG compensating efforts with respect to unbalanced voltage limits of DGs and load buses. Optimal power flow-based tertiary control using MPC is proposed in [15]. In [16], authors proposed a centralized IOT-based tertiary control solution for multi-microgrids.
Many studies are proposed in the literature incorporating primary and secondary control levels and implementing the amalgam of linear and nonlinear controllers. Hierarchical control for grid supporting in- verter in AC MG is investigated in [17]. PR based inner and PI based
secondary loops are proposed in [18] for the islanded AC microgrid. However, multiple resonant controllers are connected in parallel to cope with the fifth and seventh harmonics, which makes the system complex and takes the system towards instability. In [19], the authors proposed the hierarchical control for MG. The PI based linear controller is implemented in the microgridâ€™s (primary and secondary) control lev- els. However, linear-based controllers cannot track the sinusoidal wave with zero steady state error and poor disturbance rejection capability and cannot handle the power systemsâ€™ nonlinearity. Flexible secondary control for three VSIs operated in parallel is proposed in [20]. The authors also proposed a new algorithm to optimally tune the various gain of PR controllers. MPC based primary and secondary control is proposed in [21,22]. The predictive voltage hierarchical control for islanded MC with limited communications is studied in [23]. However, implementing predictive control at the secondary level is unsuitable due to the computational burden. Implementing MPC at the secondary level increases the system complexity and decreases the system re- sponse due to computational burden. Table 1 summarizes some of the recent studies on the hierarchical control of MG based on different control typologies.
The main task of primary control is to regulate the voltage and
also achieve accurate power sharing among the DGs. Different types of linear and nonlinear control techniques have been proposed and investigated in the literature [29]. Linear controllers are limited in their ability to handle the nonlinearities and parameter variations of power systems, as well as other practical issues such as the need for tuning parameters and potential stability problems [20]. Nonlinear controllers perform better than linear controllers but have limitations, such as com- plex mathematical modeling [30], variable switching frequency [31], and high computational burden [32]. In [33], the author proposed sliding mode control for voltage regulation of a standalone DC/AC converter. Nevertheless, the complex mathematical modeling and chat- tering (an undesirable phenomenon) reduce the systemâ€™s performance. MPC based hierarchical control for AC MG is proposed in [34] but the authors did not test the proposed under different dynamic loads and THD (%) is more than the proposed scheme.
The artificial neural network (ANN) aided MPC based voltage regu- lation technique is proposed in [35,36]. The authors use the MPC as the parent system to train the ANN. The performance of ANN is better than MPC in terms of total harmonic distortion (THD) and computational burden. However, the control technique needs to be more mature. The PID controller and its combinations are matured and vastly im- plemented by the power electronics industry. However, the nonlinear or advanced control approaches need complex mathematical modeling, and their implementation requires high-speed digital platforms. Table 2 summarized the pros and cons of different advanced control techniques.


Table 1
Comparison of hierarchical control approaches.



Table 2
Comparison of the different linear and nonlinear control techniques.


This study aims to develop and implement the decentralized hierar- chical control technique for attaining enhanced transient stability and accurate power sharing among the DGs under different dynamics loads in islanded AC MG. Fig. 6 elucidates the implemented hybrid MPC- based hierarchical control for DG. The key contributions in this study are as follows:
The finite control set model predictive voltage control is intro- duced at the primary layer to regulate the voltage of the DG and droop control is also implemented to attain accurate power- sharing among the DGs under complex load conditions. MPC uses DERâ€™s discrete time domain model to anticipate the future voltage states for each possible switching combination in every sampling time. This technique determines the error using the pre-defined cost function and produces optimal control action for the coming instant based on the error minimization. In order to reduce the switching loss, the switching frequency reduction technique is implemented based on [37].
Lyapunov stability studies are carried out to validate the stability of the proposed controller. According to the authorsâ€™ best knowl- edge, this analysis has not been previously carried out for 2-level DC/AC three-phase inverters.
At the secondary control level, the PI controller based frequency and voltage regulation loop are employed to annihilate the voltage and the frequency deviation overlooked by the pri- mary control in AC MG. The proposed technique uses local measurements to regulate the voltage and frequency of MG.
The impact of different dynamics loads, such as commercial, residential, and constant power, on the proposed controller is also studied and evaluated.
Additionally, to validate the system performance in real time, the controller hardware in the loop (CHIL) testing is carried out using
cable is used for two way communication. Finally, we also provide an GitHub1 open repository of the dataset and simulation files and ZYBO Z7 (ZYNQ-7020) board definition files (to integrate the board into the MATLAB FPGA Manager for HIL validation) to the community for further research activities.
The rest of the paper is organized as follows: Section 2 explains the structure of MG. Section 2.1 describes the discrete modeling of DER and MPC and the switching reduction method is written in Section 2.2. The Lyapunov function MPC stability for DC/AC converter is derived in Section 2.3. Section 2.4 discusses the virtual impedance loop while the droop control and its implementation are expressed in Section 2.5. PI-based secondary control and its stability analysis are studied in Sec- tion 3. Dynamics loads and their mathematical modeling is explained in Section 4. Section 5 discusses the simulation studies. In contrast, HIL testing of the proposed control scheme is discussed in Section 5.1 while parametric uncertainty tests are presented in Section 5.2. Finally, the conclusion is presented in Section 6.

Microgrid

Fig. 2 illustrates the common configuration of a microgrid, which contains multiple DGs, loads, the energy storage system (ESS), trans- mission lines, and their effective control. MG is connected to the utility grid through a circuit breaker or static transfer switch. DGs are connected to an AC bus through a feeder. MG has the ability to work in grid connected or islanded mode. In this study, only islanded mode operation of MG is studied. Fig. 1 expressed the hierarchical control layers of MG and their roles. Since tertiary control has no role in islanded operation mode, it is not taken into account in this study. Droop control and virtual impedance loop are also discussed in this section.

the FPGA ZYBO Z7 board. The proposed controller runs on the FPGA		
board while AC MG is simulated in MATLAB/Simulink. The JTAG	1   https://github.com/HS-Khan/-PREDICITVECONTROLUsingFPGAZYNQ7020


states (000, 100, 110, 010, 011, 001, 101,& 111). At every switching action, VSI has a different output value and is expressed as follows:
{ 2	ğœ‹
The mathematical model of the VSI and its filter can be determined
the dynamic behavior of the capacitor and inductor, respectively. ğ¼ğ‘“ ğ‘ğ‘ğ‘ by using Kirchhoff voltage and current law. Eqs. (2) and (3) express is the inductor current through inductor ğ¿ğ‘“ while ğ‘‰0ğ‘ğ‘ğ‘ is the voltage across capacitor ğ¶ğ‘“ , and ğ‘–0ğ‘ğ‘ğ‘ is the output current. ğ‘‰ğ‘– is the output of
the converter. The equations are as follows:

 1 ğ‘‘ğ‘‰0ğ‘ğ‘ğ‘ (ğ‘¡) = ğ‘– (ğ‘¡) âˆ’ ğ‘–
(ğ‘¡).	(2)

ğ¶ğ‘“
ğ‘‘(ğ‘¡)
ğ‘“	0ğ‘ğ‘ğ‘
ğ‘‘ğ‘–ğ‘“ (ğ‘¡)



/ig. 2. Possible configuration of an islanded AC MG.
ğ‘‰ğ‘– = ğ‘–ğ‘“ (ğ‘¡)ğ‘…ğ‘“ + ğ¿ğ‘“ (ğ‘¡) ğ‘‘(ğ‘¡) + ğ‘‰0ğ‘ğ‘ğ‘ (ğ‘¡)	(3)
The state space model of the system is determined by combining Eqs. (2) and (3) and written as:
ğ‘‘(ğ‘¦) = ğ´ğ‘¥ + ğµğ‘¦	(4)
ğ‘‘(ğ‘¡)
In Eq. (5), the ğ‘¥ matrix represents the systemâ€™s state variables, and the ğ‘¦ matrix explains the output variables of the system.
ğ‘¥ = [ğ‘‰0ğ‘ğ‘ğ‘ ] , ğ‘¦ = [ ğ‘‰ğ‘– ]	(5)

ğ‘–ğ‘“
ğ‘–0ğ‘ğ‘ğ‘
1	1

ğ´ = â¡â¢ 0
ğ¶ğ‘“
ğ‘…ğ‘“
â¤â¥ , ğµ = â¡â¢ 0	âˆ’ ğ¶ğ‘“ â¤â¥

(6)

â¢â£âˆ’ ğ¿ğ‘“	âˆ’ ğ¿ğ‘“ â¥â¦
â¢â£ ğ¿ğ‘“	0 â¥â¦

By solving Eq. (4) using Eulerâ€™s technique, the discrete time model of the system can be expressed as:

[ ğ‘‰0ğ‘ğ‘ğ‘ (ğ‘¡ğ‘˜ + 1) ] = ğ´ [ ğ‘‰0ğ‘ğ‘ğ‘ (ğ‘¡) ] + ğµ [  ğ‘‰ğ‘–(ğ‘¡)
]	(7)

ğ´ = ğ‘’ğ´ğ‘‡ğ‘  â‰ˆ 1 + ğ´ğ‘‡	,  ğµ = ğµ (ğ´ âˆ’ ğ¼ )	(8)





/ig. 3. Classical hierarchical control configuration of islanded AC MG.



MPC based primary control
where â€˜â€˜tâ€™â€™ represents the present instant, while Îµğ‘¡ğ‘˜ + 1Îµ is the future
sampling instant. Eq. (7) is used to pre-calculate the capacitor voltage
for all feasible voltage vectors in the coming instant.
The definition of CF is essential in the design of MPC. CF is used to calculate the lowest error while handling multiple objectives. It is the error between the predefined reference and actual values. The general CF equation is presented in Eq. (9).
ğ‘¡ğ‘˜ +ğ‘ âˆ’1

This section discusses the discrete time modeling of VSI, the MPCâ€™s basic working principle, and its cost function definition. Fig. 3 demon- strates the classical hierarchical control implemented in literature for
ğ‘”Gen =
ğ‘–âˆ‘=ğ‘¡ğ‘˜
â€–ğ‘£
ğ‘“ ğ‘’
(ğ‘– 2
â€–2
â„lim
(ğ‘–) + ğœ†ğ‘¢ğ‘ ğ‘¤2(ğ‘–)	(9)

tion [38,39] to formulate the primary control in the ğ›¼ğ›½ reference readersâ€™ better understanding. This study uses the Clarke transforma-
frame. However, the performance of MPC in all frames of reference is evaluated to be the same [40].
The inner control of VSI is based on FCSMPC because it has better
where ğ‘£ğ‘“ ğ‘’ is the anticipated tracking error and primary objective while
secondary objectives are â„ğ‘™ğ‘–ğ‘š(ğ‘–) is the current limitation, ğ‘ ğ‘¤2(ğ‘–) defines
factor ğœ†. The CF defined in this study is only based on the primary the reduction of switching frequency and is regulated by weighting
objective (Voltage) and is expressed as follows:

performance under transient conditions, the ability to handle the non-	ğº
= (ğ‘‰ âˆ— âˆ’ ğ‘‰ (ğ‘¡ğ‘˜ +1))2 + (ğ‘‰ âˆ— âˆ’ ğ‘‰ (ğ‘¡ğ‘˜ +1))2	(10)

tracking capability [22]. The power converterâ€™s discrete-time model and filter are employed to anticipate the future response of DG for
probable eight (23) switching states. Among these, six states are stated
as active states, while two states with zero output are known as zero states as expressed in Eq. (1). The control approach based on MPC theory chooses the switching state, which has the least value of CF among them and is implemented for the next sampling time. Fig. 6 presents the two level three phase voltage source inverter with an LC filter to mitigate the switching harmonics. Each leg of VSC has two switches; they can be in on or off state and represented as 1 and 0, respectively. The output voltage of the VSI depends upon the switching
where ğ‘‰ âˆ— represents the reference voltage for DG in the ğ›¼ğ›½ reference frame, and ğ‘‰ (ğ‘¡ğ‘˜ +1) is determined using Eq. (7). The reference voltage is
provided by the droop control. The DC-link capacitor voltage is taken as constant throughout the modeling. The working process of the MPVC is illustrated in the flowchart as shown in Fig. 4. After the controllerâ€™s initialization, measured inputs are taken by the controller to predict the one step ahead voltage and current using Eq. (7). Eq. (10) is used to determine the value of the CF for each possible switching state of the converter. Among all possible switching states, the switching state, which has minimal error value, is applied to the converter for the next switching instant.































































/ig. 4. Flow chart of the proposed predictive controller.





Two steps ahead switching frequency reduction scheme
The power convertersâ€™ switching frequency has a major effect on systemsâ€™ losses. If the switching frequency is high, more loss and more stress on the converter switches will consequently occur, reducing the converterâ€™s life and decreasing the systemâ€™s efficiency. Classical MPC has higher switching losses due to high switching frequency. In order to cope with this issue, a two step ahead reduction approach
/ig. 5. Demonstration of prediction approach. (a) ğ‘ = 1, (b) ğ‘ = 2, and Different voltage vectors are used every sampling time. (c) ğ‘ = 2, but the same vector is
considered for two consecutive sampling times.





eight possible switching states (six active and two zero vector states) in one sampling instant, as shown in Fig. 5a. The switching state fulfills the CF criteria and is applied to the converter for the next sampling instant. In the two steps ahead classical approach, the total possible sequences are 49. So, The algorithm has to run the loop for 49 times, which increases the computation burden and also enhances the MPC performance, as demonstrated Fig. 5b. In this study, the two step prediction is accomplished by taking only eight vectors into account, as illustrated in Fig. 5c. This technique showed similar performance but had a lower switching frequency and computational burden hence
the form of lower THD. The predicted voltage for instant (ğ‘¡ğ‘˜ + 2) is using fewer hardware resources and improving the voltage quality in
determined by Eq. (7).

MPC stability analysis

In the case of a linear theory based controller, the power electronic system is considered a linear system. In contrast, the nonlinear con- troller uses a power electronic system in a discrete time. So, the analysis methods based on eigenvector, bode plot, etc., are not ideal for finding the MPC stability. The Lyapunov stability criteria are widely used for the stability analysis of nonlinear controllers. There is no proper math- ematical method to prove MPC stability, but many studies incorporate the Lyapunov stability to establish MPC stability. In [41], a statistical model checking approach is proposed to validate the MPC stability in the PC domain. The Lyapunov function based MPC is proposed for a four leg inverter in [42]. In [43], the authors studied the stability of MPC based on Lyapunov theory for AC/DC converters in battery applications. According to the authorâ€™s best knowledge, the Lyapunov- based stability for a two level three phase DC/AC converter has not been derived before. In [44,45], multiple simulations are carried out with different system parameters to validate the response of the power converter under model uncertainties and parametric variations. The re- sults of simulations are also verified by experiments and compared with the classical PI benchmark model. It is observed from the results that the control performance deteriorates for underestimated inductance and has no effect on the overestimated inductance. The described cases demonstrate a good steady state and transient response. The downside of this type of study is that the experiments are very time consuming. Table 3 illustrates the overview of literature work done in the domain of performance and stability of FCS-MPC.
The discrete Lyapunov function is expressed as:

is implemented in this study. For two level VSI, the converter has
ğ¿(ğ‘˜) = 1 [ğ‘‰
err
]ğ‘‡ [ğ‘‰
ğ‘’ğ‘Ÿğ‘Ÿ
]	(11)


Table 3
Summary of the state-of-the-art stability and validation of FCS-MPC.



where ğ‘‰ğ‘’ğ‘Ÿğ‘Ÿ is the voltage tracking error. The change in the Lyapunov
Here, ğ›¿1(ğ‘¡ + 1), ğ›¿2(ğ‘¡ + 1), ğ›¿3(ğ‘¡ + 1) are the quantization errors.

function is as follows:
ğ›¥ğ¿(ğ‘˜) = ğ¿ (ğ‘‰err [ğ‘¡ + 1]) âˆ’ ğ¿ (ğ‘‰err [ğ‘¡])	(12)
ğ›¥ğ‘‰ (ğ‘¡) =
 1
ğ‘˜3
ğ‘‰ğ‘–(ğ‘¡ + 1) + ğ‘˜3
ğ›¿1(ğ‘¡ + 1) âˆ’
ğ‘˜1
ğ‘˜3
ğ‘–0ğ‘ğ‘ğ‘ (ğ‘¡ + 1)

The system is asymptotically stable if the input ğ‘‰ğ‘’ğ‘Ÿğ‘Ÿ(ğ‘¡)ğœ–ğ´ and also
ğ‘˜3 2
ğ‘˜3
0ğ‘ğ‘ğ‘
ğ‘˜3 3
ğ‘˜3 ğ‘“

satisfies Eq. (13) or Eq. (14). Basically, Eq. (14) is the further elabora-


âˆ’ğ‘‰ âˆ—(ğ‘¡ + 1) )ğ‘‡ â‹… (  1 ğ‘‰ (ğ‘¡ + 1) +  1 ğ›¿ (ğ‘¡ + 1)
(20)

â€–ğ¿ (ğ‘‰	[ğ‘¡ + 1]) âˆ’ ğ¿ (ğ‘‰  [ğ‘¡]) â€– â‰¤ ğ¿ â€– (ğ‘‰  [ğ‘¡ + 1])
â€“ ğ‘˜1 ğ‘–	(ğ‘¡ + 1) âˆ’ ğ‘˜1 ğ›¿ (ğ‘¡ + 1) âˆ’ ğ‘˜2 ğ‘‰	(ğ‘¡ + 1)

err
ğ‘’ğ‘Ÿğ‘Ÿ
(
ğ‘ 	1
) â€–
ğ‘’ğ‘Ÿğ‘Ÿ
(13)
ğ‘˜3
0ğ‘ğ‘ğ‘
ğ‘˜3 2
ğ‘˜3
0ğ‘ğ‘ğ‘

â€“ ğ‘‰err [ğ‘¡]
âˆ€ğ‘‰ğ‘’ğ‘Ÿğ‘Ÿ[ğ‘¡] âˆˆ A âŠ† R
â€“ ğ‘˜2 ğ›¿ (ğ‘¡ + 1) âˆ’ ğ‘˜4 ğ‘–
â€“ ğ‘‰ âˆ—(ğ‘¡ + 1) ) âˆ’ 1 [ğ‘‰
(ğ‘¡)]ğ‘‡ [ğ‘‰
(ğ‘¡)]

â€–ğ¿ (ğ‘‰err [ğ‘¡ + 1]) âˆ’ ğ¿ (ğ‘‰err [ğ‘¡])â€– â‰¥ ğ¿2â€– (ğ‘‰err [ğ‘¡ + 1])

(14)


ğ‘˜3 3

ğ‘˜3 ğ‘“	0
2	ğ‘’ğ‘Ÿğ‘Ÿ
ğ‘’ğ‘Ÿğ‘Ÿ

â€“ (ğ‘‰
err
[ğ‘¡â€–]) â€–
âˆ€ğ‘‰
eâ€–rr
[ğ‘¡] âˆˆ B âŠ‚ A
The VSI voltage vector, load current, and voltage are finite sets and
bounded. The change of defined control error in Eq. (15), can be written as:

â€–	â€–	ğ›¥ğ‘‰ (ğ‘¡) â‰¤ âˆ’
ğ‘‰ğ‘’ğ‘Ÿğ‘Ÿ(ğ‘¡)
ğ‘‰ğ‘’ğ‘Ÿğ‘Ÿ(ğ‘¡)

ğ›¥ğ‘‰ (ğ‘¡) < âˆ’ğ¿3 ğ‘‰err [ğ‘¡] ğ‘  + ğ¿4	(15)
where ğ¿1 âˆ’ ğ¿4 must be positive values and ğ‘  â‰¥ 1. A is a positively

1 (  1
1
ğ‘˜1
ğ‘‡
ğ‘˜2
)2]	(21)

invariant set of natural numbers. Now, define the inverter output voltage at t+1 sampling instant and express it as:
~
ğ‘‰ğ‘–[ğ‘¡ + 1] = ğ‘‰ ğ‘–[ğ‘¡ + 1] + ğ›¥[ğ‘¡ + 1]	(16)
+ 2  ğ‘˜3 ğ›¿1 âˆ’ ğ‘˜3 ğ›¿2 âˆ’ ğ‘˜3 ğ›¿3
The stability of the system is satisfied by the given conditions:
ğ¿1 = ğ¿2 = 1, ğ¿3 = 1 ,

~
ğ‘‰ ğ‘–[ğ‘¡+1] is the continuous voltage input vector, and ğ›¥[ğ‘¡+1] represents
quantization error and satisfies the condition given in Eq. (16). Where
ğ¿4 = 1 ( 1 ğ›¿1 âˆ’
1 ğ›¿2 âˆ’
ğ‘˜3
ğ‘˜
ğ‘˜3 ğ›¿3
)2	(22)

is the quantization error upper limit and is greater than 0:
ğ›¥(ğ‘¡ + 1) â‰¤ ğ›¿1	(17)
As Eq. (21) has a negative sign, the system energy converges to zero with the time towards infinite and defines voltage control error converges as a compact set:

The change in the Lyapunov function for converter output voltage
is:
ğ›¿ =
ğ¿4
ğ¿3
â‰¥ (ğ‘‰
err
âˆ£ ğ‘‰
err )]

(23)

ğ›¥ğ‘‰ (ğ‘¡) = 1 (  1 ğ‘‰ (ğ‘¡ + 1) âˆ’ ğ‘˜1 ğ‘–	(ğ‘¡ + 1) âˆ’ ğ‘˜2 ğ‘‰
(ğ‘¡ + 1)

â€“ ğ‘˜4 ğ‘– âˆ’ ğ‘‰ âˆ—(ğ‘¡ + 1) )ğ‘‡ â‹… (  1 ğ‘‰ (ğ‘¡ + 1) âˆ’ ğ‘˜1 ğ‘–	(ğ‘¡ + 1)

â€“ ğ‘˜2 ğ‘‰	(ğ‘¡ + 1) âˆ’ ğ‘˜4 ğ‘– âˆ’ ğ‘‰ âˆ—(ğ‘¡ + 1) )
and provides PQ decoupling. It also lowers the circulating current and




where
ğ‘˜3
0ğ‘ğ‘ğ‘
ğ‘˜3 ğ‘“
â€“ 1 [ğ‘‰ğ‘’ğ‘Ÿğ‘Ÿ
0
(ğ‘¡)]ğ‘‡ [ğ‘‰
ğ‘’ğ‘Ÿğ‘Ÿ
(ğ‘¡)]
The voltage drop can be calculated in ğ›¼ğ›½ reference frame using Eq. (24) power ripple. The virtual DG impedance value is determined from [50].
as stated:
[ğ‘‰ğ‘‘ğ›¼ ] = [ ğ‘…1	âˆ’ğœ”ğ¿1] [ğ‘–0ğ›¼ ]	(24)

ğ¿ğ‘“
(	ğ¿ğ‘“ )
ğ¿ğ‘“ ğ¶ğ‘“
ğ‘‰ğ‘‘ğ›½
ğœ”ğ¿1	ğ‘…1
ğ‘–0ğ›½

ğ‘˜1 =
ğ‘ 
, ğ‘˜2 =
1 âˆ’
ğ‘‡ğ‘ 
, ğ¾3 =	2  ,
ğ‘ 
(19)
Here ğ‘…1 and ğ¿1 represent the feeder impedance.

ğ‘˜4 =
ğ‘…ğ‘ ğ‘‡ğ‘  âˆ’ ğ¿ğ‘“
ğ‘‡ğ‘ 
2.5. Droop control

Now rewrite Eq. (18) as per Eq. (16) by converting the load voltage, current, and inverters voltage vector into vector and quantization error.
Droop control is responsible for accurate power sharing among the distributed generations and lies at the upper level of primary control of




/ig. 6. Block diagram of the proposed decentralized control strategy.


MG, and is widely used due to its communication less structure [18,51]. P-f and Q-v droop strategy is implemented in this study and expressed as follows:
ğ‘“ = ğ‘“ğ‘› âˆ’ ğ¾ğ‘(ğ‘ƒ âˆ’ ğ‘ƒğ‘Ÿğ‘’ğ‘“ )	(25)
ğ‘‰ = ğ‘‰ğ‘› âˆ’ ğ¾ğ‘ (ğ‘„ âˆ’ ğ‘„ğ‘Ÿğ‘’ğ‘“ )	(26)
ğ‘ƒğ‘Ÿğ‘’ğ‘“ and ğ‘„ğ‘Ÿğ‘’ğ‘“ are zero in the case of islanded MG, and V and f are
for concern DG. ğ¾ğ‘ and ğ¾ğ‘ are droop coefficients and expressed as the voltage amplitude and frequency generated by the droop approach

ğ¾  =  ğ›¥ğ‘“
ğ‘ƒğ‘šğ‘ğ‘¥
and ğ¾  =  ğ›¥ğ‘‰  . ğ›¥ğ‘‰ and ğ›¥ğ‘“ are the maximum deviations
ğ‘„ğ‘šğ‘ğ‘¥

in voltage and frequency, while ğ‘ƒğ‘šğ‘ğ‘¥ and ğ‘„ğ‘šğ‘ğ‘¥ are rated active and
reactive power of the DG. Droop control keeps the voltage and phase
angle stable, eliminating the circulating current. Eqs. (14) to (15) are used to evaluate the P and Q using instantaneous power theory in the
ğ›¼ğ›½ reference frame:
ğ‘ƒ = ğ‘–ğ‘“ ğ›¼ ğ‘‰0ğ›¼ + ğ‘–ğ‘“ ğ›½ ğ‘‰0ğ›½	(27)
ğ‘„ = ğ‘–ğ‘“ ğ›¼ ğ‘‰0ğ›½ âˆ’ ğ‘–ğ‘“ ğ›½ ğ‘‰0ğ›¼	(28)

Secondary control

The fundamental responsibility of secondary control is to regulate the voltage and frequency deviation at PCC and forcefully shift the system variables to their nominal reference values with zero steady- state error after each change of generation and load. However, these deviations are generated due to overseeing the primary control. The voltage and frequency deviations are larger in the case of linear theory based controllers while smaller in the case of nonlinear controllers. In order to attenuate these deviations, the PI controller is used as a regulator. The secondary control layer usually consists of a voltage and frequency regulation loop. A second order generalized integrator phase locked loop (SOGI PLL) is used to measure the systemâ€™s frequency. The secondary voltage and frequency compensation loops are extracted as follows:
ğ›¥ğ‘‰ = ğ‘˜ğ‘ğ‘£ (ğ‘‰ğ‘Ÿğ‘’ğ‘“ âˆ’ ğ‘‰ğ´ğ‘ğ‘¡) + ğ‘˜ğ‘–ğ‘£ âˆ« (ğ‘‰ğ‘Ÿğ‘’ğ‘“ âˆ’ ğ‘‰ğ´ğ‘ğ‘¡) ğ‘‘ğ‘¡	(29)
ğ›¥ğ‘“ = ğ‘˜ğ‘ğ‘“ (ğ‘“ref âˆ’ ğ‘“SOGI ) + ğ‘˜ğ‘–ğ‘“ âˆ« (ğ‘“ref âˆ’ ğ‘“SOGI ) ğ‘‘ğ‘¡	(30)










/ig. 7. Block diagram of the secondary control for frequency and voltage restoration.



where ğ‘˜ğ‘ğ‘£, ğ‘˜ğ‘–ğ‘£, ğ‘˜ğ‘ğ‘“ and ğ‘˜ğ‘–ğ‘“ are the gain parameters of secondary layers regulators. ğ‘‰ğ‘Ÿğ‘’ğ‘“ and ğ‘“ğ‘Ÿğ‘’ğ‘“ are the reference voltage and frequency of MG, while ğ‘“ğ‘†ğ‘‚ğºğ¼ and ğ‘‰ğ´ğ‘ğ‘¡ are the actual frequency and voltage of AC bus
in MG.
Fig. 7 illustrates the complete structure and process and how sec- ondary control works and restores the voltage and frequency deviation. However, the response of the secondary level control is slower than the primary level control. As shown in the p-f graph, with the load increment, primary control acts first accordingly and increases the
power generation. However, the systemâ€™s frequency moves from ğ‘“2 to
ğ‘“3 Hz. Then secondary control adds the ğ›¿ğ‘“ factor into droop control
to shift the characteristic curve to attain the system frequency. The
same principle is applied in the voltage droop case. Without secondary control, the amplitude and frequency of MG would be load dependent. To design the regulator and analyze the systemâ€™s stability, the transfer function is determined for the frequency regulation loop as written in Eq. (32). As shown in Fig. 6, the block model comprises droop control, secondary control gain, second order generalized integrator based phase lock loop, and communication delay. The block model is


mathematically represented as:
ğºğ‘“ ğ‘ ğ‘’ğ‘ (ğ‘ )ğºğ‘‘ğ‘’ğ‘™ (ğ‘ )

ğ‘“ğ‘ğ‘¢ğ‘  =
ğ‘“ ğ‘ ğ‘’ğ‘
(ğ‘ )ğºğ‘‘ğ‘’ğ‘™
(ğ‘ )ğºSOGI
(ğ‘ ) ğ‘“ğ‘Ÿğ‘’ğ‘“
(31)

â€“	ğ‘˜ğ‘ğºğ¿ğ‘ƒ ğ¹ (ğ‘ )
1 + ğºğ‘“ ğ‘ ğ‘’ğ‘ (ğ‘ )ğºğ‘‘ğ‘’ğ‘™ (ğ‘ )ğºğ‘†ğ‘‚ğºğ¼ (ğ‘ )
ğ‘ƒğ‘Ÿğ‘’ğ‘“

Here the transfer function is demonstrated as follows:
ğ‘˜ğ‘ğ‘“ ğ‘  + ğ‘˜ğ‘–ğ¹

ğºğ‘“ ğ‘ ğ‘’ğ‘ (ğ‘ ) =
(32)
ğ‘ 

ğºğ‘‘ğ‘’ğ‘™
ğº
(ğ‘ ) = 	1	
ğ‘  + 1.5ğœ”ğ‘ 
(ğ‘ ) =  ğœ”ğ‘ 
(33)

(34)

ğ¿ğ‘ƒ ğ¹
ğ‘  + ğœ”ğ‘

The ğ‘ƒğ‘Ÿğ‘’ğ‘“ to ğ‘“ğ‘ğ‘¢ğ‘  transfer function can be written as:
ğ‘˜ ğœ” ğ‘  ğ‘ 2 + ğ‘ ğ‘ + ğ‘
ğ‘“ğ‘ğ‘¢ğ‘  = ğ‘ 4 + ğ‘ 3ğ‘ + ğ‘ 2ğ‘‘ + ğ‘ ğ‘’ + ğ‘“ ğ‘ƒğ‘Ÿğ‘’ğ‘“
The parameters are given as:


(35)







Table 4




/ig. 8. Simulated communication and physical model of MG.

ğ’‚ = ğ‘¡ + 1.5ğ‘‡ğ‘ , ğ’ƒ = 1.5ğ‘‡ğ‘ ğ‘¡ğ’„ = 1.5ğ‘‡ğ‘  + ğœ”ğ‘ + ğ‘¡	(36)
ğ‘‘ = ğœ” (1.5ğ‘‡ + ğ‘¡) + ğ‘¡ (1.5ğ‘‡ + ğ‘˜  )	(37)
Dynamics load contacts and their power ratings.
Load types	Load constants	Active power

Reactive power

ğ‘
ğ‘’ = ğ‘¡ (ğœ”ğ‘ (ğ‘˜
ğ‘ 
ğ‘ğ‘“
+ 1.5ğ‘‡ğ‘ ) + ğ‘˜
ğ‘ 
ğ‘–ğ¹
ğ‘ğ‘“
) ğ‘“ = ğ‘¡ğ‘˜
ğ‘–ğ¹
ğœ”ğ‘
(38)

By using this model, the secondary control parameters can be easily adjusted, and the effects of communication delays can also be analyzed. The voltage regulation loop is also modeled and developed using the same procedure.

Dynamics loads


The dynamic load is a load in which active and reactive power depends on the voltage and frequency of the systems. However, the voltage variation is in practice larger than the frequency variation [52]. The mathematical model of the load as a function of voltage is as follows:


Table 5
Simulation parameters.


Parameter	Value
DC Input ğ‘‰ğ‘‘ğ‘	700 [V]

ğ‘ƒ = ğ‘ƒ	ğ‘‰
ğ‘‰0
ğ‘›ğ‘
1 + ğ‘›ğ‘ğ‘“
ğ›¥ğ‘“ )

(39)
Inductor value	ğ¿ğ‘“ = 2 Ã— 10âˆ’3 [H]
Nominal Bus Voltage	ğ‘‰ğ‘ğ‘¢ğ‘  = 320 [V]
Capacitor	ğ¶ğ‘“ = 250 Ã— 10âˆ’6 [F]

ğ‘„ = ğ‘„0
ğ‘›ğ‘„
ğ‘‰0	1 + ğ‘›ğ‘ğ‘“ ğ›¥ğ‘“
(40)
System Frequency	50 [Hz]
Droop Coefficients	ğ¾ğ‘ = 0.0001, ğ¾ğ‘ = 0.001
Sampling Time	20 Ã— 10âˆ’6 [s]

ğ‘ƒ0 and ğ‘„0 are the nominal power rating of load. P and Q are the
The ğ‘›ğ‘ and ğ‘›ğ‘ are the load constants that define the loadâ€™s nature. For net power rating of load w.r.t the frequency and voltage of the system. constant current load, the value of ğ‘›ğ‘ and ğ‘›ğ‘ equals to one, and the value is two for constant impedance load. ğ‘›ğ‘ğ‘“ and ğ‘›ğ‘ğ‘“ are weighting
factors to control the effect of frequency on load. The relationship
between power and voltage is quadratic under constant impedance load (CZ), while in constant current load (CI), power is linear with bus voltage. However, constant power (CP) loads are independent of voltage. Table 4 expressed load constants, the power rating of the dynamic loads used in this study.

Simulation results

This part of the article discusses the simulation studies of the MG model developed in the MATLAB/Simulink environment to eval- uate the performance of the proposed control strategy. Several MAT- LAB/Simulink simulations are carried out to assess the response of the proposed controller under different types of dynamic loads. In the simulation studies, two DGs with feeder mismatch are tested under different dynamic loads such as constant current, constant impedance, and constant power load to validate the performance of the studied con- troller, as shown in Fig. 8. The proposed systemâ€™s control parameters
Secondary Voltage Control Gains	ğ¾ğ‘ = 1.01, ğ¾ğ‘– =0.001
Secondary Frequency Control Gains	ğ¾ğ‘ = 0.165, ğ¾ğ‘– = 0.001
Switching Frequency	20 [kHz]
Line Impedance	ğ‘…1 = 0.1 [Î©], ğ¿1 = 2.4 Ã— 10âˆ’3 [H]


20 Î¼s. The results analysis is further divided into two parts; the first are prescribed in Table 5, and the sampling time of the simulation is
part explains the response of the studied controller with secondary and without secondary controller under normal RL load. The second part illustrates the systemâ€™s performance under different types of dynamic loads.
To validate the performance of the proposed control, two DGs are operated in parallel, having an LC filter, and a feeder impedance is also added to make the system more realistic. The total load of 13 kW and 6 kVar is connected to the common MG AC bus. Fig. 9 shows the voltage
and frequency of the ğ·ğº1 and ğ·ğº2 without secondary control. The
to the system at instant t = 0.2 s So, there is a negligible dip in the initial part of the RL load of 9 kW and 4 kVar is suddenly connected
instant t = 0.6 s, the load is further increased to 13 kW and 6 kVar. voltage and frequency due to connecting the initial load. Again, at
The DGsâ€™ voltage and frequency drop and settle at a lower value due to the absence of secondary control.










/ig. 9. Frequency and voltage of DGs under RL load, when secondary control is not employed.


/ig. 10. Frequency and voltage of DGs under RL load, when secondary control is employed.


/ig. 11. Frequency and voltage waveform of DGs (PI based primary control) under RL load.


/ig. 12. Frequency and voltage waveform of DGs under RL load, when PI based hierarchical control is implemented.



At t = 0.8 s, the ğ·ğº1 is disconnected from the system. Therefore, the frequency of ğ·ğº2 drops from its nominal value, and the voltage also falls due to an increased share of the load. ğ·ğº2 is under a no load condition, so the voltage and frequency of ğ·ğº2 elevate to the
predefined reference value.
Fig. 10 illustrates the voltage and frequency of the DGs with sec- ondary control. It can be observed from Fig. 10 that the frequency and voltage demonstrate a slight dip and deviation from the reference values due to the load change. The secondary controller adds the increments to attain the reference value within no time. It is also seen
/ig. 13. THD of the MG at PCC.



in Fig. 10 that small transients occur in the system due to the operation of circuit breakers. However, the controller effectively accomplishes its goal of promptly achieving the reference voltage and frequency. Figs. 11 to 12 present DGsâ€™ output voltage and frequency when imple- menting PI-based hierarchical control. As shown in Fig. 11, the voltage and frequency of DGs decrease with the increase in load due to the absence of secondary control loop, and the PI based primary control loop has more deviation in voltage and frequency compared to the proposed controller. Fig. 12 depicts the performance of DGs when PI controller based hierarchical control is implemented. From Fig. 12, it can be observed that the PI based hierarchical control exhibits inferior performance when compared to the proposed control scheme. Fig. 13 illustrates the total harmonic distortion (THD) of the voltage at the AC bus of the MG. The voltage THD remains under 2 percent for the proposed control scheme.
The performance of the proposed PI+MPC based hierarchical con- trol scheme is also analyzed under the different dynamics loads such as CZ, CI, and CP.
Constant Impedance: The output power of CZ load is in a quadratic relationship with voltage. Fig. 14(a) exhibits the voltage and frequency
of ğ·ğº1 and ğ·ğº2 under constant impedance (CZ) load. At t = 0.3 s,
the load of 2 kW is suddenly connected to the system. However, the
voltage and frequency remain stable despite the switching of the load. The THD percentage of the current is 0.65. So the proposed controller effectively suppressed the voltage and current harmonics.
Constant Current: In this load, the output current remains con- stant, but the power changes linearly with the voltage. The power rating CI load is 6 kW and 4 kVar, which is connected to the system
at t = 0.3 s, as demonstrated in Fig. 14(b). It is observed from the
simulation results that the voltage and frequency of the system drop
due to the addition of the load. But the proposed control system effectively tracks the reference and shares the DGsâ€™ harmonics. The percentage THD of the voltage is less than with the conventional control techniques, as shown in Table 6. At the same time, the current harmonics is about 0.47 percent, far less than the recommended value of IEEE/IEC standards such as IEC 62040, IEEE 1547 [53], and IEEE 519 [54]. The IEEE 519 standard recommends that the total harmonic distortion (THD) for voltage should not exceed 5 percent for systems with a voltage at the point of common coupling (PCC) of 69 kV and below. For individual harmonics, the standard recommends that it should not exceed 3 percent [54].
Constant Power: In this type of load, power remains constant and dependent on the input voltage change. The total load of 8 kW and 6 kVar is applied to the system at 0.3 s, as shown in Fig. 14(c). The system voltage and frequency show some disturbance, attain the reference, and become stable. The current harmonics are observed at PCC due to the feeder mismatch. However, the current harmonics are reduced and properly shared by the DGs. The current harmonic percentage is
0.33 at the PCC. The THD percentage comparison among the different control schemes is presented in Table 6.
Fig. 14(d) illustrates the simulation results of voltage and frequency of islanded MG when the industrial motor load is connected with a power rating of 16.55 kVA. The motor load is connected to the system at 0.3 s and shows the spike in voltage and current wave- form due to the switching of the circuit breaker. The nominal voltage







/ig. 14. Impact of different dynamics loads on the voltage and frequency of the AC MG.



and frequency of the DGs deviate from their reference. The proposed secondary controller eliminates voltage and frequency deviation with minor transients in 0.1 s, produced by the droop control due to a change in load. The current harmonics in the case of the industrial motor is
0.22 percent. The active and reactive power generated by the DGs to meet the load demand is illustrated in Fig. 15. The power voltage relation is quadratic in the case of CZ load and also has a large load power variation. At the same time, the CI load has less load power variation compared to CZ and has linear relation between voltage & power. In the case of CP, the voltage is not dependent on power and has a constant power load. Table 6 explains the performance analysis of THD among different control techniques. The proposed hybrid control scheme has achieved less percentage THD in all load types.

Controller-HIL studies

FPGA-in-the-loop (FIL) wizard provides the capability to use MAT- LAB/Simulink for testing controllers in real hardware conditions. The FIL wizard generates the code in VHSIC hardware descriptive language (VHDL) then generated VHDL code of the controller under test (CUT)
Table 6
Voltage quality performance of the proposed controller under complex load conditions.




is burned on the selected FPGA board. The communication between the board and MATLAB/Simulink is carried out through a JTAG cable. In this study, ZYBO Z7 (ZYNQ-7020 development board) is used. The ZYBO Z7 is driven by 125 MHz oscillators and supports the JTAG mode. It has 13300 logic slices, 106,4000 flip flops, and 630 kB embedded RAM. Fig. 16 illustrates the working of the FIL implementation in




/ig. 17. Systematic view of FPGA controller hardware in the loop simulation environment along with the signal flow.





























/ig. 15. The response of DGs power generation under different dynamic loads.


/ig. 16. Working principle of FPGA-in-Loop simulation environment.



SIMULINK. The CUT is burnt on the FPGA board, while the remaining AC MG model is on the MATLAB/Simulink environment. The interac- tive communication is done through a JTAG cable. FIL Implementation is performed in the following steps:
The controller under test is specified using a Simulink subsystem. Then inputs and outputs of the subsystem are defined as fixed data types(This operation can be performed using SIMULINK Fixed Point Tool).
After defining data types, select the CUT subsystem, open the HDL workflow, and run all tasks.
After running all tasks successfully, Matlab will generate the VHDL code of CUT and write it up on the FPGA board.
The performance of the studied controller is verified experimentally. Fig. 17 presents the systematic diagram of the experimental setup uti- lized for the proposed algorithm. This study implements the secondary controller on an FPGA card, while the AC MG model and MPC-based primary controller are modeled on MATLAB/Simulink environment. The controller hardware in the loop (CHIL) testing is carried out to study the response of the secondary controller in real time. Fig. 8 explains the detailed structure of the studied cases. Fig. 18 expressed the voltage and current of DERs during the step change of load under
primary and secondary control. At t = 0.2 s, the RL load is connected
to MG at the PCC. Voltage, the output current of the DERs remains
stable despite a smaller dip, as shown in Fig. 18. Suddenly further load of 5 kW & 2 KVar is added into the system to see the impact
of load on the proposed controller at t = 0.6 s The system remains
stable and attains the new power demand in no time. At t = 0.8 s, hot-
swap operation is performed. Usually, this type of simulations studies
is performed for UPS applications [55]. In this test, one DG suddenly goes out of the system due to a circuit breaker tripping. The remaining
that ğ·ğº1 instantly increased its power generation to fulfill the load DGs take the whole connected load. It can be noticed from the figure
the transition period when ğ·ğº2 was isolated from the system. Fig. 19 demand. The quality of voltage and current remained stable despite
shows the voltage and frequency of the DGs. It is observed from Fig. 19 that the voltage and frequency of the system remain stable despite disturbances occurring to changes in load. Fig. 20 shows the response of droop control to share the active and reactive power between the
ğ·ğº1 and ğ·ğº2 according to the load demand.
Figs. 21 to 22 present the systemâ€™s fault study results. At t = 0.3 s,
the three phase ground fault occurred at the PCC. DG voltage becomes
zero, and the output current increases by 3 times the load current. Fig. 22 illustrates the fault current injection and bus voltage at the point of fault. When the fault is cleared at 0.4 s, the voltage and current of the MG are stabilized within no time.

Parametric uncertainty tests

This section discusses the performance of the proposed controller under the parameter uncertainty issues. The filter value of the DG is
changed at t = 0.4 s from 2 mH to 1 mH. After changing the filter
inductance value, The proposed controller performs better than PI, as
shown in Figs. 23 to 24. This comparison is carried out based on THD in the converterâ€™s output voltage, which is 1.88 percent in the case of the proposed controller, but THD is 4 percent when PI is employed. The results illustrate the suitability and better performance of the studied controller under realistic conditions, and thus the proposed control can be effectively implemented for practical applications.

Conclusion

This paper proposed a decentralized hierarchical control comprised of FCS-MPC-based primary control and PI-based secondary approach for islanded AC microgrid to enhance the transient stability, load sharing, and power quality among the parallel connected DGs in AC MG under different dynamic loads (CZ, CI, CP, and industrial load). The mathematical stability of the proposed controller is also justified




/ig. 18. Three phase voltage of DERs with RL load under step change of load.


/ig. 19. DERs frequency and output voltage under step change of load.



/ig. 20. Active and reactive power generated by the DERs to cope with the load demand.


/ig. 21. Voltage and fault current injection during the 3-phase balanced fault at PCC.




using Lyapunov stability criteria. This rigorous mathematical proof confirms that the controller maintains stability within the system. The performance of the proposed control scheme is validated through the realistic MG test bench comprising two DGs operated in parallel along with an LC filter and a feeder impedance. The effectiveness of the proposed control technique was verified by performing simulations in MATLAB/Simulink along with hardware-in-loop testing using the FPGA-in-loop. The simulations and hardware setup results illustrated that the proposed approach tracked the reference with zero steady- state error by effectively regulating the voltage and frequency to its nominal value. The proposed control strategy achieved a THD (%)

/ig. 22. Three phase voltage and output current of DERs under 3-phase balanced fault.



L   =   2   mH   to   L   =   1   mH   at   t   =   0.4   s. /ig. 23. Performance of the proposed control approach under load inductance changes

/ig. 24. Performance of the PI control approach under load inductance changes L =
2 mH to L = 1 mH at t = 0.4 s.



of 0.98 percent, much less than required per IEEE standards. Conse- quently, it enhances the power quality and ensures active and reactive power sharing between the DER under steady-state and transient load conditions.

CRediT authorship contribution statement

Hussain Sarwar Khan: Conceptualization, Methodology, Soft- ware & Hardware implementation, Writing â€“ original draft. Kimmo Kauhaniemi: Supervision, Proofreading, Modification for the final layout.

Declaration of competing interest

The authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper.

Acknowledgments

The authors would like to thank the editors and anonymous review- ers for providing insightful suggestions and comments to improve the quality of the research paper. This work is done in the SolarX and Smart Grid 2.0 research projects with the financial support provided by Business Finland with Grant No. 6844/31/2018 & 1386/31/2022. The financial support provided by the funding organization is highly acknowledged.

References

P. Agreement, Paris agreement, in: Report of the Conference of the Parties to the United Nations Framework Convention on Climate Change (21st Session, 2015: Paris). Retrived December. Vol. 4, HeinOnline, 2015, p. 2017.
M. Ahmed, L. Meegahapola, A. Vahidnia, M. Datta, Stability and control aspects of microgrid architecturesâ€“A comprehensive review, IEEE Access 8 (2020) 144730â€“144766.
A.A. Alkahtani, S.T. Alfalahi, A.A. Athamneh, A.Q. Al-Shetwi, M.B. Mansor, M. Hannan, V.G. Agelidis, Power quality in microgrids including supraharmonics: Issues, standards, and mitigations, IEEE Access 8 (2020) 127104â€“127122.
Y.-Y. Hong, F.I. Alano, Hierarchical energy management in Islanded networked microgrids, IEEE Access 10 (2022) 8121â€“8132.
A. Banerji, D. Sen, A.K. Bera, D. Ray, D. Paul, A. Bhakat, S.K. Biswas, Microgrid: A review, in: 2013 IEEE Global Humanitarian Technology Conference: South Asia Satellite, GHTC-SAS, IEEE, 2013, pp. 27â€“35.
Requirements for Generating Plants to Be Connected in Parallel with Distribution Networks - Part 1: Connection to a LV Distribution Network - Generating Plants Up to and Including Type B, Vol. 2019, Standard, European standard, Brussels, Bel, 2019, EN50549-1:2019.
G. Buticchi, S. Bozhko, M. Liserre, P. Wheeler, K. Al-Haddad, On-board mi- crogrids for the more electric aircraftâ€”Technology review, IEEE Trans. Ind. Electron. 66 (7) (2018) 5588â€“5599.
C. Wu, D. Zhou, X. Lin, Q. Sui, F. Wei, Z. Li, A novel energy cooperation framework for multi-island microgrids based on marine mobile energy storage systems, Energy 252 (2022) 124060.
M. Srinivasan, A. Kwasinski, Decentralized control of a vehicular microgrid with constant power loads, in: 2014 IEEE International Electric Vehicle Conference, IEVC, IEEE, 2014, pp. 1â€“8.
Y. Khayat, Q. Shafiee, R. Heydari, M. Naderi, T. DragiÄeviÄ‡, J.W. Simpson-Porco,
F. DÃ¶rfler, M. Fathi, F. Blaabjerg, J.M. Guerrero, et al., On the secondary control architectures of AC microgrids: An overview, IEEE Trans. Power Electron. 35 (6) (2019) 6482â€“6500.
T. Dragicevic, D. Wu, Q. Shafiee, L. Meng, Distributed and decentralized control architectures for converter-interfaced microgrids, Chin. J. Electr. Eng. 3 (2) (2017) 41â€“52.
J.M. Guerrero, P.C. Loh, T.-L. Lee, M. Chandorkar, Advanced control archi- tectures for intelligent microgridsâ€”Part II: Power quality, energy storage, and AC/DC microgrids, IEEE Trans. Ind. Electron. 60 (4) (2012) 1263â€“1270.
J.M. Guerrero, M. Chandorkar, T.-L. Lee, P.C. Loh, Advanced control architec- tures for intelligent microgridsâ€”Part I: Decentralized and hierarchical control, IEEE Trans. Ind. Electron. 60 (4) (2012) 1254â€“1262.
L. Meng, F. Tang, M. Savaghebi, J.C. Vasquez, J.M. Guerrero, Tertiary control of voltage unbalance compensation for optimal power quality in Islanded microgrids, IEEE Trans. Energy Convers. 29 (4) (2014) 802â€“815.
F. Delfino, G. Ferro, M. Robba, M. Rossi, An architecture for the optimal control of tertiary and secondary levels in small-size Islanded microgrids, Int. J. Electr. Power Energy Syst. 103 (2018) 75â€“88.
Y. Li, T. Zhao, P. Wang, H.B. Gooi, L. Wu, Y. Liu, J. Ye, Optimal operation of multimicrogrids via cooperative energy and reserve scheduling, IEEE Trans. Ind. Inform. 14 (8) (2018) 3459â€“3468.
Z. Li, C. Zang, P. Zeng, H. Yu, S. Li, Fully distributed hierarchical control of parallel grid-supporting inverters in Islanded AC microgrids, IEEE Trans. Ind. Inform. 14 (2) (2017) 679â€“690.
J.C. Vasquez, J.M. Guerrero, M. Savaghebi, J. Eloy-Garcia, R. Teodorescu, Modeling, analysis, and design of stationary-reference-frame droop-controlled parallel three-phase voltage source inverters, IEEE Trans. Ind. Electron. 60 (4) (2012) 1271â€“1280.
X. Hou, Y. Sun, J. Lu, X. Zhang, L.H. Koh, M. Su, J.M. Guerrero, Distributed hierarchical control of AC microgrid operating in grid-connected, Islanded and their transition modes, Ieee Access 6 (2018) 77388â€“77401.
I. Ziouani, D. Boukhetala, A.-M. Darcherif, B. Amghar, I. El Abbassi, Hierarchical control for flexible microgrid based on three-phase voltage source inverters operated in parallel, Int. J. Electr. Power Energy Syst. 95 (2018) 188â€“201.
M. Jayachandran, G. Ravi, Decentralized model predictive hierarchical control strategy for Islanded AC microgrids, Electr. Power Syst. Res. 170 (2019) 92â€“100.
H.S. Khan, M. Aamir, K. Kauhaniemi, M. Mumtaz, M.W. Hassan, M. Ali, Improved finite control set model predictive control for distributed energy resource in Islanded microgrid with fault-tolerance capability, Eng. Sci. Technol. Int. J. 24
(3) (2021) 694â€“705.
Z. Zhang, C. Dou, D. Yue, B. Zhang, Predictive voltage hierarchical controller design for Islanded microgrids under limited communication, IEEE Trans. Circuits Syst. I. Regul. Pap. 69 (2) (2021) 933â€“945.
Z. Zhao, P. Yang, Y. Wang, Z. Xu, J.M. Guerrero, Dynamic characteristics analysis and stabilization of PV-based multiple microgrid clusters, IEEE Trans. Smart Grid 10 (1) (2019) 805â€“818.
M. Ali, M. Aamir, H.S. Khan, A.A. Khan, F. Haroon, Design and implementation of fractional-order sliding mode control for parallel distributed generations units in Islanded microgrid, in: 2019 IEEE 28th International Symposium on Industrial Electronics, ISIE, IEEE, 2019, pp. 64â€“69.
based model predictive control of three-phase inverter with an output ğ¿ğ¶ filter, [26] I.S. Mohamed, S. Rovetta, T.D. Do, T. DragiceviÄ‡, A.A.Z. Diab, A neural-network-
IEEE Access 7 (2019) 124737â€“124749.
Y.E. YaÄŸan, K. Vardar, Artificial neural networks controllers for three-phase neutral point clamped inverters, Eng. Sci. Technol. Int. J. 41 (2023) 101390.
H.S. Khan, M. Aamir, M. Ali, A. Waqar, S.U. Ali, J. Imtiaz, Finite control set model predictive control for parallel connected online ups system under unbalanced and nonlinear loads, Energies 12 (4) (2019) 581.
D.E. Olivares, A. Mehrizi-Sani, A.H. Etemadi, C.A. CaÃ±izares, R. Iravani, M. Kazerani, A.H. Hajimiragha, O. Gomis-Bellmunt, M. Saeedifard, R. Palma-Behnke, et al., Trends in microgrid control, IEEE Trans. Smart Grid 5 (4) (2014) 1905â€“1919.
Y. Mousavi, G. Bevan, I.B. Kucukdemiral, A. Fekih, Sliding mode control of wind energy conversion systems: Trends and applications, Renew. Sustain. Energy Rev. 167 (2022) 112734.
S.A.Q. Mohammed, I.M. Alsofyani, K.-B. Lee, Improved adaptive CCS-MPCC for distorted model parameters mitigation of IPMSM drives, IEEE Trans. Ind. Electron. (2023).
K. Rajesh, S. Dash, R. Rajagopal, R. Sridhar, A review on control of ac microgrid, Renew. Sustain. Energy Rev. 71 (2017) 814â€“819.
M. Ali, M. Aamir, H.S. Khan, A. Waqar, F. Haroon, A.R. Jafri, Lyapunov stability and performance analysis of the fractional order sliding mode control for a parallel connected UPS system under unbalanced and nonlinear load conditions, Energies 11 (12) (2018) 3475.
I. Poonahela, A. Krama, S. Bayhan, U. Fesli, M.B. Shadmand, H. Abu-Rub, M.M. Begovic, Hierarchical model-predictive droop control for voltage and frequency restoration in AC microgrids, IEEE Open J. Ind. Electron. Soc. 4 (2023) 85â€“97, http://dx.doi.org/10.1109/OJIES.2023.3240070.
J. Kaushal, P. Basak, Power quality control based on voltage sag/swell, unbal- ancing, frequency, THD and power factor using artificial neural network in PV integrated AC microgrid, Sustain. Energy Grids Netw. 23 (2020) 100365.
H.S. Khan, I.S. Mohamed, K. Kauhaniemi, L. Liu, Artificial neural network-based voltage control of DC/DC converter for dc microgrid applications, in: 2021 6th IEEE Workshop on the Electronic Grid, EGRID, IEEE, 2021, pp. 1â€“6.
J. Hu, J. Zhu, D.G. Dorrell, Model predictive control of grid-connected inverters for PV systems with flexible power regulation and switching frequency reduction, IEEE Trans. Ind. Appl. 51 (1) (2015) 587â€“594.
E. Clarke, C. Park, Generalized theory of electrical machines, Trans. Am. Inst. Electr. Eng. Part II: Appl. Ind. 74 (3) (1954) 1292â€“1301.
W. Duesterhoeft, M.W. Schulz, E. Clarke, Determination of instantaneous currents and voltages by means of alpha, beta, and zero components, Trans. Am. Inst. Electr. Eng. 70 (2) (1951) 1248â€“1255.
S. Vazquez, J. Leon, L. Franquelo, J. Carrasco, E. Dominguez, P. Cortes, J. Rodriguez, Comparison between FS-MPC control strategy for an UPS inverter
application in ğ›¼-ğ›½ and abc frames, in: 2010 IEEE International Symposium on
Industrial Electronics, IEEE, 2010, pp. 3133â€“3138.



M. Novak, U.M. Nyman, T. Dragicevic, F. Blaabjerg, Analytical design and performance validation of finite set MPC regulated power converters, IEEE Trans. Ind. Electron. 66 (3) (2019) 2004â€“2014.
K. Alam, M.P. Akter, S.S.I. Shakib, D. Xiao, D. Zhang, M. Rahman, Lyapunov- function based predictive approach for load voltage control of four-leg inverter with an output LC filter, in: 2018 IEEE Energy Conversion Congress and Exposition, ECCE, IEEE, 2018, pp. 6880â€“6885.
M.P. Akter, S. Mekhilef, N.M.L. Tan, H. Akagi, Modified model predictive control of a bidirectional ACâ€“DC converter based on Lyapunov function for energy storage systems, IEEE Trans. Ind. Electron. 63 (2) (2015) 704â€“715.
V. Yaramasu, M. Rivera, B. Wu, J. Rodriguez, Model predictive current control of two-level four-leg invertersâ€”Part I: Concept, algorithm, and simulation analysis, IEEE Trans. Power Electron. 28 (7) (2012) 3459â€“3468.
R.N. Fard, H. Nademi, L. Norum, Analysis of a modular multilevel inverter under the predicted current control based on finite-control-set strategy, in: 2013 3rd International Conference on Electric Power and Energy Conversion Systems, IEEE, 2013, pp. 1â€“6.
R.P. Aguilera, D.E. Quevedo, On stability and performance of finite control set MPC for power converters, in: 2011 Workshop on Predictive Control of Electrical Drives and Power Electronics, IEEE, 2011, pp. 55â€“62.
R.P. Aguilera, On stability of finite control set MPC strategy for multicell converters, in: 2010 IEEE International Conference on Industrial Technology, IEEE, 2010, pp. 1277â€“1282.
M.P. Akter, S. Mekhilef, N.M.L. Tan, H. Akagi, Modified model predictive control of a bidirectional ACâ€“DC converter based on Lyapunov function for energy storage systems, IEEE Trans. Ind. Electron. 63 (2) (2015) 704â€“715.
H.A. Young, M.A. Perez, J. Rodriguez, H. Abu-Rub, Assessing finite-control- set model predictive control: A comparison with a linear current controller in two-level voltage source inverters, IEEE Ind. Electron. Mag. 8 (1) (2014) 44â€“52.
J. He, Y.W. Li, Analysis and design of interfacing inverter output virtual impedance in a low voltage microgrid, in: 2010 IEEE Energy Conversion Congress and Exposition, IEEE, 2010, pp. 2857â€“2864.
U.B. Tayab, M.A.B. Roslan, L.J. Hwai, M. Kashif, A review of droop control techniques for microgrid, Renew. Sustain. Energy Rev. 76 (2017) 717â€“727.
W. Price, C. Taylor, G. Rogers, Standard load models for power flow and dynamic performance simulation, IEEE Trans. Power Syst. 10 (CONF-940702-) (1995).
IEEE standard for interconnection and interoperability of distributed energy resources with associated electric power systems interfaces, in: IEEE Std 1547- 2018 (Revision of IEEE Std 1547-2003), 2018, pp. 1â€“138, http://dx.doi.org/10. 1109/IEEESTD.2018.8332112.
IEEE recommended practice and requirements for harmonic control in electric power systems, in: IEEE Std 519-2014 (Revision of IEEE Std 519-1992), 2014,
pp. 1â€“29, http://dx.doi.org/10.1109/IEEESTD.2014.6826459.
predictive control of an inverter with output ğ¿ğ¶ filter for UPS applications, [55] P. CortÃ©s, G. Ortiz, J.I. Yuz, J. RodrÃ­guez, S. Vazquez, L.G. Franquelo, Model
IEEE Trans. Ind. Electron. 56 (6) (2009) 1875â€“1883.
