Since the seminal work by Moggi in the late 80s [25], monads, more precisely, strong monads, have become a generally accepted tool for structuring effectful notions of computation, such as computation with exceptions, output, computation using an environment, state-transforming, nondeterministic and probabilistic computation etc. The idea is to use a Kleisli category as the category of impure, effectful func- tions, with the Kleisli inclusion giving an embedding of the pure functions from the base category. Although finer and coarser accounts of effects based on Lawvere theories [27] (this reference is only the first in a series of papers; for more recent pre- sentations, see [28,18]) and arrows/Freyd categories [17,30] also exist, the monadic approach remains central and best known. In particular, monads are part of the standard libraries of Haskell.

In functional programming, Kieburtz [20] was first to advocate comonads as tools for structuring context-dependent computations and gave some interesting exam- ples. The specific application of comonads to environment-passing computation or implicit parameters has been discussed by Lewis et al. [22].

In this paper, we proceed directly from the motivation to treat some impor- tant notions of context-dependent computation, namely notions of dataflow com- putation (stream-based computation) and notions of computation on trees such as tree relabellings in attribute evaluation. We demonstrate that a rather elegant framework for working with these notions of computation is given by symmetric (semi)monoidal comonads. Reassuringly, strong monads appear associated with symmetric monoidal comonads also in works on the categorical semantics of intu- itionistic linear and modal logic [4,7]. We describe some aspects of the structure of coKleisli categories corresponding to symmetric (semi)monoidal comonads and de- scribe then a general interpretation of languages for context-dependent computation into such categories.

We have previously described our proposal at work on language processors for dataflow computation [34] and attribute evaluation [35] implemented in Haskell. In this paper, written with a different slant, we look into the underlying theory, con- centrating on the issue of the most appropriate additional structure for comonads. The organization of the paper is the following. First, we present a compressed recap of strong monads, their Kleisli categories and the semantics of effectful lan- guages `a la Moggi. Then we develop our analogous account of context-dependent computation based on coKleisli categories of symmetric (semi)monoidal comonads. We emphasize the important differences resulting from the fact that, despite dual- izing from monads to comonads, we are still interested in transferring as much of a given Cartesian closed structure (possibly with coproducts and a uniform parame- terized fixpoint operation) as possible. Finally, we briefly comment on the relation to computational comonads and some important advanced issues that we intend to

In case of general or causal stream functions, an element of D1 is a list over 1, i.e., a natural number, for the time elapsed from the beginning of the history at a moment of interest. Of course it identifies a stream position.

In what sense is this semantics correct? We could compare the generic coKleisli semantics to some other generic semantics, e.g., an operational semantics, if we had one available. Unfortunately this is not the case: generic operational semantics for context-dependent languages is future work for us.

Several of notions of context that we looked at do not correspond to strong symmet- ric monoidal comonads. Rather, they correspond to lax symmetric semimonoidal comonads, for the reason that m should morally be partial and the total version fails to be an isomorphism and rules out the existence of a cohering e. Here indexing in the form of use of comonads on presheaf categories can help.

It is feasible that a notion of computation combines both effectfulness and context-dependence. Such combinations can correspond to distributive laws of a comonad over a monad in which case the category of impure functions is the bi- Kleisli category of the distributive law. This design appeared already in the work of Brookes and Van Stone [9]. We have applied it to clocked causal dataflow computa- tion, combining causal dataflow and exceptions [34]. Power and Watanabe [32] have given a definitive account of the mathematics of distributive laws between monads and comonads.

Lawvere theories [27] and arrows/Freyd categories [17,30] 4 are finer and coarser approaches to effectful computation. Lawvere theories make the effectful opera- tions of a notion of effect explicit. Arrows/Freyd categories, generalizing strong monads/their Kleisli categories, were proposed as an axiomatization of notions of impure computation reaching beyond Moggi-style effects.

