We study a class of extended automata de ned by guarded commands over Pres- burger arithmetic with uninterpreted functions. On the theoretical side, we show that the bounded reachability problem is decidable in this model. On the practical side, the class is useful for modeling programs with unbounded data structures, and the reachability procedure can be used for symbolic simulation, testing, and veri cation.

The rest of the paper is organized as follows. In Section 2 we present the theory of Presburger arithmetic with uninterpreted function symbols. In Sec- tion 3 we de ne a class of extended automata (called pf-automata) with guards and assignments in a decidable fragment of this theory. The initial condition may constrain an unbounded number of function values, and assignments may modify an unbounded number of such values. In Section 4 we present a de- cision procedure for the bounded reachability problem in pf-automata, based on symbolic analysis techniques.  The procedure is implemented using the ics decision procedure package [9] from SRI International. Section 5 presents conclusions, related work, and future work.

Consider now the existential fragment of pf (i.e., only existential quanti ers are allowed, and under the scope of an even number of negations). Modulo variable renaming, it is possible to move all quanti ers to the outermost level. Then, a formula 9x:' has a model if and only if ' also has one. Indeed, if there exist values of the functions and free variables that satisfy ', then the same values satisfy 9x:', and if there exists a model for 9x:', then this model, augmented with the \witness" value of x for the existential quanti er, is a model for '. Thus, the fragment is decidable. This reasoning can be pushed further: a pf formula ' is satis able if and only if 9f:', where f is a function, is satis able. Note that such a formula is not in pf. We use this result in Section 4.

Indeed, any model of Formula (5) is also a model for '0. Conversely, suppose ' has a model M'0 . Then, M'0 clearly induces a model M' for '. As # is semi-universal, this means there exists also a model M for  such that M' and M agree on the values of the free variables common to ' and . Now, M  can be extended into a model M 0 of  : the latter may have more

We build a valuation M#0 for the free variables and functions of For- mula (5) as follows. The values of the free variables of '0 (resp. 0) are taken from M'0 (resp. M 0 ). The values of the functions fj (j = 1 ::: n) are de ned as follows: at all positions i de ned by the values of t1;::: ; tm in M'0 we let fj(i) evaluate according to M'0 , and at all positions i di erent from the values of t1;::: ; tm in M'0 we let fj(i) evaluate according to M 0 .

The construction of M#0 is sound because we have assumed that ' has function depth 1, thus, t1;::: ; tm depend only on the free variables, and M'0 , M 0 agree on the values of the free variables common to ' and . We now prove that M#0 is a model for Formula (5). By construction, M#0 evaluates the rst two conjuncts of (5) just as M'0 does, thus, M#0 satis es the rst two conjuncts. Similarly, M#0 evaluates the third conjunct of (5) just as M 0 does, hence, M#0 also satis es the third conjunct, and the proof is done.  2

We extend M into a model for M 0 of  by choosing x = 0 as in M'0 , and build a valuation M#0 as shown in the proof of Lemma 2.4. The values of free variables x and y are chosen from M'0 : x = 0, y = 2. The values of f (i) such that i = x +1 or i = y, that is, for i 2 f1; 2g, are also chosen from M'0 : f (1) = 3; f (2) = 3. The values of f (i) such that i 62 f1; 2g are chosen from M 0 , that is, for all i 2= f1; 2g : f (i) = 3. Thus, the valuation M#0 , which is also a model for #, is

It is a simple semi-universal formula as it satis es the syntactic conditions of De nition 2.7, i.e. has functions depth 1, ' is quanti er-free, and is shielded. For the semantic condition, note that coincides with its universal closure and is satis able.	2

A valuation is a mapping that assigns, to each free variable appearing in the automaton, a value in Z, and to each function symbol, a function from Z to Z. We denote by V the set of all valuations. A state is a pair (q; v) consisting of a location q 2 Q and a valuation v 2 V. Note that, for a pf-automaton with at least one function symbol, there is an uncountably in nite set of states. An initial state is a state of the form (q0; v0) such that v0 j= , that is, the location is initial and the values of the variables and functions satisfy the initial condition . The set of states is denoted by S, and the set of initial states is denoted by S0. Each transition  2 T de nes a transition relation

if the location of s (resp. of s0) is the origin (resp. destination) of , and the variables and functions in s satisfy the guard of . Moreover, the variables and functions get new values according to the assignments of .

Formally, for a pf formula ' and a valuation v 2 V, let '[v] be the truth value of ' when the free variables and the function symbols of ' evaluate according to v. For a term t, we denote by t[v] the integer value obtained by evaluating variables and function symbols according to v. We now de ne how valuations are modi ed by assignments.

According to De nition 3.3, there are two kinds of assignments: variable assignments and function assignments. Let v0 2 V be the valuation obtained from v after an assignment, then, v0 is obtained in the following way. If the assignment is of the form x0 = t, where x is a variable, then v0 is the valuation such that for all u 2 F [ (V n fxg), v0(u) = v(u), and v0(x) = t[v]. Otherwise, the assignment is of the form 8i:(e1  f 0(i) = e2), where e1 is a

Here, x ; x2 ;::: ; x(k 1) and f ; f2 ;::: ; f (k 1) (resp. x and f ) are the values of free variables and functions on previous steps (resp. on current step) of the calculation of post (S0).

For the inductive step, consider a transition  = hq; ; ; ; q0i of the pf-automaton. For simplicity, we assume without loss of generality that the pf-automaton has only one function symbol f . This means that the function assignments of transition consists of one element, of the form 8i:(e1(i; x; f )  f 0(i) = e2(i; x; f )). Then, for a state predicate  of the form (6), the predicate post ( ) can be written as Formula (7)

(See Example 4.2 for an illustration.) The meaning of Formula (7) is that the next control is at location q, that  must hold on the values of the variables and the function at the previous step, i.e. on x and f , and that   must hold on the values of the variables and the function at all previous steps, i.e. on x ;::: ; xk and f ;::: ; fk . Moreover, the variables are modi ed by the assignments  , depending on their previous values and that of the function, and the function is updated at all positions i where e1 holds of i, x , and f .

What we still have to show is that the formula obtained from (7) after removing the existential quanti ers is a semi-universal formula. By induction hypothesis, # is a semi-universal formula. Thus, # is a formula of function depth 1, of the form ' ^ 8i1 1 ^ ::: ^ 8im: m, where ' is a quanti er-free pf formula, all formulas  1;::: ;  m are quanti er-free, and the semantic property of De nition 2.2 holds: for every model M' of ', there exists a model M of  :	8i1: 1 ^ ::: ^ 8im: m such that the free variables among x ;::: ; xk that are common to ' and  have the same values in M', M .

Now, it is possible to write the formula obtained from (7) after removing all existential quanti ers, as the conjunction '0 ^ 0, where '0 :  x = (x ;f ) ^ ', and 0 : 8i1 1 ^ ::: ^ 8im: m ^8i:(e1(i; x ;f )  f 0(i) = e2(i; x ;f ) ^ 8i:(:e1(i; x ;f ) f 0(i) = f (i))). Clearly, '0 is a quanti er-free pf formula, all conjuncts of 0 are shielded, and all are of function depth 1. To complete the proof, we just have to show that the semantic property of De nition	2.2

We still have to show that M'0  and M 0  agree on the values of their common free variables. But these are just the variables among x ;::: ; xk that were also common to ' and  . By induction hypothesis, M' and M agree on the values of these variables, and, by construction, M'0 agrees with M' on all these values, and M 0  agrees with M'0 . The proof is done.	2

The proof of Lemma 4.1 shows that checking reachability in m steps involves checking satis ability of a semi-universal formula # with m copies of each vari- able and function symbol. This, in turn, involves instantiating every universal quanti er from the universal part of # to all the terms in its quanti er-free part (cf. Lemma 2.4). Finally, a decision procedure for quanti er-free Pres- burger arithmetic with uninterpreted function symbols is used to decide the resulting quanti er-free formula. We use the ics decision procedure package from SRI International [9].

Preliminary results with our symbolic analysis prototype are encouraging: for example, a symbolic simulation of a path of about ten thousand steps in a vector-sorting algorithm was completed in about twenty hours. This means ten thousand calls to the decision procedures for checking formulas with thousands of variables and function applications. As optimizations in both ics and our prototype are still being developed, we expect to be able in the future to perform symbolic simulation on real-size programs and speci cations.

Finally, it worth noting that a simple extension of pf-automata which con- sists in letting the guards be universal a pf formulas, is too expressive for symbolic simulation, as reachability even in one step becomes highly undecid- able (cf. Section 2.3).

