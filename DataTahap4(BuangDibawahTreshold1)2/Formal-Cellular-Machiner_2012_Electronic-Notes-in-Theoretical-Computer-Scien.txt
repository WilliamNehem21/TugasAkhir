It has been about 10 years now since part of the theoretical computer science com- munity got interested in applying formal methods to systems biology. Since then it seems that the quest for a calculus having proteins, compartments or channels as first class citizens has not reached an end. Among the large variety of lan- guages that have been proposed to tackle various aspects of systems biology (see Refs. [22,5,21,10,12,3,1,18,20,17,19,15,2,4,14] for a non exhaustive list), several ideas seem of particular importance to us: (i) the cellular medium can be described as a graph where nodes represent molecules and edges represent physical contacts be- tween these molecules [10,12,1,14], (ii) languages with a natural notion of location

C2: the main expressiveness increment of our language. It introduces compart- ments and the notion of projectivity of membrane reactions, i.e. the possibility to mention patches of membrane, without having to deal with their global curvature. We propose a matching algorithm, that is proven both sound and complete. At this stage, generators allow modelers to create and destroy compartments in a projective fashion.

C3: the final step of the construction deals with the diffusion problem. In partic- ular we incorporate means to talk about connected components of reactants, which is a key feature for a new set of generators modeling diffusion of molecular species and intra-molecular complex formation. To the best of our knowledge C3 is the first calculus of its kind that allows one to model molecular agents both at a micro level (where interactions are purely local) and a macro level (where interactions involve connected components of agents).

Consider an infinite set of site names S = {x, y, z, . . . } and a disjoint infinite set of backbone names B = {a, b, c, . . . }. Let D be a terminal symbol, distinct from all others, that we use to denote domains. Terms T of C0 are built on the following grammar:

Connections between sites correspond to physical contacts between protein parts. This connection being exclusive we want to restrict to terms where restrictions bind at most two occurrences of site names. In the following of this paper we will assume that for any term T , free site names occur exactly once in T and bound site names have at most two occurrences. Note that we do not impose such restrictions on backbone name sharing.

possess. It is clear that we lack means of naming molecular components such as do- main names (SH2, Tyrosine, PWWP etc.) or protein names (SOS, EGF, IGF, p53, etc.). Before performing a bigger increment in expressiveness, when we introduce compartments in Section 4, we would like to briefly introduce a way to deal with names as a particular type of context in which unamed proteins can be embedded. The intent is to provide a way to define molecular reactions as refinements of the generators we have just presented, in keeping with the biological intuition that in- formation about molecular objects is always partial and that more context could reveal more about the nature of a molecule. In particular, we have the ontology problem in mind that several names can denote the same protein or gene.

As we already stressed in the previous sections, we have for now abstracted away from space and geometry: molecules are assumed to be floating in a uniform medium that lets domains react freely with each other. One could for instance encode a discrete compartment as info nodes attached to each domain and make sure they are compatible when two domains encounter. Yet, not only would this induce an explosion in the number of rules to write, but also entail a lot of book keeping rules in order to make sure that protein domains remain co-localized. We propose here to exploit our informal yet underlying relationship with bigraphs in order to add a simple notion of compartmentalization to our language.

Let V be an infinite set of parameter names {X, Y, Z, ... } assumed to be pairwise disjoint from S, B and M. Let C be a terminal symbol, distinct from previous ones. Terms P, Q,... of C2 are generated by the following extension of the grammar for C1:

where specB(T ) denotes the fact that term T describes a partial species, i.e. is either a connected component or a pattern that should be placed in a context that will make it connected. The sets B and S denote respectively the free backbone names

The idea behind C3 is that although connectivity, i.e. transitive closure of name sharing, is a property one may not want to consider in general, it becomes relevant for some particular interactions including diffusion. We will come back to this in the section describing the new generators.

The above proposition guarantees that one may always eliminate species nodes of the form specB(T ) from a mixture, provided the sets B and S capture the free names of T and provided T defines a single connected set of agents. Note however, that general global terms need not be mixtures and one may have occurrences of species node in rules that do not satisfy this condition as it is for instance the case in the diffusem generator. Yet not all species node make sense in a C3 expression.

The subscript on a site indicate its internal state. This is essentially a placeholder for a tag that serves to identify sites that have been chemically modified. Note that the absence of tag indicates that one does not care about its internal state in the expression.

