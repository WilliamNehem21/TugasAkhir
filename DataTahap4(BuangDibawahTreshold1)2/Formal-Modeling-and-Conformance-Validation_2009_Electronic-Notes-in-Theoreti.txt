Service-Oriented Computing (SOC) is an emerging paradigm for distributed com- puting and e-business processing. The aim of web service composition is to provide the mechanism to fulfill the complexity of the execution of business processes. Two different but overlapping viewpoints for the composition of web services are un- der investigation, namely orchestration and choreography. The former focuses on a single service, describing its interactions with other services as well as its internal actions. The latter is a multi-party contract that describes the external observable behavior across multiple participants from a global view [24,25]. Following the sec- ond approach, the overall activity is achieved by the composition of peer-to-peer

In this paper, we use Reo and Constraint Automata with State Memory (CASM) for modeling choreographies and conformance validation. Reo [5] is an exogenous coordination model wherein complex coordinators, called connectors, are compo- sitionally built out of simpler ones. Constraint automata [8] and its variations, e.g., CASM [6], are proposed as operational semantics for Reo. The advantage of Reo is that Reo circuits can be used for modeling both communication and coor- dination of web services [18,27,28]. In [28] we proposed a mapping from BPEL to Reo and CA (simple form of CASM). Regarding to this merit of Reo and our previous work [28], in this paper our goal is to build up a unified formalism for both choreography and orchestration, and use it for automatic analysis of confor- mance in choreography and orchestration. We present a slightly modified version

CASMchcompositionally. Then, we define end-point projection on CASMch which results in the behavior of a given party in a choreography in the form of CASM. Then we present the simulation relation in CASM and use it for conformance analysis of choreography and orchestration.

The structure of this paper is as follows: Section 2 contains a brief description of Reo and CASM. An overview of WS-CDL and our proposed model for WS- CDL components are provided in Section 3. The theory of addressing the end- point projection and the conformance problems are presented in Section 4, while its practical example appears in Section 5. Finally, the previous related works and our conclusions can be found in Sections 6 and 7, respectively.

A choreography can be recognized as a container for a collection of activities that may be performed by the participants. In our model, each participant is considered as a Reo component. In order to make the CASM proper for modeling activities, we impose a convention on its name set to include two parts: component name and port name instead of just one part, port name. On the other hand, in WS-CDL, variables which are used for holding information and values of states are uniquely identified

Formally, a complete WS-CDL model is described by a set of choreographies. A WS-CDL choreography description is essentially a container for a collection of ac- tivities that may be performed by one or more of the participants and consists of three parts: choreography life-line, choreography exception blocks and chore- ography finalizer blocks. The choreography life-line expresses the progression of a collaboration through enabled activities and enclosed choreographies. Activities describe the actions performed within a choreography. The basic building block of a choreography is the interaction activity which results in an exchange of informa- tion between participants while the control-flow among activities is described by ordering structures activities.

or abstract organization. A roleType enumerates potential observable behavior a participantType can exhibit in order to interact. A relationshipType identifies the mutual commitments that must be made for collaborations to be successful. In our model, participantTypes can be considered as components in a Reo circuit, a roleType is a group of ports which implements its observable behaviors (each behavior can be implemented by a port in components) and the relationship type will be the connections in Reo circuit which determine which components can interact with each other.

A channel realizes a point of collaboration between participantTypes by specifying where and how information is exchanged. Within WS-CDL, channels are abstractly modeled as channelTypes. As channels in WS-CDL may be one-way or two-way, and in Reo each channel can only have two ends, we modeled each WS-CDL one-way channel by a Sync channel in Reo and the WS-CDL two-way channel is modeled by combining two one-way channels.

Activities describe the actions performed within a choreography. Ordering struc- tures combine activities with other ordering structures in a nested structure to ex- press the ordering rules of actions performed within a choreography. In our model, each basic activity is modeled by a component whose behavior is specified by a CASMch. The ordering structures of activities (control flow activities) are mod- eled and visualized by Reo circuits coordinating the activities.

In order to investigate the conformance of a given party or orchestration to a chore- ography, end-point projection must be performed. In this operation, the desired behavior of a party (end-point process) is extracted from a choreography (global description). In our approach, each choreography can be modeled by a Reo circuit. In order to extract the behavioral interface of a choreography with respect to a certain participant, we shall hide all the nodes in the Reo circuit except the nodes of the desired component. Accordingly, the external behavior of a component can be extracted from the CA of a Reo circuit by applying the hide operation defined for CA. Therefore, as an advantage of our approach, we can use the already defined operator in our formal model, the hide operator, for end-point projection. After end-point projection, the conformance problem is reduced to comparison of the behavior of the given party (implementation) with the specification extracted by end-point projection. Again, the simulation relation defined for CA can be a satis- factory definition in this regard. Although, in comparison to CA, some changes in

According to [28] each orchestration described by BPEL can be specified by a Reo circuit and its corresponding CA. In our Reo circuit extracted from a BPEL code, we can also hide the internal behavior and only keep the observable behavior (abstract BPEL process). Since each CA can be considered as a special case of CASM, we can have the behavior of each orchestration in the form of a CASM. Thanks to this unified formalism, after end-point projection, the conformance problem is reduced to the examination of the CASM obtained by end-point projection and the CASM of the orchestration.

Intuitively, conformance is the capability of a web service to interact with the other peers according to a choreography. A web service will be conformant to a choreography if it complies to the choreography in all possible interactions [17]. This intuitive definition is not directly usable for automatic verification as there is no unique formal definition for conformance. Therefore, the relationships between choreography and behavioral interface (called abstract process in WS-BPEL) of

In CA, the input and output actions and also termination and deadlock states are not distinguished. On the other hand, as mentioned before, we abstract away from internal actions of a web service by hide operation and use abstract BPEL processes. After hiding, we have no information about the internal actions of web services and the casual relationship between messages. In our conformance definition, we assume a web service conforms to a choreography if every action allowed by the web service is

also allowed by the behavioral interfaces extracted from choreography by end-point projection, i.e. an orchestration that performs actions which are not foreseen and desired by the choreography, may disturb the communication of web services. Hence, there should be no action in the web service that is not foreseen by the choreography. This is obtained when in each state all possible actions of the web service (all possible transitions in the CASM that can be traversed) are a subset of the possible actions desired by the choreography. In other words, conformance is obtained when the satisfaction of the data constraints in each transition in each state of the web service implies the satisfaction of the data constraint of the corresponding transition in the CASM of the behavioral interface. This examination can be implemented by utilizing the predefined concept in ordinary CA [8], the simulation relation. But here, we need to customize the simulation definition of ordinary CA with respect to the notions in CASM. In the following, we define the simulation relation in CASM and show how to exploit that for conformance validation.

Now as an example, we consider bartering protocol used in [4,25] with some changes. In this system, the buyer repeatedly asks for a quote from seller until he agrees with the quote and places an order. For this purpose, a workunit is used in which there is a condition that governs the repetition, namely barteringDone = false and accept = false. For the sake of simplicity, instead of its WS-CDL code, its pseudo-code is shown in the following (a@R means variable a of Role R [4]):

Busi et al [15] design a simple choreography language CL whose main concepts are based on WS-CDL. This language covers a few constructs, nevertheless it offers a starting point for the design and analysis of choreography. Gorrieri and others [21] give a deep analysis of interaction patterns in the WS-CDL specification by taking into account the alignment property, whose meaning is related to the possibility to control when the interaction completes. The work in [29] proposes a small language, CDL, and its operational semantics as a formal model of simplified WS-CDL. Veri- fication of some properties are also presented in a choreography sample using SPIN model-checker. A more complete work on formal specification of WS-CDL can be found in [24] in which the semantics of WS-CDL is presented in terms of process algebra CSP.

the end-point projection operator on CASMch whose outcome is in the form of CASM. Regarding to our previous work in which the BPEL orchestration language is modeled by Reo and CA (the simplified form of CASM), both of the orchestration and end-point projected choreography can be presented with a unified formalism through which conformance problem is resolved by defining the simulation relation. The practical application of our work is illustrated in a bartering protocol.

