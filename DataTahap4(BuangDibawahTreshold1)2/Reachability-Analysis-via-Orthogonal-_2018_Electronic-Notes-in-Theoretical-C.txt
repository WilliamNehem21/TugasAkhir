We develop abstract interpretation tools to capture invariants about the biochemical structure of the bio- molecular species that may occur in a given model. In previous works, we have focused on the relationships between the states of the sites that belong to the same instance of a protein. This comes down to detect for a specific set of patterns, which ones may be reachable during the execution of the model.

Our classical pipeline to check the consistency of models consists in combining static analysis [9,13,15] and causality analysis [10,6]. Static analysis provides auto- matically and without executing the model, an over-approximation of its potential behaviour. When static analysis warns about an unexpected behaviour, causal anal- ysis can be used to check whether this is a true alarm and, if so, to understand its origin. Then, the modeller can update the model accordingly.

In previous works, we have used abstract interpretation [4,5] to formalise static analyses that can capture the relationships between the potential states of the sites that belong to a same instance of a protein [9,13]. In this paper, we generalise this approach to a broader family of abstract domains that we call orthogonal sets of patterns. Orthogonal sets of patterns can be obtained by refining recursively the information about a given pattern so as to partition the set of occurrences of a given protein in any mixture. We show that orthogonal sets of patterns offer a convenient choice to design scalable and accurate static analyses. As an example, we use them to infer properties in models with transport of molecules (more precisely, we show that each pair of proteins that are connected, always belong to the same compartment), and models involving double bindings (we show that whenever a protein of type A is bound twice to proteins of type B, then the protein A is necessarily bound twice to the same instance of the protein B).

The paper is organised as follows. In Sect. 2, we provide some case studies to illustrate the goal of our analysis. In Sect. 3, we recall the semantics of Kappa. In Sect. 4, we describe a generic abstraction of bio-molecular mixtures by the means of sets of patterns and we introduce the notion of orthogonal sets of patterns. In Sect. 5, we use orthogonal sets of patterns to abstract the set of reachable mixtures in Kappa models.

We describe the instances of these proteins graphically. Each protein of kind A is drawn as a square with its site r on the right. Each protein of kind B is drawn as a rectangle, with its site l on the left, its site r on the bottom right, and its site x on the top right. Each protein of kind C is drawn as an oval shape with its site l on the left. When the site x of a protein B is phosphorylated, we annotate it with a black smaller disk, otherwise, we annotate it with a white disk. Pairs of binding sites that are linked together are depicted thanks to an edge between these sites, whereas free sites are annotated with the symbol E. In a rule, it is also possible to specify that a site is bound without specifying its partner site, in such a case, we annotate the site with a dandling edge.

In this model, because the phosphorylation of a protein B blocks its potential dissociation from a protein A, any protein B that is phosphorylated is necessarily bound to a protein A. In the same way, because the binding between a protein B and a protein C blocks the potential dephosphorylation of this protein B , any protein B that is bound to a protein C is necessarily phosphorylated (and hence bound to a protein A). These are the properties of interest we would like to compute automatically from the model. We notice that views analysis [13,9] can capture these

Now we introduce another model to illustrate the kind of properties that may arise when proteins may be transported within a finite set of compartments. In this model, we consider two compartments: the cytoplasm and the nucleus. We also consider two kinds of protein D and E . The protein E is assumed to be a transport molecule. Its purpose is to grab a protein D in the cytoplasm, so as to take it into the nucleus. Each protein has two sites l and b . The site l is used to encode the location of the protein, whereas the site b is a binding site.

Each protein D is drawn as a rectangle. Its site l is depicted at the top right of the protein and its site b at the bottom right. Each protein E is drawn as an oval shape. Its site l is depicted at the top left of the protein and its site b at the bottom left. Furthermore, we annotate the site l of a protein with a white disk whenever this protein is in the cytoplasm, and with a black disk whenever this protein is in the nucleus.

In this model, we consider two kinds of protein F and G . Each protein has two binding sites x and y . Each protein F is drawn as a square with its site x at the top right and its site y at the bottom right. Each protein G is drawn as a square with its site x at the top left and its site y at the bottom left.

We notice that whenever both sites of a protein are bound, then they are neces- sarily bound to the same instance of a protein. This is the property of interest for this model. Our framework is able to capture it automatically.

In Exa. 3.4, it is worth noticing that in the site-graph H, the state of every site in every protein is fully defined. The site-graph is called a chemical mixture. This is not the case for the site-graph G, since not only the state of the site l of the protein B only partially specified, but also the site x is missing. The site-graph G is called a pattern.

When a site-graph G is transformed into another site-graph H, it is important to identify which agents of G correspond to which agents of H. Since some agents of G may disappear and some agents of H may be created during the transformation, we need to formalise a partial matching between the agents of the site-graphs G and H. This partial matching is described by the means of a span of embeddings. For the sake of generality, we define firstly the notion of weak partial embeddings.

(ii) ensures that when a site gets bound, we know to which site it is bound. The constraint (iii) ensures that the sites which occur both in the left hand side and in the right hand side of a rule, have a binding state in the left hand side of this rule if and only if they have a binding state in the right hand side of this rule. The constraint (iv) ensures that when an agent is created, the state of all its sites is defined.

In order to apply a rule in a specific context, we have to check whether it is possible to reach a mixture that contains an occurrence of the left hand side of the refinement of this rule, that specialises this rule to this particular context. This comes down to check whether a given pattern occurs in a reachable mixture. Thus, we propose to use our abstraction to answer to this question approximately.

It is worth noticing that the choice of the set P of the patterns of interest is crucial. It impacts the accuracy of our abstraction, that is to say our capability to express the fact that a given pattern is reachable, or not. But it also impacts the efficiency of our analysis: according to the set of patterns of interest, it may be more or less costly to compute whether the relation Y |=r P is satisfied for a given subset Y of patterns of interest and for a given pattern P . We address this issue by restricting the set of potential sets of patterns of interest, in order to provide them with a more convenient algebraic structure. We also approximate even further the computation of the relation |=r .

Finite orthogonal sets of patterns for a given agent A can be defined inductively. We start with the set that contains only the pair made of the site-graph A and the unique embedding from the site-graph A to itself. Then, an induction step, consists in refining a given pattern by considering any possibility for the state of an unspecified site. More precisely, we consider the following three kinds of orthogonal refinements:

Yet, the computation of this fix-point can be costly, or could even not terminate in case of polymerisation. Thus we are going to abstract this computation, by the means of a collection of orthogonal sets of patterns. Formally, we assume that we are given a set D of orthogonal sets of pattern for the agent type A. We denote

In this paper, we have developed an abstract interpretation static analysis to capture invariants about the biochemical structure of bio-molecular species that may be reachable in a given model. Our framework extends our previous works in local views [9,13]. Our analysis not only can infer relationships among the state of the sites of a same protein, but also it can detect relationships between the sites of several proteins of a given molecular species.

given agent according to some contextual information. Orthogonal sets of patterns offer a nice trade-off between accuracy, efficiency, and expressiveness. We have used them not only to reformulate our previous analysis for local views, but also to de- tect properties related to the transport of molecules and to the formation of double bonds between proteins. We have shown the scalability of our approach on two models in development.

