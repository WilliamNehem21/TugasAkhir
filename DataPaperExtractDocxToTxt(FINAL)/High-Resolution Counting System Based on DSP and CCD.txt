Available online at www.sciencedirect.com



AASRI Procedia 3 (2012) 501 – 507




2012 AASRI Conference on Modelling, Identification and Control
High-resolution Counting System based on DSP and CCD
Qi Xiao-guang,Sui Xiu-wu*,Li Da-peng
Tianjin Key Laboratory of Advanced Mechatronics Equipment Technology, School of Mechanical Engineering,Tianjin Polytechnic University,
	Tianjin,China	

Abstract

This paper presents a high-resolution CCD counting system based on the Texas Instruments (TI) TMS320VC5509 Digital Signal Processor (DSP). The counting system is used in pharmaceutical packaging machinery. The major advantage of the system is high in counting speed , stable and reliable in performance. The counting system meets the requirements of speed and precision for pharmaceutical packaging machinery.


© 2012 The Authors. Published by Elsevier B.V.
Open access under CC BY-NC-ND license.

Selection and/or peer review under responsibility of American Applied Science Research Institute

Key words:Counting System,TMS320VC5509,TCD1209D,EMP3064A;


Introduction

In order to meet the requirements of speed and precision for pharmaceutical packaging machinery, the counting system of electronic counting-machine is designed based on DSP and linear CCD sensors [1]. Compare with the old system, the system resolution is higher; counting speed is faster, filling accuracy is much higher. Meanwhile, the system can detect tablets size and adhesion, then picks out the medicine bottle filled with crushing-pills. The counting system makes electronic counting-machine is much more efficient.





*SUI Xiu-wu. Tel.: +1-392-035-1685.
E-mail address: allensui@163.com. QI Xiao-guang.Tel.:+1-890-207-5875
E-mail address: qixiaoguang629@163.com






2212-6716 © 2012 The Authors. Published by Elsevier B.V. Open access under CC BY-NC-ND license.
Selection and/or peer review under responsibility of American Applied Science Research Institute doi:10.1016/j.aasri.2012.11.079


Design of system

Fig.1 shows the functional blocks in the Counting System. As is shown in Figure 1, through the lens, the light shoots at the CCD sensor, and immediately the sensor converts the light into electric charge and processes it into electronic signals. When pills fills down through the detection channel, the light intensity in the detection channel will be weakened, and then the electronic signals from the CCD sensor will be changed. The Light source provides the system with stable light intensity. Through the detecting space, the pills image on photo surface of CCD sensor. TLC2543 takes the analog signal , processed by the CCD sensor, conversion for digital signal and the digital signal will be sent to the First In First Out FIFO  memory for the frequency matching factor between the ADC(TLC5510) and DSP(TMS320VC5509).The ADC and the FIFO data-in operation are also driven by the timing generator.


Light Source
Detection Channel

Lens


CCD








Fig. 1.Block diagram of counting system

The TMS320VC5509 gets the commands from the HMI(Human Machine Interface), and it not only provides the timing signal to the ADC and FIFO, but also sets the counting mode of the system. In the meantime, the timing generator provide timing signal for CCD sensor. The DSP continually reads out the image data from the FIFO by the half-full flag of FIFO until all of the data from detection channel sent to the synchronous dynamic random access memory(SDRAM) by itself. After a series of data processing, the DSP send the processing results to the HMI. The touch screen (Human Machine Interface) show the results and save the results to SD card automatically.

Optical system

However, on order to improve the system reliability, a reliable optical system is the key factors. In this step, the system coverts light into electronic.

Design of Optical circuit

The Toshiba TCD1209D is used as a sensor of the counting system. The device contains a row of 2048 elements photodiodes, and the Image Sensing Element Size is 14  m [2]. The Imaging length is:



L  2048
 0.014
28.672 mm
(1)


As is shown in Fig. 2, the detection distance is 400mm.So the counting system will be divided into two parts of CCD, and a single CCD optical circuit schematic diagram is shown in Fig.2.
Work Distance  Back focal plane Distance











Fig. 2.Single CCD optical circuit schematic diagram

The magnification of the single CCD optical circuit is defined as MD[3].

(2)


In equation 2, the letters are defined as follows,u: the object distance or the work distance(WD); v: the image distance; L: the imaging length; FOV: the field of view;
If the image distance is 18mm, working distance:


WD  u  v M
18
0.1436

125 .35 mm
(3)



As is shown in type (4), the focal length can be calculated:

WD



125



. 35


(4)

F
(1	1  )
MD


(1	1	)
0 . 1436
15 . 7 mm


In equation 4, the letters are defined as follows, F: the focal length;WD: the work distance;MD: the magnification;
According to results of the equation 4, the focal length is 16mm.


Timing Generator


Fig. 3(a)Output sequence of timing generator ;(b)Block diagram of the data acquisition

The Altera EMP3064A is used as the timing generator of the counting system. EMP3064A is a CPLD chip with 64 micro-cells, 1250 usable gates and 66 user I/O pins.Line timing(SH),driving timing(  1and  2), reset pulse timing(RS), buffering timing(CP) are all generated by the EMP3064A chip, furthermore, EMP3064A receive the synchronous signal from DSP[5][6]. The output sequence of timing Generator is shown in Fig.3(a).

Data acquisition

The CCD sensor converts the light into electric charge and processes it into analog signal. However the analog signal must be transformed into the digital signal so that it can be recognized and used by DSP. The Texas Instruments (TI) TLC5510 is used as the ADC. The TLC5510 is CMOS.8-bit, 20 MSPS analog-to- digital converters that utilize a semi-flash architecture [4].ALL422B is used as the FIFO, that consists of 3M- bits of DRAM, and is configured as 393,216 words. The signals were stored and then transmitted to RAM of DSP. The ADC and FIFO receive synchronous sequential signal which come from DSP. The block diagram of Data acquisition is shown in Fig.3(b)

Data Processing

The Texas Instruments (TI) TMS320VC5509A is used as MCU. The TMS320VC5509A of fixed-point digital signal processor (DSP) is based on the TMS320C55x DSP generation CPU processor core. With performance of 8000 million instructions per second (MIPS) at a clock rate of 200MHz, the C55x devices offer cost-effective solutions to high-performance DSP programming challenges. The block diagram of DSP module is shown in Fig.4(a)

Drop Pills


Scanning line


Fig.4(a)Block deagram of DSP module;(b) CCD detection schematic diagram


As is shown in Fig.4(b), the DSP module determines the integrity of the pills, through the judgment x and y sizes.
From the edge of the jolting table dropped the pills at same speed of horizontal velocity. Through the type 5 and 6,when the pill down to detection channel, the speed(  ) and time ( t ) can be calculated.

t	(5)


v  gt
(6)



The calculated results is: t
 0.143s
v  1.4m / s

As is shown in Fig. 4(b), the time which one of diameter 9 mm thickness of 4.5 mm pills goes through the detection channel is defined as t1. The falling height is defined as  . The equation 7 indicate the relationship of t1 and  .


	1 gt 2  vt


(7)

2	1	1

The solutions of equation 7 is:t1=6.4ms.
The scanning time which is the CCD sensor scans 2048-pixels is defined as t0.

t 0 =2048  1/10M Hz=2.048  10-4s	(8)

From above we can know, when the pill goes though the detection channel, it will be scanned n ' times and the n ' is:


n '  t1   3 1
t 0

(9)


As is shown in Fig. 5, the pulse width tells the x-size (use as "x" ).

x	B  0.014
M	(10)

In equation 10, the variables are defined as follows:
B: the pulse width; M: the magnification




Figure.5. CCD output signal

The y-size(use as "y") can be told by the number of CCD sensor scanning. y is the calculation of equation 11.
y	1 g[(n '1)t ]2  v(n '1)t

2	0	0
(11)


In equation 11, the variables are defined as follows. n ' : scanning time, t0 : the line scanning time of CCD

sensor, g : the gravitational acceleration, g=9.8m/s2  : v
1 . 4 m / s

The DSP judges whether the pill is fracture or not,and marks the bottle through comparing x, y and data coming from HMI.

Human Machine Interface

The Weinview MT506TV is used as a Human machine interface(HMI) of the counting system. The interface of man-machine communication based on the Modbus protocol .The design of interface is shown in Fig.6.

Fig.6. Design of HMI

Conclusion

The counting system is installed in the electronic counting-machine, which runs to 48 hours long, its counting speed up to 10000~12000 tablets per minute. The system error can be dropped below 4.67%. The counting system can meet the demands in practice.
Experiments show that the system is high in counting speed, stable and reliable in performance.


Acknowledgements

We would like to express our gratitude to Mr.Wang.With his help,we are possible to get much information about the CCDs and enough funds to perform the experiment.


References
Lian Lu, The present situation of American packaging industry and the difference in china, Chinese Packaging Engineering, 2005 26(3)  15 -- 16
TOSHIBA Corp. TCD1209D datasheet[S]. 1999
Wang Qingyou, The technology of the CCD application [M], Tianjin: Tianjin university Press, 2000 [4]TLC5510,TLC5510A 8-BIT HIGH-SPEED ANALOG-TO-DIGITAL CONVERTERS,
Texas Instruments,Inc.,MAY.1999.
Dou Jianhua, Wang Ying, Li Changkai, et al, Design of linear array CCD data acquisition system based on CPLD and DSP, Journal of Hefei University of Technology, 2010 33(5):690-693
Xiang Dapeng, YangJiang Yang Jian, Design of Driving Time Sequence Circuit of Linear Array CCD Based on CPLD, Journal of Geodesy and Geodynamics, 2010,30 2   123-125.
