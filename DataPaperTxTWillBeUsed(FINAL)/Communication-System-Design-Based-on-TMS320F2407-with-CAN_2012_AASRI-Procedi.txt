Available online at www.sciencedirect.com



AASRI Procedia 3 (2012) 463 – 467




2012 AASRI Conference on Modeling, Identification and Control
Communication System Design Based on TMS320F2407 with CAN Bus
Guang Liua, Ai-ping Xiaoa*, Hua Qiana,
aSchool of Technology, Beijing Forestry University, Beijing 100083, China




Abstract

In order to keep the communication fast and stable between a variety of control modules, the CAN bus communication system was designed in this paper. CAN bus communication system was designed as follow: the eCAN module of DSP chip TMS320F2407 was applied as CAN controller and the chip SN65HVD230 was applied as CAN transceiver, a variety of control modules was linked by the bus. For illustration, the chassis communication of a security robot is utilized to show how the CAN bus works. Empirical results show that the chassis communication of robot security is fast and stable with CAN bus. The CAN bus communication system designed in this paper can solve the unstable problem in the communication between control modules; it can be promoted to other control system.
© 2012 The Authors. Published by Elsevier B.V. Open access under CC BY-NC-ND license.
Selection and/or peer review under responsibility of American Applied Science Research Institute

Keywords: TMS320F2407;CAN Bus; eCAN control module.


Introduction

The definitions of man-machine interaction are extensive. Simply stated, it is a very important technology All The Controller Area Network (CAN) is a serial communications protocol which efficiently supports distributed realtime control with a very high level of security. Its domain of application ranges from high speed networks to low cost multiplex wiring. In automotive electronics, engine control units, sensors, anti- skid-systems, etc. are connected using CAN with bitrates up to 1Mbit/s. At the same time it is cost effective to

* Corresponding author: Ai-ping Xiao. Tel.: +1-352-293-0446.
E-mail address: xxaapp@sina.com.






2212-6716 © 2012 The Authors. Published by Elsevier B.V. Open access under CC BY-NC-ND license. Selection and/or peer review under responsibility of American Applied Science Research Institute doi:10.1016/j.aasri.2012.11.073


build into vehicle body electronics, e.g. lamp clusters, electric windows etc. to replace the wiring harness otherwise required [1].
One of the biggest CAN protocol characteristic is the abolishment of traditional stand address coding, instead of to communication data block coding. The advantages of this method can make the number of the nodes in the network in theory unlimited, the identification of the data block code can set by 11 or 29 of a binary number, so can be defined 211 or 229 different data block. In this way, it still can make different nodes to transmit and receive the same data, which is very useful in distributed control system. The data length for a maximum of 8 bytes, can meet usually in the field of industrial control command, working status and test data of general requirement. At the same time, 8 bytes will not take bus time too long, so as to ensure the real-time communication.
Two complementary values Dominant and Recessive mean logic 0 and 1 in CAN bus. When a dominant and a recessive sent at the same time, bus value will appear dominant, as the following figure 1 shows.

Fig. 1.Bus value

A data frame is composed of seven different bit fields: START OF FRAME, ARBITRATION FIELD, CONTROL FIELD, DATA FIELD, CRC FIELD, ACK FIELD, END OF FRAME, as the following figure 2
shows. The DATA FIELD can be of length zero.

Fig. 2. component of a data frame

Can Bus Communication Hardware Design

ECAN module is enhanced CAN controller of TMS320F2407DSP, its performance compared to the existing DSP embedded controller CAN has large improvement, with data transmission more agile and convenient, more data, higher reliability and more complete function [2]. With a large number of promotion of TMS320F2407 use, eCAN based on the CAN bus communication mode will be widely used. ECAN module


is a new generation of 16 bits senior CAN controller from TI Company, it is fully compatible with CAN2.0 B agreement, while it can work in the interference environment using the above protocol in serial communication with other controllers.
According to the convenience and practicability of the eCAN module embedded in TMS320F2407, this article using the TMS320F2407 micro controller composes a CAN bus network, sending and receiving data in real time. Hardware system is divided into two layers: the first CAN
bus and F2407 interface layer to realize the CAN bus and F2407 physical interface; The second layer, DSP information processing with peripheral devices, F2407 is a new industrial control chip applied in control field, integrated digital I/O, EV (event manager), A/D(analog-to-digital conversion), SPI (serial peripherals interface), SCI (asynchronous serial communication interface), eCAN controller etc. Following Introduce the CAN bus and F2407 interface circuit. The CAN bus communication system shows in figure3.
 
Fig. 3. CAN bus communication system schemes.

SN65HVD230 is a interface driving CAN controller and physical between the bus, it provides the differential send and receive function. Hardware principle is as shown in figure 4 shows. Because SN65HVD230 is supplied with 3.3V power and F2407 is also supplied with 3.3V power, it can be directly connected, which simplifies the circuit [3].


Fig. 4. CAN bus and DSP2407 interface circuit diagram.

Application: Can Bus in the the Security Robot

With the rapid development of the robot, robot applied in security is increasing. Security robot applies in some large security meetings and related units, responsible for important occasions security work. A kind of security robots has travel mechanism with wheel structure, the movement of the drive wheels was driven by two sets of servo motor, while Communication Design of the drive wheels control system is CAN bus. There are two nodes in CAN bus, Connected to a motor drive respectively. Motor drive connected servo motor


while Servos motor and wheels were linked. Control signals from the control unit (TMS320F2407) through the CAN bus, will go to motor drive, at the same time and the related state signal of motor drive is sent to control unit through the CAN bus. The block diagram of control system of is shown in figure5.

Fig. 5. The block diagram of control system applied in the security robot.

Empirical results show that the left wheel and right wheel react intelligent and move quickly, the chassis communication of robot security is fast and stable with CAN bus.

Discuss: why can bus is fast and steady

CAN is high effective because the bus is used only by those pending stand who requests bus, the request is processed according to the importance of the message in the whole system. This method has many advantages in the network with heavy load, because the priority of read order has been put in every message, which can guarantee the lower individual concealed time in real-time systems.
The follow CAN protocol characterizes guarantee the communication between a variety of control modules fast and steady.
Communication Distance and Bit Rate
The bit rate can be as fast as 1000kbps when the distance of communication system is within 40 meters [4]. Most of the distance of communication system is shorter than 40 meters, so it is very fast to transmit information by CAN bus.
Arbitration
CAN bus uses the more master competitive type bus structure, it has the more master operation, scattered arbitration serial bus and radio communication features. In CAN bus any node at any moment can be active on the network to send information to other nodes without primary and secondary, so it realize the free communication between each node.
Whenever the bus is free, any unit may start to transmit a message. If 2 or more units start transmitting messages at the same time, the bus access conflict is resolved by bitwise arbitration using the IDENTIFIER; while a minimum of a binary number identifier has the highest priority. The mechanism of arbitration guarantees that neither information nor time is lost. When a ’recessive’ level is sent and a ’dominant’ level is monitored (see Bus Values), the unit has lost arbitration and must withdraw without sending one more bit.
CRC Sequence
The frame check sequence is derived from a cyclic redundancy code best suited for frames with bit counts less than 127 bits (BCH Code). In order to carry out the CRC calculation the polynomial to be divided is defined as the polynomial, the coefficients of which are given by the destuffed bit stream consisting of START OF FRAME, ARBITRATION FIELD, CONTROL FIELD, DATA FIELD (if present), for the 15
lowest coefficients, by 0 [5].
So if the received message does not match the transmitted message exactly, the CRC code will point out


a error. CAN protocol adopts the CRC inspection and provides the corresponding error handling function, which guarantees the reliability of the data communication.

Conclusions

ECAN module embedded TMS320F2407 make the hardware circuit design simple and reliable. The CAN bus communication system designed in this paper is high effective and steady, it makes the security robot chassis works perfect.
With excellent characteristics, extreme reliability and unique design, CAN protocol is especially suitable for industrial process monitoring equipment of the interconnections, and has been recognized as one of the most promising field bus.


Acknowledgment

This subject is funded by state forestry administration 948 item.
This full name of this foundation item is state forestry administration introduced advanced forestry science and technology project "Critical technology introduction of Flotation Column recycling fiber from deinking pulp":Number:2009-4-57.


References
[1]CAN specification V2.0, BOSCH Company, pp. 5–10
[2]M.A. Su Kuifeng and lv Qiang, “principle of TMS320F2407DSP and C program development”, Beijing aerospace university press, pp. 15–23.
Kui Xianhui, The fieldbus technology and its application, Tsinghua University Press, pp. 105–131.
CANopen Programmer’s Manual  Copley Controls Corporation, pp. 33–34.
CiA301 – CANopen application layer and communication profile, pp. 43–47.
