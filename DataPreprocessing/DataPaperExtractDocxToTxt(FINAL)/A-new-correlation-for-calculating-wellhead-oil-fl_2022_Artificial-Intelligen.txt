Artificial Intelligence in Geosciences 3 (2022) 1–7

		




A new correlation for calculating wellhead oil flow rate using artificial neural network
Reda Abdel Azim
American University of Kurdistan, Petroleum Engineering Department, Iraq



A B S T R A C T

A separator and multiphase flow meters are considered the most accurate tools used to measure the surface oil flow rates. However, these tools are expensive and time consuming. Thus, this study aims to develop a correlation for accurate and quick evaluation of well surface flow rates and consequently the well inflow performance relationship. In order to achieve the abovementioned aim, this study uses artificial neural network (ANN) for flow rates prediction particularly in artificial lifted wells especially in the absence of wellhead pressure data. The ANN model is developed and validated by utilizing 350 data points collected from numerous fields located in Nile Delta and Western Desert of Egypt with inputs include; wellhead temperature, gas liquid ratio, water cut, surface and bottomhole temperatures, water cut, surface production rates, tubing cross section area, and well depth. The results of this study show that, the collected data are distributed as follows; 60% for training, 30% for testing and 10% for the validation processes with R2 of 0.96 and mean square error (MSE) of 0.02. A comparison study is implemented between the new ANN correlation and other published correlations (Gilbert, Ros and Achong correlations) to show the robustness of the developed correlation. The results show that the developed correlation able to predict oil flow rates accurately with the lowest mean square error.



Introduction

The most widely used correlations for wellhead rate estimation are presented by Gilbert (1954); Ros (1960); Achong (1961); and Al-Attar and Abdul-Majeed, (1988) for multiphase flow across wellhead choke and critical flow. Gilbert's correlation is valid only when the upstream pressure greater than downstream pressure by at least 70%. The corre- lation is given by:
around 210 wells in Iraq. The data include gas-liquid ratio, upstream/- downstream pressures, chock size, production rates and API oil gravity. The author performed a sensitivity analysis to select the best correlation for rate estimation. The results show that the Gilbert's correlation yielded a relative accurate prediction of the wellhead rates while Achong's cor- relation underestimated the production rates. Economides et al. (2011) mentioned that the theory of multi-phase fluid flow through choke is not clearly described. Ghareeb and Shedid (2007) proposed a study to
develop a new correlation for artificially lifted wells to predict surface

Pwh ¼
CRmQ	(1)
Sn
flow rates using the least square method technique. While, Rasoul (2012) proposed mathematical correlation used to calculate wellbore flow

where;
Pwh is the wellhead pressure (psia), S is the choke size (1/64 inch), R is the gas–liquid ratio (SCF/STB), and, Q is the liquid critical-flow rate (STBD).
C, m and C ¼ n are the coefficients calculated based on sufficient data
available for specific reservoir. A ¼ 0.1, B ¼ 1.89 and C ¼ 0.546.
Following Ros [2] and Achong [3] modified the coefficient of Gilbert's correlation as follows;
temperature. Khorzoughi (2013) presented a multiphase flow chock correlation using non-linear optimization technique and Monto Carlo simulation. Seidi and Sayahi (2015) combined a genetic algorithm with non-linear regression analysis to predict the sub-critical flow through wellhead chokes.
Although the pressure measured at the wellhead is considered one of the main parameter that used to predict the wellhead flow rates in several choke correlations, however, this parameter disappears for artificially lifted wells. This due to the absence of critical flow condition and choke is

Pwh ¼
CRmQ	(2)
Sn
either disconnected or fully opened during the oil lifting process. Therefore, the main aim of this study is to develop a correlation that heavily based on the wellhead temperature (Th) to eliminate the effect of

where C ¼ 0.05, m ¼ 1.88 and n ¼ 0.65.
Al-Attar and Abdul-Majeed, (1988) collected wellhead data from
unavailable wellhead pressure data. The proposed correlation in this study is function of gas-oil ratio (GOR), surface temperature (Ts), water


E-mail address: reda.abdulrasoul@auk.edu.krd. https://doi.org/10.1016/j.aiig.2022.04.001
Received 23 January 2022; Received in revised form 24 April 2022; Accepted 24 April 2022
Available online 4 May 2022
2666-5441/© 2022 The Authors. Publishing Services by Elsevier B.V. on behalf of KeAi Communications Co. Ltd. This is an open access article under the CC BY-NC-ND license (http://creativecommons.org/licenses/by-nc-nd/4.0/).



cut (WC), surface production rate (Q), bottom hole temperature (T tubing cross section area (A), and well depth (H) as follows;
bh),
S = X xiwi

(5)


Ql = f (Th; Q; WC; GOR; Tbh;A; H)	(3)
Around 350 data points are collected from numerous wells drilled in Egypt. The wells are artificially lifted using gas lift or sucker rod pumps. The artificial neural network technique (ANN) is used in this study to achieve that goal.

Artificial neural network

The artificial neural network is widely used in petroleum engineering applications includes diagnosis of the drill bit (Arehart 1989), well test interpretation (Al-Kaabi et al., 1993), spatial property mapping (Veez- hinathan et al., 1992), wireline log analysis (Rogers et al., 1992), and identification of well productivity (Garcia et al., 1992). The neural network can be trained by supervised and unsupervised training algo- rithms. Supervised learning algorithm as back propagation (Rumelhart et al., 1986 and Lippmann 1987) requires training data with the desired outcome for each pattern of input. Unsupervised learning algorithm (Hopfield 1992) is suitable for classification problems. A simple flow chart is presented to describe how the supervised learning algorithm works (see Fig. 1). The neural net consists of three layers include input, hidden and output layers. The number of hidden layers should be a positive number including zero. If none of the hidden layer used in the network, the network calls simple perceptron that suitable for classifi- cation linearly patterns (Morgan et al., 1989). If the network contains one or more hidden layers, it calls multiple perceptron and can be used for nonlinear separable patterns. Each layer in the neural net contains pro- cessing elements called neurons. Each neuron in the input layer trans- ports into the network the value of one independent variable, and no mathematical operations are performed. Entirely, neurons are connected together with the hidden layer by a simple weighted link. Each link has a weight either positive or negative. Each of the output layer neurons receive signals from hidden neurons and provides a similar weighted response (see Fig. 2).
The tan sigmoid function is the most commonly used in the neural network to constrain the output values to a range of 0 and 1 (Mahmoodi et al., 2016). The function is expressed by:
i=0

where n is the dimensions of the input vector X (x0, x1, …, xn), and W (w0,w1, …,wn) is corresponding weight vector. Note that w0 is the weight for the bias input x0 (which is equal to one).
There are two process in the neural net, forward and backward propagation steps. In the forward step, signals are sent through neurons to calculate the output targets while backward step is used to calculate the error vector between actual and target values. The error value at the output neurons for a training pattern can be defined by a quadratic cost function:

1	2


p	p	p
1

where E is the error vector for the training pattern p.
In this study, the back propagation algorithm is used. This is due to the strength shown by the algorithm in learning and generalizing large variety of relationship embedded in the training data set. The algorithm does not require prior mathematical knowledge that maps the input patterns to the output patterns. In addition, the flexibility of the back propagation algorithm in choosing number of hidden layers, in- terconnections, neurons, the learning and momentum constants is wide.

Application of ANN in predicting surface production rates

The previous researches regarding the application of the ANN in predicting the wellhead surface rates are presented in Table 1. The conclusion is the literature does not provide a single physical equation that can be used to predict surface oil rates for specific fields using ANN. Therefore, this study aims to clarify the black box concept of the ANN and to present a new correlation to combine wellbore and fluid parameters to predict surface oil rates for wells located in Egypt.
Zhong-bao et al., (2011) proposed a neural network model that based on the back propagation learning algorithm to predict surface oil rates. The neural network consists of one hidden layer and 10 neurons. The input neurons include the wells number, the coordinates of the wells, the cumulative production, the derivative of cumulative production, the shut-in time, the average distance to surrounding wells, average cumu-

  1 
)= 1 + e—s
where S is expressed as:
























Fig. 1. Architecture of the ANN model.
(4)
lative production of surrounding wells, and the cumulative production days. The output layer contains one neuron representing the cumulative production at time t+1. The results indicate that the model can predict the flow rate for short term of flow.
Elmabrouk et al. (2010) established a neural network model to pre- dict the reservoir average pressure without shut the wells. Elshafiei et al. (2011) presented a neural network model to predict the crude oil pro- duction rates from multi stage oil separators. The model is based on in- puts that include initial, final temperature for each stage and oil composition.

Data processing

Around 350 measured points are collected from numerous fields in Egypt include: Bakr, Meliha, Lotus, Aman, and Wadi El Sahl fields. The data include; the gas-oil ratio (GOR), water cut (WC), surface production rate (Q), bottom hole temperature (Tbh), tubing cross section area (A), and well depth (H). In advance, the data are pre-processed and its quality has been tested to avoid peculiar answers. In order to improve the per- formance of the neural network model, the dataset is subdivided randomly into 60% for training, 30% for testing, while validation dataset is 10% of the total collected data. Table 2 shows the statistical analysis of the input data. Numerous scenarios are performed to test the effect of each input parameter on the outputs. Therefore, the input parameters are removed one by one while others are kept constant. The surface




Fig. 2. Schematic representation of the neural network.


Table 1
Some applications of machine learning used to predict surface oil production rate.
Author and year	Field	Machine learning method	Input variables	R2	Reported error

Gorjaei et al. (2015) [20]
Oil field	Least squares support vector machine-
Choke size (D), Wellhead pressure (Pwh), Gas liquid ratio (GLR)	0.976	ARE = 0.80 &
AARE = 7.99

AlAjmi et al. (2015) [21]
Oil field	fuzzy logic	Choke size (D), Wellhead pressure (Pwh), Gas liquid ratio (GLR)	0.94	RMSE = 1392

Hasanvand and Berneti (2015) [22]
Oil field	Artificial neural network (ANN)
Choke size (D), Wellhead pressure (Pwh), Gas liquid ratio (GLR),W=Water cut (WC)
0.96	RMSE = 1254

Choubineh et al. (2017) [23]
Gas condensate
field
Artificial neural network (ANN)
Choke size (D), Wellhead pressure (Pwh), Oil specific gravity, Gas specific gravity, Gas liquid ratio (GLR), Temperature (T)
0.947	RMSE = 1227 &
AARE = 14.85

Ghorbani et al. (2019) [24]
Khamis et al. (2020) [25]
Oil field	Genetic Algorithm (GA) &
Excel solver optimizer
Oil field	Artificial neural network (ANN) Fuzzy logic (FL)
Liquid flow rate (QL) Wellhead press. (Pwh) Gas liquid ratio (GLR) Choke     size     (D)     Water     cu Upstream press. (Pup) Gas liquid ratio (GLR) Choke size (D) Temperature (T)
0.997	RMSE = 562.52 &
AAPD = 7.33
0.84

Azim (2020) [26, 27]	Oil field	Artificial neural network
(ANN)
Pump upstream/downstream pressures, Pump intake/discharge pressures, Temperature intake/discharge, Wellhead pressure, Choke size, WC, GOR
0.99	RMSE = 0.023




Table 2
Statistics analysis of the input data.

temperature is the first then water cut, gas liquid ratio, bottom-hole	temperature followed by depth and tubing size. Table 3 summarizes
the sensitivity runs with mean square error (MSE) and R2 value to assess the accuracy of each run. The results show that surface measured tem-

Table 3
MSE and R2 as a function of input data parameters for the neural network.


Parameters	R2	MSE
perature has a significant effect on the predicted surface flow rates.
The optimum architecture of the neural network is achieved by trial and error approach, in which the optimum number of the hidden layer is one with 10 neurons. The neurons in the hidden and output layers are activated with the logistic function and Levenberg Marquardt (More, 1978) algorithm that provides the back error propagation with the lowest mean square-error (MSE).


Results and discussion	The extracted correlation is given as:


A total of 350 data points are used in the neural net, in which 60% for training, 30% for testing, while validation dataset is 10%. Results in this study show a reasonable match between the predicted and measured data as shown in Fig. 3. This exceptional match based on the back propagation
learning algorithm that used in the ANN model. The back propagation

Qon =

N

i=1

J
w2itansig
J=1
w1i;jxj + b1j !#

+ b2	(7)

learning algorithm (BP) is selected in this study with sigmoid function
"XN		1	!#




(SCG) and one-step secant (OSS) algorithms. A 500 epches (iterations) is used to get the minimum error which confirms the effectiveness of convergence technique used with the ANN model. This section will test

+b2
i=1
+exp


(8)

the robustness of the designed neural network. Fig. 3 shows a comparison between the network surface oil rates versus measured oil rates at the
wellhead during the training and testing processes. The results show that the network gives R2 of 0.963 with MSE = 0.02 for the training. It can be seen that from Fig. 3 that the results are in a close agreement with the
actual flow rates. In addition, same procedure is followed for testing process, the results show that the optimum R2 of 0.94 found with using 10 neurons with MSE = 0.0325.
It can be seen form these encouraging outcomes in this study, a mathematical correlation can be extracted to calculate the surface oil rates at wellheads as a function of wellbore parameters that has been mentioned before. The correlation is based on weights and biases and their values are given in Table 4.

Fig. 3. Actual Qo versus targets using testing data (a) and for training data (b).
where Qon is the normalized surface oil flow rate, (w2, i) is the weight vector connect the hidden layer with output layer. (w1, j) is the weight vector connect the input and the hidden layer, j is the neuron number, b1 is the biases vector for the input layer, and b2 for the output layer, for- mation depth (H), water cut (WC), surface temperature (Ts), bottom hole temperature (Tbh), tubing cross section area (A) and, gas liquid ratio (GLR).
The extracted Qo equation can be attained by de-normalizing Qo as follows:
Qo = 1203 × Qon + 80	(9)

Validation of the ANN model

To validate the designed artificial neural network, a new dataset is collected from west Bakr reservoir in Egypt. This dataset never used during the training and testing of the ANN model. The generated corre- lation in this study (see Eqs (8) and (9)) used to predict the oil rates at the wellhead, and then the results are compared with published correlations include Gilbert, Ros, and Achonhg correlations. Fig. 4 shows the recorded wellhead head temperature and GLR versus the well depth for the tested wells. As it can be seen from Fig. 4 that the wells exhibit a severe fluc- tuation in the measured temperature and GLR. The existing fluctuation scheme complicates the prediction of the oil rates at surface using traditional correlations specially with the disappearing of recorded daily well events.
The results show that this study developed a new correlation able to predict the oil flow rate with R2 of 0.93 as shown in Fig. 5. In addition, Fig. 6 shows a comparison between actual and predicted flow rates for the dataset used in validation operation. A good match is achieved at different depths. Statistically, the ANN model presented in this study is reliable based on the calculated MSE between actual and predicted oil rates. Base on the results, ANN correlation gives the lowest MSE with
0.02 compared to Gilbert, Ros, and Achonhg correlations as shown in Fig. 7.

Conclusion

The results of this study shows a robustness of the presented ANN model used to predict the oil flow rates for artificially lifted wells based on recorded surface temperature in the absence of wellhead pressures with accuracy exceeds 96% compared to well-known cor-
relations (Gilbert, Ros, and Achong correlation with MSE = 0.02.
Based on the outcome of this study, a new correlation is extracted based on proposed ANN that can be used for wells located in Nile Delta and Western Desert parts of Egypt.
The ANN model in this study use back propagation learning algorithm which provides the optimum results in terms of lowest MSE and highest R2 values.
A comparison is carried out in this study, shows that the well-known correlations have deficiencies in predicting oil rates at the wellhead, those correlations are the most widely used in predicting oil rates. Therefore, this study anticipated a solution for companies in Egypt to


Table 4
Weights and biases for the generated correlation Eq. (8).

Neuron
Input and hidden layers weights (w1)	Hidden and output layers
Hidden layer bias
Output layer bias




Fig. 4. Recorded wellhead temperature and GLR for wells used in validation process.



Fig. 5. The R2 of 0.93 for the validation process between actual and target
flow rate.


Fig. 7. MSE for the ANN correlation, Gilbert, Ros, and Aching correlations.





Fig. 6. Comparison between the actual and target flow rate for the validation process.



predict precisely the oil flow rates and construct precise Inflow Per- formance Relationship (IPR) curve consequently.

The authors declare that they have no any conflict of interest

This paper presents a reliable ANN model to predict surface flow
rate for oil production wells using measured wellhead temperature
A mathematical equation is extracted out of the ANN model.



Appendix

Statistical Error Analysis

The accuracy of the developed ANN model and correlation relative to experimental data is tested by carious statistical indices include standard deviation (SD) and the correlation coefficient (r2).

Standard Deviation (SD)

The standard deviation is an important factor that indicates the degree of scattering. The lower SD value means indicates high correlation accuracy and small degree of data scattering. The standard deviation is defined by:

2   1
 Xn	2




The Correlation Coefficient

It represents the degree of reducing the standard deviation by regression analysis and is defined by:
Pn  xexp xest 2

where, xbar represents the average of the experimental data points and the correlation coefficient lies between 0 and 1.

Appendix A. Supplementary data

Supplementary data to this article can be found online at https://doi.org/10.1016/j.aiig.2022.04.001.


References

Achong, I., 1961. Revised Bean Performance Formula for Lake Maracaibo Wells, Internal Report. Shell Oil Co., Houston, TX.
Al-Attar, H.H., Abdul-Majeed, G.H., 1988. Revised bean performance equation for East Baghdad oil wells. SPE Production Engineering 3 (01), 127–131.
Al-Kaabi, A.U., Lee, W.J., 1993. Using artificial neural networks to identify the well test interpretation model (includes associated papers 28151 and 28165). SPE Form. Eval. 8 (3), 233–240.
AlAjmi, M.D., Alarifi, S.A., Mahsoon, A.H., 2015, March. Improving multiphase choke performance prediction and well production test validation using artificial intelligence: a new milestone. In: SPE Digital Energy Conference and Exhibition. OnePetro.
Arehart, R.A., 1989. Drill bit diagnosis using neural networks. In: Annual Technical
Conference and Exhibition, pp. 401–408.
Azim, R.A., 2020. Prediction of multiphase flow rate for artificially flowing wells using rigorous artificial neural network technique. Flow Meas. Instrum. 76, 101835.
Choubineh, A., Ghorbani, H., Wood, D.A., Moosavi, S.R., Khalafi, E., Sadatshojaei, E., 2017. Improved predictions of wellhead choke liquid critical-flow rates: modelling based on hybrid neural network training learning based optimization. Fuel 207, 547–560.
Elmabrouk, S., Shirif, E., Mayorga, R., 2010. A neural network approach to predict average reservoir pressure. In: Proc. 5th Technology of Oil and Gas Forum, Tripoli, Libya, pp. 15–17.
Elshafei, M., Khoukhi, A., Abdulraheem, A., 2010, May. Neural network aided design of oil production units. In: 10th International Conference on Information Science, Signal Processing and Their Applications (ISSPA 2010). IEEE, pp. 638–641.
Garcia, G., Whitman, W.W., 1992, July. Inversion of a lateral log using neural networks.
In: Petroleum Computer Conference. OnePetro.
Ghareeb, M., Elgaghah, S., 2007, December. A new correlation for calculating wellhead production considering influences of temperature, GOR, and water-cut for artificially lifted wells. In: International Petroleum Technology Conference. OnePetro.
Ghorbani, H., Wood, D.A., Moghadasi, J., Choubineh, A., Abdizadeh, P., Mohamadian, N., 2019. Predicting liquid flow-rate performance through wellhead chokes with genetic and solver optimizers: an oil field case study. J. Pet. Explor. Prod. Technol. 9 (2), 1355–1373.
Gilbert, W.E., 1954, January. Flowing and gas-lift well performance. In: Drilling and Production Practice. American Petroleum Institute.
Gorjaei, R.G., Songolzadeh, R., Torkaman, M., Safari, M., Zargar, G., 2015. A novel PSO- LSSVM model for predicting liquid rate of two phase flow through wellhead chokes.
J. Nat. Gas Sci. Eng. 24, 228–237.
Hasanvand, M., Berneti, S.M., 2015. Predicting oil flow rate due to multiphase flow meter by using an artificial neural network. Energy Sources, Part A Recovery, Util. Environ. Eff. 37 (8), 840–845.
Hopfield, J.J., 1982. Neural networks and physical systems with emergent collective computational abilities. Proc. Natl. Acad. Sci. Unit. States Am. 79 (8), 2554–2558.
Kappos, L., Economides, M.J., Buscaglia, R., 2011, October. A holistic approach to back allocation of well production. In: SPE Reservoir Characterisation and Simulation Conference and Exhibition. OnePetro.
Khamis, M., Elhaj, M., Abdulraheem, A., 2020. Optimization of choke size for two-phase
flow using artificial intelligence. J. Pet. Explor. Prod. Technol. 10 (2), 487–500.
Khorzoughi, M.B., Beiranvand, M.S., Rasaei, M.R., 2013. Investigation of a new multiphase flow choke correlation by linear and non-linear optimization methods and Monte Carlo sampling. J. Pet. Explor. Prod. Technol. 3 (4), 279–285.
Lippmann, R., 1987. An introduction to computing with neural nets. IEEE ASSP Mag. 4 (2), 4–22.
Mahmoodi, O., Smith, R.S., Tinkham, D.K., 2016. Supervised classification of down-hole physical properties measurements using neural network to predict the lithology.
J. Appl. Geophys. 124, 17–26.
Mor´e, J.J., 1978. The Levenberg-Marquardt algorithm: implementation and theory. In: Numerical Analysis. Springer, Berlin, Heidelberg, pp. 105–116.
Morgan, N., Bourlard, H., 1989. Generalization and parameter estimation in feedforward nets: some experiments. Adv. Neural Inf. Process. Syst. 2, 630–637.
Rasoul, A., Rabiee, R., 2012, January. Novel applications of distributed temperature measurements to estimate zonal flow rate and pressure in offshore gas wells. In: SPE



International Production and Operations Conference & Exhibition. Society of Petroleum Engineers.
Rogers, S.J., Fang, J.H., Karr, C.L., Stanley, D.A., 1992. Determination of lithology from well logs using a neural network. AAPG Bull. 76 (5), 731–739.
Ros, N.C.J., 1960. An analysis of critical simultaneous gas/liquid flow through a restriction and its application to flowmetering. Appl. Sci. Res. 9 (1), 374.
Rumelhart, D.E., Hinton, G.E., Williams, R.J., 1986. Learning representations by back- propagating errors. Nature 323 (6088), 533–536.
Seidi, S., Sayahi, T., 2015. A new correlation for prediction of sub-critical two-phase flow pressure drop through large-sized wellhead chokes. J. Nat. Gas Sci. Eng. 26, 264–278.
Veezhinathan, J., Chambers, R., Chen, K., 1992. Neural network modeling for spatial mapping. In: Conference of Artificial Intelligence in Petroleum Exploration and Production. University of Tulsa.
Zhong-bao, Z.H.A.N.G., Ding-zhao, C.H.E.N., Zhi-ping, T.A.N.G., Shi-qiang, H.U., 2011. Analysis of liquid-carrying capacity in high GLR gas wells with downhole choke. Xinjiang Petroleum Geology 32 (5), 495.
