example in which we specify the search of the best offer between several distributed alternatives. Section 6 explains how we have used the model checker to check properties on our Mobile Maude specifications. Section 7 wraps this piece of work with some final conclusions.

In case there is no socket associated to a particular location in the map neighbors, there can be a default socket stored in the attribute defNeighbor. Nevertheless, the value of the defNeighbor attribute may also be unspecified. The sort Default{X} declared in the module DEFAULT-ELEMENT below adds a default value to the sort used in the instantiation of the module. We define the parameter- ized functional module DEFAULT-ELEMENT{X :: TRIV} in which we declare a sort Default{X} as a supersort of the sort Elt of the parameter theory, and a constant null of sort Default{X}.

If there is no socket associated to a particular location and a default one has not been specified then the data is not delivered. Note that this model allows us to represent many different network architectures, and, although we do not care here about it, the routing information may be updated and used in a very flexible way. We will explain how to build a very simple architecture in Section 4.2.

Finally, a root object may be in state idle, waiting-connection, or active. The attribute state will take one of these values. Root objects are only idle when they are created, being their first action either being activated as a client or server socket. They stay in waiting-connection until they get the confirmation from the server socket, passing then to active mode, state in which they will develop their normal activity.

to send messages to the appropriate locations. The first and second arguments of the Send message are, respectively, the addressee and sender of the message, and the third argument is the message being sent. We will see in Section 4 how the Send messages will be used to send the corresponding data through the appropriate sockets.

Sockets are accessed using the messages declared in the module SOCKET, which can be found in the file socket.maude distributed with Maude. We briefly describe here Maude sockets. For a complete explanation of Maude sockets, their use, and examples, we refer the reader to the Maude manual [2]. Currently only IPv4 TCP sockets are supported; other protocol families and socket types may be added in the future.

As we have seen in Section 3, the specification of Mobile Maude does not know about sockets. The only place where we get close to sockets is when using the Send messages, which is in fact not a socket message, but a buffered socket one. We intro- duce in Section 4.1 buffered sockets, a kind of filter class that makes Mobile Maude independent of sockets at the same time it adds some additional functionality. As we will see in Section 6, this independence is precisely what allows us to model check Mobile Maude specifications in a rather clean way. Section 4.2 talks about the architecture of the systems, on how processes get connected, and show how to do it for a very simple architecture.

The key is then in the reception of messages. A BufferedSocket object is always listening to the socket. It sends a receive message at start up and puts all the received messages in its buffer. Notice that a buffered socket goes from idle to active in the buffer-start-up rule. A Receive message is then handled if there is a complete message in the buffer, that is, there is a mark on it, and results in the reception of the first message in the buffer, which is removed from it.

When a ServerRootObject is created it send an AcceptClient message in- dicating that it is ready to accept clients through the server socket. When a ClientRootObject is created it first tries to establish a connection with the sever by sending a CreateClientTcpSocket message. In the rule acceptedClient below, in addition to sending messages AcceptClient and Receive indicating, respec- tively, that it is ready to accept new clients through the server socket, and messages through the new socket, the server root object that gets the AcceptedClient mes- sage sends a start-up message new-socket communicating its identifier. Notice that the client knows the address and port of the server root object, but not its identity. In this first message the server sends its name to its client, allowing to this one establishing the association between the socket and the identity of the object in it.

The attributes neighbors and defNeighbor are key for sending messages through the appropriate sockets. The reason why the first message sent through a socket after its creation is the message new-socket is to initialize these attributes. When it is received, depending on whether the receiver is a client or a server, and whether there is already a default neighbor or not, one or another action is taken. To avoid unintended loops in the delivering of messages, we assume that server root objects do not have default neighbors. For clients, the first connection is made

In this section we present a simple application to illustrate how mobile application code can be written in Maude and can be wrapped in mobile objects. In this example we have printers, buyers, and sellers; a buyer agent visits several printer sellers which provide him information on their printers. The buyer looks for the cheapest printer, and once he has visited all the sellers, he goes back to the location of the seller offering the best price.

A buyer has an attribute sellers with a list of the identifiers of the known sell- ers. It also has an attribute status with its current state: onArrival, asking, done, or buying. Finally, the buyer keeps information about the printer with the best price in the attributes price and bestSeller of sorts, respectively, Default{Nat} and Default{Oid}. Initially, these two last attributes are null.

We have used the language to implement several case studies. Here we have shown an application where a printer buyer has to choose the seller offering the cheapest printer. The conference reviewing system presented in [4] has also been migrated to this new version of the language.

