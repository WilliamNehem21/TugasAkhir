There is a need to provide secure cryptographic services in dynamic network en- vironments with untrusted parties and a changing net topology. Cryptographic services are security services implemented by cryptographic mechanisms, examples of such services are confidentiality, authenticity, integrity, privacy, accountability, accessibility and nonrepudiation. Privacy is a service that is often difficult to realize at the same time as other cryptographic services, like authenticity, accountability and nonrepudiation. Parties in dynamic networking environments like mobile ad hoc networks, where each node is acting as a combined terminal and router, would be particularly exposed to threats against their privacy since they have no control over the trustworthiness of network nodes that handle the messages sent. Appro- priate privacy enhancing cryptographic mechanisms, that can be trusted to work

For the ad hoc routing setting an anonymous routing protocol should ideally offer sender and recipient anonymity, meaning that the sender of a message or recipient of a message remains unidentifiable under the assumed adversary model. We also want to achieve realationship anonymity between the sender and the recipient of a message, so that an observer cannot determine which nodes are taking part in a specific communication flow. In other words, sender and recipient are unlinkable. Note that the unlinkability property is weaker than the anonymity property, as anonymity of both sender and recipient implies the unlinkabilty between them. For the remaining of this paper we will focus on anonymity in the context of ad hoc routing, and in particular look at sender and recipient anonymity in the route discovery part of ad hoc routing protocols.

The classic way of quantifying the degree of anonymity is done by simply measuring the size of the anonymity set [3]. The size of the anonymity set is intuitively an indication of the degree of anonymity, as the more members of the set of potential senders/receivers, the less is the probability that a randomly chosen member of the set was the actual sender/receiver. But we should take into account that anonymity is stronger the more evenly distributed the sending and receiving of messages by the subjects within that set is.

The degree of anonymity could also be quantified in terms of the information theoretical entropy of the probability distribution that the attacker assigns to each possible sender as being the originator of a message, after observing the system. In a system with N users, let pi be the probability assigned by the attacker for user i to be the sender/recipient of a message, and let X be the discrete random variable taking the possible values x1, x2,..., xN with probabilities p1, p2,..., pN respectively, the entropy H(X) of the probability distribution can be calculated by

The ad hoc network consists of a collection of nodes that can come and go into the network, the nodes simultaneously act as senders, recipients and routers. An ad- versary model usually distinguishes between external/internal, passive/active and global/local adversaries. An external adversary can only capture the communication between nodes while the internal adversary has access to all internal information of compromised nodes. A passive adversary can only eavesdrop on the communi- cation or read the internal information of nodes, while an active adversary may insert, delete or modify messages or alter internal information in nodes. A global adversary has full information of the network while a local adversary only controls part of the network. The most common adversary model used when analyzing the anonymity offered by ad hoc routing protocols is an external passive global adver- sary (an eavesdropper on the wireless communication of all nodes in the network), that possibly cooperates with one or more internal passive or active local adver- saries (malicious nodes inside the network). The proposals for anonymous routing protocols by Zhang et al [17], Boukerche et al [1], Kong and Hong [9] and Seys and Preneel [14] all use variants of this adversary model.

Hu and Perrig [7] propose to characterize an adversary based on the number of nodes it owns in the network and the number of nodes it has compromised, they suggest to use the notation Active-n-m for an active adversary that has compro- mised n nodes and owns m nodes. We do not wish to separate between owned and compromised nodes, as we assume that a compromised node is fully controlled by the adversary. We are interested in knowing how many nodes in the network that can be overtaken by an adversary before the anonymity offered by the rout- ing protocol gets unacceptably low. In order to achieve this we need to have a quantification of the anonymity offered by the protocol in relation to the number of compromised nodes as well as the total number of nodes in the network. We propose to use the term Passive-c/n for an adversary that is an external passive local or global adversary for the whole network, which is consisting of N nodes, of which this adversary can eavesdrop on the communication of a subset of n nodes, and that has compromised or owns c nodes inside the network, in other words the local or global external adversary cooperates with a local internal passive adversary that controls c nodes. As we are focusing on the anonymity aspects of the routing protocol we do not in our model take into account an active adversary that could

We choose to use an analytical probabilistic model of the ad hoc network topology, because we want the measurement model to be as general as possible to be able to compare different protocols not only for specific network topologies and specific attack scenarios. An alternative to our analytical approach could be to use simu- lations, where the anonymity measure is calculated over many different simulated network topologies and routes. When concerning the mobility of nodes this would indeed be a better solution and will be investigated in our further work. It should be noted that the proposed measurement model is resistant on the net topology, so our approach could still be applied to other network topology models.

Assume that a node Nj is taken over by the adversary, and that this node receives the message m. With the internal information of this node the adversary could then possibly gain some new information about which node that originated m, so that the probability distribution P0 can be updated to P1. As will be illustrated by the examples later this new information can for instance be about how many hops away the message was originated. If the node internal processing of the message m reveals the number of hops it has travelled or how many hops away to the destination it has left to travel, the adversary can in the worst case locate the position of the sending or receiving node of this message, e.g. the message was originated one hop away. If the message reveals that it was generated k hops away, the size of the anonymity set for the sending node will be where the ki are secret keys shared between N1 and all the other nodes on the route. This message is called an onion, Some padding also has to be added to the onion, so that it has a constant size, otherwise the size of the onion would reveal the distance in number of hops from the sender to the recipient. The privacy of the sender and the receiver of a message relies on the fact that there should be no correspondence between incoming and outgoing messages from a node. In practice an external passive global adversary could just track the flow of messages through the network. To prevent this, an addition of dummy traffic and different mixing strategies are applied as extra measures beside the routing protocol.

It should be noted that the weakness of the padding of onions in the ANODR protocol, allowing for an internal node to deduce the number of hops from source node, was fixed in an updated version of the protocol. To achieve secure onion routing the padding of onions should be done in such a way that a node receiving a padded onion is unable to tell if it was padded or not, the cryptographic issues involved in such a padding scheme were treated formally by Camenisch and Lysyan- skaya [2]. However, in an ad hoc routing setting we need to be concerned about the efficiency of computations, so there is always a trade-off between the security and usability of a protocol, which sometimes rules out the use of provable secure but computationally heavy solutions.

There are many possible directions for further research based on this approach. When designers of a protocol want to achieve a statistical notion of anonymity, meaning that the probability of determining the sender or recipient of a message should not exceed a certain threshold, as described by [8] and [16], our approach could possibly be used in an analysis for maximising anonymity while minimising the computational cost. We proposed an analytical model for calculating anonymity in terms of entropy, giving a weighted average entropy measure. We used a simple network topology model for our calculations, to further improve the measurement model we could in our future work replace the topology model with simulations of many different network topologies and routes, with a varying number of adversarial nodes.

