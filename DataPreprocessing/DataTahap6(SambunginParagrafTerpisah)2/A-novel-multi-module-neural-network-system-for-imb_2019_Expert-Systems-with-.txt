In this paper, a novel multi-module neural network system named MMNNS is proposed to solve the im- balance problem in electrocardiogram (ECG) heartbeats classification. Four submodules are designed to construct the system: preprocessing, imbalance problem processing, feature extraction and classification. Imbalance problem processing module mainly introduces three methods: BLSM, CTFM and 2PT, which are proposed from three aspects of resampling, data feature and algorithm respectively. BLSM is used to synthesize virtual samples linearly around the minority samples. CTFM consists of DAE-based feature ex- traction part and QRS-based feature selection part, in which selected features and complete features are applied to determine the heartbeat class simultaneously. The processed data are fed into a convolutional neural network (CNN) by applying 2PT to train and fine-tune. MMNNS is trained on MIT-BIH Arrhyth- mia Database following AAMI standard, using intra-patient and inter-patient scheme, especially the latter which is strongly recommended. The comparisons with several state-of-the-art methods using standard criteria on three datasets demonstrate the superiority of MMNNS for improving detection of heartbeats and addressing imbalance in ECG heartbeats classification.

A CAD system automatically classifies heartbeats, which contains four steps of ECG signal preprocessing, heartbeat segmentation, feature extraction and learning/classification. Traditional methods first extract features from the original data, such as P-QRS-T com- plex features, statistical features, morphological features, wavelet features, etc. (Acharya et al., 2015; Khandoker, Palaniswami, & Kar-

Four submodules are designed to construct the whole system, of which Imbalance Problem Processing Module, the core part, introduces three methods to eliminate the negative effect of imbalanced data distribution, named Borderline-SMOTE (BLSM), Context-Feature Module (CTFM) and Two-Phase Training (2PT). These methods are from the views of resampling, data feature and algorithm respectively. To the best of our knowledge, this is the first try to combine such three modules together to over- come imbalance problem.

MMNNS is trained on two data division schemes of intra- patient and inter-patient simultaneously, especially the latter which is more convincing but has not been adopted by most scholars. To validate the effectiveness of our model, extensive experiments are carried out on three datasets using seven clas- sification assessment metrics and two statistical measures. Be- sides, a large number of comparisons have been made between MMNNS and state-of-the-arts.

As the great success in image recognition, speech recogni- tion, natural language processing and other fields, deep learning model has been gradually applied to ECG analysis in recent years. Taking convolutional neural network (CNN) as an example, CNN integrates feature extraction and classification, classifying high- level features automatically learned by itself from original data. Li, Zhang, Zhang, and Wei (2017) feed the raw ECG signals directly into a 5-layer CNN for feature extraction and training. The idea of transfer learning is adopted in Isin and Ozdalili (2017) to take pre-trained AlexNet as a feature extractor, and the extracted fea- tures are then fed into a simple BP neural network to classify the heartbeats. Rahhal et al. (2016) uses active learning technology to improve the performance of the system. Zhai and Tin (2018) and Golrizkhatami and Acan (2018) process the input of the final clas- sifier respectively, the former transforms the beats into dual beat couple matrix as 2-D inputs of CNN, and the latter fuses the 2D- convolutional and handcrafted features extracted from each beat. The accuracy of deep learning model is shown higher than that of the traditional classifier combined with manual feature extraction. Although the aforementioned methods have achieved consider- able classification accuracy, the evaluation metric of accuracy is in- comprehensive when training data is skewed. Most of these papers fail to pay attention to the adverse effects of imbalance problem yet. As a result, solving the imbalance problem reasonably accord- ing to the characteristics of ECG data is the key to improve the

Convolutional neural networks (CNNs) refer to the neural networks that use convolution operations at least one layer of the network instead of general matrix multiplication, specifically for processing data with grid-like topology (Ian Goodfellow, 2016). It integrates feature extraction and classification together, different from the traditional classifier which needs to input pre-extracted features. A typical layer in a CNN consists of a convolutional layer and a pooling layer. Feature maps of previous layer are computed with several convolutions in parallel to generate a set of linear activation responses. Then, they passed through a nonlinear acti- vation function to generate a feature map for next layer. Finally, the pooling function is used to further adjust the output. CNNs are stacked with several typical layers, which can be used to extract high-level features.

be removed by median filter effectively. As in De et al. (2004), we use a 200 ms width median filter to remove P wave and QRS complex wave, then use a 600 ms width median filter to remove T wave, and afterwards subtract the filtered signal from the origi- nal signal to get the baseline correction signal. The 12-tap low-pass

Besides, performance measures are essential for effectiveness evaluations and guidance of learning. As stated at the beginning of this section, accuracy, a commonly used metric, favors majority class and easily leads to misleading assessment. Metrics like preci- sion, specificity, sensitivity, G-mean, F-measure are introduced into imbalanced learning field. Some works even focus on novel eval- uation metrics, such as Adjusted F-measure (Maratea, Petrosino, & Manzo, 2014).

Neural networks and deep learning have gained lots of inter- ests recently, also facing the imbalance problem. In standard back propagation algorithm, weights are updated by minimizing over- all error, which are contributed mainly from majority class. Thus, we achieve biased classification results. To tackle this problem, two novel loss functions named MFE and MSFE are proposed in Wang et al. (2016). A stacked denoising autoencoder neural net- works algorithm based on cost-sensitive oversampling is designed in Zhang, Gao, Song, and Jiang (2016). Khan, Hayat, Bennamoun, Sohel, and Togneri (2018) present a cost sensitive deep neural network which can automatically learn robust feature representa- tions for both of the majority and minority classes. Raj, Magg, and Wermter (2016) integrate different methods into a novel approach using cost sensitive neural networks to improve the performance on imbalanced datasets.

We design a structure to deal with imbalanced training data combining both data and algorithm level. Above all, from data point of view, we apply Borderline-SMOTE (BLSM) algorithm to one-dimensional ECG time series data, and oversample minority samples by linear synthesis. Secondly, considering the features ex- tracted from skewed data are biased towards majority class, a novel context-feature module (CTFM) is introduced in this paper. CTFM integrates feature extraction and feature selection, feeding prominent feature of each heartbeat segmentation and the features in the larger region of its context to the classifier simultaneously. CTFM doubles the number of minority samples, and enhances both the accuracy of model recognition and reliability for feature extrac- tion. Finally, we adopt Two-Phase Training, referred to as 2PT. In the first training stage, the convolutional neural network (CNN) is trained with balanced data, and in second stage, the model is fine- tuned with original skewed data.

Data augmentation can be regarded as expanding data by adding similar but different samples in the original training set (Zhang, Cisse, Dauphin, & Lopezpaz, 2018). On the basis of this definition, overcoming the imbalance problem in the number of training data can be regarded as local augmentation of minority class in training data. When realizing images classification, we usu- ally obtained augmented data with horizontal reflection, rotation and scaling. Inspired by this idea, we plan to add virtual samples

SMOTE resamples the training data by synthesizing each mi- nority sample and its random selected neighbor. Since the num- ber of original samples in each class located at the boundaries is small, the newly synthetic samples are mainly distributed in the non-boundary regions. However, the samples near the borderline, also referred as dangerous samples, are more likely to be misclas- sified than those far away from borderline, and are of more signifi- cance to classification tasks. Therefore, BLSM, an improved version of SMOTE, only oversamples the minority examples near the bor- derline, which is more in line with our expectations.

In BLSM, minority class examples which are easily misclassi- fied will get more training. Minority examples on the borderline are first found, and then synthesized with their selected k near- est neighbors. BLSM algorithm is modified slightly and adapted to one-dimensional ECG time series data in this paper. The detailed process is shown as follows.

What needs to be stressed is that the number of samples varies greatly from one class to another. If a complete balance is achieved by BLSM, it may cause the boundary between different classes to become blurred, which makes it easier to misclassify. Therefore, we synthesize the minority class to make they reach only half of the number of majority class.

Feature extraction, as another way to deal with dimensionality, converts the original features into new feature set. When solving imbalance problem, extracted features are often biased to predict the majority class samples that lead to poor performance on classi- fication. Taking principal component analysis (PCA) as an example, (Braytee, Liu, & Kennedy, 2016) point out that PCA algorithm seeks the orthogonal feature extractors that maximize the total variance. As a result, the extracted features favor majority class because their number is larger than the minority class. Moreover, other feature extraction methods will encounter the same problem. Accordingly, improved feature extraction algorithms are proposed recently to adapt to imbalanced training data (Moepya, Akhoury, & Nelwa- mondo, 2015; Ng, Zeng, Zhang, Yeung, & Pedrycz, 2016).

In the present study, we construct a CTFM module consist- ing of two parts: DAE-based feature extraction part (PART I) and QRS-based feature selection part (PART II). In PART I, we choose DAE as our extractor to extract sparse high-level features from all the heartbeats obtained in Section 3.2.1. On the one hand, the

In this paper, training of the algorithm is done in 800 epochs with a mini batch size of 200. Validation set is used to validate the model each 100 rounds of training. After training CNN with processed balanced data, the model is fine-tuned according to the method described in 3.2.3. The final performance of the testing set is measured by eight metrics defined below.

MIT-BIH arrhythmia database consists of 48 records slightly longer than 30 min of two-channel ECG recordings with digitiza- tion rate of 360 Hz. The signals of the two channels were recorded by placing the electrodes at different angles on the chest. The up- per signal is a modified limb lead II (MLII), and the lower signal is a modified lead V1, V2, or V5 (Moody & Mark, 2002). ECG data were collected from 47 subjects, including 25 men aged 32-89 and 22 women aged 23-89 (Records 201 and 202 are from the same male subject). More than 100,900 heart beats in the database have been annotated. Only one channel (channel MLII) for each record- ing is used for the classification task, excluding four records with poor quality (102,104,107,217).

71. Each record lasts for two hours, and two signals contained are both sampled at 250 samples per second. Two cardiologists anno- tated each record beat by beat and for changes in ST segment and T-wave morphology, rhythm and signal quality.

Only one channel of both two datasets is selected to conduct the experiments. The heartbeats obtained from these two datasets are fed into the model which we have already trained before. Test results are used for further comparison and evaluation from differ- ent aspects.

patient. This may easily lead to biased results due to the heart- beats from same patient have strong correlation and dependence. In the inter-patient scheme, all records are divided into two groups with similar number and similar proportions of each class. Heart- beats in DS1 are all from records: 101, 106, 108, 109, 112, 114, 115,

228, 231, 232, 233 and 234. The heartbeats of two groups will not come from the same subjects. In the intra-patient scheme, 49,953 heartbeats (N44800, S1345, V3412, F396) are selected from the to- tal heartbeats as the training set and the rest as the testing set. In

Area under the receiver operating characteristic curve (AUC) is a sound measure of discrimination and has been widely used as an evaluation metric for classifiers, especially in im- balanced learning. We use a multi-class modification of ba- sic version of ROC. The multi-class AUC (MAUC) is calculated by taking the average of AUCs obtained independently for each class for the binary classification task of distinguishing a given class from all the other (Buda et al., 2017).

The first algorithm named PCNN aims to feed the original im- balanced data directly into a pure CNN model without any process. Algorithm SMCNN and BSCNN preprocess the original data by over- sampling them using SMOTE and BLSM respectively. On the basis of BSCNN, the classifier CNN is replaced by a cascaded structure of DAE and CNN in algorithm BSDC, which feeds oversampled train- ing data to a DAE at first and then to a CNN. The fifth algorithm is BSCP, which integrates 2PT to BSCNN. Unlike BSCNN, which only fine-tunes the model using balanced training data after oversam- pling, BSCP introduces an extra fine-tuning phase using the origi- nal imbalanced data. The last one is our method: MMNNS.

