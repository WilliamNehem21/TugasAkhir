We show how tools from categorical logic can be used to give a general account of models of higher-order separation logic with a sublogic of so-called persistent predicates satisfying the usual rules of higher-order logic. The models of separation logic are based on a notion of resource, a partial commutative monoid, and the persistent predicates can be defined using a modality. We classify well-behaved sublogics of persistent predicates in terms of interior operators on the partial commutative monoid of resources. We further show how the general constructions can be used to recover the model of Iris, a state-of-the-art higher-order separation logic with guarded recursive predicates.

In this paper we show how tools from categorical logic can be used to give a general account of models of higher-order separation logic with a sublogic of persistent predicates. We focus on the basic rules and basic connectives used in separation logic and do not consider the so-called specification logic, i.e., Hoare triples, and concepts such as invariants, and rules particular to specific separation logics. We aim to show how to model the basic parts of the logic in a general way, so that in future work the effort can be spent on modelling the parts particular to the logic at hand.

We make use of the standard notion of a complete Heyting algebra to model standard higher-order logic and the notion of a complete BI algebra [4] to model higher-order separation logic. We show how to construct such algebras based on a model of resources, formalized by a kind of partial commutative monoid, and different ways of singling out the idempotent (duplicable) monoid elements. We show that our abstract framework is general enough to encompass models which also include a modality for reasoning about guarded recursive predicates: by a simple change of the ambient category, from sets to the topos of trees, we recover the step-indexed notion of resource model used to model Iris [9], a state-of-the-art higher-order separation logic with guarded recursive predicates.

In Sections 3 and 4 we study conditions under which one can obtain a logic of persistent predicates. We give two different constructions, one based on idempotent resources and one based on an interior operator on the resources. For the first construction, one obtains a sublogic closed under some of the logical connectives, but in general not all. In particular it can fail to be closed under universal quantification of the ambient logic. For the second construction, one obtains a sublogic closed under all the standard logical connectives of the ambient logic.

In Section 5 we show that any sublogic on duplicable predicates only, and closed under all the standard connectives must be of the form considered in Section 4. We further show that sublogics considered in Section 4 are all at most as expressive as the logic based on idempotent elements considered in Section 3, and we show necessary and sufficient conditions for this latter logic to be closed under univer- sal quantification. These conditions are stated in terms of the structure of the idempotents of the resource monoid.

The models described hitherto do not directly support guarded recursive pred- icates, as used in Iris [10,9] and other logics, e.g. Appel [1]. To support guarded recursive predicates, the types and terms of the Iris logic are modelled using a sub- category of the topos of trees [9]. The Iris model construction is based on a kind of step-indexed resource model, called a complete metric resource algebra (CMRA). The technical definition of a CMRA, recalled in Definition 6.5, perhaps looks a bit ad-hoc. In Section 6 we show that it is in fact canonical, because it can be understood as a partial commutative monoid, just in a different ambient category. Moreover, we also show that the model of Iris predicates [9] can be recovered by using the topos of trees as the ambient category in which the constructions from Sections 3 and 4 are carried out.

G. However we wish the modality arising from this adjunction to be well-behaved and thus we also wish that it preserve unions, since this is needed for the modality to commute with existential quantification in the logic. Therefore we are interested in situations where G preserve unions as well. However it does not do so in many practical cases as we demonstrate below.

Note that essentially the same counterexample, mutatis mutandis, can be con- structed using the partial commutative monoid of partial finite maps with fractional permissions, as used in some program logics. One particular thing we can learn from this example is that problems are caused by duplicable elements P which are approximated entirely by non-duplicable ones. Thus one possible solution presents itself. We restrict attention to those predicates P which are generated by duplicable principal ideals. We study the set of such predicates in the next section.

some function f . Further, if we wish that all predicates in Lf are duplicable then f must map into idempotents. Hence we show in particular that the notion of a core, as considered in Iris, is necessary as soon as we decide that we wish a well-behaved modality  in the logic. 4

Interior operators f mapping into idempotents correspond to the core operation of Iris. What we have shown is that the choice made in Iris is necessary if we wish to have a well-behaved sublogic of persistent predicates, all of which are duplicable. Moreover, we have shown conditions under which a largest such sublogic exists. This is exactly when the set of idempotents below m has a greatest element for any

Remark 6.2 There is also a notion of a non-unital resource algebra [9]. These are used as intermediate steps in the construction of a unital resource algebras which is used in the construction of the model. Since we are interested in the model we only focus on unital resource algebras in connection with ordered partial commutative monoids.

To claim that Proposition 6.7 together with Proposition 6.4 imply that the model of (a large part of) Iris can be recovered from the general constructions of the preceding sections we must explain in what way carrying out constructions in the internal logic of the topos of trees gives the same result as the externally constructed model. The precise statement is the following theorem.

We have shown how a modicum of categorical logic can be used to give a gen- eral account of models of higher-order separation logic with a sublogic of persistent predicates. In particular, we have shown that changing the ambient category pro- vides a systematic way to obtain models supporting guarded recursive predicates, as used, e.g., in the model of Iris, a state-of-the-art higher-order separation logic with guarded recursive predicates. In the future, we are interested in employing this systematic approach to investigate variations of models which combine linear and separation logic together with guarded recursive predicates. Such combinations of linearity and separation are useful for tracking resource usage more precisely, as, e.g., demonstrated in recent work by Tassarotti et. al. [17].

