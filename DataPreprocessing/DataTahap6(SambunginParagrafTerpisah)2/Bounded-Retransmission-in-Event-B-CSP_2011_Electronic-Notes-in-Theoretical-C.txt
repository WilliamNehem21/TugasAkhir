In Event-B, there are proof obligations at each stage to establish the validity of the refinement. The introduction of CSP allows some of the burden of proof to be handled within the CSP framework. In particular, those obligations concerned with flow of control can be discharged more easily with refinement checks. Establishing properties such as trace refinement and divergence-freedom for a model now allow a degree of automation. The technical details of this approach are given in [9,8]. The intention of this paper is to illustrate the kind of refinement steps that are now supported, and to provide an example of the approach.

They may be refinements of events of Mi , with either the same name or a different name (this includes events which are exactly the same in each level). Refinement events give rise to a mapping fi+1 which maps events of Mi+1 to events of Mi . The mapping is obtained from the refines clauses of event definitions, where ainMi+1 refines fi+1(a)inMi . Note that Event-B allows one event in Mi+1 to refine several in Mi in the most general case, but here we allow an event to refine at most one other.

This case study illustrates the transfer of a file by sending data packets over an unreliable medium. CSP is used to describe the repetitious behaviour in the sender (repeated transmission, and progress through the file) and the receiver (progressive receipt of the data packets), whereas the Event-B part of the model focuses on the state. For the purposes of this case study we focus only on the unreliability of the transmission medium, allowing reliable acknowledgements.

the Event-B description has allowed a clearer and more natural expression of the flow of control of events, particularly with respect to the timeout and repeated transmission of the data. It also allows for simpler event descriptions in the Event- B machine, since control variables in event guards and assignments can be removed where their effect is now taken care of by the CSP controller. For example, in the pure Event-B version, at Level 3 there are several control bits w , ab, db, which are set and reset by events, and are used within event guards, to manage the flow of control. In any state, no more than one of them can have the value 1. Thus the event SNDsndcurrentdata is given as follows:

