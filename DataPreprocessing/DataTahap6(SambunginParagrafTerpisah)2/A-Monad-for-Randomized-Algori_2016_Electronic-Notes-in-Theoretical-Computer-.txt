In this paper, we introduce a monad of random choice for domains that does not suffer from the main two drawbacks of the probabilistic powerdomain. It is not known whether any Cartesian closed category of domains is closed under the probabilistic powerdomain, but the Cartesian closed category BCD is closed under this monad of random choice. Also, there is no distributive law between the probabilistic powerdomain and any of the nondeterministic powerdomains, but there is a distributive law between the monad of random choice and the lower powerdomain. In order to work with the convex powerdomain, an alteration to the monad of random choice is made, so that the Cartesian closed categories RB and FS are closed under this construction. Then, in these categories, there is a distributive law between this monad and the convex powerdomain. This work is based on the uniform continuous random variables of Goubault-Larrecq and Varacca, which do not form a monad. This paper gives motivation for this model and changes the definition of the Kleisli extension of Goubault-Larrecq and Varacca so that it is monotone, which was the problem with their definition.

Mislove [13] built upon this work, using an indexed valuation model to define a monad of finite random variables. The Cartesian closed categories RB and FS were shown to be closed under this construction. Later, Goubault-Larrecq and Varacca [9] proposed a model of continuous random variables over the Cartesian closed category BCD, but the model did not form a monad in this category [14]. The model that this paper describes is based upon these continuous random vari- ables, in particular, the uniform continuous random variables. In this construction, computation is allowed to take different branches based on the flips of an unbiased coin.

A nonempty subset is directed if each pair of its elements has an upper bound also within the subset. A poset is directed complete if each of its directed subsets has a least upper bound. A dcpo is a directed complete partial order. Maps between

We are interested in three particular Cartesian closed categories of domains: BCD, RB, and FS. The maximal Cartesian closed categories of domains were char- acterized by Jung [10]. Here are descriptions of the Cartesian closed categories of domains we will need. Note that in each case, the morphisms in the category are the Scott-continuous maps.

Randomized computation first gained prominence when Rabin [6] introduced a randomized algorithm for finding the nearest pair in a set of n points. This algo- rithm had a linear average runtime, faster than the n log n runtime of the fastest known deterministic algorithm. More well known are the algorithms of Solovay and Strassen [21] and Rabin [17] for determining if a number is prime. These algorithms run in polynomial time (with a small error probability), and they were discovered over 20 years before the AKS primality test [3], the first known deterministic algo- rithm for recognizing prime numbers in polynomial time.

This work is inspired by a model of uniform continuous random variables first pro- posed by Goubault-Larrecq and Varacca [9]. In their paper, it was shown that the category of bounded complete domains (BCD) is closed under a similar construc- tion. However, their assertion that the construction forms a monad in BCD was incorrect, since the proposed Kleisli extension failed to be monotone, thus not Scott continuous.

The basic idea of a random variable model is to separate the random choices from the domain itself. In the probabilistic powerdomain, the probability distributions are placed on the underlying domain. In a model of random variables, random bits are generated by coin flips, and then a random variable is defined from these random outcomes to the underlying domain. In the probabilistic powerdomain, for an element d, making a choice between d and d is the same as just d, since the probabilities are the same. In the model described here, there is a distinction between choosing d or d and d itself, even though the probabilities are the same. In the first case, a random bit is still chosen, so programmatically, this is distinct from the latter case where no such choice is made.

The above construction is a monad in the category BCD. However, only two of the nondeterministic powerdomains (the upper and lower) leave BCD invariant. BCD is not closed under the convex powerdomain, but the Cartesian closed categories RB and FS, which contain BCD, are. The monad RC is not believed to stay within these categories, since we see no way to construct the deflations needed to show that an object is in one or the other of these categories. In BCD, infima can be used, but outside of BCD, infima are not guaranteed. One way to repair this is to not only define our functions on antichains, but instead to define them on the Scott closure, or lower set, of these antichains. This way, there is no need for infima to project down to smaller trees, since the function is already defined on the lower set. In our first monad, antichains are used, representing the possible outcomes of a random computation. Now we change this monad to include not only antichains of words, but also the prefixes of these words. These prefixes represent intermediate

These random variables can be thought of as using an oracle that randomly gives a element of [0, 1], and then the function of the random variable uses this number to output an element of P(N). Notice that in the above definition for application, both random variables receive the same t. Thus, the oracle is consulted only once instead of giving a different random number to each random variable. This exactly mimics the concurrent operation of our Kleisli extension. But instead of an oracle giving an entire real number at once (which has infinite information), the oracle gives one bit at a time.

In this paper, we have a presented two monads for randomized computation in Cartesian closed categories of domains. Computational motivation is given for the structure of these monads. In a program, random choice results in the branching of computation, so the possible outcomes form a tree. Our first monad separates random choice from the underlying domain and confines it to the leaves of a binary tree. This is the main difference between our construction and the probabilistic powerdomain. We have shown that this monad captures the randomized behavior found in algorithms such as the Miller-Rabin primality test. We have given a new Kleisli extension that satisfies the monad laws and presented a distributive law with the lower powerdomain, all within the category BCD. In order to work with the

There is much work to be done concerning these monads. Some work has al- ready been completed that is beyond the scope of this paper. Another alteration can be made to the monad to obtain a distributive law with the upper powerdomain. Furthermore, an operational version of the monad has been developed and imple- mented in functional programming languages such as Scala and Haskell. The proof that the monad laws hold for this operational version has been formally verified us- ing Isabelle. Finally, Randomized PCF (rPCF), a programming language that adds random choice to PCF [19], has been designed, and the Miller-Rabin algorithm has been implemented within the language. An operational and denotational semantics for rPCF have been developed using the monad presented in this paper. This is a proof of concept to show how this monad can be used to augment other languages with random choice.

The author thanks Michael Mislove for the guidance and the many fruitful discus- sions that made this work possible, along with several much-needed suggestions for the preparation of this paper. The author also thanks Jean Goubault-Larrecq and Dana Scott for email correspondence regarding the model of continuous random variables and the stochastic lambda calculus, respectively. Finally, the author ac- knowledges the support of the AFOSR under award no. FA0550-13-1-0135 during the preparation of this work.

