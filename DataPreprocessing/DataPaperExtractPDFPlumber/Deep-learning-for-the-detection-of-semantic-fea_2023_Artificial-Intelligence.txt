ArtificialIntelligenceinAgriculture7(2023)13–26
ContentslistsavailableatScienceDirect
Artificial Intelligence in Agriculture
journal homepage: http://www.keaipublishing.com/en/journals/artificial-
intelligence-in-agriculture/
Deep learning for the detection of semantic features in tree
X-ray CT scans
SalimKhazema,b,⁎ ,AntoineRicharde,JeremyFixb,d,CédricPradaliera,c
aGeorgiaTech-CNRSIRL2958,Metz,France
bCentraleSupélec,Metz,France
cGeorgiaTechLorraine,Metz,France
dLORIA,CNRSUMR7503,Metz,France
eUniversityofLuxembourg,CampusKirchberg,6,rueRichardCoudenhove-KalergiL-1359Luxembourg
a r t i c l e i n f o a b s t r a c t
Articlehistory: Accordingtotheindustry,thevalueofwoodlogsisheavilyinfluencedbytheirinternalstructure,particularlythe
Received10August2022 distributionofknotswithinthetrees.Nowadays,CTscannerscombinedwithclassicalcomputervisionapproach
Receivedinrevisedform13December2022 arethemostcommontoolforobtainingreliableandaccurateimagesoftheinteriorstructureoftrees.Knowing
Accepted24December2022
wherethetreesemanticfeatures,especiallyknots,contoursandcentersarewithinatreecouldimprovetheef-
Availableonline4January2023 ficiencyoftheoveralltreeindustrybyminimizingwasteandenhancingthequalityofwood-logby-products.
However,thisrequirestoautomaticallyprocesstheCT-scannerimagessoastoextractthedifferentelements
Keywords:
suchastreecenterline,knotlocalizationandlogcontour,inarobustandefficientmanner.Inthispaper,wepro-
X-raysimages
Deeplearning poseaneffectivemethodologybasedondeeplearningforperformingthesedifferenttasksbyprocessingCT-
Convolutionalneuralnetworks scannerimageswithdeepconvolutionalneuralnetworks.Tomeetthisobjective,threeend-to-endtrainable
Imagesegmentation pipelinesareproposed.ThefirstpipelineisfocusedoncentersdetectionusingCNNsarchitecturewitharegres-
Woodknots sionhead,thesecondandthethirdoneaddresscontourestimationandknotdetectionasabinarysegmentation
Coordinatesdetection taskbasedonanEncoder-Decoderarchitecture.Thedifferentarchitecturesaretestedonseveraltreespecies.
Contourestimation Withtheseexperiments,wedemonstratethatourapproachescanbeusedtoextractthedifferentelementsof
treesinaprecisemannerwhilepreservinggoodperformancesofrobustness.Themainobjectivewastodemon-
stratethatmethodsbasedondeeplearningmightbeusedandhavearelevantpotentialforsegmentationand
regressiononCT-scansoftreetrunks.
©2023TheAuthors.PublishingservicesbyElsevierB.V.onbehalfofKeAiCommunicationsCo.,Ltd.Thisisanopen
accessarticleundertheCCBY-NC-NDlicense(http://creativecommons.org/licenses/by-nc-nd/4.0/).
1.Introduction growthbasedongeometricmeasurementssuchas(knotlength,ring
diameter,etc.),withouthavingtofellthetree.
Knotsareoneofthemostsignificantfactorsinthewoodprocessing Detectionofcenters,contours,andknotsisaveryrelevanttaskfor
chain. A knot is defined as the part of a branch embedded in the thewoodindustry,whichcansignificantlyimproveproductionquality,
trunkthatgenerallyarisesatthetipofthetrunk(Longoetal.,2019). andyield.Nowadays,sawmillsaddresstheseneedsbyscanningtree
Biologically,allbranchesgrowupfromthepith,thecenterofthetree logswithvarioussensorsbeforeplanninghowitwillbecut.Among
stemandthegrowthrings.Theknotshaveadirectimpactonthequality thesesensors,3Dscannersbuilda3Dmodelofthetreeexterior,mostly
andvalueoflogs,whichmakesknowingtheirexactlocalizationanddis- towardsvolumeestimation,andX-rayComputedTomography(CT)
tributionwithinthelogsrelevantandcrucialforforestersandsawyers. provides a 3D density model of the tree interior, represented as a
If the knot, defect location and size are known before sawing stackofimagedescribingslicesorthogonaltothelengthofthetree.
(Bhandarkar et al., 1999), this could generate a potential gain of Fromsuchimagestacks,treesemanticfeatures(centerline,contour,
15–18%invalueofproducts.Moreover,thisknowledgewouldsupport knots) are localized using traditional computer vision methods
forest scientist by providing an insight on the mechanisms of tree (Krähenbühletal.,2012,2013a,2014).
Thesetraditionalapproacheshaveshownpromisingresultsonsome
species.However,theymaylackrobustnessinchallengingcasessuchas
⁎ Correspondingauthorat:GeorgiaTech-CNRSIRL2958,Metz,France. fordetectingknotswhenthesapwoodiswet(inthesesituations,the
E-mailaddress:skhazem@georgiatech-metz.fr(S.Khazem). densityofthewoodissimilartothedensityoftheknot).Withthe
https://doi.org/10.1016/j.aiia.2022.12.001
2589-7217/©2023TheAuthors.PublishingservicesbyElsevierB.V.onbehalfofKeAiCommunicationsCo.,Ltd.ThisisanopenaccessarticleundertheCCBY-NC-NDlicense(http://
creativecommons.org/licenses/by-nc-nd/4.0/).S.Khazem,A.Richard,J.Fixetal. ArtificialIntelligenceinAgriculture7(2023)13–26
forwhichknotshavebeenlabeledbyhand.Thisallowsustohighlight
therobustnesschallengesandtheperformanceofourapproach.
Alltheresultspresentedinthispaperhavebeenevaluatedonatree
databasecontainingCT-scansof682treesfrom23species(seeFig.1).
Fig.2illustratesthenumberoftreesbyspeciesandthenumberofim-
agesbyspeciesaccordingtotheindexesreportedonTable1.
2.Relatedwork
Thispapercanbecomparedwithtwocategoriesofrelatedwork.On
theonehand,asignificantbodyofworkinthedeeplearningcommu-
nityaddressesquestionsofregressionfromimages,imagesegmenta-
tion ordetection ofobjects.However,thesetools haverarelybeen
appliedtosupportthewoodprocessingindustry.Ontheotherhand,
weidentifiedanumberofworksappliedspecificallytowoodimagery,
eitherusingtraditionalimagingtechniquesonplanksortrunksorX-
raytomography.
2.1.Thedeeplearningtoolboxforimageprocessing
Deeplearningapproacheshaveshownconsiderablepromiseinvar-
ioustasksthatinvolvehandlingmassivevolumesofdigitaldata.Inthe
fieldofcomputervision,deeplearningmethodsarealsorapidlybeing
Fig.1.Illustrationofthedifferenttreespeciescontainedinthedatasetwithrespectivein- appliedinawiderangeofareaandhavedemonstratedremarkableim-
dexes(seeTable1). provementinseveraltaskssuchasimagereconstruction,objectdetec-
tion, image classification andimage segmentation.During thepast
decade,manyapproachesandarchitectureshavebeendevelopedin
recentadventofdeeplearninganditssuccessonavarietyofmachine thisfieldsuchasResNet-50(Heetal.,2016),MobileNets(Howard
learningproblems,thelimitationsoftraditionalapproachesmaybe etal.,2017),EfficientNet(TanandLe, 2019).Thesenetworkshave
overcome,althoughatthecostofrequiringalargeramountofanno- beenintroducedforclassificationtasks,butcanalsobeusedforregres-
tateddata. sionandasbackboneforsegmentationtasks.Forthedifferentsegmen-
Inthispaper,wedemonstratehowdatadrivenmachinelearning tationtaskssuchasSemanticsegmentationwhichisbasedonpixel
andspecificallydeeplearning,canbeusedtoaddresstheserobustness levelclassificationintoapredefinedsetofclassesorInstancesegmenta-
issuesonthreespecificapplications: tionwhichconsistsofdetect,segmentandclassifyeachindividualob-
• Fortreecenterlinedetection,wetrainaregressionmodeltopre- ject.SomearchitecturessuchasUNet,SegNet,LinkNet,MaskRCNN
dicttheintersectionofthetreecenterlinewitheachX-rayCTimages andUpsnet(Ronnebergeretal.,2015;Badrinarayananetal.,2016;
(foragivenslice,werefertothisintersectionasthetreecenter).Incom- ChaurasiaandCulurciello,2017;Heetal.,2017;Xiongetal.,2019)
parisontopreviousstudies,thisistestedonalargesetofspeciesandhas haveshowngreatperformances.
shownitsrobustness.
• UsinganEncoder-Decoderarchitecture,wedemonstratehow 2.1.1.Networkarchitectures
treecontourextractioncanbereliablycastasanimagesegmentation Adeeplearningarchitectureisdefinedasamulti-layersstackof
problem.Hereaswell,wetestedonalargesetofspeciesthanprevious basicmoduleswhichhavetheabilitytolearntotransformtheirinput
studies,andwedemonstrateitsrobustness. toimprovetherepresentationselectivityandinvariance(LeCunetal.,
• Finally,usingthesamesegmentationnetwork,weshowcasethe 2015).Inthecomputervisionfield,manydeeplearningarchitectures
detectionofknotsintheCTimagesandvalidateitonasubsetofspecies haveevolvedoverthelastfewyears.Inparticular,architecturesbased
Fig.2.OverviewofthedistributionofthenumberoftreeperspeciesandthenumberofXrayimagesperspecies.
14S.Khazem,A.Richard,J.Fixetal. ArtificialIntelligenceinAgriculture7(2023)13–26
Table1 totalnumberofpixelsintheimageandy ∈{0,1}representsthelabel
i
Speciesindexes. ofthei-thpixel,where0indicatesthatthepixelbelongstotheback-
Scientificname Englishname Index Scientific English Index groundand1meansthatthepixelbelongstoaknot.Theprobability
name name ofthesegmentationmodeltopredictapixelbelongstoaknotisde-
noted p ∈ [0,1] and ε is a smoothness coefficient. In the different
Carpinus Hornbeam 0 Betula Birch 12 i
Prunusavium Gean 1 Fraxinus Ash 13
experiments,weempiricallysetε=1.
Acer Maple 2 Acer Hedge 14
campestre Maple
2.1.3.Dataaugmentation
Sorbustorminalis Whitebeam 3 Piceaabies Spruce 15
Pinussylvestris Scotsfir 4 Abies Pine 16
Dataaugmentationisacommonlyusedtechniqueforartificiallyin-
Quercus Oak 5 Fagus Beech 17 creasingthesizeofthesampledatabasesbyapplyingdifferenttransfor-
sylvatica mationstotheavailablepair(imagesandlabels).Itincreasesthesizeof
Acacia Acacia 6 Larixdecidua Larch 18 theinputandcreatesdiversityinthedata.Ifcorrectlycalibrated,data
Pseudotsuga Douglasfir 7 Tilia Lime 19
augmentationcanimprovegeneralizationandperformanceofthetrain-
menziesii
Alnus Alder 8 Quercus Sessileoak 20 ingmodel(ShortenandKhoshgoftaar,2019;PerezandWang,2017).In
petraea Computervision,imageaugmentationhasbecomeacommonimplicit
Quercusrubra Redoak 9 Populus Aspen 21 regularizationapproachtopreventoverfitting(poorgeneralization)
tremula
andgenerallyenhancesperformances.
Acerplatanoides Norwaymaple 10 Ulmus Elm 22
Acer Sycamore 11 / / /
pseudoplatanus Maple 2.2.Detectingsemanticfeaturesintrees
Intheonehand,traditionalopticalimagingtechniquearestillused
onConvolutionalNeuralNetworks(CNNs)suchasVGG,Residualnet-
inindustrytoperformprocessingandtaskssuchasobjectdetection,
work (ResNet), MobileNets and EfficientNet (Simonyan and classificationandsegmentation.Inthewoodindustry,whenitcomes
Zisserman, 2015; He et al., 2016; Howard et al., 2017; Tan and Le,
todetectdefectsonthesurfaceofeitherthetreeorplanks,weusually
2019)aredevelopedtosolveproblemsindifferentdomainsoruse-
usethiskindofdataduetotheireaseofacquisitionandtheirpractical
casesandhavesignificantlydriventheperformanceofvisiontasks
use.Inthiscontext,wehaveidentifiedsomepreviousworkusingthis
basedontheirrichrepresentationpower.Thisledtotheadventof
typeofdatatodetectdefectsandsurfaceknotsusingdeeplearning
more complex neural network such as (Liu et al., 2022) and those
based approaches (Gao et al., 2021a; Lopes et al., 2020; Norlander
basedonattentionsuchasVisionTransformer(ViT),Data-Efficient
etal.,2015;Gaoetal.,2021b).Intheotherhand,X-raytomographyrep-
ImageTransformers(DeiT)andSwinTransformer(Dosovitskiyetal.,
resentsoneofthestandardmedicalimagingmodalitywhichisconsid-
2021;Touvronetal.,2021;Liuetal.,2021). eredasthemostefficientwaytogetaccurateandinformativeimagesof
theinnerstructurenon-invasively.Inrecentyears,severalindustries,in
2.1.2.Networklosses
particularthewoodprocessingindustry,havechosentotakeadvantage
Thetrainingofadeepneuralnetworkistightlyspecifiedbytheloss
ofthistechnologytoobtainbetterunderstandingoftheirproductsin
functionusedtoquantifythequalityofthenetwork'spredictionwith
order to increase yield. Several approaches that aim to detect the
respecttoandwhatitshouldhavepredicted,namedlabel,ground-
innerpropertiesandfeaturesofthetreehavebeenproposedbasedon
truthortargetdependingontheapplications.Inthecaseofanetwork
thismodality(KerautretandLachaud,2009;Krähenbühletal.,2012,
performing a regression task, the typical loss is the mean-squared
2013a)andwillbediscussedbelow.
errordefinedbelow,whereMisthenumberofdimensionofthenet-
workoutput,y thetargetvalueandp theoutputofthenetwork:
i i 2.2.1.Expertmethods
Treesemanticfeatures(centers,knots,contours)withinlogcross-
1 M
L MSE¼ M∑ðy i(cid:2)p iÞ2 ð1Þ sectionsareanactiveareaofresearchwherehighvariabilityinknotap-
i¼1 pearanceandlabeleddataavailabilityaremajorchallenges.Methods,
suchas(Johanssonetal.,2013;Krähenbühletal.,2013b)aredeveloped
Forbinaryclassificationproblems,thebinarycross-entropybetween
toaddressthischallenge.Johanssonetal.(2013)isbasedonmodeling
thepredictedprobabilityofbeingpositiveandthegroundtruth,asde-
theknotbynon-concentricellipsesinsidethelogwithdifferentradius
finedinEq.(2),istypicallyselectedasthelossfunctiontobeminimized
tolocalizetheknots.Theyproposeanellipsedetectionalgorithmthat
duringthenetworktraining.
involvesthefollowingsteps.First,theytrytodetecttheheartwoodCon-
centricSurface(CS),whichisconsideredsimilartoacylindricalshell,by
1 M
L ¼ (cid:2) ∑y logðpÞþð1(cid:2)yÞlogð1(cid:2)pÞ ð2Þ fittingellipsestotheannualringsofthelog.Then,alltheobjects(re-
BCE M i i i i
i¼1 gionswithhighdensityvalue)ontheconcentricheartwoodsurface
arefittedtoellipsesandfinallyalloverlappingellipsesacrosstheheart-
Additionally,whentheclassesareunbalanced,theBCEisusuallynot
woodconcentricsurfacearetrackeduntilreachingasapwoodCSwhich
sufficienttolearnagoodpredictorandtrainingmayfavorthemajority
isconsideredastheendoftheknot.(Krähenbühletal.,2013a)proposed
classes.Insuchcase,otherlossessuchastheDicelossmightbepre- anapproachtotackletheproblemofsegmentingwetarea:theyfirstde-
ferred.TheDicelossfunction(Sudreetal.,2017),definedinEq.(5),
tecttheknotareasusing(Krähenbühletal.,2012)approach,andthen
whichtendstofocusonpixelsthataremispredictedbythemodelcan
exploitthegeometricalpropertiessuchasdominantpointsandcurva-
alsobeincludedtosupervisethemodel'straining.
turecomputedfromdiscretecontours(KerautretandLachaud,2009)
toestimatethepositionandorientationoftheknotsinthesapwood.
2∑M py þε
L ¼1(cid:2) i¼1 i i ð3Þ Finally,thisinformationisusedtoreportasegmentationmask.How-
Dice ∑M i¼1p iþ∑M i¼1y iþε ever,thesemethodsheavilyrelyonuserexpertisetoadjusttheparam-
etersofthealgorithmscorrectly.Letustakeasexampleknotdetection.
Inthecontextofanimagesegmentationtask,forexampleforthe Knotscanhavevariedshapesthatishardtodelineate.Inaddition,
predictionofthepresenceofknots,inEqs.(2)and(3),Mdenotesthe takingintothetreetype,whichitsspecificdensity,isnotaneasytask.
15S.Khazem,A.Richard,J.Fixetal. ArtificialIntelligenceinAgriculture7(2023)13–26
Indeed,theexpertmethodshavebeenexperimentedonlyonafewtree 3.1.Treecenterlinedetection
species.Incomparison,weareproposingend-to-endtrainedpipelines
basedondeeplearningtoaddressthesedifferenttreesemanticapplica- Withinthispart,wewillpresenttheproposedarchitectureforcen-
tions,andweconsideramuchmorediversesetofspecies. tersdetectionandthedataaugmentationstrategyweselected.
Insteadof proposinganewarchitecture,wehaveexploitedthe
2.2.2.Datadrivenmethods knowledgeofasetofalreadyexistingconvolutionalneuralnetworkar-
Withtherecentsuccessesofneuralnetworksonawiderangeofma- chitectures(see2.1.1)thathaveperformedexcellentlyonseveralimage
chine learning problems, these techniques have also been tasks.Thechoiceofconvolutionnetworksisdrivenbythefactthatour
experimentedonwoodlogsCTscans.Theworkof(Norlanderetal., taskconsistsonperformingregressiononimages.Forourwork,weuse
2015) showed that deep learning approaches, and specifically ResNet-34(Heetal.,2016)whichisavariantoftheresidualneuralnet-
convolutionalneuralnetworks,outperformedacommercialdetector workwithatotalof34layers,theadvantageofthisarchitectureisthatit
based on feature descriptors and Support Vector Machine (SVM) offersagoodcombinationofnumberofparametersandperformance,
(CortesandVapnik,1995)whenthetaskwastodetectknotsinoak andhasprovenitsperformanceonimageclassificationtasks.Another
treeplanks.AccordingtoNorlanderetal.(2015),theappropriateap- reasonforexploitingtheresidualnetworkarchitectureisthepossibility
proachistorelyonneuralnetworksarchitecturesinsteadofrelying offeedingimagesofdifferentsizesfromthosewithwhichtheyare
onthetraditionalcomputervisionmethodsusuallyusedinthisfield trainedthankstoglobalaveragepoolinglayer,1whichcomputestheav-
to locate the knots inside the CT-Scanned wood-logs. Several ap- eragevalueoverthespatialdimensionsofeachfeaturesthenfeededdi-
proachesarealsoproposedtodetectknotsonthesurfaceofwood. rectlytothesoftmaxactivation.Thisisconsideredacrucialparttodo
Gaoetal.(2021a)proposedanapproachbasedontransferlearning transferlearning,whichhelpustoachievehighperformanceonanet-
usingresidualneuralnetworkstodetectdefects(knots)onthesurface workusingveryfewepochs.TheResNet-34networkcontains21.2mil-
ofwoodandperformaclassificationtasktocategorizethemintoseven lionoftrainableparameters.
defecttypes.TheworkofLopesetal.(2020)consistsofusingandtrain- Detectingthecentersinthewood-logtomographyslicesisapixel-
ingThe”Youonlylookonce”(Yolov3)(RedmonandFarhadi,2018)ar- coordinateregression,sincethelabelsoftheimagesarethecentercoor-
chitecturefromscratchtoperformknotsdetectiononthesurfaceof dinatesXandY.Ourworkattemptstoautomatethistaskwithanend-
woodathighspeedandhaveshowngoodresultsonknotsthatareon to-endtrainablepipeline.
thesurface.However,thisapproachhasnotbeentestedeitheronX- WetrainedaResNet34(Heetal.,2016)on256×256pixelimages
rayimagesortheinnerknotswhichareverychallenging. witharegressionhead(thelastlinearlayerpretrainedonImageNetis
Althoughmanydifferentarchitecturesandmodelsareavailable(see replacedwithalinearlayerwithtwounits,initializedusingthedefault
2.1.1),theirapplicationinthewoodindustryremainslimitedandcould pytorch strategy with both the weights and biases sampled from
(cid:3) (cid:4)
beimproved.Ourworkcanbesplitintotwomaintasks:Regressionand U (cid:2) pffiffi1ffiffiffiffiffiffiffiffi,pffiffi1ffiffiffiffiffiffiffiffi )andamean-squarederrorloss(Eq.(1)).Forreg-
Segmentation.PithestimationfromCTscansisaregressiontaskfrom fanin fanin
images,andseveralend-to-endtrainableneuralnetworksmentioned ularization,wetestedsomedataaugmentationstrategies(see2.1.3)
in(2.1.1)witharegressionheadcanbetrainedonthistask.Knotdetec- andearlystoppingtopreventoverfitting.Toensurethattheaugmenta-
tioncanbeeitherformulatedasasegmentationtaskorobjectdetection tionoftheseimagesisachievablewithreasonablememoryusageand
task,andthereexistsalsoavarietyofend-to-endtrainableneuralnet- speed,weusedanopensourcelibrary,Albumentations(Buslaevetal.,
worksinthecomputervisioncommunityforsolvingthistask.Contour 2020).Theimagesarenormalizedbetweenthevalues[0,1].Wetrained
estimation,ontheotherhand,canbeaddressedinseveralways.One thenetworkwiththeconvolutionalpartpretrainedonImageNet,the
approachistocastthecontourestimationastreesegmentationwhere first convolutional layer2 being randomly initialized using the He
thetaskistopredictallthepixelsbelongingtothetree,henceabinary normalstrategyandthelinearlayerisrandomlyinitializedusingthe
semanticsegmentationtaskfromwhichU-Net,Faster-RCNN,andany defaultpytorchstrategywithboththeweightsandbiasessampled
(cid:3) (cid:4)
semanticsegmentationneuralnetworkcanbeapplied.Thatfirstap-
proach,althoughclassical,suffersfromthedifficultyofproducingan fromU (cid:2) pffi faffi1ffi nffiffiffiffi iffi nffiffi,pffi faffi1ffi nffiffiffiffi iffi nffiffi .WeusedAdam(KingmaandBa,2015)as
outputthatisnotnecessarilyaclosedcurveasexpectedforacontour anoptimizerwithalearningrate1e−3andthelearningrateisreduced
predictor.Asecondapproachreliesonend-to-endtrainablepredictors byafactorof0.1everytimethevalidationmetricstalls.Weusedabatch
outputtingaclosedcurve.Thisisnotstraightforwardtodesignatrain- sizeof256.Wealsousedmixedprecisiontraining(Micikeviciusetal.,
ableneuralnetworkforoutputtingaclosedcurve,butrecentworks 2017)whichspeduptrainingwithoutlossofperformance.Theloss
on differentiable active contours follow that track (Marcos et al., function usedinimplementationistheMeanSquaredError(MSE)
2018).Thisisarecentlyproposedapproachwhichhasthebenefitto loss.Wesplitthedatasetintotrainingandvalidationfoldsof,respec-
outputaclosedcurve,byconstraint,butthatwedidnotexploreyetin tively,90%and10%.Fig.3illustratesourdetailedregressionpipeline
thispaper. forcenterdetection.
Forthedataaugmentation(seeninsubsection2.1.3),aftertesting
2.3.Synthesisontherelatedwork severalones,weselectedthefollowingrelevanttransformations:shift,
scale,coloraugmentation(saturation,brightness,contrast),random
Thevarioustechniquesdescribedabovehighlightboththeavailabil- horizontalandverticalflipping,androtations.Weusedtheaugmenta-
ityofalargeandwell-proventoolboxofdeep-learning-basedrobust tiononlywiththetrainingdata.Attheend,wedidsomeexperiments
imageprocessingtechniques,andtheexistenceofanumberofimage that consist of augmenting test data to evaluate the robustness of
processingchallengeswhosesolutionwouldsupportthewoodindus- the model. The random seed of the data augmentation is fixed for
try.Thispaperbuildsonthesetwoobservationstodeployandevaluate reproducibility.
deep-learningsolutionstothespecificcontextofprocessingX-rayto-
mographyofwoodlogs.
1 Itmightappearassurprisingthatanetworkwithglobalaveragepoolingisabletopre-
3.Materialsandmethods dictaspatializedoutputbuttheempiricalresultsactuallyshowthatthisworksandthis
architectureissignificantlylessparametrizedthanthesamewithouttheglobalaverage
poolinglayer.
Withinthissectionwewillcoverdifferentwood-logssemanticfeatures
2 ThenetworkspretrainedonImageNetinvolvecolorimageswith3inputschannels
extractionsandproposetechniquesandmodelsforthedifferenttaskssuch whileourdatainvolveonlyonechannel,hencethefirstconvolutionallayerisreplaced
ascenterlinedetection,contourextraction,andknotsegmentation. withconvolutionalkernelsexpectedoneinputchannel.
16S.Khazem,A.Richard,J.Fixetal. ArtificialIntelligenceinAgriculture7(2023)13–26
Fig.3.ThepipelineforregressingthetreecenterisbasedonaResNet-34convolutionalbackbone,pretrainedonImageNet,andarandomlyinitializedfirstconvolutionallayerandregres-
sionhead.Trainingisperformedonaugmenteddata,applyingrandomtransformationstothetrainingimagesandtargets.
3.2.Treescontourdetection contoursegmentationisillustratedinFig.4.Moredetailsofthearchitec-
tureareillustratedinappendixAppendixC.
Thispartdealswiththepredictionofthecontourofthetree.The
contourisathinlineseparatingthewoodlogfromtherest(back- 3.3.Treeknotsdetection
ground,wedges,etc…)intheCT-scanimages.Ratherthanpredicting
thatthinline,wetransformthemachinelearningproblemintotheseg- Inthispart,wepresentourapproachtoperformtheknotsegmenta-
mentationofthewoodlogfromtherest,fromwhichwecanderivethe tiontaskasbinarymaskpredictionfromsinglechannel512×512CT-
contour. scanimages.
WeproposetouseanEncoder-Decoderbasedmodel,andspecifi- Thesegmentationtaskrequiresseparatingtheforeground(knots)
callyU-Net(Ronnebergeretal.,2015).Intheencoderpart,themodel andthebackground(othertissues).Thenetworkarchitectureisthe
takesanimageasinputandappliesasequenceofconvolutions,max- sameU-Netarchitectureusedforthesegmentationtaskinsection3.2.
poolingandReLUactivationandcompressestheimageintoalatent However,inadditiontothebinarycrossentropyloss(Eq.(2))and
spacewhileextractingthemostrelevantfeatures.Thedecoderpartis giventhatthewoodslicespresentveryfewknots,weadditionallyuse
asequenceofconvolutionalandtransposedconvolutionallayersthat aDiceloss(Eq.(5))totrytoovercomeclassunbalancing.Tohandle
attempttodecodethesegmentationmaskfromthelatentspaceand thelimitednumberofsamplesissue,weusedasimpledataaugmenta-
input image. Skip connections are used to take advantage of high- tionstrategybyapplyinghorizontalandverticalflipsonthefly.The
resolutionlayersoftheencoderbysendinginformationtothecorre- datasetissplitintotrainingandvalidationfoldsof,respectively,90%
spondinglayersofthedecoder,whichallowsthemodeltousefine- and10%.Forthetrainingparameters,weusedthesameasintheseg-
graineddetailslearnedfromtheencoderparttoconstructtheimage mentationtaskinsection3.2.Fig.5depictsourdetailedproposedpipe-
onthedecoderpart.Theseconnectionshelpthenetworktobettercap- linetoperformtheknotsegmentationtask.
turesmalldetailsthatarepresentinhigh-resolution.Theparametersof
al (cid:3)ltheconvolutional (cid:4)layersofthenetworkarerandomlyinitializedfrom 4.Experimentsandcomparisons
U (cid:2) pffiffi1ffiffiffiffiffiffiffiffi,pffiffi1ffiffiffiffiffiffiffiffi .Beforetraining,thefirststageofourpipeline
fanin fanin Inthissection,wepresentthevariousexperimentsandtheresultsof
performspre-processingon512×512pixelsimagesbynormalizing thedifferenttasksonstemsofseveraltreespecies.
themin[0,1].Weusesomeon-the-flynon-destructiveaugmentation
schemetoexpandthedataset'ssizeandimprovethevariabilityofsam- 4.1.Datasets
ples,includingrandomrotationandhorizontal,verticalflipwithaprob-
abilityp=0.5.Thesecondstageconsistsoffeedingthepreprocessed 4.1.1.CTimages
datatotheU-Netarchitectureandperformingtraining.Thelossfunc- TheusedimagescomefromX-rayCTscannersinDigitalImaging
tionusedfortheU-Netisbinarycrossentropy3(Eq.(2)).Weused andCommunicationinMedicine(DICOM)formatwhichisconsidered
RMSpropasanoptimizerwithalearningrate1e−3,amomentum themostpopularstandardinmedicine,whichmakesmedicalimageex-
0.9andabatchsizeof8.Thelearningrateisdecreasedbyafactorof changeeasierandmoreindependentoftheimagingequipmentmanu-
0.1everytimethevalidationerrorreachesaplateau.Thedataaresplit facturer.Inadditiontotheimage,theDICOMformatcanalsosupport
intoatrainingfoldof90%andavalidationfoldof10%.Inthefoldcon- otherusefulinformation tobestdescribetheimagesuchaswidth,
struction,itispossiblethatamongconsecutiveslices,oneispresentin height,inadditiontosomedetailsrelatedtotheacquisitionsuchas,
thetrainingfoldandtheotherinthevalidationfold,whichmayinduce technology used, serial number, date of acquisition (Mustra et al.,
abiasintheestimationoftherealriskfromthevalidationfold.How- 2008).The512×512pixelsimagesareextractedfromtheDICOMs
ever,aswillbeshownintheresults,theselectednetworkwhichmini- forthethreetasksofcenterdetection,contourandknotssegmentation.
mizesthevalidationlossisstillabletogeneralizetounseentrees,even SomesampleimageswiththeirapparentknotsareshowninFig.6.The
fromunseenspecies.Topreventoverfitting,inadditiontotheaugmen- Figs.6showX-rayimagescontainingfrom1to5knots.
tationstrategy,andweightdecayof10−8,weusedearlystoppingby
selectingthebestmodelastheoneminimizingtheBCElossontheval- 4.1.2.Annotations
idationfold.Thedatasetusedforthetrainingiscomposedof9Abies Thedatasethasbeenmanuallyannotatedforthedifferenttasksby
(Fir)treewhichrepresents2504annotatedimages.Thepipelinefor ourselves.Forthecenterdetectiontask,thelabelsareprovidedinthe
formofX,Yfloatingcoordinatesofthewood-logsbiologicalcenters.
Forthesegmentationtasks(eq.knotsandcontours)thelabelsarepro-
3 Inthistask,oneveryslice,positiveandnegativesamplesareapproximatelybalanced, videdintheformofbinarymasks,eachwood-logisassociatedwithits
henceaBCElossmakessense. relatedbinarymask.
17S.Khazem,A.Richard,J.Fixetal. ArtificialIntelligenceinAgriculture7(2023)13–26
Fig.4.ThepipelineforthetreecontoursegmentationisbasedonanEncoder-DecoderU-Netarchitecture.Trainingisperformedonaugmenteddata,applyingrandomnon-destructive
transformationtothetrainingimagesandbinarymasks.
Fig.5.PipelineforthetreeknotssegmentationisbasedonanEncoder-DecoderU-Netarchitecture.Trainingisperformedonaugmenteddata,applyingrandomnon-destructivetransfor-
mationtothetrainingimagesandbinarymasks.Theimageontherightofthepipelineillustratesaprediction(yellowmask)overlayedwiththeinput.
Fig.6.ExamplesofusedX-rayimagesandknotconfigurationwithacolorcodingrepresentingthewooddensity.(6-a)showsanexampleofaconfigurationwhichcontains1knot.(6-b)
illustratesanexamplewith3knotswhichcontainnoisecausedbythewetsapwoodand(6-c)showsanexamplewith5knotswhichalsocontainsomenoisecausebythewetsapwood.
4.2.Implementationdetails 4.3.Metrics
WeusedNeptune4andTensorboard5platformstotracktheexperi- Fortheseveralexperiments,weuseddifferentquantitativemetrics
mentsandlogthecurves(meanabsoluteerror,crossentropylossand toevaluatethequalityandperformanceofourapproaches.Forthere-
Diceloss).WeusedseveralworkstationswithanNVIDIARTX3090 gression task (centers detection) we use the Mean Absolute Error
GPU,anAMDRyzen5950×16coresand32threadsfortrainingand
inference.
Theentiredatapreprocessing,thenetworkmodelsinvolvedinthe Table2
experiment,aswellasthenetworktraining,wereprogrammedinPy- Modelcomparisonwithdifferentparameters.Themetricsareevaluatedonthevalidation
fold.
thonandPytorch(Paszkeetal.,2019)withNvidiaCUDA.6Thecenter
detectiontaskwasconductedfor40epochs,Thesegmentationtasks Augmentation MAE(px) MAE(mm)
(contourandknots)wereconductedfor100epochspermodel. / 6.6 6.58
RandomContrast 3.9 3.89
VerticalFlip 3.1 3.09
HorizontalFlip 2.3 2.29
4 https://neptune.ai
ShiftScaleRotation 1.2 1.19
5 https://www.tensorflow.org/tensorboard
All 1.1 1.09
6 ComputeUnifiedDeviceArchitecture
18S.Khazem,A.Richard,J.Fixetal. ArtificialIntelligenceinAgriculture7(2023)13–26
Fig.7.Overviewoftheresultsofthemodelfordifferentspeciesfor8000samples.
(MAE)asametrictomeasuresthequalityofthepredictor.Forsegmen- 4.4.Resultsanddiscussions
tationtasks(contourandknots),weevaluatetheDicecoefficient(Dice),
AccuracyandMeanIntersectionOverUnion(meanIoU).Wedenotedby 4.4.1.Centerdetection
asfinalpredictionandythetruevaluetobepredicted.Forthesegmen- Inthissection,wepresenttheresultsofthenetworkperformanceon
tationtasks,wedenoteTP,TN,FP,FNrespectivelythenumberoftrue thetreecenterlinedetectiontask,aswellasthequantitativemetricswe
positives,truenegatives,falsepositivesandfalsenegativesbetweeny used.Table2presentstheresultsofperformancesoncenterdetection
andby.Alltheevaluationmetricsadoptedinourexperimentscouldbe taskwithdifferentparameters.
formulatedasfollows: AsshowninTable2,ournetworkachievesagoodMAEforthediffer-
entparametersweevaluated.Inparticular,wetesteddifferenttypesof
4.3.1.Meanabsoluteerror(MAE) augmentationsindividuallytoseetheeffectofeachoneontheperfor-
manceofthemodel.Wecanobservethatthedataaugmentationtech-
∀y;y^∈ℝ;MAEðy;y^Þ¼jy−y^j ð4Þ niquesimprovedconsiderablytheperformanceofthenetworks.Itcan
bealsoobservedthatShift-Scale-RotationandHorizontalFlipwhich
arespatial-leveltransformshavemoreeffectontheperformancethan
pixel-leveltransformsuchasRandomContrast.Nevertheless,bycom-
4.3.2.Dicescore/F1score
biningalltheproposedaugmentations,weachievedabetterperfor-
(cid:5) (cid:6) mance with a MAE of 1.1 pixel on the valid dataset, which
(cid:5) (cid:6) 2TP y,by
∀y,by∈f0,1gN,Dice y,by ¼ (cid:5) (cid:6) (cid:5) (cid:6) (cid:5) (cid:6) ð5Þ correspondtoanerrorof2.2 mm.TheMAEmetriciscalculatedon
2TP y,by þFP y,by þFN y,by theoriginalimage(256×256).
Tobetterhighlighttherobustnessofthemodel tothedifferent
species,wetestedourmodelwithseveralspecies.TheFig.7presents
thequantitativeresultforeachspecie.Wenoticedthatexceptthelittle
4.3.3.MeanintersectionoverUnion(meanIoU)
variabilityoftheprecisionbetweenspecies,theexperiencerevealsthat
(cid:5) (cid:6) themodelisgloballyrobust.Wealsoevaluatedasimplepredictorthat
(cid:5) (cid:6) TP y,by
∀y,by∈f0,1gN,IoU y,by ¼ (cid:5) (cid:6) (cid:5) (cid:6) (cid:5) (cid:6) ð6Þ alwaysoutputthecenteroftheimage,independentlyofthespecies.
TP y,by þFP y,by þFN y,by
Weobtainedanerrorof7.88pixelcomparedto2.84pixelforourmodel.
19S.Khazem,A.Richard,J.Fixetal. ArtificialIntelligenceinAgriculture7(2023)13–26
Fig.8.Qualitativeanalysisofourmodelwithdifferenttrees.Thefirstrowcorrespondstotheinputimages,thesecondrowistheassociatedgroundtruth,thethirdoneisthepredictions
andthelastoneillustratesazoominonthepredictionswherethebluecrossrepresentsthepredictionandtheyellowisthegroundtruth.
Additionally,wetestedtheimpactofusingAMP(AutomatedMixed
Table3
Precision)ontheperformanceofthemodel,andwenoticedthatthedif-
Modelcomparisonwithdifferentparameters,themetricsbeingcomputedonthevalida-
ferenceinperformanceisnotsignificant.Forsimplemodels,weob-
tionfoldofthefirtreedataset.
tained6.1pixel(6.09mm)withoutAMPand6.6pixel(6.58mm)with
Architecture Augmentation meanDice/F1score MeanIoU
AMP.However,whenusingAMP,thegainoftrainingtimeandtheuse
of memory is significant. This is consistent with the work of U-Net / 0.875 0.780
(Micikeviciusetal.,2018),whichshowedthattheuseofAMPleadsto U-Net FlipandRotate 0.878 0.785
speedupsofafactor2-6×comparedtothetraditionalmethod(FP32)
withlessmemoryconsumption.Asaresult,alltheevaluationspre-
sentedinthispaperuseAMPbydefault. QualitativeresultsareshowninFig.9.Visually,thenetworkdetected
QualitativeresultsareshowninFig.8.Visually,thisrevealsthatthe themasksofthewoodlogareaprecisely.
modeldetectedthecentersprecisely.Specifically,thelastrowofthe Takingintoaccountthatourmodelwasonlytrainedonfirtrees,and
Fig.8highlightshowsmallistheerrorbetweenthegroundtruthand tobetterhighlightitsrobustness,weexperimenteditonmanyspecies
theprediction,asshownintheTable2.Globally,theexperimentalresult withdifferentshapesandsizes,noneofwhichwasseenintraining.
showsthatourapproach,incombinationwithsomefine-tuning,iseffi- Fig.10presentsthequalitativeresultsoftherobustnessofourmodel.
cienttotacklethecenterdetectiontaskaccuratelywhilehavingagood Wenoticedthatourmodelwasabletogeneralizethepredictionwith
generalization. otherspeciesthathaveneverbeenobservedontrainingprocess.Unfor-
tunately,duetothelackoflabelsforalltheotherspeciesatthetimeof
4.4.2.Contoursegmentation thiswriting,wecannotcomputethemetricsonallthedatasetaswedid
Inthissection,wepresenttheresultsofthenetworkperformance forthecenterlineprediction.
andthequantitativemetricsusedforthecontoursegmentationtask. ThisexperimentalresultrevealsthattheU-Netarchitecture,with
Table3presentstheperformanceofthemodel,bothwithandwithout agoodpre-processingcombinedwithagoodsetofparametersand
dataaugmentation.Asshowninthesametable,wecanseethatthepro- hyperparameters, is sufficient to capture the complex texture of
posednetworkachievesgoodscoresinbothcases.Weseeasmallim- treesliceCTimageswhilehavingagoodperformanceandrobust-
provement for the performance using random flip and random ness.TheacaciaandfirtreespresentedinFig.10provetheability
rotation.Theperformancesofthesegmentationnetworkarereasonably ofthemodeltogeneralizethepredictiontodifferentshapesand
goodbutthedataaugmentationhasonlyaverylimitedimpactonthem. sizes,astheacaciatreeissmallerthantheexampledatausedduring
20S.Khazem,A.Richard,J.Fixetal. ArtificialIntelligenceinAgriculture7(2023)13–26
Fig.9.QualitativeanalysisofourmodelfordifferentFirtreespecies.Thefirstrowcorrespondstotheinputimages,thesecondrowistheassociatedgroundtruthandthefinaloneisthe
predictions.Thesesamplesallbelongtothevalidationset.
Fig.10.Qualitativeanalysisoftherobustnessofourmodelwithdifferenttreespecies.Thefirstrowcorrespondstotheinputimages,thesecondrowisthepredictions,andthelastone
illustratesanoverlayoftheprediction.
Fig.11.Exampleofnetworkmispredictions.Thefirstcolumncorrespondstotheinputimages,thesecondcolumnistheassociatedgroundtruthandthefinaloneisthepredictions.Thered
framehighlightsthemispredictionpart.S.Khazem,A.Richard,J.Fixetal. ArtificialIntelligenceinAgriculture7(2023)13–26
Table4 showninFig.11.Onthesesamples,thedifficultyseemstostemfrom
Modelcomparisonwithdifferentparameters. thesimilaritybetweenthetrunkandtheobjectsaroundthem.More-
Architecture Augmentation MeanDice/F1score over,themodelstrugglestodistinguishbetweentheboundaryofthe
trunkandthewedgethatisveryclosetoit.Themispredictionishigh-
U-Net / 0.645
lightedinaredframeinFig.11.
U-Net Flipping&rotation 0.698
4.4.3.Knotsegmentation
thetraining,andthisfirtreeloghasaparticularshape.Despitethis, Finally,weexperimentedourproposedmethodologyfortheknot
themodelwasabletosegmentpreciselytheentirevisiblepartof segmentationtask.Quantitativeresultsofthebestmodelminimizing
thetree.Moresamplesofdifferentspeciesareillustratedinappendix theDicescoreonthevalidationareshowninTable4,withorwithout
AppendixA. dataaugmentation.Quantitatively,onaper-casebasis,wecanseethat
Additionally,tobetterhighlightthelimitsofourapproach,wese- theproposedarchitectureachievesagoodscore.Wecanalsoseethat
lectedthevalidationsamplesforwhichtheDicescorewasthelowest. asimpledataaugmentationpipelinebringsimprovement,whichvali-
Thesesamples,alongwiththeirpredictionsandgroundtruths,are datestheimportanceofvariabilityofthedatasetandtheefficiency
Fig.12.Qualitativeanalysisofourmodelfordifferentfirtrees.Thefirstrowcorrespondstotheinputimages,thesecondrowistheassociatedgroundtruthandthefinaloneisthe
predictions.
Fig.13.Qualitativeanalysisoftherobustnessoftheknotsegmentationmodelwithdifferenttreespecies.Thefirstrowcorrespondstotheinputimages,thesecondrowisthemask
predictions,andthelastoneillustratesanoverlayoftheprediction.
22S.Khazem,A.Richard,J.Fixetal. ArtificialIntelligenceinAgriculture7(2023)13–26
predictionoftreesemanticfeaturesinX-rayimages.Theproposed
methodsincludethreeend-to-endpipelinesthatperformrespec-
tivelythetreecenterlineregression,thecontoursandknotsseg-
mentations.Thedifferentresultsobtainedhavedemonstratedthe
efficiencyofthismethodologyandmainlyitsrobustnessonnew
unseen samples,whichsupportstherelevanceofdeeplearning
basedapproachesforthesetasks.Theseresultsalsohighlighted
thegeneralizationcapacityofthemodelsondifferentspecieswith
variousshapesandsizes,despitethelimitednumberofannotated
data.
However,asoftoday,wealsoidentifiedthefollowinglimita-
tions.Thefirstlimitationcomesfromthesmallsizeofchallenging
detailsthatthemodelwasunabletocaptureonsomespecies.This
isespeciallytruewiththecontourstaskasshowninFig.11where
themodelstruggletodistinguishtheboundaryofthetrunkfrom
thesupportingwedge,andwiththeknotsegmentationtask(See
Fig.14.Exampleofnetworkpredictionlimits,thefirstcolumncorrespondstotheinput
Fig.14)wherethemodelfailstodetecttheentireknotinachal-
image,thesecondoneistheassociatedgroundtruthandthethirdoneistheprediction
lengingimagecharacterizedbythesmallsizeoftheknot.Thesec-
onwhichweseethatpartoftheknotisnotcorrectlydetected.
ondlimitationcomesfromthecomplexityoftheknotstructures
andthedensitysimilaritywiththesurroundingwoodinsomein-
ofusingdataaugmentationontheperformanceofthesegmentation stances,whichleadstocompletedetectionfailure(Fig.14).These
network. limitationscouldbepartiallyaddressedbyannotatingmoredata
QualitativeresultsareshowninFig.12,wecanseevisuallythatour withcomplexstructuressoastohelpthemodeltocapturesmall
networkdetectstheknotsprecisely,wealsonoticedthattheproposed detailsandspecies-specificfeatures.Therearealsovariousnetwork
methodologyexhibitsagoodperformanceonthesegmentationtaskde- architecturalopportunitiesthatcouldallowimprovingtheperfor-
spitethelimitedannotateddata(2504images),whichprovetheeffi- mancesofthepresentedapproach.Comparedtothesingleframe
ciencyofourapproach. approachwhichusesonlyspatialinformation,weintendtoexplore
Similarlytothecontoursegmentationtask,andtobetterevaluate theuseofimagesequencestotakeadvantageofthesequentialin-
the robustness of our model, we tested it on differentspecies that formationaswell.Inaddition,wearealsoconsideringaddingaspa-
haveneverbeenobservedduringthetrainingprocess.TheFig.13pre- tialattentionblocktofocusonthemostimportant,possiblydistant,
sents the qualitative resultsof therobustness,we noticed that the featurestocomputethepredictions(Wooetal.,2018).
modelwasabletogeneralizewelldespitethechallengeofthedifferent
structuresandshapesoftheknots.Unfortunately,duetolackoflabels CRediTauthorshipcontributionstatement
foralltheotherspeciesatthetimeofthiswriting,wecannotcompute
themetricsonallthedatasetaswedidforthecenterlineprediction. Salim Khazem: Conceptualization, Methodology, Software,
TheappendixAppendixBillustratesmoresamplesfordifferentspecies. Formal analysis, Investigation, Writing – original draft. Antoine
Tobetterhighlightthelimitsofourmodelonthischallengingtask, Richard:Writing–review&editing,Software,Datacuration.Jeremy
weselectedavalidationsampleforwhichtheDicescorewaslow.The Fix:Supervision,Writing–review&editing,Software,Validation.
sample, along with his prediction and ground truth, is shown in Cédric Pradalier: Supervision, Writing – review & editing, Data
Fig.14.Onthissample,thedifficultyseemstostemfromthesmall curation,Validation.
sizeoftheknotandthesimilaritybetweenthedensityoftheknotand
thesurroundingwood,whichmayexplainwhythenetworkfailstopre- Declarationofcompetinginterest
dicttheentireknot.Asasidenote,onthisfigure,onecannoticesome
high-densityradialfeaturesnotlabeledasknotsintheground-truth. Theauthorsdeclarethattheyhavenoknowncompetingfinancial
Thesewooddefectsarenotlabeledasknotsbecausetheyarenotrelated interestsorpersonalrelationshipsthatcouldhaveappearedtoinflu-
tothegrowthofabranch.Thenetworkcorrectlyignorestheminthis encetheworkreportedinthispaper.
segmentationtask.
Acknowledgment
5.Conclusion
ThisresearchwasmadepossiblewiththesupportfromtheFrench
Inthispaper,weintroducedaneffectivemethodologybasedon NationalResearchAgency,intheframeworkoftheprojectWoodSeer,
deep convolutional neural networks to perform detection and ANR-19-CE10-011.
23S.Khazem,A.Richard,J.Fixetal. ArtificialIntelligenceinAgriculture7(2023)13–26
AppendixA.Contoursegmentation
Thefigurebelowdepictsanumberofqualitativeresultsofcontoursegmentationappliedtovarioustreespeciesnotseeninthetrainingdataset
andforwhichthegroundtruthisnotavailable.
24S.Khazem,A.Richard,J.Fixetal. ArtificialIntelligenceinAgriculture7(2023)13–26
AppendixB.Knotssegmentation
Thefigurebelowdepictsanumberofqualitativeresultsofknotsegmentationappliedtovarioustreespeciesnotseeninthetrainingdatasetand
forwhichthegroundtruthisnotavailable.
25S.Khazem,A.Richard,J.Fixetal. ArtificialIntelligenceinAgriculture7(2023)13–26
AppendixC.UNetarchitecture Kingma,D.P.,Ba,J.,2015.Adam:amethodforstochasticoptimization.ICLR(Poster).
Krähenbühl,A.,Kerautret,B.,Debled-Rennesson,I.,Longuetaud,F.,Mothe,F.,2012.Knot
detectioninX-rayCTimagesofwood.InternationalSymposiumonVisualComput-
TableC.5 ing.Springer,pp.209–218.
Unetarchitecture.Conv(n)denotesa2Dconvolutionallayerwithnkernelsofsize(3,3). Krähenbühl,A.,Kerautret,B.,Debled-Rennesson,I.,2013a.Knotsegmentationinnoisy3d
Everyconvolutionhasastride1andzeropaddingofsize1.MaxPoolisa2Dmaxpooling imagesofwood.InternationalConferenceonDiscreteGeometryforComputerImag-
layerwithkernelsize(2,2),stride2. ery.Springer,pp.383–394.
Krähenbühl,A.,Kerautret,B.,Debled-Rennesson,I.,2013b.Tkdetection:aSoftwaretoDe-
Input(512×512)
tectandSegmentWoodKnots.Imagen-a3.URLhttps://hal.archives-ouvertes.fr/hal-
E1: Conv(64),BatchNorm,Relu 01265531.
Krähenbühl,A.,Kerautret,B.,Debled-Rennesson,I.,Mothe,F.,Longuetaud,F.,2014.Knot
En:fornin{2.0.5}: segmentationin3dctimagesofwetwood.PatternRecogn.47,3852–3869.
with2c0=128 LeCun,Y.,Bengio,Y.,Hinton,G.,2015.Deeplearning.Nature521,436–444.https://doi.
MaxPool org/10.1038/nature14539.
4(cid:3)4Convð2ðn−2Þ(cid:3)c0Þ;BatchNorm;Relu Liu,Z.,Lin,Y.,Cao,Y.,Hu,H.,Wei,Y.,Zhang,Z.,Lin,S.,Guo,B.,2021.Swintransformer:
Convð2ðn−2Þ(cid:3)c0Þ;BatchNorm;Relu hierarchicalvisiontransformerusingshiftedwindows.2IEEE/CVFInternationalCon-
D1: C Co on nv caT tr (a En 4s )pose(512) f IEer Ee En ,c pe po .n 99C 9o 2m –1p 0u 0te 0r 2V hi ts ti pon s:, /I /C dC oV i.o2 rg0 /2 11 0, .M 11o 0n 9t /r Ie Ca Cl V,Q 48C 9, 2C 2an .2a 0d 2a 1, .O 00ct 9o 8b 6e .r10-17,2021.
Conv(512),BatchNorm,Relu Liu,Z.,Mao,H.,Wu,C.,Feichtenhofer,C.,Darrell,T.,Xie,S.,2022.AConvnetforthe2020s.
D2: ConvTranspose(256) LongC oo ,R BR .,a Bb rüs/ c2 h2 e0 r1 t,.0 F3 .,5 B4 e5 c. kU erR ,L Gh .,t Stp aus: t/ e/ ra ,r Uxi .v ,. 2o 0r 1g/ 9a .b Vs a/2 li2 d0 a1 ti. o0 n35 o4 f5 a. ca trX ki nv o:2 t2 d0 e1 te.0 c3 ti5 o4 n5 a.
lgo-
Concat(E3)
rithmonfreshDouglas-fir(pseudotsugamenziesii(mirb.)franco)logs.Ann.For.Sci.
Conv(256),BatchNorm,Relu
76.https://doi.org/10.1007/s13595-019-0812-4.
D3: ConvTranspose(128) Lopes,D.J.V.,dosSantosBobadilha,G.,Grebner,K.M.,2020.Afastandrobustartificialin-
Concat(E2) telligencetechniqueforwoodknotdetection.BioResources15,9351–9361.https://
Conv(128),BatchNorm,Relu doi.org/10.15376/BIORES.15.4.9351-9361.
D4: ConvTranspose(64) Marcos,D.,Tuia,D.,Kellenberger,B.,Zhang,L.,Bai,M.,Liao,R.,Urtasun,R.,2018.Learning
Concat(E1) deepstructuredactivecontoursend-to-end.Proc.IEEEConf.Comput.Vis.Pattern
Conv(64),BatchNorm,Relu Recognit,pp.8877–8885.
Output: Conv(ncls),Sigmoid Micikevicius,P.,Narang,S.,Alben,J.,Diamos,G.,Elsen,E.,Garcia,D.,Ginsburg,B.,Houston,
Outputshape(512×512) M.,Kuchaiev,O.,Venkatesh,G.,etal.,2017.MixedPrecisionTrainingarXivpreprint
arXiv:1710.03740.
Micikevicius,P.,Narang,S.,Alben,J.,Diamos,G.,Elsen,E.,Garcia,D.,Ginsburg,B.,Houston,
References M.,Kuchaiev,O.,Venkatesh,G.,Wu,H.,2018.Mixedprecisiontraining.arXiv:
1710.03740[cs,stat]URLhttp://arxiv.org/abs/1710.03740.
Badrinarayanan,V.,Kendall,A.,Cipolla,R.,2016.SegNet:ADeepConvolutionalEncoder- Mustra,M.,Delac,K.,Grgic,M.,2008.Overviewofthedicomstandard.50thinternational
DecoderArchitectureforImageSegmentation.arXiv:1511.00561[cs]URLhttp://
symposiumELMAR.IEEE,pp.39–44.
arxiv.org/abs/1511.00561. Norlander,R.,Grahn,J.,Maki,A.,2015.Woodenknotdetectionusingconvnettransfer
Bhandarkar,S.M.,Faust,T.D.,Tang,M.,1999.CATALOG:asystemfordetectionandren-
learning.ScandinavianConferenceonImageAnalysis.Springer,pp.263–274.
deringofinternallogdefectsusingcomputertomography.Mach.Vis.Appl.11, Paszke,A.,Gross,S.,Massa,F.,Lerer,A.,Bradbury,J.,Chanan,G.,Killeen,T.,Lin,Z.,
171–190.https://doi.org/10.1007/s001380050100. Gimelshein, N., Antiga, L., et al., 2019. Pytorch: an imperative style, high-
Buslaev,A.,Iglovikov,V.I.,Khvedchenya,E.,Parinov,A.,Druzhinin,M.,Kalinin,A.A.,2020. performancedeeplearninglibrary.Adv.NeuralInf.Proces.Syst.32.
Albumentations:fastandflexibleimageaugmentations.Inf.11,125.https://doi.org/ Perez,L.,Wang,J.,2017.TheEffectivenessofDataAugmentationinImageClassification
10.3390/info11020125. UsingDeepLearningarXivpreprintarXiv:1712.04621.
Chaurasia,A.,Culurciello,E.,2017.LinkNet:exploitingencoderrepresentationsforeffi- Redmon,J.,Farhadi,A.,2018.Yolov3:AnIncrementalImprovementarXivpreprintarXiv:
cientsemanticsegmentation.IEEEVisualCommunicationsandImageProcessing 1804.02767.
(VCIP),pp.1–4URL. Ronneberger,O.,Fischer,P.,Brox,T.,2015.U-Net:ConvolutionalNetworksforBiomedical
Cortes,C.,Vapnik,V.,1995.Support-vectornetworks.Mach.Learn.20,273–297. ImageSegmentation.arXiv:1505.04597[cs]URLhttp://arxiv.org/abs/1505.04597.
Dosovitskiy,A.,Beyer,L.,Kolesnikov,A.,Weissenborn,D.,Zhai,X.,Unterthiner,T., Shorten,C.,Khoshgoftaar,T.M.,2019.Asurveyonimagedataaugmentationfordeep
Dehghani,M.,Minderer,M.,Heigold,G.,Gelly,S.,Uszkoreit,J.,Houlsby,N.,2021.An learning.J.BigData6,60.https://doi.org/10.1186/s40537-019-0197-0.
ImageIsWorth16x16Words:TransformersforImageRecognitionatScale.9thInter- Simonyan,K.,Zisserman,A.,2015.Verydeepconvolutionalnetworksforlarge-scale
nationalConferenceonLearningRepresentations,ICLR2021,VirtualEvent,Austria, imagerecognition.In:Bengio,Y.,LeCun,Y.(Eds.),3rdInternationalConferenceon
May 3–7, 2021. OpenReview.net URL https://openreview.net/forum?id= LearningRepresentations,ICLR2015,SanDiego,CA,USA,May7–9,2015,Conference
YicbFdNTTy. TrackProceedings URLhttp://arxiv.org/abs/1409.1556.
Gao,M.,Song,P.,Wang,F.,Liu,J.,Mandelis,A.,Qi,D.,2021b.Anoveldeepconvolutional Sudre,C.H.,Li,W.,Vercauteren,T.,Ourselin,S.,JorgeCardoso,M.,2017.Generaliseddice
neuralnetworkbasedonresnet-18andtransferlearningfordetectionofwoodknot overlapasadeeplearninglossfunctionforhighlyunbalancedsegmentations.Deep
defects.J.Sensor.https://doi.org/10.1155/2021/4428964. LearninginMedicalImageAnalysisandMultimodalLearningforClinicalDecision
Gao,M.,Chen,J.,Mu,H.,Qi,D.,2021a.Atransferresidualneuralnetworkbasedonresnet-
Support.Springer,pp.240–248.
34fordetectionofwoodknotdefects.Forests12,1–16.https://doi.org/10.3390/ Tan,M.,Le,Q.,2019.Efficientnet:rethinkingmodelscalingforconvolutionalneuralnet-
F12020212.
works.InternationalConferenceonMachineLearning.PMLR,pp.6105–6114.
He,K.,Zhang,X.,Ren,S.,Sun,J.,2016.Deepresiduallearningforimagerecognition.Proc. Touvron,H.,Cord,M.,Douze,M.,Massa,F.,Sablayrolles,A.,Jégou,H.,2021.Trainingdata-
IEEEConf.Comput.Vis.PatternRecognit,pp.770–778. efficientimagetransformers&distillationthroughattention.In:Meila,M.,Zhang,T.
He,K.,Gkioxari,G.,Dollár,P.,Girshick,R.,2017.Maskr-cnn.ProceedingsoftheIeeeInter- (Eds.),Proceedingsofthe38thInternationalConferenceonMachineLearning,
nationalConferenceonComputerVision,pp.2961–2969. ICML2021,18–24July2021,VirtualEvent.PMLR,pp.10347–10357URLhttp://
Howard,A.G.,Zhu,M.,Chen,B.,Kalenichenko,D.,Wang,W.,Weyand,T.,Andreetto,M., proceedings.mlr.press/v139/touvron21a.html.
Adam,H.,2017.Mobilenets:EfficientConvolutionalNeuralNetworksforMobileVi- Woo,S.,Park,J.,Lee,J.Y.,Kweon,I.S.,2018.Cbam:convolutionalblockattentionmodule.
sionApplicationsarXivpreprintarXiv:1704.04861.
ProceedingsoftheEuropeanConferenceonComputerVision(ECCV),pp.3–19.
Johansson,E.,Johansson,D.,Skog,J.,Fredriksson,M.,2013.Automatedknotdetectionfor
Xiong,Y.,Liao,R.,Zhao,H.,Hu,R.,Bai,M.,Yumer,E.,Urtasun,R.,2019.Upsnet:aunified
highspeedcomputedtomographyonpinussylvestrisl.andpiceaabies(l.)karst. panopticsegmentationnetwork.ProceedingsoftheIEEE/CVFConferenceonCom-
Usingellipsefittinginconcentricsurfaces.Comput.Electron.Agric.96,238–245URL. puterVisionandPatternRecognition,pp.8818–8826.
Kerautret,B.,Lachaud,J.O.,2009.Curvatureestimationalongnoisydigitalcontoursbyap-
proximateglobaloptimization.PatternRecogn.42,2265–2278.https://doi.org/10.
1016/J.PATCOG.2008.11.013.
26