drawn from the same distribution, which is essential for the success of a trained NN (Kouw, 2018). Thus, many synthetically trained NNs have performed poorly on real data. On the other hand, training on real data provides NNs that are often, at best, as good as the accuracy of the labels that were determined by humans or human-crafted algorithms (weak supervision, due to limited labels or labels prone to errors Kara- manolakis et al., 2021). So, the data-driven feature of machine learning, in this case, will be highly compromised (Zhou, 2017; Zheng et al., 2021). As a result, we should synthetically generate data for training our NN that are as realistic as possible.

The concept of trying to bridge the gap between the training and application data in machine learning is referred to as domain adap- tation (Kouw, 2018; Lemberger and Panico, 2020). In this case, the training dataset is assumed to belong to the source domain and the application/inference data are assumed to belong to the target domain, the target of our training. The classic theory of machine learning as- sumes that the application (target) data of a trained model should come from the same general population (sampled from the same distribution) as the training (source) set. So we need the probability distribution accomplished by projecting the source and target data to the eigenvec- tors of the two subspaces, then finding a transformation between these projected spaces. Such projections can be achieved by Neural Network embeddings (which are low-dimensional, learned continuous vector representations of discrete variables, Koehrsen, 2018) aimed to find the weights of the embedding layers that minimizes the distance between the distribution of the source samples and the target ones. There are many ways to constrain the transformation or weights to make the distributions similar including the use of optimal transport (Villani, 2008). In this category, even cycle Generative Adversarial Networks (GANs) are used for the purpose of learning a generator to map the target data distribution to the source data distribution (Palladino et al., 2020). However, these methods become more difficult to apply when the dimensions of the data are large, as is the case with waveform (including seismic and ultrasound) data. The method proposed in this paper shares the general framework of subspace alignment imple- mented in an empirical fashion, and specifically tailored for waveform (like seismic) data.

The method proposed here is applicable mainly to supervised learn- ing. Also, we assume that the vertical axis of the input sections (images or shot gathers) are not crucial in absolute values to the task at hand. Only the relative relation between events matters along that dimension. The reason for this assumption will be clear later.

We assume we do not have labels for the application data, and thus, we cannot perform transfer learning (a form of domain adaptation) (Wu et al., 2020). In our case, the source synthetic data are labeled, but the target real data are not. This form of domain adaptation is often addressed with unsupervised ML methods (Fernando et al., 2013). In such domain adaptation, another important assumption is implied, and data generation represents the actual physical behavior. In other words, the assumptions used to model the synthetic training set represent the object of application (like the Earth). This assumption is used in most optimization applications including FWI (Tarantola, 1987b). Thus, the

of the real data imprint on the training set. Assuming we only have noise in the real data, the autocorrelation of random noise yields a quasi delta function at zero lag proportional to the energy of the noise. A convolution with such a function will incorporate that energy into the synthetic data so that the signal-to-noise ratio (SNR) in the transformed synthetic data would be comparable to that of the autocorrelated real data.

Thus, the steps involved in the transformations, suggested here for domain adaptation, can be summarized using Algorithm 1 during training stage. After training, the application (inference) on the real data can be summarized using Algorithm 2. Considering the linear nature of the transforms involved, all the transformation steps can be performed efficiently in the Fourier domain. We only need to inverse Fourier transform of the data at the end of the process.

respectively. We also find it helpful to initialize the network follow- ing (He et al., 2016), as well as to average predictions within an ensemble (Chollet, 2017) of 5 network initializations to reduce noise in the output data. One more note about training is that we setthe set the

the marine streamer and the number of time samples, respectively. Receivers are spaced 25 m apart while the temporal sampling is coars- ened to 8 ms. We create a training dataset of 3072 shot gathers by modeling 3 shots in each of the 1024 random subsurface realizations. These shots are then split into partitions of 2765, 154, and 153 samples for training, validation, and testing, respectively. The set of random subsurface models is derived by distorting the layered models using

One of the reasons for the crosscorrelation with a reference trace is to balance the contributions from synthetic and real data in the input data to the network, without affecting the general features of the input data. In the microseismic example, this operation also helped reduce the input data size. The fact that the input-to-the-network is effectively different from the original data is not an issue for NN models, as they adapt to any data we deem as input. What matters is whether the input is consistent between the training (source) and application (target) data. Actually, the cross-correlation operation can enhance the data with features (from the cross-talk between unrelated events) that will further enrich the training data with information that can help in identifying the corresponding labels. For example, if a shot gather includes two reflections, the crosscorrelation of that shot gather with a reference trace from it will result in two additional events from the crosstalk of the two events, and these added events will be different from one shot gather to another depending on the distance between the two events and their moveouts. Such additional events will add to the information embedded in the input data that the NN model can use to learn to identify the corresponding labels.

We proposed a novel technique to precondition the synthetic train- ing data set for a supervised neural network optimization so that the trained model works better on real data. The concept is based on incorporating as much information from the real data into the training without harming the synthetic data features crucial for the prediction. Considering the two data domains (synthetic and real), we specifically cross-correlate an input section from one domain of data with a reference trace from that data followed by convolution with an autocorrelated section from the other domain. For training the NN model, the input section is from the synthetic data domain, and for the application (inference) of the NN model, the input section is from the real data domain. A test of this approach on a microseismic source

We thank Umair bin Waheed from KFUPM, Frantisek Stanek from Seismik, and Claire Birnie and Yuanyuan Li from KAUST for helpful discussions. We thank Microseismic, Inc. and Newfield Exploration Mid-Continent, Inc. for graciously supplying the data. We thank CGG for the marine dataset. We also thank KAUST for its support and the seismic wave analysis group (SWAG) for constructive discussions.

