In this paper a new technique is introduced for bias compensation of gyroscopes with a focus on mobiles phones. The standard problem of using gyroscopes is that integration of raw angular rates with non-zero bias will lead to continuous drift of the estimated orientation. To examine the nature of this bias, a simple error model was constructed for the whole device in terms of inertial sensing. For eliminating the bias, a sensor fusion algorithm was developed using the benefits of optical flow from the camera of the device. Our orientation estimator and bias removal method is based on complementary filters, in combination with an adaptive reliability filter for the optical flow features. The feedback of the fused result is combined with the raw gyroscope angular rates to compensate the bias. Various measurements were recorded on a real device running the demanding optical flow onboard. This way a robust and reliable fusion was constructed, which matched our expectations, and has been validated with simulations and real world measurements.

The accuracy of optical flow estimation algorithms have been improving steadily as evidenced by results on the Middlebury optical flow benchmark. In [4] the authors attempt to uncover what has made recent advances possible through a thorough analysis of how the objective function, the optimization method, and modern implementation practices influence accuracy. They have found that while median filtering of intermediate flow fields during optimization is a key to recent performance gains, it leads to higher energy solutions. In order to understand the principles behind this phenomenon, they have derived a new objective that formalizes the median filtering heuristic and they have developed a method that ranks at the top of the Middlebury benchmark.

Simulations were done in MATLAB after all raw data had been recorded on the mobile device. For testing different critical situations, various datasets were generated and also used to measure reliability of the algorithm. In this paper focus is taken on real world measurements.

To find the third absolute angle, magnetometers can be utilized. Measuring the geomagnetic field that is strictly not parallel with the gravity vector, a 3D Earth-based absolute orientation can be constructed using the previous filtered gravity and the geomagnetic data. Although, magnetic field is often perturbed mostly in non- natural scenes, such as buildings, underground, close to wiring or electrical devices. If an orientation estimation algorithm relies on the fact that on the long term magnetometer values are trustworthy, the output angles will be deceiving in the mentioned situations.

The filtering algorithm is constructed by three main blocks. The reliability calculation and aggregation has already been discussed. On its input it receives all the feature displacements and the bias compensated angular rate of the gyroscope. Both the result of optical flow and the compensated gyroscope value are processed by a complementary filter. The aim of this block is to create a good balance between slowly changing but on the long-term precise optical flow results, and the fast changing gyroscope angular rates. Complementary filters are easy to implement, quick to be computed, and in this case the results are satisfying. For it is assumed that the final output angular rate will be used by a sophisticated orientation estimator that combines it with acceleration and geomagnetic data, (like extended Kalman filters or the algorithm of Madgwick [1]) it is unnecessary here to apply such for the results. On its input it high-pass and low-pass filters the data, and uses

Future plans include testing of other methods for the correlation observation of gyroscope angular rates and optical flow feature displacement values. Other plans include the testing of Kalman filters, and RANSAC for the optical flow processing. The aggregation method of the reliable features has also further possibilities by using more sophisticated methods, like weighted median filters.

