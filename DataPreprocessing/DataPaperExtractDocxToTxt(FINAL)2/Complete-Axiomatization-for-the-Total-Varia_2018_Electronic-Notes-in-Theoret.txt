Available online at www.sciencedirect.com


Electronic Notes in Theoretical Computer Science 336 (2018) 27–39
www.elsevier.com/locate/entcs


Complete Axiomatization for the Total Variation Distance of Markov Chains
Giorgio Bacci1 Giovanni Bacci Kim G. Larsen Radu Mardare
Department of Computer Science, Aalborg University, Denmark

Abstract
We propose a complete axiomatization for the total variation distance of finite labelled Markov chains. Our axiomatization is given in the form of a quantitative deduction system, a framework recently proposed by Mardare, Panangaden, and Plotkin (LICS 2016) to extend classical equational deduction systems by means of inferences of equality relations t ≡ε s indexed by rationals, expressing that “t is approximately equal to s up to an error ε”. Notably, the quantitative equational system is obtained by extending our previous axiomatization (CONCUR 2016) for the probabilistic bisimilarity distance with a distributivity axiom for the prefix operator over the probabilistic choice inspired by Rabinovich’s (MFPS 1983).
Finally, we propose a metric extension to the Kleene-style representation theorem for finite labelled Markov chains w.r.t. trace equivalence due to Silva and Sokolova (MFPS 2011).
Keywords: Behavioral Distances, Markov Chains, Axiomatization, Quantitative Deductive Systems.


Introduction
In [12], Kleene introduced an algebra of regular events to represent behaviors of finite automata. Kleene’s approach was essentially equational, but he did not provide a completeness result for his characterization. The first sound and complete axiomatization of regular expressions is due to Salomaa [20], later refined by Kozen [13].
The above programme was applied by Milner [16] to nondeterministic process behaviors, providing a sound and complete axiomatization for bisimilarity of labelled transition systems. Milner’s work inspired a number of extensions [5,17,8,21,7], among which it is notable the work of Rabinovich [19] who axiomatized trace equivalence of labelled transition systems. The key observation in Rabinovich’s work is that trace equivalence satisfies a distributivity law for the prefix operator over nondeterministic choice. A similar idea was used by Silva and Sokolova [22] for axiomatizing probabilistic trace equivalence of (generative) labelled Markov chains. Their equational characterization extends Stark and Smolka’s [23] axiomatization for probabilistic bisimilarity by introducing a distributivity axiom for the prefix operator over probabilistic choice.
The attractiveness towards sound and complete axiomatizations for process behaviors comes from the fact that one can reason about their equivalence in a purely syntactic way by means of classical logical deduction of valid equational statements.
Giacalone, Jou, and Smolka [11,10], however, observed that for reasoning about the behavior of proba- bilistic systems (more generally, all types of quantitative systems) a notion of distance is preferable to that of equivalence, since the latter is not robust w.r.t. small variations of numerical values. This motivated the development of metric-based semantics for probabilistic systems, initiated by Desharnais et al. [9] on labelled

1 Corresponding author: grbacci@cs.aau.dk










https://doi.org/10.1016/j.entcs.2018.03.014
1571-0661/© 2018 The Author(s). Published by Elsevier B.V.
This is an open access article under the CC BY-NC-ND license (http://creativecommons.org/licenses/by-nc-nd/4.0/).

Markov chains and greatly developed and explored by van Breugel, Worrell and others [25,26,3,2]. It consists in proposing a pseudometric which measures the dissimilarities between quantitative behaviors.
Recently, in [4], we provided a sound and complete axiomatization for the probabilistic bisimilarity distance of Desharnais et al. [9] on labelled Markov chains. The axiomatization was given in the form of a quantita- tive deduction system, a concept introduced by Mardare, Panangaden, and Plotkin [15] with the purpose of developing a general research programme for a quantitative algebraic theory of effects [18]. The key idea is to use “quantitative equations” of the form t ≡ε s indexed by positive rationals to be interpreted as “t is approximately equal to s up to an error ε”. The main result in [15] is that completeness for a quantitative theory always holds on the freely-generated algebra of terms equipped with a metric that is freely-induced by the axioms.
In this paper, we present a sound and complete axiomatization for the total variation distance on labelled Markov chains, i.e. a natural metric-lifting of probabilistic trace equivalence. Interestingly, completeness is obtained by extending our axiomatization for the probabilistic bisimilarity distance [4] with the distributivity axiom for the prefix operator over probabilistic choice introduced in [22]. This shows that Rabinovich’s idea applies also in a quantitative equational scenario.
The similarities with Rabinovich’s work, however, are limited only to the style of the axioms. For our proof of completeness we had to face a number of problems that do not occur in the classical equational case [19,22]. One of the difficulties was that the recursion operator does not satisfy non-expansiveness w.r.t. the total variation distance (cf. Example 5.10). This prevented us from directly apply the general completeness result of [15], which specifically requires non-expansiveness for all algebraic operators. This issue was overcome by using a convergence result from [2], that characterizes the total variation distance as the point-wise limit of a convergent net of certain multi-steps probabilistic bisimilarity distances, that approach the total variation distance by extending the probabilistic observations from single labels to words on labels of increasing length. Then, by generalizing a proof technique used in [4], we were able to prove completeness for each of these bisimilarity-like distances, and we extended it to the total variation distance (hence, to their point-wise limit) by means of the Archimedean axiom.
As a final result we give a metric extension to the Kleene’s representation theorem of Silva and Sokolova [22] (see also [21,6]) for finite labelled Markov chains up-to trace equivalence. Specifically, we show that process expressions, equipped with the pseudometric freely-induced by the axioms, are in isometric correspondence with finite labelled Markov chains metrised by the total variation distance.
Preliminaries and Notation
For R ⊆ M × M an equivalence relation, M/R is its quotient set. For M, N sets, M N is the disjoint union, [M → N ] (or NM ) the set of functions from M to N .
A discrete sub-probability on M is a function μ : M → [0, 1], such that μ(M ) ≤ 1, where, for E ⊆ M , μ(E) =  m∈E μ(m); it is a probability distribution if μ(M ) = 1. The support of μ is the set supp(μ) = 
{m ∈ M | μ(m) > 0}. We denote by Δ(M ) and D(M ) the set of discrete probability and finitely-supported sub-probability distributions on M , respectively.
A 1-bounded pseudometric on M is a function d : M ×M → [0, 1] such that, for any m, n, u ∈ M , d(m, m)= 0, d(m, n)= d(n, m) and d(m, n)+ d(n, u) ≥ d(m, u); d is a metric if, in addition, d(m, m) = 0 implies m = n. The pair (M, d) is called (pseudo)metric space. Recall that, 1-bounded pseudometrics on M ordered point-wise by d ± d′ iff d(m, n) ≤ d′(m, n), for all m, n ∈ M , form a complete lattice (we denote by 0 and 1 the bottom and top of 1-bounded pseudometrics, respectively).
Quantitative Equational Theories
We recall the main definitions and results from [15]. Let Σ be a signature of function symbols f : n ∈ Σ of arity n ∈ N. Fix a countable set of metavariables X, ranged over by x, y, z, . . . ∈ X. Let T(Σ,X) denote the set of Σ-terms freely generated over X; terms will be ranged over by t, s, u,... A substitution of type Σ is a function σ : X → T(Σ,X) that is homomorphically extended to terms as σ(f (t1,..., tn)) = f (σ(t1),..., σ(tn)); by S(Σ) we denote the set of substitutions of type Σ.
A quantitative equation of type Σ is an expression of the form t ≡ε s, where t, s ∈ T(Σ,X) and ε ∈ Q+. We denote by E (Σ) the set of quantitative equations of type Σ; subsets of E (Σ) will be ranged over by Γ, Θ, Π,... 
Let ▶⊆ 2E(Σ) ×E (Σ) be a relation from the powerset of E (Σ) to E (Σ). We write Γ ▶ t ≡ε s if (Γ,t ≡ε s) ∈ ▶; by ▶ t ≡ε s we denote ∅▶ t ≡ε s, and by Γ ▶ Θ we mean that Γ ▶ t ≡ε s, for all t ≡ε s ∈ Θ. The relation ▶ is

called quantitative deduction system of type Σ if it satisfies the following axioms and rules (Refl) ▶ t ≡0 t, 
(Symm) {t ≡ε s}▶ s ≡ε t, 
(Triang) {t ≡ε u, u ≡ε' s}▶ t ≡ε+ε' s, (Max) {t ≡ε s}▶ t ≡ε+ε' s, for all ε > 0 , (Arch) {t ≡ε' s | ε > ε}▶ t ≡ε s, 
(NExp) {t1 =ε s1,..., tn =ε sn}▶ f (t1,..., tn) ≡ε f (s1,..., sn) , for all f : n ∈ Σ ,
(Subst) If Γ ▶ t ≡ε s, then σ(Γ) ▶ σ(t) ≡ε σ(t), for all σ ∈ S(Σ) ,
(Cut) If Γ ▶ Θ and Θ ▶ t ≡ε s, thenΓ ▶ t ≡ε s, 
(Assum) If t ≡ε s ∈ Γ, then Γ ▶ t ≡ε s. 
where σ(Γ) = {σ(t) ≡ε σ(s) | t ≡ε s ∈ Γ}.
The rules (Subst), (Cut), (Assum) are those of classical logical deduction. The axioms (Refl), (Symm), (Triang) are reflexivity, symmetry, and triangular inequality for a pseudometric, respectively; (Max) is inclusion of neighborhoods of increasing diameter; (Arch) is the Archimedean law; and (NExp) is non-expansiveness of f ∈ Σ.
A quantitative equational theory is a set U of universally quantified quantitative inferences, (i.e., expressions of the form {t1 ≡ε1 s1,..., tn ≡εn sn} ▶ t ≡ε s, with a finite set of hypotheses) closed under ▶-deducibility. A set A of quantitative inferences is said to axiomatize U , if U is the smallest quantitative equational theory containing A. A theory U is called inconsistent if ▶ x ≡0 y ∈ U , for distinct metavariables x, y ∈ X, it is called consistent otherwise 2 .
The models of quantitative equational theories are quantitative algebras.
Definition 3.1 A quantitative Σ-algebra is a tuple A = (A, ΣA, dA), consisting of a pseudometric space (A, dA) and a set ΣA = f A : An → A | f : n ∈ Σ of interpretations for f ∈ Σ, required to be non-expansive w.r.t. dA, i.e., for all 1 ≤ i ≤ n and ai, bi ∈ A, dA(ai, bi) ≥ dA(f A(a1,..., an),fA(b1,..., bn)).
A quantitative algebra A = (A, ΣA, dA) satisﬁes the inference Γ ▶ t ≡ε s, written Γ |=A t ≡ε s, if for any assignment of the meta-variables ι : X → A,
for all t′ ≡ε' s′ ∈ Γ, dA(ι(t′), ι(s′)) ≤ ε′	implies	dA(ι(t), ι(s)) ≤ ε, 
where, for a term t ∈ T(Σ,X), ι(t) denotes the homomorphic interpretation of t in A. A quantitative algebra A is said to satisfy (or is a model for) the quantitative theory U , if whenever Γ ▶ t ≡ε s ∈ U , then Γ |=A t ≡ε s. In [15] it is shown that any quantitative theory U has a universal model TU (the freely generated ▶- model) satisfying exactly those quantitative equations belonging to U . Moreover, [15, Theorem 5.2] proves a completeness theorem for quantitative equational theories U , stating that a quantitative inference is satisfied
by all the algebras satisfying U iff it belongs to U .
The Algebra of Probabilistic Behaviors
In this section we present the algebra of open Markov chains from [4]. Open Markov chains extend the familiar notion of discrete-time generative Markov chain with “open” states taken from a fixed countable set X of names ranged over by X,Y, Z, ... ∈ X . Names indicate states at which the behavior of the Markov chain can be extended by substitution of another Markov chain, in a way which will be made precise later.
In what follows we fix a countable set L of labels, ranged over by a, b, c, . . .
Definition 4.1 An open Markov chain M = (M, τ ) consists of a set M of states and a transition probability function τ : M → D((L× M ) X ).
Intuitively, if M is in a state m ∈ M , then it emits a ∈L and moves to n ∈ M with probability τ (m)(a, n), or it moves to a name X ∈ X without emitting any label with probability τ (m)(X). A state m ∈ M is terminating if τ (m)((L× M ) X ) = 0. A name X ∈X is unguarded in the state m ∈ M , if τ (m)(X) > 0.

2 Note that for an inconsistent theory U , by Subst, we have ▶ t ≡0 s ∈ U , for all t, s ∈ T(Σ,X).

A pointed open Markov chain (M, m) ∈ OMC is an open Markov chain M with distinguished initial state
m. Hereafter, we use M = (M, τ ), N = (N, θ) to denote generic open Markov chains, and (M, m), (N, n) for pointed open Markov chains.
Definition 4.2 An equivalence relation R ⊆ M ×M is a probabilistic bisimulation on M if whenever m R m′, then, for all a ∈ L, X ∈X and C ∈ M/R,
τ (m)(X)= τ (m′)(X),
τ (m)({a}× C)= τ (m′)({a}× C).
Two states m, m′ ∈ M are probabilistic bisimilar w.r.t. M, written m ∼M m′, if there exists a probabilistic bisimulation relation on M relating them.
The above definition is a straightforward adaptation of Larsen and Skou’s probabilistic bisimulation [14]. We say that (M, m), (N, n) ∈ OMC are bisimilar, written (M, m) ∼ (N, n), if m and n are bisimilar w.r.t. the disjoint union of M and N (denoted by M⊕ N ) defined as expected. Note that ∼ is an equivalence relation.
Next we turn to a simple algebra of pointed open Markov chains. The signature of algebraic operator symbols is defined as follows.
Σ= {X :0 | X ∈ X} ∪	(names)
{a.(·): 1 | a ∈ L} ∪	(prefix)
{+e :2 | e ∈ [0, 1]}∪	(probabilistic choice)
{rec X :1 | X ∈ X} .	(recursion)
It consists of a constant X for each name in X ; a prefix a.· and a recursion rec X unary operators, for each a ∈ L and X ∈ X ; and a probabilistic choice +e binary operator for each e ∈ [0, 1]. For t ∈ T(Σ,M ), fn(t) denotes the set of free names in t, where the notions of free and bound name are defined in the standard way, with rec X acting as a binding construct. A term is closed if it does not contain any free variable. Throughout the paper we consider two terms as syntactically identical if they are identical up to renaming of their bound names (α-equivalence). For t, s1,..., sn ∈ T(Σ,M ) and an n-vector X = (X1,..., Xn) of distinct names, t[s/X] denotes the simultaneous capture avoiding substitution of Xi in t with si, for i = 1,..., n. A name X is guarded 3 in a term t if every free occurrence of X in t occurs within a context the following forms: a.[·], s +1 [·], or [·] +0 s.
Since from now on we will only refer to terms constructed over the signature Σ, we will simply write T(M ) and T, in place of T(Σ,M ) and T(Σ, ∅), respectively.
To give the interpretation of the operators in Σ, we define an operator U on open Markov chains, taking M to the open Markov chain U(M) = (T(M ), μM), where the transition probability function μM is defined as the least solution (over the complete partial order of the set of functions mapping elements in T(M ) to a [0, 1]-valued function from (L× T(M )) X , ordered point-wise) of the equation
μM = PM μM .
The functional operator PM is defined by structural induction on T(M ), for arbitrary functions θ : T(M ) →
[(L× T(M )) X → [0, 1]], as follows:


P  (θ)(m)= τ (m)
PM(θ)(a.t)= 1{(a,t)}

M
PM(θ)(X)= 1{X}
PM(θ)(t +e s)= eθ(t)+ (1 − e)θ(s)

PM(θ)(rec X.t)= θ(t[rec X.t/X]) ,
where 1E denotes the characteristic function of the set E.
Notice that requiring μM to be the least solution is essential for its well definition as a transition probability function. As a consequence of this definition, for all X ∈ X , rec X.X is a terminating state in U(M), i.e., μM(rec X.X)((L× T(M )) X )= 0.

3 This notion, coincides with the one in [23], though our definition may seem more involved due to the fact that we allow the probabilistic choice operators +e with e ranging in the closed interval [0, 1].



JZ)


1
 Z 
Ja.X)
Ja.X + 1 Z)



 Z 
Jrec X.(a.X + 1 Z))
~
a, 1
X	 	 
1


a, 1

 X 	 X 
a, 1	2

Fig. 1. Compositional step-by-step construction of the semantics of rec X.(a.X + 1 Z).
2
Remark 4.3 The definition of μM corresponds essentially to the operational semantics given by Stark and Smolka in [23]. The only differences are that the above is given over generic terms in T(M ) and our formulation is simpler because it avoids the construction of a labelled transition system. For more details see [1,23].
Definition 4.4 Let M∅ = (∅, τ∅) be the open Markov chain with τ∅ the empty transition function. The
universal open Markov chain is U(M∅).
The reason why it is called universal will be clarified soon. As for now just note that U(M∅) has T as the set of states and transition probability function equal to the one defined in [23]. To ease the notation we will denote U(M∅) as U = (T, μT).
The algebra of open pointed Markov chains is defined by (OMC, Σomc), where the interpretations f omc : OMCn → OMC ∈ Σomc for the symbols f : n ∈ Σ is given, for arbitrary (M, m), (N, n) ∈ OMC as
Xomc = (U,X) ,	(M, m) +omc (N, n)= (U(M⊕N ),m +e n) ,

(a.(M, m))omc = (U(M), a.m) ,
(rec X.(M, m))omc = (U(M∗
), rec X.m) ,

where, for M = (M, τ ), M∗
denotes the open Markov chain (M, τ∗
) with transition function defined, for

all m′ ∈ M and E ⊆ (L× M ) X , as


∗
X,m
(m′)(E)= τ (m′)(X)τ (m)(E \ {X})+ τ (m′)(Xc)τ (m′)(E \ {X}) .

where Xc = ((L× M )  X ) \ {X}. Intuitively, τ∗	removes the name X ∈ X from the support of τ (m′)
replacing it with the probabilistic behavior of m.
The semantics of terms is given via the Σ-homomorphism · : T → OMC, defined by induction on terms as follows

JX) = X
omc
,
omc
omc
e	e
omc
(semantics)

Ja.t) = (a.Jt))	,	Jrec X.t) = (rec X.Jt))	.
Figure 1 shows how terms are interpreted to pointed open Markov chains.
The next result states that it is equivalent to reason about the equivalence of the behavior of t and s by just considering bisimilarity between the corresponding states t and s in the universal open Markov chain U.
Theorem 4.5 (Universality) For all t ∈ T, Jt) ∼ (U, t).
Axiomatization of the Total Variation Distance
We present a quantitative deduction system and we prove its soundness and completeness w.r.t. the total variation distance.
Probabilistic Trace Equivalence and the Total Variation Distance
To ease the technical presentation of the forthcoming results, it is convenient to interpret sub-probability transition functions τ : M → D((L× M ) X ) fully-probabilistically as τ∗ : M → Δ((L× M )  X⊥), where

X⊥ = X {⊥} and τ∗ is the extension of τ such that τ∗(m)(⊥)= 1−τ (m)((L×M ) X ). These representations are equivalent and do not alter the validity of the previous results.
The type of observable traces that open Markov chains can emit are either finite traces of the form a1 ... anχ ∈ L∗X⊥ starting with a sequence of labels a1 ... an ∈ L∗ and ending in χ ∈ X⊥ (this indicates the chain ends either in a open name or ⊥) or infinite sequences of labels a1a2a3 ... ∈ Lω. We write Π = Lω ∪L∗X⊥ for the set of observable traces and (Π, ΣΠ) for the measurable space of traces with σ-algebra ΣΠ generated by the set C(Π) of cylinders of the form
C(w)= {w}Π	and	C(wχ)= {wχ} ,	for w ∈ L∗ and χ ∈ X⊥ .
Given a pointed open Markov chain (M, m), its probability of emitting traces in (Π, ΣΠ) starting from m
is given by the distribution PM(m) defined as follows:
Definition 5.1 Let PM : M → D(Π, ΣΠ) be such that, for all m ∈ M , PM(m) is the unique probability measure on (Π, ΣΠ) such that,
PM(m)(C(χ)) = τ∗(m)(χ) ,	for all χ ∈ X⊥ ,
PM(m)(C(aw)) = ∫ PM(·)(C(w)) dτa(m) ,	for all a ∈L and w ∈ L∗ ∪ L∗X⊥ ,
where τa : M → D(M ) is given as τa(m)(n)= τ (m)(a, n), for arbitrary m, n ∈ M .
The existence and unicity of the family of probability measures (PM(m))m∈M satisfying the equations above follows by the Hahn-Kolmogorov extension theorem.
Definition 5.2 Two states m, m′ ∈ M are probabilistic trace equivalent w.r.t. M, written m ≈M m′, if for all cylinders C ∈ C(Π), PM(m)(C)= PM(m′)(C).
A pseudometric lifting probabilistic trace equivalence is the following.
Definition 5.3 The total variation distance tvM : M × M → [0, 1] on M is defined, for arbitrary m, m′ ∈ M , as tvM(m, m′)= supE∈Σ |PM(m)(E) − PM(m′)(E)|.
Hereafter, when M is clear from the context super/subscripts will be omitted.
The proof of completeness in Section 5.5 relies on a result from [2], stating that tv is the point-wise limit of a net of k-multistep bisimilarity pseudometrics dk `a la Desharnais et al. [9], whose definition will be made precise later.
Theorem 5.4 ([2]) Let K be the poset of positive integers ordered by divisibility. Then, the net (dk)k∈K
converges point-wise to tv and, for all k ∈ K, tv ± dk.
The intuitive idea of the convergence is that tv can be approached by stretching the observations from single- step transitions to k-multistep transitions. Here, the pseudometric dk measures the k-multistep behavioral similarities of states.
For k ≥ 1 and M = (M, τ ) be an open Markov chain, the k-multistep transition probability function τk : M → Δ((Lk × M )  L<kX⊥) of M is defined by induction on k, for arbitrary m, m′ ∈ M , χ ∈ X⊥, a ∈ L, u ∈ L<k, w ∈ Lk, as follows


τ1 = τ∗ ,
τ	(m)(auχ)=  τ (·)(uχ) dτ (m) ,
τ	(m)((aw, m′)) = ∫ τ (·)((w, m′)) dτ (m) .


The definition of the multistep bisimilarity distances is based on the Kantorovich (pseudo)metric between probability distributions over finite (pseudo)metric spaces (A, d), defined for arbitrary μ, ν ∈ Δ(A) as follows
K(d)(μ, ν)= min ∫ d dω | ω ∈ Ω(μ, ν)} .

where Ω(μ, ν) denotes the set of couplings for (μ, ν), i.e., probability distributions ω ∈ Δ(A × A) such that, for all E ⊆ A, ω(E × A)= μ(E) and ω(A × E)= ν(E).

Definition 5.5 For any integer k ≥ 1, the probabilistic k-bisimilarity pseudometric dM : M ×M → [0, 1] on M
is the least fixed-point of the following functional operator on 1-bounded pseudometrics (ordered point-wise),
ΨM(d)(m, m′)= K(Λk(d))(τk(m), τk(m′))	(k-Kantorovich Operator)
where Λk(d) is the greatest 1-bounded pseudometric on (Lk × M )  L<kX⊥ such that for all w ∈ Lk and
m, m′ ∈ M , Λk(d)((w, m), (w, m′)) = d(m, m′).
The well definition of dk follows by Knaster-Tarski fixed-point theorem and monotonicity of Ψk (which is implied by the monotonicity of K and Λk). Note that d1 corresponds to the probabilistic bisimilarity distance of Desharnais et al. [9,25].
Definition 5.6 An equivalence relation R ⊆ M×M is a k-probabilistic bisimulation on M if whenever m R m′, then, for all w ∈ Lk, u ∈ L<k, χ ∈ X⊥, and C ∈ M/R,
τk(m)(uχ)= τk(m′)(uχ),
τk(m)({w}× C)= τk(m′)({w}× C).
Two states m, m′ ∈ M are k-probabilistic bisimilar w.r.t. M, written m ∼M m′, if there exists a k-probabilistic

bisimulation relation on M relating them.
Lemma 5.7 dk(m, m′)=0 iff m ∼k m′.
For each k ≥ 1, the k-bisimilarity distance can be alternatively obtained as dk
ω-limit of the decreasing chain 1 ≡ Ψ˜ k(1) ≡ Ψ˜ 2 (1) ≡ ... , where Ψ˜ k is the operator


= .i∈ω


Ψ˜ i (1), i.e., the

˜	′	 0	if m ∼k m′,
L.emma 5.8 Ψ˜ k is.ω-cocontinuous, i.e., for .any countable decreasing chain d0 ≡ d1 ≡ d2 ≡ ... , it holds

i∈ω
Ψ˜ k(di)= Ψ˜ k(
i∈ω
di). Moreover, dk =
i∈ω
Ψ˜ i (1).

A Quantitative Algebra of Open Markov Chains
We turn the algebra of pointed open Markov chains (OMC, Σomc) given in Section 4 into a relaxed quantitative algebra by endowing it with the total variation distance. The term “relaxed” is used to stress the fact that differently from Definition 3.1, we do not require non-expansiveness for the algebraic operators. This relaxation is necessary because the recursion operator does not satisfy non-expansiveness.
We define the total variation distance tvomc on OMC as the total variation distance between the initial states on the disjoint union of the two open Markov chains. Equivalently, one can compute it simply as
tvomc((M, m), (N, n)) = supE∈Σ |PM(m)(E) − PN (n)(E)| .
We define the (relaxed) quantitative algebra of OMC as (OMC, Σomc, tvomc).
In Example 5.10 we show that the operator rec X fails to be non-expansive w.r.t. the total variation distance.
Our proof relies on the following technical lemma.
Lemma 5.9 For arbitrary m, n ∈ M, tv(m, n) < 1 iff one of the following holds
P(m)(C(w)) > 0 and P(n)(C(w)) > 0 for some w ∈ L∗X⊥,
τ|w|(m)((w, m′)) > 0 and τ|w|(n)((w, n′)) > 0, for some m′ ≈ n′ and w ∈ L∗.
Example 5.10 (Recursion is not non-expansive!) Let 0 < ε < 1 and consider the two pointed open
Markov chains depicted below.


(M, m)= a,
b, 1
(M′, m′)= 
b, 1 + ε

Since P(m)(C(aX)) = 1 and P(m′)(C(aX)) = 1 − ε > 0, by Lemma 5.9 (i), tv(m, m′) < 1. Consider the
	
2	2
application of the operator (rec X)omc on these two pointed open Markov chains. The resulting chains have the following behavior.

a, 1	a, 1 − ε


(rec X.(M, m))omc ∼
a,
(rec X.(M′, m′))omc ∼
a, 1 − ε
b, 1 + ε
n′
b, 1 + ε


Note that P(rec X.m)(C(u)) = P(rec X.m′)(C(u)) = 0, for all u ∈ L∗X⊥ (the chains are fully-probabilistic and there are no “open states”). Moreover, by the assumption that 0 < ε < 1 , none of the states in (rec X.(M, m))omc is trace equivalent with any of the states in (rec X.(M′, m′))omc. Hence, by Lemma 5.9, tv((rec X.(M, m))omc, (rec X.(M′, m′))omc) = 1. This proves that (rec X)omc fails to be non-expansive w.r.t. the total variation distance.
The following result is a direct consequence of Theorem 4.5 and the fact that bisimilarity implies trace equivalence.
Theorem 5.11 For all t, s ∈ T, tvomc(Jt), Js))= tvU(t, s).
A Quantitative Deduction System
Now we present a relaxed quantitative deduction system which will be later shown to be sound and complete
w.r.t. the total variation distance. The deduction system we propose is not a quantitative deduction system in the sense of [15], because it does not include the (NExp) axiom of non-expansiveness of the operators (cf. Section 3).
The quantitative deduction system ▶⊆ 2E(Σ) ×E (Σ) of type Σ that we consider satisfies the axioms (Refl), (Symm), (Triang), (Max), (Arch) and rules (Subst), (Cut) (Assum) from Section 3 and the following additional axioms
(B1) ▶ t +1 s ≡0 t, 
(B2) ▶ t +e t ≡0 t, 
(SC) ▶ t +e s ≡0 s +1−e t, 
′
(SA) ▶ (t +e s) +e' u ≡0 t +ee' (s + e'−ee' u) , for e, e ∈ [0, 1) ,
1−ee'
(Unfold) ▶ rec X.t ≡0 t[rec X.t/X] ,
(Unguard) ▶ rec X.(t +e X) ≡0 rec X.t ,
(Fix) {s ≡0 t[s/X]}▶ s ≡0 rec X.t , for X guarded in t, 
(Cong) {t ≡0 s}▶ rec X.t ≡0 rec X.s , (DP) ▶ a.(t +e s) ≡0 a.t +e a.s , (Top) ▶ t ≡1 s, 
(Pref) {t ≡ε s}▶ a.t ≡ε a.s ,
(IB) {t ≡ε s, t ≡ε' s }▶ t +e t ≡ε'' s +e s , for ε ≥ eε + (1 − e)ε .
Note that the axiom (NExp) is not included in the definition.
(B1), (B2), (SC), (SA) are the axioms of barycentric algebras due to Stone [24], used here to axiomatize the convex set of probability distributions. (SC) stands for skew commutativity and (SA) for skew associativity.
The axioms (Unfold), (Unguard), (Fix), (Cong) are the recursion axioms of Milner [16], used here to axiom- atize coinductive behaviors. (Unfold) and (Fix) state that, whenever X is guarded in a term t, rec X.t is the unique solution of the recursive equation s ≡0 t[s/X]. The axiom (Unguard) deals with unguarded recursive behavior, and (Cong) states the congruential properties of the recursion operator.

The axiom (DP) is the distributivity law of the prefix operator over the probabilistic choice of Silva and Sokolova [22].
The last three axioms are the only truly quantitative one. (Top) states that the distance is bounded by 1; (Pref) is the non-expansiveness for the prefix operator; and (IB) is the interpolative barycentric axiom introduced in [15] for axiomatizing the Kantorovich distance on finitely-supported probability distributions (cf.
§10 in [15]).
It is important to remark that the quantitative deduction system given above subsumes the equational systems of Stark and Smolka [23] axiomatizing probabilistic bisimilarity, and of Silva and Sokolova [22] for probabilistic trace equivalence.
Soundness
In this section we show the soundness of our quantitative deduction system w.r.t. the bisimilarity distance between pointed open Markov chains.
Recall that, by Theorem 5.11, for all t, s ∈ T, |=OMC t ≡ε s is equivalent to |=U t ≡ε s. To ease the notation, in the following we simply write |= t ≡ε s.
Theorem 5.12 (Soundness) For any t, s ∈ T, if ▶ t ≡ε s then |= t ≡ε s.
Proof. The axioms (Refl), (Symm), (Triang), (Max), and (Arch) are sound since tv is a pseudometric. The soundness of the classical logical deduction rules (Subst), (Cut), and (Assum) is immediate. By ∼ ⊆ ≈, the axioms (B1), (B2), (SC), and (SA) along with (Unfold) and (Unguard) follow directly by the soundness theorem proven in [23]. The soundness of (Cong), (Fix), (DP) follow by the soundness of [22].
The soundness of (Top) follows from the fact that tv is 1-bounded. To prove the soundness of (Pref) it suffices to show tv(t, s) ≥ tv(a.t, a.s).
tv(a.t, a.s)= supE∈ΣΠ |P(a.t)(E) − P(a.s)(E)|	(def. tv)
= supE∈ΣΠ |P(a.t)({a}E) − P(a.s)({a}E)|	(P(a.t)(C(a)) = P(a.s)(C(a)) = 1)
= supE∈ΣΠ |P(t)(E) − P(s)(E)| = tv(t, s)	(def. μT, PU, tv)
The soundness of (IB) follows by e tv(t, s)+ (1 − e) tv(t′, s′) ≥ tv(t +e t′,s +e s′).

tv(t +e t′,s +e s′)= supE∈Σ
|P(t +e t)(E) − P(s +e s′)(E)|	(def. tv)

Π
≤ e supE∈Σ |P(t)(E) − P(s)(E)| + (1 − e) supE∈Σ |P(t′)(E) − P(s′)(E)|
≤ e tv(t, s)+ (1 − e) tv(t′, s′)	(def. tv)
The above concludes the proof.	2
Completeness
In this section we prove completeness of our quantitative deduction system w.r.t. the total variation distance between pointed open Markov chains.
For the sake of readability we introduce the following notation for formal sums of terms (or convex combi-
nations of terms). For n ≥ 1, t1,..., tn ∈ T terms, and e1,..., en ∈ [0, 1] positive reals such that Σn  ei = 1,

we define
Σn  e · t =  t1	 Σ


if e1 =1 
	

Following the pattern of [16,23], the completeness theorem hinges on a couple of important transformations. The first of these is the Bekiˇc-Scott construction of solutions of simultaneous recursive definitions. This is embodied in the next theorem, which is [16, Theorem 5.7].

Theorem 5.13 (Unique Solution of Equations) Let X = (X1,..., Xk) and Y = (Y1,..., Yh) be distinct names, and t = (t1,..., tk) terms with free names in (X, Y ) in which each Xi is guarded. Then there exist



terms s = (s1,..., sk) with free names in Y such that

▶ si ≡0 ti[s/X] ,	for all i ≤ k.


	
Moreover, if for some u = (u1,..., uk) with free variables in Y , ▶ ui ≡0 ti[u/X], for all i ≤ k, then ▶ si ≡0 ui, for all i ≤ k.
The second transformation provides a deducible “k-steps normal form” for terms, where k is a parameter counting the number of nested prefixes. This result is embodied in the following theorem (when k = 1, this is [23, Theorem 5.9] 4 ).

Theorem 5.14 (Eq. Characterization) For any k ≥ 1 and any term t, with free names in Y , there exist terms t1,..., tn with free names in Y , s.t. ▶ t ≡0 t1 and
▶ ti ≡0 Σh(i) pij · sij ,	for all i ≤ n, 
where the terms sij are enumerated without repetitions, each sij is either of the form a1 ....ak .tf(i,j), or

b1 ....buij . rec X.X, or c1	cwij .Y
, for some uij, wij < k.
ij	ij

ij	ij
ij	ij
g(i,j)

The last lemma relates the proposed deduction system with the Kantorovich distance. So far this is the only transformation embodying the use of the interpolative barycentric axiom (IB) to deduce nontrivial quantitative information on terms.
Lemma 5.15 Let d be a 1-bounded pseudometric over T and μ, ν ∈ Δ(T) probability measures with supports supp(μ)= {t1,..., tk} and supp(ν)= {s1,..., sr}. Then

k	r
{ti ≡ε su | ε ≥ d(ti, su), 1 ≤ i ≤ k and 1 ≤ u ≤ r}▶ Σ μ(ti) · ti ≡ε' Σ ν(su) · su ,


for all ε′ ≥ K(d)(μ, ν).
i=1
u=1

Now we are ready to prove the main result of this section. The proof of completeness can be sketched as follows. Given t, s ∈ T such that tv(t, s) ≤ ε, to prove ▶ t ≡ε s, we first show that, for any k ≥ 1, εk ≥ dk(t, s) implies ▶ t ≡εk s, then, by Theorem 5.4 and (Arch), we deduce ▶ t ≡ε s.
Theorem 5.16 (Completeness) For any t, s ∈ T, if |= t ≡ε s, then ▶ t ≡ε s.
Proof. Let t, s ∈ T and ε ∈ Q+. By Theorem 5.4 and (Arch), to prove that tv(t, s) ≤ ε implies ▶ t ≡ε s, it suffices to show that for any k ≥ 1, ε ≥ dk(t, s) implies ▶ t ≡ε s. Let k ≥ 1. The case ε ≥ 1 trivially follows by (Top) and (Max). Let ε < 1. By Theorem 5.14, there exist terms t1,..., tm and s1,..., sr with free names
in X and Y , respectively, such that ▶ t ≡0 t1, ▶ s ≡0 s1, and
▶ ti ≡0 Σh(i) pij · t′ ,	for all i ≤ m,	(1)
▶ su ≡0 Σn(u) quv · s′ ,	for all u ≤ r,	(2)

where the terms t′
(resp. s′ ) are enumerated without repetitions, and t′
(resp. s′
) have either the form

a1	ak .t
(resp. b1 ....bk .s
), or a1 ....aαij . rec Z.Z (resp. b1 ....bβuv . rec Z.Z) , or a1	aγij .X

ij	ij
f (i,j)
uv	uv
z(u,v)
ij	ij
uv	uv
ij	ij
g(i,j)

(resp. b1	bδuv .Yw(u,v)), for some αij, γij < k (resp. βuv, δuv < k). If we can prove that for all σ ∈ ω,
uv	uv
▶ ti ≡ε su ,	for all i ≤ m, u ≤ r, and ε ≥ Ψ˜ σ (1)(ti, su) ,	(3)
then, by Lemma 5.8 and (Arch), we get ▶ ti ≡ε su, for all ε ≥ dk(ti, su). Since ▶ t ≡0 t1, ▶ s ≡0 s1, by (Triang), we deduce ▶ t ≡ε s, for all ε ≥ dk(t, s).

4 The formulation given here is slightly simpler than the original one in [23], since our deduction system satisfies the axiom (B1), which is not included in the equational deduction system of [23].

In the remainder of the proof we prove (3), by induction on σ ∈ ω.
(Base case: σ = 0) Ψ˜ 0 (1)(ti, su) = 1(ti, su). Since 1(ti, su) = 0 whenever ti = su and 1(ti, su) = 1 if
ti /= su, then (3) follows by the axioms (Refl), (Top) and (Max).
(Inductive step: σ > 0). We consider the cases ti ∼k su and ti /∼k su separately. Assume ti ∼k su. By following the same proof strategy of [23, Theorem 3] (using Theorem 5.14 in place of [23, Theorem 2]) from
ti ∼k su we get ▶ ti ≡0 su. By (Max), ▶ ti ≡ε su, for all ε ≥ Ψ˜ σ (1)(ti, su) = 0. Assume ti /∼k su and let t′
k	ij

and s′
be the terms occurring in the formal sums of (1), (2), respectively. Then, by (1), (2), and definition

of (μT)k, for x, y ∈ (Lk × T)  L<kX⊥,
 pij  if ξ(x)= t′

 quv  if ξ(y)= s′


where ξ is the mapping s.t. for all t ∈ T, a1,..., ak ∈ L, k′ < k, and X ∈ X , ξ((a1 ... ak, t)) = a1	ak.t,
ξ(a1 ... ak' X)= a1....ak' .X, and ξ(a1 ... ak' ⊥)= a1	ak' . rec Z.Z. If we can prove that, for all i ≤ m, j ≤ h(i),
u ≤ r, and v ≤ n(u),

▶ t′ ≡ε s′ ,	for all ε ≥ Λk(Ψ˜ σ−1(1))(ξ(t′ ),ξ(s′
)) ,	(4)

ij	uv	k	ij	uv
then, by Lemma 5.15, for all ε ≥ K(Λk(Ψ˜ σ−1(1)))((μT)k(ti), (μT)k(su)) we can deduce ▶ ti ≡ε su. By this and definitions of Ψ˜ σ and Ψk, since we assumed ti /∼k su, we conclude (3).

Next we prove (4). The only interesting case is when t′
= a1	ak.tf(i,j) and s′
= a1	ak.sz(u,v) —

the others follow by (Refl), if t′
′
u,v
, (Top) otherwise, and then (Max). By definitions of ξ and Λk,

we have Λk(Ψ˜ σ−1(1))(ξ(t′ ),ξ(s′ )) = Ψ˜ σ−1(1)(tf(i,j), sz(u,v)). By inductive hypothesis on σ − 1, we have
ij	uv
▶ tf(i,j) ≡ε sz(u,v), for all ε ≥ Ψ˜ σ−1(1)(tf(i,j), sz(u,v)), and by repeatedly applying (Pref) we get (4).	2
A Quantitative Kleene’s Theorem
In this section we provide a metric extension to the quantitative Kleene’s representation theorem of Silva and Sokolova [22] (see also [21,6]). Specifically, we have that any (finite) pointed open Markov chains can be represented up to bisimilarity as a Σ-term and, vice versa, for any Σ-term t there exist a (finite) pointed open Markov chain bisimilar to t . Moreover, by endowing the set of Σ-terms with the pseudometric freely- generated by the quantitative deduction system ▶ presented in Section 5.3 (in a way which will be made precise later in Definition 6.1) we get that the correspondence stated above is metric invariant.
Next we recall from [15] the definition of initial quantitative model for a quantitative deduction system.
Definition 6.1 The initial ▶-model is the quantitative algebra (T, Σ, dT), where (T, Σ) is the initial algebra of Σ-terms and dT : T × T → [0, 1] is the 1-bounded pseudometric defined, for arbitrary terms t, s ∈ T, as dT(t, s)= inf {ε |▶ t ≡ε s}.
By (Refl), (Symm), (Triang), (Top) it is easy to prove that dT is a well-defined 1-bounded pseudometric.
Moreover, (T, Σ, dT) is a sound model for ▶.
Next we show that there is a strong correspondence between the initial ▶-model and the quantitative algebra of finite pointed open Markov chains.
Theorem 6.2 (Quantitative Kleene’s Theorem)
For any pair (M, m), (N, n) of ﬁnite open Markov chains, there exist t, s ∈ T such that Jt) ∼ (M, m),
Js) ∼ (N, n), and tv((M, m), (N, n)) = dT(t, s);
For any t, s ∈ T, there exist ﬁnite pointed open Markov chains (M, m), (N, n), such that Jt) ∼ (M, m),
Js) ∼ (N, n), and tv((M, m), (N, n)) = dT(t, s).
Conclusions and Future Work
In this paper we proposed a sound and complete axiomatization for the total variation distance of Markov chains. The proposed axiomatic system comes as a natural generalization of the one in [22] for probabilistic trace equivalence.

Similarly to [4], where we provided a sound and complete axiomatization for the bisimilarity distance of Desharnais et al., also this case recursion was not sound w.r.t. the non-expansiveness axiom (NExp). Still we were able to prove completeness for the axiomatization. This further result entails the possibility of generalizing the original quantitative framework of Mardare, Panangaden, and Plotkin [15], maybe allowing for algebraic operators that are simply required to be continuous.
Another appealing direction of future work is to apply our results on quantitative systems described as coalgebras in a way similar to one proposed in [6,21,7]. By pursuing this direction we would be able to obtain metric axiomatizations for a wide variety of quantitative systems, including non-generative probabilistic models, weighted transition systems, Segala’s systems, stratified systems, Pnueli-Zuck systems, etc.
Acknowledgment
We would like to thank Frank van Breugel for suggesting the topic this paper, and Ana Sokolova and Alexandra Silva for pointing out some issues on a preliminary version of this paper.
This work has been supported by the EU 7th Framework Programme (FP7/2007-13) under Grants Agree- ment nr.318490 (SENSATION), nr.601148 (CASSTING), the Sino-Danish Basic Research Center IDEA4CPS funded by Danish National Research Foundation and National Science Foundation China, the ASAP Project (4181-00360) funded by the Danish Council for Independent Research, the ERC Advanced Grant LASSO, and the Innovation Fund Denmark center DiCyPS.

References
Luca Aceto, Zolt´an E´sik, and Anna Ing´olfsd´ottir. Equational axioms for probabilistic bisimilarity. In AMAST 2002, Lecture Notes in Computer Science, pages 239–253, 2002.
Giorgio Bacci, Giovanni Bacci, Kim G. Larsen, and Radu Mardare. Converging from Branching to Linear Metrics on Markov Chains. In ICTAC, volume 9399 of Lecture Notes in Computer Science, pages 349–367. Springer, 2015.
Giorgio Bacci, Giovanni Bacci, Kim G. Larsen, and Radu Mardare. On the Total Variation Distance of Semi-Markov Chains. In FoSSaCS, volume 9034 of Lecture Notes in Computer Science, pages 185–199, 2015.
Giorgio Bacci, Giovanni Bacci, Kim G. Larsen, and Radu Mardare. Complete Axiomatization for the Bisimilarity Distance on Markov Chains. In CONCUR, volume 59 of LIPIcs, pages 21:1–21:14. Schloss Dagstuhl - Leibniz-Zentrum fuer Informatik, 2016.
Emanuele Bandini and Roberto Segala. Axiomatizations for probabilistic bisimulation. In ICALP, Lecture Notes in Computer Science, pages 370–381, 2001.
Filippo Bonchi, Marcello M. Bonsangue, Jan J. M. M. Rutten, and Alexandra Silva. Deriving syntax and axioms for quantitative regular behaviours. In CONCUR, volume 5710 of Lecture Notes in Computer Science, pages 146–162. Springer, 2009.
Marcello Bonsangue, Stefan Milius, and Alexandra Silva. Sound and Complete Axiomatizations of Coalgebraic Language Equivalence. ACM Transactions on Computational Logic, 14(1):7, 2013.
Yuxin Deng and Catuscia Palamidessi. Axiomatizations for probabilistic finite-state behaviors. Theor. Comput. Sci., 373(1- 2):92–114, 2007.
Josee Desharnais, Vineet Gupta, Radha Jagadeesan, and Prakash Panangaden. Metrics for labelled Markov processes.
Theoretical Computer Science, 318(3):323–354, 2004.
Alessandro Giacalone, Chi chang Jou, and Scott A. Smolka. Algebraic reasoning for probabilistic concurrent systems. In
Proc. IFIP TC2 Working Conference on Programming Concepts and Methods, pages 443–458. North-Holland, 1990.
Chi-Chang Jou and Scott A. Smolka. Equivalences, congruences, and complete axiomatizations for probabilistic processes. In
CONCUR, volume 458 of Lecture Notes in Computer Science, pages 367–383. Springer, 1990.
Stephen Kleene. Representation of events in nerve nets and finite automata. Automata Studies, 34:3–42, 1956.
Dexter Kozen. A completeness theorem for kleene algebras and the algebra of regular events. In LICS, pages 214–225. IEEE Computer Society, 1991.
Kim Guldstrand Larsen and Arne Skou. Bisimulation Through Probabilistic Testing. In POPL, pages 344–352, 1989.
Radu Mardare, Prakash Panangaden, and Gordon D. Plotkin. Quantitative Algebraic Reasoning. In LICS, pages 700–709. ACM, 2016.
Robin Milner. A complete inference system for a class of regular behaviours. J. Comput. Syst. Sci., 28(3):439–466, 1984.


Michael Mislove, Jo¨el Ouaknine, and James Worrell. Axioms for probability and nondeterminism. Electronic Notes in Theoretical Computer Science, 96:7–28, 2004.
Gordon D. Plotkin and John Power. Semantics for algebraic operations. Electr. Notes Theor. Comput. Sci., 45:332–345, 2001.
Alexander Moshe Rabinovich. A complete axiomatisation for trace congruence of finite state behaviors. In MFPS, volume 802 of Lecture Notes in Computer Science, pages 530–543. Springer, 1993.
Arto Salomaa. Two complete axiom systems for the algebra of regular events. J. ACM, 13(1):158–169, 1966.
Alexandra Silva, Filippo Bonchi, Marcello M. Bonsangue, and Jan J. M. M. Rutten. Quantitative kleene coalgebras. Inf. Comput., 209(5):822–849, 2011.
Alexandra Silva and Ana Sokolova. Sound and complete axiomatization of trace semantics for probabilistic systems. Electr. Notes Theor. Comput. Sci., 276:291–311, 2011.
Eugene W. Stark and Scott A. Smolka. A complete axiom system for finite-state probabilistic processes. In Proof, Language, and Interaction, Essays in Honour of Robin Milner, MIT Press, pages 571–596, 2000.
Marshall H. Stone. Postulates for the barycentric calculus. Annali di Matematica Pura ed Applicata, 29(1):25–30, 1949.
Franck van Breugel and James Worrell. Towards Quantitative Verification of Probabilistic Transition Systems. In ICALP, volume 2076 of Lecture Notes in Computer Science, pages 421–432, 2001.
Franck van Breugel and James Worrell. Approximating and computing behavioural distances in probabilistic transition systems. Theoretical Computer Science, 360(1-3):373–385, 2006.
