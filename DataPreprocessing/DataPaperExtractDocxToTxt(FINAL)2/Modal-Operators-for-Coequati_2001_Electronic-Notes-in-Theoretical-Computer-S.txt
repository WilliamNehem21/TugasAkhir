Electronic Notes in Theoretical Computer Science 44 No. 1 (2001)
URL: http://www.elsevier.nl/locate/entcs/volume44.html 22 pages


Modal Operators for Coequations

Jesse Hughes
Dept. of Philosophy Carnegie Mellon University Pittsburgh, PA 15213 jesse@cmu.edu

Abstract
We present the dual to Birkhoff’s variety theorem in terms of predicates over the carrier of a cofree coalgebra. We then discuss the dual to Birkhoff’s completeness theorem, showing how closure under deductive rules dualizes to yield two modal operators acting on coequations. We discuss the properties of these operators and show that they commute, and we prove the invariance theorem, which is the formal dual of the completeness theorem.


Introduction
Jan Rutten’s development of the theory of coalgebras in [Rut96] provided a foundation for coalgebraic semantics for computer science. In addition, he proved the dual to Birkhoff’s variety theorem [Bir35] for coalgebras over Set. The covariety theorem states that a class V of coalgebras is closed under (regular) subcoalgebras, coproducts and codomains of epis just in case V is “coequationally definable”. The notion of a coequation and coequation satis- faction arises as the formal dual of sets of equations and equation satisfaction in categories of algebras.
Peter Gumm and Tobias Schro¨der continued work on the duals of Birkhoff’s theorems for coalgebras over Set in [GS98], where they dualized the deduc- tive completeness theorem as well. Namely, they showed that, given a regular injective coalgebra ⟨A, α⟩, the partial order of quasi-covarieties definable by conditional coequations over ⟨A, α⟩ is isomorphic to the invariant subcoalge- bras of ⟨A, α⟩. Here, the notion of invariance arises as the dual of closure of sets of equations under substitution of terms for variables.
In ibid, we also find the first discussion of “complete” or “behavioral” covarieties. These covarieties are definable by coequations over one “color”

 This research is part of the Logic of Types and Computation project at Carnegie Mellon University under the direction of Dana Scott.
◯c 2001 Published by Elsevier Science B. V. Open access under CC BY-NC-ND license.


or, equivalently, are the covarieties closed under total bisimulations. The work on coalgebraic specifications in [RJT01], for instance, involves giving models for classes in an object oriented language as behavioral covarieties in an appropriate category of coalgebras. Hence, we can understand this approach in terms of coequations over a single color. These coequations are dual to variable-free equations for a class of universal algebras, and so one has the idea that there is much more expressive power to exploit in the theory of coequations. We provide examples of coequations here which illustrate some of the expressive power available when one moves from behavioral covarieties to covarieties in general.
See also [Ro¸s00] for a discussion of behavioral covarieties, called “sinks” there, and [AH00] or [Hug01] for a synthesis of the work of [GS98] and [Ro¸s00], as well as some further discussion of behavioral covarieties.
In this paper, we develop the theory of coequations from a logical view- point. A coequation ϕ over a set C of colors is a regular subobject of UHC, the carrier of the cofree coalgebra over C. Hence, we can view ϕ as a predicate over UHC. In particular, we can form new coequations out of old by means of the logical connectives ∧, →, etc. Furthermore, we have available a modal operator ✷ taking a coequation ϕ to the (carrier of the) largest subcoalgebra
✷ϕ contained in the coequation. This modal operator is dual to taking a set E of equations to the least congruence containing E — hence, it is dual to closure of E under the first four rules of inference of Birkhoff’s equational logic. So we see that closure of E under deductive inferences is dual to the addition of related modal operators to Sub(UHC).
We introduce a modal operator ☒ that is dual to closure under Birkhoff’s fifth rule of inference, substitution of terms for variables. We confirm that ☒ is an S4 operator and show that, under certain conditions, ☒ commutes with ✷. We then prove the invariance theorem in terms of ☒ and ✷. In this way, we develop the coequations-as-predicates view by augmenting the predicates over UHC with two modal operators ✷ and ☒ and show that the partial order of covarieties definable by coequations over C is isomorphic to the partial order of predicates ϕ over UHC such that ϕ = ✷ ☒ ϕ.
In Section 2, we summarize the dual of Birkhoff’s variety theorem, intro- ducing the relevant terminology and results. In Section 3, we generalize the covariety theorem to accommodate quasi-covarieties and conditional coequa- tions. Section 4 is a categorical presentation of Birkhoff’s deductive complete- ness theorem and its dual, the invariance theorem. We discuss the well-known greatest subcoalgebra operator, ✷, in Section 5 and show that it is an S4 modal operator that commutes with pullbacks along homomorphisms. In Sec- tion 6, we introduce a second S4 operator, ☒, taking a coequation to its largest invariant sub-coequation. This allows an easy proof of the invariance theorem in terms of the operators ✷ and ☒ in Section 7.
This work forms part of the author’s doctoral dissertation, written un- der the supervision of Professors Dana S. Scott and Steve Awodey. Professor

Scott suggested research into the dual of Birkhoff’s theorems, and that re- search and the presentation found here benefited from many conversations with both Professors Scott and Awodey. I also benefited from conversations with Jiˇr´ıAd´amek, who pointed us to the Banaschewski and Herrlich article, Peter Gumm and Bart Jacobs.
The dual of Birkhoff’s variety theorem
We begin with a brief summary of the dual of Birkhoff’s variety theorem. This section summarizes the work found in [AH00], which can be viewed as a generalization of [Rut96] and [GS98]. A similar account of the covariety theorem can be found in [Kur00], and a similar categorical approach to the variety theorem for categories of algebras can be found in [BH76]. We start with some terminology.
Recall that a morphism is a regular mono just in case it is the equalizer for some pair of maps, and that a subobject is regular in case its inclusion is a regular mono. In what follows, we call an object C regular injective if it is injective for regular subobjects; that is, if whenever B is a regular subobject of A, then every
f :B	 C 
can be extended to a (not necessarily unique) map
g :A	 C 
such that the diagram 1 below commutes.
  g	
,, ¸,
_, , f
B
We say that a category E has enough regular injectives if, for every object
A ∈ E, there is a regular injective C such that A is a regular subobject of C.
Definition 2.1 We say that a category E is quasi-co-Birkhoff if it is regu- larly well-powered, cocomplete and has epi-regular mono factorizations. If, in addition, E has enough regular injectives, then E is co-Birkhoff.
A full subcategory of a quasi-co-Birkhoff category is a quasi-covariety iff it is closed under coproducts and codomains of epis. A quasi-covariety of a co-Birkhoff category is a covariety iff it is also closed under regular subobjects.
In fact, we could replace regular monos with strong monos throughout what follows and the results shown here would still apply. This entails weak- ening some assumptions (for instance, E needs only have epi-strong mono fac- torizations) while strengthening others (for instance, E needs enough strong

1 We use z ¸to denote regular monos.


injectives). We prefer to present the material in terms of regular monos, since there is a natural relationship between regular epis and sets of equations in the algebraic setting.
Example 2.2 The category EG of coalgebras for a comonad G = ⟨G, ε, δ⟩
forms a covariety in the category EG of coalgebras for the functor G.
Given a map f :A	 B in a category with epi-regular mono factorizations, we denote by Im(f ) (read “the image of f ”) the object through which f uniquely (up to isomorphism) factors via an epi followed by a regular mono.
We denote the partial order of regular subobjects of A by Sub(A). A map
f :A	 B induces a functor
f∗ :Sub(B)	 Su b(A),
by pulling back a regular subobject of B along f . This functor has a left adjoint,
∃f :Sub(A)	 Su b(B),
which takes a regular subobject i :P z A¸ to Im(f ◦ i).
Recall that an object A is orthogonal to an arrow f :B C (written A ⊥ f ) if, for every g : A  C , there is a unique map h : A  B such that g = f ◦ h (see [Bor94, Volume 2]). Given a collection 2 S ⊆ E1 of arrows of E , the class S⊥ ⊆ E0 is the collection of all A such that, for all f ∈ S, A ⊥ f .
The following theorem can be found in [AH00] or [Hug01].
Theorem 2.3 If C is a co-Birkhoff category, then V is a covariety iff V = S⊥
for some collection S of regular monos with regular injective codomains.
One can show that, if G = ⟨G, ε, δ⟩ is a comonad on a quasi-co-Birkhoff category and G preserves regular monos, then EG inherits the epi-regular mono factorizations from E . We use this fact to prove the following.
Theorem 2.4 Let G = ⟨G, ε, δ⟩ be a comonad on a (quasi-)co-Birkhoff cat- egory E and suppose that G preserves regular monos. Then EG is (quasi-)co- Birkhoff.
In fact, Theorem 2.4 applies more generally than stated. If E is a quasi- co-Birkhoff category and Γ is any endofunctor that preserves regular monos, then the category EΓ of coalgebras for the endofunctor Γ is quasi-co-Birkhoff. We do not need cofree Γ-coalgebras for this result.
Throughout what follows, we state our theorems in terms of coalgebras for a comonad, although we often indicate when the theorem applies to coalgebras for an endofunctor as well. The advantage of working with coalgebras for a comonad is that covarieties in EG are themselves comonadic over E , and so the results here may be “iterated”. Also, any category EΓ of coalgebras for

2 When we use the word collection, we allow that it is a proper class. We often abuse set notation and adopt it for classes in what follows.


an endofunctor is, given the presence of cofree coalgebras, equivalent to a category EG of coalgebras for a comonad (see [Tur96]). Since we often require cofree coalgebras in what follows, it’s reasonable to work with categories of coalgebras for a comonad.
We let U : EG E (or U : EΓ   E , resp.) denote the coalgebraic forgetful functor and H : E   EG  (H : E   EΓ , if it exists, resp.) be the right adjoint of
U . We omit U when convenient, writing A for U⟨A, α⟩ and just p for Up.
Theorem 2.4 ensures that categories of coalgebras are (quasi-)co-Birkhoff, assuming that the base category is and that G preserves regular monos. Thus, the abstract co-Birkhoff theorem applies. In order to understand Theorem 2.3 in categories of coalgebras, we introduce the notion of coequation.
Definition 2.5 Let C ∈ E be regular injective. A coequation over C is a regular subobject ϕ ≤ GC(= UHC). We say that a coalgebra ⟨A, α⟩ satisﬁes ϕ (written ⟨A, α⟩ |= ϕ) just in case, for every homomorphism
p :⟨A, α⟩	 H C
(equivalently, every “coloring” A  C ), there is a unique map
p˜:A	 ϕ 
making the diagram below commute.
A	p G C
z_, ,

If V is a class of coalgebras, we write V |= ϕ just in case each ⟨A, α⟩∈ V
satisfies ϕ.
In other words, ⟨A, α⟩ |= ϕ if, for every homomorphism
p :⟨A, α⟩	 H C ,
we have Im(p) ≤ ϕ, or, equivalently, T ≤ p∗ϕ. We similarly define, for each
p :⟨A, α⟩	 H C ,
⟨A, α⟩ |= ϕ(p) iff Im(p) ≤ ϕ.
Equivalently, following the presentation of [AN82] (also found in [AR94]), one could say that a coalgebra ⟨A, α⟩ satisfies a coequation ϕ over C just in case ⟨A, α⟩ is projective with respect to the inclusion ϕ z U¸ HC . In these terms, Theorem 2.3 says that any covariety is S-Proj for some collection S of regular monos with regular injective codomains.
A coequation ϕ over C can be viewed as a predicate over GC. Thus, if Sub(GC) is a Heyting algebra, we can construct coequations ϕ ∧ ψ, ϕ → ψ, etc., and so we see that coequations over C come with a natural structure.

Continuing this interpretation, if ϕ, ψ ∈ Sub(GC), we often write ϕ ▶ ψ to mean ϕ ≤ ψ. It is easy to see that, if ϕ ▶ ψ and ⟨A, α⟩ |= ϕ, then ⟨A, α⟩ |= ψ. If we view coequations ϕ over C as predicates of a variable x of type GC,
one may interpret pullback of coequations along homomorphisms
p :⟨A, α⟩	 G C
as substitution of p(y) (where y is a variable of type A) for x, i.e., p∗ϕ = ϕ[p(y)/x]. Thus, ⟨A, α⟩ |= ϕ just in case, for every homomorphism p, we have T▶ ϕ[p(y)/x].
Remark 2.6 In the case of equations, one can easily distinguish between single equations and sets of equations. Gumm makes a similar distinction between single coequations and sets of coequations in [Gum01], by interpreting coequation satisfaction as an exclusionary condition. We prefer to keep the definition of satisfaction above, in keeping with our view of coequations as predicates. Hence, we do not distinguish between single coequations and sets of coequations.
This notion of coequation allows a more familiar statement of the dual of Birkhoff’s variety theorem.
Theorem 2.7 Suppose E is co-Birkhoff and G preserves regular monos. Then a full subcategory V of EG is a covariety iff there is a collection S of coequations such that for all ⟨A, α⟩,
⟨A, α⟩∈ V iff ∀ϕ ∈ S ⟨A, α⟩ |= ϕ.
If, furthermore, G is bounded by C, then for each covariety V, there is a coequation ϕ over C such that
⟨A, α⟩∈ V iff ⟨A, α⟩ |= ϕ.
The definition of a bounded functor can be found in [Rut96] or [GS98], for instance, where Theorem 2.7 is proved for coalgebras over Set. A proof of this theorem in a more general setting can be found in [Hug01] or [Kur00].
The following corollary is a generalization of Theorem 12 from[Jac95], where the author proves it for a restricted class of coequations over Set, namely those coequations that arise as equalizers of a pair of terms related to the functor G.
Corollary 2.8 Let E be co-Birkhoff and G preserves regular monos, and let
V be a covariety of EG. Then the forgetful functor
V	 E 
is comonadic. Moreover, the associated comonad preserves regular monos and so V is again co-Birkhoff.

Proof. The forgetful functor V	 E is the composite
V  UV  EG  U	 E . 
To show that this composite is comonadic, it suffices to show (by the dual of [Bor94, Volume 2, Theorem 4.4.4] that the following hold:
U ◦ UV has a right adjoint;
U ◦ UV reflects isomorphisms;
U ◦ UV creates equalizers of pairs
f
g	 • 
such that U ◦ UVf , U ◦ UVg have a split equalizer in E .
Condition (i) follows from Theorem 3.4, below. Condition (ii) is easily verified and (iii) follows from the same condition for U and the fact that UV creates equalizers.	✷
Remark 2.9 In the examples that follow, we prefer to describe the coalge- bras as coalgebras for an endofunctor, rather than coalgebras for a comonad. Because these examples involve categories EΓ in which the forgetful functor has a right adjoint, there is a comonad G such that EΓ ∼= EG [Tur96] and hence the previous results apply.
Example 2.10 Fix a set of “inputs”, I and let Γ:Set Se t be defined by ΓS = (PfinS)I,
where Pfin is the covariant finite powerset functor. A Γ-coalgebra ⟨S, σ⟩ can be regarded as a non-deterministic automaton over I, where the structure map gives the transition function. Explicitly, for each state s ∈ S and each input i ∈ I, we write

just in case s' ∈ σ(s)(i).
s  i	 s' 

The deterministic automata are those automata ⟨S, σ⟩ such that, for each s ∈ S and each i ∈ I, there is at most one s' such that s i  s' . Let Det denote the class of deterministic automata, so Det ⊆ SetΓ. Then it is easy to see that Det is a covariety in SetΓ.
In fact, one can show that there is a coequation ϕ over 2 colors that defines
Det. Namely, define ϕ ⊆ UH2 by
ϕ = {x ∈ UH2 | ∀i ∈I ∀y, z ∈ δ(x)(i) . ε2(y)= ε2(z)},
where δ : UH2 ∼= ΓU H2 is the structure map for H2. Then, it is easy to show that
⟨A, α⟩ |= ϕ iff ⟨A, α⟩∈ Det .

Example 2.11 Fix a set Z and let Γ:Set  Se t be the functor
ΓX = Z × X.
Any Γ-coalgebra ⟨A, α⟩ can be viewed as a collection of streams over Z, then, in which the same stream may be multiply represented as elements of A.
The cofree coalgebra HN is the final N × Z ×− coalgebra – i.e., HN = (N × Z)ω. Given an element σ ∈ HN, we can define
Col(σ)= {π1 ◦ σ(i) | i < ω}
(equivalently, Col(σ)= {εN ◦ ti(σ) | i < ω}, where t is the tail destructor). In other words, Col(σ) is the set of all colors that occur in the stream σ. Define a coequation ϕ over N by
ϕ = {σ | card(Col(σ)) < ℵ0},
(where card(X) is the cardinality of X) so σ ∈ ϕ just in case only finitely many colors occur in σ.
One can check that, for any Γ-coalgebra ⟨A, α⟩, we have ⟨A, α⟩ |= ϕ just in case, for all a ∈ A, there is n ≥ 0, m > 0 such that
tn(a)= tn+m(a),
(where α = ⟨h, t⟩). In other words, ⟨A, α⟩ |= ϕ iff each stream in A has only a finite number of “states”.
Remark 2.12 If one is interested not in equality of states, but in the observ- able behavior of streams, then one might require instead that, for every a ∈ A, there is n ≥ 0, m > 0 such that for all i ≥ 0,
h ◦ tn+i(a)= h ◦ tn+m+i(a).
This condition can be specified by a coequation over 1 color.
Remark 2.13 One can easily generate other interesting coequations using Example 2.11. First, it’s easy to see that the same idea can be used with polynomial functors in general. Second, one can require that each state begins repeating within n applications of the destructors by replacing ℵ0 with n in the definition of ϕ.

Conditional coequations
In Definition 2.5, we defined a coequation ϕ over C as a regular subobject
ϕ z¸ U HC


in E . In this section, we generalize the notion of coequation to include regular subobjects
ϕ z¸ ⟨A , α⟩
where ⟨A, α⟩ is an arbitrary coalgebra.
Definition 3.1 A conditional coequation over ⟨A, α⟩ is any regular subobject ϕ ≤ A = U⟨A, α⟩. We say that ⟨B, β⟩ |=α ϕ (or just ⟨B, β⟩ |= ϕ) if and only if, for every homomorphism
p :⟨B, β⟩	 ⟨A , α⟩,
Im(p) ≤ ϕ.
We sometimes drop the word “conditional” and refer to ϕ ≤ A as a co- equation over ⟨A, α⟩.
We adopt the name conditional coequation because the semantics intro- duced in Definition 3.1 arise from the dual of conditional equations in the algebraic case. Given two coequations, ϕ and ψ, over C, we say that ⟨B, β⟩ |= ϕ ⇒ ψ just in case, for every
p :⟨B, β⟩	 H C ,
if ⟨B, β⟩ |= ϕ(p), then ⟨B, β⟩ |= ψ(p). (In [Kur99] and [Kur00], ϕ ⇒ ψ is denoted ϕ/ψ.)
Now, for any pair of coequations ϕ and ψ over C, there is a coalgebra
⟨A, α⟩ and a conditional coequation ϑ over ⟨A, α⟩ such that, for all ⟨B, β⟩,
⟨B, β⟩ |= ϕ ⇒ ψ iff ⟨B, β⟩ |=α ϑ.
Namely, we can take ⟨A, α⟩ = [ϕ]HC (see Section 5 for the definition of [−]) and ϑ = A ∧ ψ. On the other hand, given a conditional coequation ϑ over
⟨A, α⟩, we can view both ϑ and A as coequations over A — that is, as sub- objects of UHA. It is easy to check that
⟨B, β⟩ |=α ϑ iff ⟨B, β⟩ |= A ⇒ ϑ.
Remark 3.2 Given coequations ϕ and ψ over C, one can consider the co- equation ϕ → ψ over C, where → is the exponential in Sub(UHC). One can show that, if ⟨A, α⟩ |= ϕ → ψ, then ⟨A, α⟩ |= ϕ ⇒ ψ, but the converse does not hold in general.
Example 3.3 Let Γ− = −×− and let A = {a, b}. Let
⟨ε , l, r⟩ :UHA  ∼=  A × UHA × UHA
be the structure map of HA. Define coequations ϕ and ψ over A by
ϕ = {σ ∈ UHA | σ = l(σ)}, ψ = {σ ∈ UHA | σ = r(σ)}.


Let α(a) = ⟨b, b⟩ and α(b) = ⟨b, a⟩. Then ⟨A, α⟩ |= ϕ ⇒ ψ, but ⟨A, α⟩ /|=
ϕ → ψ.
Conditional coequations provide a means of interpreting the co-quasi- variety theorem, below. As before, we first state an abstract version of the quasi-variety theorem and then interpret the theorem in categories of coalge- bras. The proof of Theorem 3.4 and its corollaries can be found in [AH00]. The theorem also was proven independently by Alexander Kurz in [Kur00].
Theorem 3.4 Let C be a quasi-co-Birkhoff category and V a full subcategory of C. The following are equivalent.
V is a quasi-covariety.
The inclusion U V : V	 C has a right adjoint HV such that each compo- nent of the counit εV :1C   U VHV is a regular mono.
V = S⊥ for some collection S of regular monos.
Corollary 3.5 Let C be a quasi-co-Birkhoff category and V a quasi-covariety of C. Then
The inclusion U V :V	 C has a right adjoint HV.
The unit ηV :idV   H VU V is an isomorphism.
For each C ∈ C, C ∈ V iff C ⊥ εV, where εV is the counit of the
adjunction U V E HV.
The corresponding comonad, GV = ⟨U VHV, ε, U VηHV ⟩, is idempotent.
The comonad GV preserves regular monos.
The following corollary restates the results of Theorem 3.4 for categories of coalgebras in terms of conditional coequations.
Corollary 3.6 Let S be quasi-co-Birkhoff and let Γ:S   S be an functor that preserves regular monos. A full subcategory V of SΓ is a quasi-covariety just in case there is a collection S of conditional coequations such that
⟨B, β⟩∈ V iff 6ϕ ∈ S ⟨B, β⟩ |= ϕ.
The same claim holds if we replace the endofunctor Γ with a comonad G.

Deductive completeness and invariance
We focus now on Birkhoff’s completeness theorem. Whereas the variety the- orem gives an equivalence between closure conditions on classes of algebras and equational definability, the completeness theorem states an equivalence between deductively closed sets of equations and equational theories for classes of algebras. We first recall the completeness theorem in the classical setting. Let Σ be a signature and Γ the associated polynomial functor (so that

Alg(Σ) = SetΓ), and let
F :Set	 Se tΓ
be the left adjoint of the forgetful functor U : SetΓ   Se t. We say that a set of equations E over X (i.e., a subset of UFX × UFX) is closed if it satisfies the following:
For each x ∈ X, x = x ∈ E;
For each t1 = t2 ∈ E, t2 = t1 ∈ E;
If t1 = t2 ∈ E and t2 = t3 ∈ E, then t1 = t3 ∈ E;
For each function symbol f (n) ∈ Σ, and each n-tuple of equations,
s1 = t1,..., sn = tn,
in E, the equation f (n)(s1,..., sn)= f (n)(t1,..., tn) ∈ E.
E is closed under substitution of terms for variables. That is, for each
t1 = t2 ∈ E, t ∈ UFX, x ∈ X,
t1[t/x]= t2[t/x] ∈ E.
Theorem 4.1 (Birkhoff’s completeness theorem) A set of equations E
is the equational theory for some class V of Σ-algebras just in case E is closed.
We say that a (binary) relation E over UFX is stable just in case, for every homomorphism
f :FX	 F X,
the image of E under f is contained in E, i.e.,
∃f E ≤ E.
In categorical terms, then, a set E of equations over X is closed just in case (i') E is a congruence;
(ii') E is stable.
The notion of stable sets of equations in the algebraic setting dualize to the notion of endomorphism-invariant coequations in the coalgebraic setting. This definition is first found in [GS98]. The term endomorphism-invariant defined here should not be confused with the definition of an invariant predicate as one that admits a structure map (i.e., is the carrier of a subcoalgebra), as used in [Jac99,Maˇs01,PZ01] and elsewhere. Nonetheless, hereafter, we use “invariant” as a shorthand term for “endomorphism-invariant” and hope that no confusion will result.
Definition 4.2 Let ⟨A, α⟩ be a G-coalgebra. A regular subobject ϕ of A is endomorphism-invariant (hereafter, invariant ) just in case, for every homo- morphism
p :⟨A, α⟩	 ⟨A , α⟩,


the image of ϕ under p is contained in ϕ, i.e.,
∃pϕ ≤ ϕ.
Remark 4.3 If ⟨A, α⟩ is a subcoalgebra of the final coalgebra, then any con- ditional coequation ϕ over ⟨A, α⟩ is endomorphism-invariant.
Given a coequational variety
V = {⟨B, β⟩ | ⟨B, β⟩ |= ψ},
we are interested in the minimal coequation ϕ such that V |= ϕ. Such minimal coequations can be viewed as generating the collection of coequations that V satisfies, in the sense that, for any coequation ϑ, if V |= ϑ, then ϕ ▶ ϑ. In this sense, the minimal coequation represents the coequational theory of V
it represents the coequational commitment that V entails. This intuition motivates the following definition.
Definition 4.4 Let ϕ be a (conditional) coequation over ⟨A, α⟩ and V a col- lection of coalgebras. We say that ϕ is the generating (conditional) coequation for V just in case
V |= ϕ;
For any conditional coequation ψ over C, if V |= ψ then ϕ ▶ ψ.
Theorem 4.5 (Invariance theorem) A coequation ϕ over C is the gen- erating coequation for some collection V of coalgebras just in case ϕ is an invariant subcoalgebra of HC.
We postpone the proof until we’ve defined the modal operators ✷ and ☒. The invariance theorem first arises in [GS98], where it is proved for coalgebras over Set. The theorem is stated in different terms in their work, since it is not motivated by the coequation-as-predicate view that we take here.

The subcoalgebra operator
In what remains, we construct the modal operators that are used in the proof of the invariance theorem, and prove some basic results regarding these op- erators. Throughout what follows, we assume that S is co-Birkhoff and has pullbacks and that G preserves regular monos and pullbacks of regular monos, so that SG is co-Birkhoff and U creates pullbacks of regular monos (and, in particular, finite intersections). We further assume that, for each A ∈ S , Sub(A) is a Heyting algebra.
In this section, we introduce the modal operator ✷. Given a subobject ϕ of A = U⟨A, α⟩, ✷ϕ is the greatest subcoalgebra of A contained in ϕ. The construction is well-known, although the view that ✷ is a modal operator is perhaps less familiar. The ✷ operator is discussed in [Jac99], where it plays a

central role. It is from that work that we take the view of ✷ as a “henceforth” operator.
Since the coalgebraic forgetful functor U :SG	 S preserves regular monos, there is an induced forgetful functor,
Uα :Sub(⟨A, α⟩)	 Su b(A),
from the partial order of regular subobjects of ⟨A, α⟩ to the partial order of regular subobjects of A. As is well known, Uα has a right adjoint, which we denote [−]α (dropping the subscripts whenever convenient). The right adjoint maps a subobject B ≤ A to the largest subcoalgebra contained in B. More precisely,
[B] =  {⟨C, γ⟩≤ ⟨A, α⟩ | C ≤ B}.
Here, we use the fact that Uα creates joins. Alternatively, one may define [B] as the pullback shown below.
[B] z¸  H B

_r_z
_rz

J z¸  J 
⟨A, α⟩	HA
This adjoint pair yields a modal operator
✷α :Sub(A)	 Su b(A),
as usual, by taking the composite ✷α = [−]α◦Uα. Again, we drop the subscript when convenient.
Theorem 5.1 ✷ is an S4 necessity operator, i.e., satisﬁes the following:
If ϕ ▶ ψ, then ✷ϕ ▶ ✷ψ
✷ϕ ▶ ϕ
✷ϕ ▶ ✷✷ϕ
✷(ϕ → ψ) ▶ ✷ϕ → ✷ψ
Proof. Condition (i) is just functoriality, and conditions (ii) and (iii) are just the counit and comultiplication for the comonad ✷.
The last item follows from the fact that Uα preserves meets, and hence so does ✷. The argument for (iv) from this is standard, but we include it here.
By (i), we have


and, hence,
✷((ϕ → ψ) ∧ ϕ) ▶ ✷ψ,

✷(ϕ → ψ) ∧ ✷ϕ ▶ ✷ψ.

Therefore, ✷(ϕ → ψ) ▶ ✷ϕ → ✷ψ.	✷


Theorem 5.2 ✷ is stable under pullback along homomorphisms. That is, for any

we have
f :⟨A, α⟩	 ⟨B , β⟩,

✷α ◦ f∗ = f∗ ◦ ✷β.

Proof. The bottom face in Figure 1 commutes, since f is a homomorphism. The front and rear faces are pullbacks by definition of ✷, and the right face is a pullback since G preserves pullbacks along regular monos by assumption. Hence, the left face is a pullback.	✷


✷f∗P,
 z¸	 G f∗P,

_rz,,,,
,,,,
_rz,,,,
,,,,

,vz z¸	 ,vz

✷
_rz

J z¸	 	 J 
 G P
rz

A ,,,
,,,,
,,,vJz 
GA,,,
,,,,
,,,vJz 

B z¸	 G B

Fig. 1. ✷ commutes with pullback along homomorphisms.

Theorem 5.2 can be understood as a statement about substitution of terms for variables. Namely, we view conditional coequations ϕ over ⟨A, α⟩ as pred- icates of a single variable x of type A. Then, Theorem 5.2 says that, for any homomorphism
f :⟨B, β⟩	 ⟨A , α⟩,
and any variable y of type B, we have
(✷ϕ)[f (y)/x]= ✷(ϕ[f (y)/x]).
Thus, ✷ is stable under substitutions of terms built from homomorphisms for variables. (It is not stable under substitution of arbitrary terms for variables, however.)
The invariance operator
We apply the same approach to invariant coequations as in Section 5. That is, we first define an adjoint pair (a Galois correspondence) between the co- equations over ⟨A, α⟩ and the invariant coequations. Then, we use this pair to define a modal operator ☒ on coequations over ⟨A, α⟩.

Accordingly, let Inv(α) denote the full subcategory of Sub(A) consisting of the invariant coequations over ⟨A, α⟩, and let
Iα :Inv(α)	 Su b(A)
be the inclusion functor.
Theorem 6.1 Iα has a right adjoint.
Proof. Let ϕ ≤ A and define
Pϕ = {ψ ≤ A | 6p :⟨A, α⟩	 ⟨A , α⟩(∃pψ ≤ ϕ)}.
We define a functor Jα :Sub(A)	 Su b(A) by
Jα(ϕ)=    ψ,
ψ∈Pϕ
omitting the subscripts when convenient.
We first show that Jϕ is invariant. Let
r :⟨A, α⟩	 ⟨A , α⟩
be given. In order to show that ∃rJϕ ≤ Jϕ, it suffices to show that ∃rJϕ ∈ Pϕ, i.e., for every homomorphism p : ⟨A, α⟩ ⟨A , α⟩, we have ∃p(∃rJϕ) ≤ ϕ. A quick calculation shows

∃p∃rJϕ = ∃p◦r 
ψ∈Pϕ
ψ = 
ψ∈Pϕ

∃p◦rψ ≤ ϕ.

Next, we show that I E J. Let ψ be invariant. If ψ ≤ ϕ, then, for every endomorphism p,
∃pψ ≤ ψ ≤ ϕ,
so ψ ∈ Pϕ and hence ψ ≤ Jϕ. On the other hand, if ψ ≤ Jϕ, then
ψ ≤ Jϕ ≤ ϕ.
✷
Let ☒α = IαJα. We confirm that ☒ is an S4 operator. Again, it suffices to show that ☒ preserves meets.
Theorem 6.2 ☒ is an S4 necessity operator.
Proof. Again, since ☒ is a comonad, it suffices to show that ☒ preserves meets, or, more specifically, that
☒ϕ ∧ ☒ψ ▶ ☒(ϕ ∧ ψ).


Let p :⟨A, α⟩	 ⟨A , α⟩ be given (where ϕ and ψ are conditional coequations over ⟨A, α⟩). Then
∃p(☒ϕ ∧ ☒ψ) ≤ ∃p ☒ ϕ ≤ ϕ
and, similarly, ∃p(☒ϕ ∧ ☒ψ) ≤ ψ. Hence, ∃p(☒ϕ ∧ ☒ψ) ≤ ϕ ∧ ψ. Since p was an arbitrary homomorphism, ☒ϕ ∧ ☒ψ ▶ ☒(ϕ ∧ ψ).	✷
Remark 6.3 Unlike ✷, the operator ☒ does not commute with pullbacks along homomorphisms. Let Γ: Set Se t be the identity functor. We will consider a coequation ϕ over 2 colors, that is, a subset of UH2= 2ω, the set of streams over 2. Specifically, let
ϕ = {0, 1},
where 0 and 1 are the constant streams. Note that ϕ is invariant.
Let p : H3  H 2 be the homomorphism induced by the coloring p :3  2, 
where
p(0) = 0,	p(1) = 0,	p(2) = 1
(i.e., p = H(p)). Then p∗ϕ is the set
{σ ∈ 3ω | 6n σ(n) < 2}∪ {2}.
It is easy to check that
☒p∗ϕ = {0, 1, 2} /= p∗(☒ϕ)= p∗ϕ.
In terms of substitutions, then, it is not the case that, for every homomor- phism
f :⟨B, β⟩	 ⟨A , α⟩,
(☒ϕ)[f (y)/x]= ☒(ϕ[f (y)/x]).
We return to the examples of Section 2 to give some idea of how ☒ works. In those examples, the coequations over C were described in terms of the coloring εC. Typically, ☒ takes a coequation defined in terms of colorings to a similar coequation defined in terms of equality of states, as these examples illustrate.
Example 6.4 Let ΓS = (PfinS)I, as in Example 2.10. Recall that the class of deterministic automata Det forms a covariety of SetΓ, where the defining coequation ϕ over 2 is given by
ϕ = {x ∈ UH2 | 6i ∈I 6y, z ∈ σ(x)(i) . ε2(y)= ε2(z)}.
It is easy to show that
☒ϕ = {x ∈ UH2 | 6i ∈I 6y, z ∈ σ(x)(i) .y = z},
or, more simply,
☒ϕ = {x ∈ UH2 | 6i ∈I . card(σ(x)(i)) < 2}.

Example 6.5 Recall the functor ΓX = Z × X and the coequation ϕ over N
defined by
ϕ = {σ | card(Col(σ)) < ℵ0},
from Example 2.11. For each σ ∈ UHN, let
St(σ)= {tn(σ) | n ∈ ω},
where ⟨εN, h, t⟩ :UHN  ∼=  N × Z × UHN is the structure map for HN. Then
☒ϕ = {σ | card(St(σ)) < ℵ0}.

Generating coequations
We return to the invariance theorem. To begin, we show that, for any ϕ over
⟨A, α⟩, ☒ϕ and ✷ϕ have the same expressive power as ϕ – i.e., define the same quasi-covariety.
Theorem 7.1 Let ⟨A, α⟩ be given. For every ϕ ∈ Sub(A), ⟨B, β⟩∈ SG,
⟨B, β⟩ |= ☒ϕ iff ⟨B, β⟩ |= ϕ.
Proof. Since ☒ϕ ▶ ϕ, one direction is trivial. Suppose, then, that ⟨B, β⟩ |=
ϕ. Let
p :⟨B, β⟩	 ⟨A , α⟩
be given. To show that Im(p) ≤ ☒ϕ, we will show that, for every
r :⟨A, α⟩	 ⟨A , α⟩,
∃r Im(p) ≤ ϕ. But, ∃r Im(p)= Im(r ◦ p) ≤ ϕ, since ⟨B, β⟩ |= ϕ.	✷
Theorem 7.2 Let ⟨A, α⟩ be given. For every ϕ ∈ Sub(A), ⟨B, β⟩∈ SG,
⟨B, β⟩ |= ✷ϕ iff ⟨B, β⟩ |= ϕ.
Proof. Again, one direction is trivial. Let ⟨B, β⟩ |= ϕ and let
p :⟨B, β⟩	 ⟨A , α⟩
be given. Then Uα Im(p)= Im(Up) ≤ ϕ and so, by the adjunction Uα E [−]α,
Im(p) ≤ [ϕ]α. Thus,
Im(Up)= Uα Im(p) ≤ Uα[ϕ]α = ✷αϕ.
✷
Lemma 7.3 Let ϕ be a coequation over C. Then the coalgebra [☒ϕ] satisﬁes the coequation ϕ.

Proof. Let p : [☒ϕ]	 H C be given. Because HC is regular injective, p ex- tends to a homomorphism HC	 H C , as shown below. Hence, because
✷ ☒ ϕ < ☒ϕ
and ☒ϕ is invariant, there is a unique map ✷ ☒ ϕ	 ☒ ϕ making the square and thus the lower triangle commute, as desired.


U H,C,
 U¸ H,C,
p..

_,,....
✷ ☒ ϕ
_,,
 ☒ ϕ
✷

Theorem 7.4 (Invariance theorem) A coequation ϕ over C is the gen- erating coequation for some collection V of coalgebras just in case ϕ is an invariant subcoalgebra of HC, i.e., ϕ = ✷ ☒ ϕ.
Proof. Let ϕ = ✷ ☒ ϕ and define
V = {⟨B, β⟩ | ⟨B, β⟩ |= ϕ}.
Then, clearly, V |= ϕ. We will show that, if V |= ψ, then ϕ ▶ ψ. But, from Lemma 7.3, we know that [☒ϕ] = [ϕ] is in V. Consequently, [☒ϕ] |= ψ and hence
ϕ = ∃id✷ ☒ ϕ ▶ ψ.
✷
Remark 7.5 The same claim and proof holds for conditional coequations over
⟨A, α⟩ where ⟨A, α⟩ is regular injective or ⟨A, α⟩ is an invariant subcoalgebra of HA. That is, a conditional coequation ϕ over such ⟨A, α⟩ is a generating coequation for some class V just in case ϕ = ✷ ☒ ϕ.
Remark 7.6 Let ϕ be a coequation over C and Vϕ the covariety it defines. Let Uϕ : Vϕ   SG be the inclusion and Hϕ right adjoint to V (as in Corol- lary 3.5). Then one can show that
UUϕHϕHC = ✷ ☒ ϕ.
Example 7.7 Consider again the functor Γ:Set  Se t where ΓS = (PfinS)I and the coequation ϕ defined by
ϕ = {x ∈ UH2 | 6i ∈I 6y, z ∈ σ(x)(i) . ε2(y)= ε2(z)}.
We claimed in Example 6.4 that
☒ϕ = {x ∈ UH2 | 6i ∈I 6y, z ∈ σ(x)(i) .y = z}.


We write s	 s' if there is an i such that s i  s' and we write 	∗ for the transitive closure of   . One can further show that
✷ ☒ ϕ = {x ∈ UH2 | 6w. x	∗ w → 6i ∈I card(σ(w)(i)) < 2}.
By Theorem 7.4, ✷ ☒ ϕ is the generating coequation for Det, the class of deterministic automata.
Theorem 7.8 For any coalgebra ⟨A, α⟩,
✷☒ ≤ ☒✷.
Proof. By definition of ☒, it suffices to show that, for every homomorphism
p : ⟨A, α⟩	 ⟨A , α⟩, ∃p✷ ☒ ϕ ≤ ✷ϕ. We know that, for every p, ∃p✷ ☒ ϕ ≤
∃p ☒ ϕ ≤ ϕ. Thus, since Uα commutes with ∃p,
Uα∃p[☒ϕ]α = ∃pUα[☒ϕ]α ≤ ϕ,
and so ∃p[☒ϕ]α ≤ [ϕ]α. Thus,
∃p✷ ☒ ϕ = Uα∃p[☒ϕ]α ≤ Uα[ϕ]α = ✷ϕ.
✷
We can prove that ✷ commutes with ☒ given further assumptions. Namely, if the modal operator ✷ has a left adjoint D, then ✷☒ = ☒✷. The existence of such an adjoint arises naturally, given that the comonad G preserves non- empty intersections. In this case, the subcoalgebra forgetful functor Uα has a left adjoint,
Fα :Sub(A)	 Su b(⟨A, α⟩),
taking a subobject ϕ to the least subcoalgebra ⟨B, β⟩ such that ϕ ≤ B. The closure operator Dα is the composite UαFα.
See [Gum98b] for a discussion of functors which preserve non-empty inter- sections and an example of a functor which does not have this property. See also [Jac99] for a discussion of the closure operator Dα, where it is denoted α
⇐
(and ✷ is denoted α).
⇒
Theorem 7.9 If ✷α has a left adjoint, Dα, then ☒✷ = ✷☒.
Proof. To show that ☒✷ ≤ ✷☒, it is sufficient (by the adjunction DE ✷) to show that D ☒✷ ≤ ☒.
Let ϕ ≤ A = U⟨A, α⟩. We will show that, for every homomorphism p : ⟨A, α⟩  ⟨A , α⟩, ∃p D ☒✷ϕ ≤ ϕ and conclude (by definition of ☒) that D ☒✷ϕ ≤ ☒ϕ. Again, by the adjunctions, it suffices to show that
☒✷ϕ ≤ ✷p∗ϕ = p∗✷ϕ,
or, equivalently, ∃p ☒ ✷ϕ ≤ ✷ϕ. This is immediate from the definition of ☒.✷


One suspects that Theorem 7.9 does not depend on the existence of the closure operator D — that is, there should be a proof that ☒✷ = ✷☒ that does not require an adjoint to the modal operator ✷. At this time, we are unaware of such a proof. Nor do we have an example of a coequation ϕ in some SG for appropriate G such that ☒✷ϕ > ✷ ☒ ϕ. In any case, one finds that for many functors of interest (polynomials, finite powerset, etc.), the operator ✷ does have an adjoint D and so the assumptions above are not as limiting as one might suspect.
Example 7.10 Let ΓX = Z × X and consider again the coequation ϕ over
N from Example 2.11, where
ϕ = {σ | card(Col(σ)) < ℵ0}.
It is easy to check that ✷ϕ = ϕ, and so ☒✷ϕ = ☒ϕ (which was defined in Example 6.5) is the least coequation over N such that ⟨A, α⟩ |= ϕ just in case
⟨A, α⟩ |= ☒ϕ.
Future research
We have tried to develop the idea of “coequation-as-predicate” here. This approach naturally gives a means of constructing new coequations out of old, by using the standard logical operators ∧, ¬, ∃, etc., as well as the modal operators ✷ and ☒. We have shown that, for any coequation ϕ, the covariety ϕ defines is just the same covariety that ✷ϕ and ☒ϕ defines. It is also obvious that the covariety ϕ∧ψ defines is the intersection of the covarieties defined by ϕ and ψ. One would like to investigate the relation between the other logical operators (especially the quantifiers) and the partial order of covarieties.
One would also like to investigate the apparent inequality between ✷☒ and
☒✷. Theorem 7.9 showed that for any functor G which preserves intersections,
✷☒ = ☒✷, but it’s not clear that the assumption is really necessary. To this end, it is instructive to consider the dual case. One supposes that closing a set of equations under the congruence conditions followed by stability always yields the same set as closure under stability followed by the congruence con- ditions, but perhaps there is a technical detail one needs to prove this (maybe an assumption true for all categories of algebras over Set, even).

References
[AGM92] S. Abramsky, Dov M. Gabbay, and T. S. E Maibaum, editors. Handbook of Logic in Computer Science, volume 1. Oxford Science Publications, 1992.
[AH00] Steve Awodey and Jesse Hughes. The coalgebraic dual of Birkhoff’s variety theorem. Technical Report CMU-PHIL-109, Carnegie Mellon University, Pittsburgh, PA, 15213, November 2000.


[AN82] H. Andr´eka and I. N´emeti. A general axiomatizability theorem formulated in terms of cone-injective subcategories. In Proc. Conf. “Universal Algebra Esztergom 1977”, pages 13–15. North-Holland, Amsterdam, 1982.
[AR94] Jiˇr´ı Ada´mek and Jiˇr´ı Rosicky´. Locally Presentable and Accessible Categories, volume 189 of London Mathematical Society Lecture Note Series. Cambridge University Press, 1994.
[BH76] B. Banaschewski and H. Herrlich. Subcategories defined by implications.
Houston Journal of Mathematics, 2(2), 1976.
[Bir35] G. Birkhoff. On the structure of abstract algebras. Proceedings of the Cambridge Philosophical Society, 31:433–454, 1935.
[Bor94] F. Borceux. Handbook of Categorical Algebra I-III. Cambridge University Press, 1994.
[CLM01] A. Corradini, M. Lenisa, and U. Montanari, editors. Electronic Notes in Theoretical Computer Science, volume 44. Coalgebraic Methods in Computer Science (CMCS’2000), 2001.
[Gra¨68] George Gr¨atzer. Universal Algebra. D. Van Nostrand Company, Inc., 1968.
[GS98] H. Peter Gumm and Tobias Schro¨der. Covarieties and complete covarieties. In Jacobs et al. [JMRR98], pages 43–56.
[Gum98a] H. Peter Gumm. Equational and implicational classes of coalgebras, 1998. Extended Abstract submitted for RelMiCS’4.
[Gum98b] H. Peter Gumm. Functors for coalgebras. Preprint, 1998.
[Gum01] H. Peter Gumm. Birkhoff’s variety theorem for coalgebras. Cont. to General Algebra 2000, To appear 2001.
[Hug01] Jesse Hughes. A Study of Categories of Algebras and Coalgebras. PhD thesis, Carnegie Mellon University, 2001.
[Jac95] B. Jacobs. Mongruences and cofree coalgebras. Lecture Notes in Computer Science, 936, 1995.
[Jac99] B.P.F. Jacobs. The temporal logic of coalgebras via Galois algebras. Technical Report CSI-R9906, Computing Science Institute, April 1999.
[JMRR98] Bart Jacobs, Larry Moss, Horst Reichel, and Jan Rutten, editors. ENTCS, volume 11. Coalgebraic Methods in Computer Science (CMCS’1998), 1998.
[JR97] Bart Jacobs and Jan Rutten. A tutorial on (co)algebras and (co)induction. Bulletin of the European Association for Theoretical Computer Science, 62, 1997.


[Kur98] Alexander Kurz. A co-variety-theorem for modal logic. Proceedings of Advances in Modal Logic, 1998.
[Kur99] Alexander Kurz. Modal rules are co-implications. Draft. Available at http://helios.pst.informatik.uni-muenchen.de/~kurz, February 1999.
[Kur00] Alexander Kurz. Logics for Coalgebras and Applications for Computer Science. PhD thesis, Ludwig-Maximilians-Universita¨t Mu¨nchen, 2000.
[Man76] Ernie Manes. Algebraic Theories. Number 26 in Graduate Texts in Mathematics. Springer-Verlag, 1976.
[Maˇs01] Dragan Maˇsulovi´c. Invariants of monadic coalgebras. In Corradini et al. [CLM01].
[MT92] K. Meinke and J. V. Tucker. Universal algebra. In Abramsky et al. [AGM92], pages 189–412.
[PZ01] Erik Poll and Jan Zwanenburg.	From algebras and coalgebras to dialgebras. In Corradini et al. [CLM01].
[RJT01] J. Rothe, B. Jacobs, and H. Tews. The coalgebraic class specification language ccsl. Journal of Universal Computer Science, To appear 2001.
[Ro¸s00] Grigore Ro¸su. Equational axiomatizability for coalgebra. Theoretical Computer Science, 260, 2000. Scheduled to appear.
[Rut96] J.J.M.M. Rutten. Universal coalgebra: a theory of systems. Technical Report CS-R9652, Centrum voor Wiskunde en Informatica, 1996.
[Tur96] Daniele Turi. Functorial Operational Semantics and its Denotational Dual. PhD thesis, Free University, Amsterdam, June 1996.
