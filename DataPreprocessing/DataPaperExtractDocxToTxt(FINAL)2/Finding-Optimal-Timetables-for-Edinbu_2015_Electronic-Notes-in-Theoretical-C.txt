Available online at www.sciencedirect.com


Electronic Notes in Theoretical Computer Science 310 (2015) 179–199
www.elsevier.com/locate/entcs


Finding Optimal Timetables for Edinburgh Bus Routes
Ludovica Luisa Vissat
Dipartimento di Matematica e Geoscienze Università degli Studi di Trieste
Trieste, Italy
Allan Clark and Stephen Gilmore1,2
Laboratory for Foundations of Computer Science The University of Edinburgh
Edinburgh, Scotland

Abstract
We present a novel application of stochastic simulation and model-checking methods to determining whether bus services are fulfilling their service-level agreement to provide on-time departures of buses from stops sufficiently often. We use open data on predicted bus arrival times to parameterise a stochastic model of a particular bus route from Edinburgh city centre out to suburban and rural areas to the south of the city. We validate and then analyse our stochastic model using both simulation and model-checking methods. Finally, we complete an optimisation study on the model and discover a better timetable for the service which would expose the bus service operator to less financial risk of penalties being applied by the regulatory authorities which define standards for bus service, punctuality and reliability.
Keywords: Open data, parameter fitting, phase-type distributions, simulation, model-checking, optimisation.

Introduction
In the United Kingdom, Traffic Commissioners are responsible for licensing and regulating operators of heavy goods vehicles, public service vehicles and local bus services and they can also take action against their drivers. They have powers protected in law to allow them to call a formal public inquiry in court to get evidence to help them in making decisions, such as whether they should grant or refuse licences, or take action against a bus service operator or a driver of a bus, minibus or lorry. They have published the Practice Direction: Standards for Local Bus

1 This work is supported by the EU project QUANTICOL, 600708.
2 Email: stg@inf.ed.ac.uk

http://dx.doi.org/10.1016/j.entcs.2014.12.018
1571-0661/© 2015 The Authors. Published by Elsevier B.V.
This is an open access article under the CC BY-NC-ND license (http://creativecommons.org/licenses/by-nc-nd/3.0/).

Services which outlines the standards that bus operators are expected to adhere to [10].
In Scotland, bus operators must know these standards and the Scottish Gov- ernment works with them to improve their services, through its Smarter Scotland initiative. The Bus Punctuality Improvement Partnerships (BPIP) report [9], sets definitions and targets for operators regarding bus service provision. Similar defi- nitions for key concepts such as “window of tolerance” are also used in the national Department for Transport report [2].
Our case study here is concerned with modelling and analysing the public trans- port system in the city of Edinburgh, with a specific focus on the bus network. Buses in Edinburgh are thoroughly instrumented with GPS positioning instrumen- tation, and report their latitude and longitude every thirty seconds back to a central server which uses a predictive model to estimate arrival times at bus stops. These predictions are relayed back to passengers of the bus service using on-street signage, made accessible via a web site, and delivered by smartphone apps.
Buses and punctuality
The integration of Automatic Vehicle Location (AVL) equipment with the real- time passenger information system means that information is effectively transmitted to the passengers who want to choose the best bus service to take them to their destination most efficiently.
It is a requirement under the UK Transport Act of 1985 that bus operators should register the route and timetable of any bus service they wish to operate. This must include details of specific timing points along the route, which should not be more than 15 minutes apart (except where the next available stop is more than 15 minutes running time from the preceding stop). The exception to the above is where a service is registered as a frequent service, according to the PSV (Registration of Local Services) (Scotland) Regulations 2001, whereby the service interval is 10 minutes or less and therefore individual timings do not need to be specified.
Standards for bus services
The Traffic Commissioners’ Practice Direction: Standards for Local Bus Services outlines the standards which bus service operators must adhere to. The Scottish Government through its Smarter Scotland initiative works together with opera- tors to improve their services through Bus Punctuality Improvement Partnerships (BPIPs). The BPIP report, published in 2009, sets forward definitions and targets for operators regarding bus service provision.
The BPIP 2009 report includes a definition of on time which means buses should depart from a bus stop between one minute early and ﬁve minutes late, more com- monly referred to as the window of tolerance around departures. This window is intentionally asymmetric so that early-running buses are given less room for error than late-running buses (because it is possible to wait for a late-running bus, but

not for an early-running one).
Other definitions provided in the BPIP 2009 report include punctuality and
reliability.
Punctuality: the percentage figure is calculated as the number of journeys oper- ated between 60 seconds early and ﬁve minutes late, divided by the total number of journeys scheduled.
Reliability: the percentage figure is calculated as the number of miles not op- erated, divided by the total number of miles that were planned to be operated.
Specific targets for the quality of service provided are specified according to stages of the journey, and are different for frequent, and non-frequent services.
For non-frequent services, 95% of journeys should depart within the ‘window of tolerance’ at the start of their route.
For frequent services it is expected that on at least 95% of occasions:
six or more buses will depart within any period of 60 minutes; and
the interval between consecutive buses will not exceed 15 minutes.
The reason to treat frequent and non-frequent services differently stems from the
perception that passengers access frequent and non-frequent services differently. Passengers using frequent services (where the service interval is 10 minutes or less) tend to go to a bus stop without first checking the timetable because they have little risk of waiting very long at the bus stop for the next bus. In contrast, a passenger using a non-frequent service (where, for example, the service interval is one hour) will almost certainly check the timetable and expect the buses to be closely following the timetable.
For subsequent timing points along the bus route, the standards are slightly different again.
For non-frequent services, the absolute minimum standard acceptable to the Traf- fic Commissioner that an operator will be expected to attain is for 70% of buses to depart at timing points along the route within the ‘window of tolerance’.
For frequent services, measurement is based upon the Transport for London con- cept of Excess Waiting Time (EWT) [3].
This is the difference between the average waiting time expected from the
timetable, and what is actually experienced by passengers on the street.
TC standards specify that EWT should not exceed 1.25 minutes.
The question of whether a service as a whole should be treated as a frequent service,
if it only has a service interval of 10 minutes or less for part of the day is unclear. We will treat our example later as a non-frequent service, so the first rule is significant for us (“70% of buses depart on-time”).
Final timing points are treated slightly differently again in the BPIP 2009 report.
Traffic Commissioners expect 95% of all services to arrive at their final destination point no more than ﬁve minutes late, and emphasise that they would not expect to find undue recovery time inserted in the timetable towards the end of a journey.

However, in contrast to the start and intermediate timing points, the arrival time at the journey destination is not used by the Traffic Commissioners to assess an operator’s punctuality performance. (It is not considered to be a problem to arrive at the final destination early.)

The Traffic Commissioner’s Public Enquiry
The BPIP 2009 report defines expected levels of service, under different conditions of operation. The gravity and seriousness of these definitions was made clear in 2010 when the Traffic Commissioner for Scotland held a public enquiry into the operation of Lothian Buses in response to a complaint about buses running too early. The public enquiry and the subsequent decision of the Traffic Commissioner were reported in the Scotsman newspaper in July 2010.
Lothian Buses are a widely-respected bus company. They are the only municipal bus company in Scotland and are the largest municipal bus company in the United Kingdom. Lothian Buses have won several awards for their services to Edinburgh and the Lothians including Best UK Bus Company in 2002 and 2003, Scotland’s Best Bus Company 2006, UK Bus Operator of the Year in 2007, Public Transport Operator of the Year (Bus) in 2008, Top City Operator of the Year in 2011, Best Green Large Company in 2012, and the Contribution to Sustainable Transport award in 2013, as well as being short-listed in many other categories on numerous occasions.
Inspectors from the Vehicle and Operator Services Agency (VOSA) carried out a monitoring exercise on Lothian Bus services 4, 16, 27 and 45 and found that out of 303 services, 23 departed too late and 44 departed too early, with the remain- ing 236 departing on-time (as defined by the window of tolerance). Lothian Buses explained that they had built extra slack into their timetables expecting delays caused by engineering works which were needed to lay tracks for Edinburgh’s tram system. However, the hold-ups anticipated due to these engineering works did not turn out to be as bad as expected, leaving many of the company’s buses running ahead of schedule.
The Traffic Commissioner for Scotland fined Lothian Buses £10,500. The com- missioner, who had the power to fine the bus firm up to £385,000 — calculated as
£550 times the level of an operator’s authorisation, in this case 700 buses — said she would not take any action against its licence, leaving it free to continue serving the city.
The public enquiry and the monitoring exercise were carried out after just one complaint was received about the bus company. To put this into context, a customer who missed a service 4, 16, 27 or 45 bus would be likely to have to wait up to 30 minutes for the next bus.

The response to the public inquiry
The response of Lothian Buses to the outcome of the public enquiry was reported on their website in August 2010. The company took the decision to install an early warning driver alert system to its in-cab Automatic Vehicle Location (AVL)




Fig. 1. A map showing the four timing points from North Bridge (in the north) to Cameron Toll, Lasswade Road Crossroads, and Bonnyrigg Toll (in the south). There are many bus stops between each pair of timing points.
equipment.
The system is activated if a driver is running early (at least one minute) prior to reaching a timing point. The first alert is triggered two bus stops before the timing point and displays a message on the driver’s console “Slow down: you are early! ” and sounds a warning buzzer. If the vehicle continues to run early, a second alert sounds and the message “Wait your time: you are early! ” is displayed just prior to reaching the timing point.
The system was developed in conjunction with INEO, the French based real-time passenger information specialist who worked with Lothian Buses to equip their en- tire fleet with AVL equipment, integrating with the real-time passenger information system.
— 3 —
The formal framework set out for assessing bus services, coupled with the ev- ident seriousness of the interpretation of these regulations, motivates the wish to formally model this system of operating conditions and ask whether we can deter- mine whether potential future changes to the bus service — or to the regulations mandated by the Bus Punctuality Improvement Partnership — would expose the company to potential liability in the future.

Case study: The number 31 bus
As our case study, we will consider the number 31 bus, a service which runs across the city centre and then travels south out of the city of Edinburgh to rural areas in the south. We will be particularly focussed on the seven-mile journey from North Bridge (NB) in the city centre, to Cameron Toll (CT), Lasswade Road Crossroads (LR), and Bonnyrigg Toll (BT). These four timing points for the 31 service are illustrated in Figure 1.
We chose this service from the many services which are provided because it had

a number of different road conditions in a relatively compact route. At the start of the journey the buses experience busy city traffic conditions with high congestion, moving to suburban areas with less traffic pressure, out to essentially open roads with little congestion in the last part of the journey. In addition, the timetable presents a simple pattern of departure times from North Bridge during the day, making it easy for us to remember the pattern of departures and refer to it in our graphs and model results.
Within this service we will particularly look at a period in the weekday when the service operates as a frequent service, with departures from North Bridge on the hour, and at ten minute intervals between 11:20 and 16:10. The timetable is shown in Figure 2. The description of the service in the timetable can be interpreted as a deterministic process, with precise journey times of 16, 8, and 10 minutes between timing points. This is clearly an abstraction, and the concrete realisation of this system will be a stochastic process with delays introduced by traffic conditions, traffic control and signalling, passenger numbers and fluctuation in service demand, pedestrians and other road users, and even the weather conditions.

NB . CT . LR . BT
(deterministic durations in minutes: . 16, . 8, . 10)
Fig. 2. The number 31 bus timetable, showing planned departures from North Bridge (NB), Cameron Toll (CT), Lasswade Road Crossroads (LR), and Bonnyrigg Toll (BT).


Obtaining data from the Bus Tracker web site
The names used in the timetable can be mapped to the names of bus stops to obtain a numeric eight-digit stop code which can be used to access the real-time passenger information on the Edinburgh Bus Tracker website at http://mybustracker.co. uk. The mapping of timetable names to bus stops is shown in Figure 3.
The eight-digit stop code can be passed as a parameter to the Bus Tracker

Fig. 3. Names and codes of timing points on the 31 service route



November 19, 2013


14


12


10


8


6


4


2


0
11:20:00	11:30:00	11:40:00	11:50:00	12:00:00	12:10:00	12:20
Time of day

Fig. 4. Comparing the timetable model against the predicted waiting times at North Bridge as reported by the Bus Tracker website.

website in order to obtain real-time information about the departures from this stop, as shown below.
http://mybustracker.co.uk/?module=consult&mode=busStopQuickSearch& busStopCode=36234754
This web page can be obtained programmatically, using a script implemented in the Python programming language. This script retrieves the web page and uses the Beautiful Soup HTML parsing library [7] to extract the required semantic content, which is the number of minutes to wait until the next departure of the 31 bus. This information is gathered over the four timing points on the route every thirty seconds throughout the day.

Timetable data and predicted waiting times
The data gathered by this process can be visualised and compared against the timetable, as shown in Figure 4. The Bus Tracker website reports predicted waiting times at a granularity of one minute with short waiting times mapped to the word “DUE”, which we represent as the value 0. Thus an observer studying the Bus Tracker website would expect to see the monotonically decreasing sequence of values 10, 9, 8, 7, 6, 5, 4, 3, DUE followed by the same sequence of values repeated. In practice, due to delays an observer may see values larger than 10, and due to revisions of the waiting time predictions by the Bus Tracker service the sequence of predicted waiting times will not always be a series of monotonically decreasing sequences.
We gathered data on the 31 bus service over a period of days in November 2013. The results of this data collection for November 19th 2013 over the five hours between 11:10 and 16:20 are shown in Figure 5. Little can be concluded from this short observation period except to note that the maximum waiting times were seen towards the end of the route, with the longest waiting time (of over 20 minutes) being seen at the Bonnyrigg Toll stop.





November 19, 2013
25

November 19, 2013
25





20	20




15	15




10	10




5	5



0
11:20:00	11:30:00	11:40:00	11:50:00	12:00:00	12:10:00	12:20:00
Time of day

0
11:30:00  11:45:00  12:00:00  12:15:00  12:30:00  12:45:00  13:00:00  13:15:00
Time of day

(a)	(b)



November 19, 2013
25

November 19, 2013
25





20	20




15	15




10	10




5	5



0
11:30:00	12:00:00	12:30:00	13:00:00	13:30:00	14:00:00
Time of day

0
11:30:00  12:00:00  12:30:00  13:00:00  13:30:00  14:00:00  14:30:00  15:00:00
Time of day

(c)	(d)



November 19, 2013
25

November 19, 2013
25





20	20




15	15




10	10




5	5



0
11:30:00 12:00:00 12:30:00 13:00:00 13:30:00 14:00:00 14:30:00 15:00:00 15:30:00 16:00:00
Time of day

0
11:30:00 12:00:00 12:30:00 13:00:00 13:30:00 14:00:00 14:30:00 15:00:00 15:30:00 16:00:00
Time of day

(e)	(f)

Fig. 5. Predicted waiting times at the timing points on the 31 bus route on November 19th 2013, for (a) one hour, (b) two hours, (c) three hours, (d) four hours, and (e) five hours. Cumulative mean waiting times are presented in (f).

Converting waiting time data to departure events
From the data collected over a period of days in November 2013, we can detect departure events because they consist of a series of observations of short waiting times followed by a sudden increase in waiting time (as we move from waiting for one bus to waiting for the next one). These events are different in nature from the predicted waiting times because they represent an event which has occurred rather than a prediction of an event which might or might not occur at the predicted time. Discarding the prediction data and retaining only the departure event data we arrive at a useful slice of the data. Correlating this with the timetable, as in Figure 6, we are able to determine journey times. Collecting up computed journey times, we can compile a distribution of journey times.









Time
17:00

16:00

15:00

14:00

13:00

12:00



11:00

0	2	4	6	8
Distance in miles


Fig. 6. Relating departure events and distance in miles from North Bridge with departures according to the timetable. Cameron Toll is 2.1 miles from North Bridge, Lasswade Road Crossroads is 4.7 miles from North Bridge, and Bonnyrigg Toll is 6.9 miles from North Bridge.


Fitting phase-type distributions with HyperStar
The empirical distributions of journey times are used as a data set which is given as an input to a data-fitting tool. HyperStar [8] is a software tool for fitting phase-type distributions to data sets. Phase-type distributions have the desirable property that they can approximate any distribution with non-negative support arbitrarily closely. In addition to this, they can also be represented as continuous-time Markov chains (CTMCs), meaning that any modelling tool which supports CTMCs can process models which are composed of phase-type distributions. The modelling tools of interest to us include the Bio-PEPA Eclipse plug-in, for performing discrete-event simulations, expressible as state-event traces documented in a format suitable for the Traviando trace-analyser; and the PRISM probabilistic model-checker, for verifying formulae of Continuous Stochastic Logic (CSL).

The distribution of journey times for each stage of the journey is mapped to a stochastic process using HyperStar. The results of this process are a fitted CDF and a fitted PDF for the data, as seen in Figure 7. HyperStar was at liberty to choose any phase-type distribution to fit the data but in each of our stages, the result of the phase-type fitting was an Erlang distribution. This would not necessarily be the case for all journey times between timing points on a bus route so we did not want to assume this distribution in advance and would rather have it selected for us as the best fit by the fitting procedure in use. Erlang distributions may be found frequently because the constraints on the placement of timing points mean that they tend to be 10–15 minutes distant along the route. Traffic Commissioner regulations mean that they should not be too far apart, and wanting to have a concise timetable means that they should not be too close together. This tension tends to separate them sufficiently that the overall journey time tends to become more predictable. In other work [6], HyperStar has returned hyper-Erlang distributions.

Fig. 7. Fitting the North Bridge to Cameron Toll phase of the journey using HyperStar

The HyperStar fitting procedure produces the following results for the three stages of the journey.

We can quickly check how these stochastic process parameters, derived from our data collected from the Bus Tracker website, stand in relation to the deterministic model published in the bus timetable. We use the parameter of each exponential distribution to compute an average duration and imagine that this average duration was the duration of each stage in the Erlang distribution. We then multiply by the number of phases in each Erlang to get an approximate average duration of the

stochastic process made up of that number of exponentially-distributed events.

We find that, for the stochastic process derived from our data set, that it seems that the part-journey which it will be most difficult to complete within the required time bound is the journey from Cameron Toll (CT) to Lasswade Road Crossroads (LR). This observation stems from the fact that the average total duration estimated from our journey time data is larger than the timetabled 8 minutes.
We can visualise the stochastic process which results from the data fitting pro- cedure as in Figure 8. It is a series of three Erlang distributions with 105, 83 and 98 phases respectively. The exponential distributions making up the first Erlang have rate 6.47. The exponential distributions making up the second Erlang have rate
8.79. The exponential distributions making up the third Erlang have rate 10.54.

NB . . . . . . . . . . . . . . . . . . . . . . . . . . 
. . . . . . . . . . . . . . . . . . . . . . . . . . . . 
CT . . . . . . . . . . . . . . . . . . . . . . . . . . 
.. . . . . . . . . . ................ 
LR . . . . . . . . . . . . . . . . . . . . . . . . . . 
.. . . . . . . . . . . . . . . . . . . . . . . . . . 

105 exponentials . rate 6.47,

83 exponentials . rate 8.79,

98 exponentials . rate 10.54

BT

Fig. 8. The stochastic process modelling the journey NB . CT . LR . BT


Kolmogorov-Smirnov test
After the fitting procedure and writing the model we can attempt to determine if the real data from MyBusTracker and the results of our model differ significantly or not. To this end we can deploy the Kolmogorov-Smirnov test (KS-test), which is used to quantify either a distance between the empirical distribution function of a sample and the cumulative distribution function of a reference distribution (one-sample KS test), or to compare two distributions (two-sample KS test). For our case we present the results of the Kolmogorov-Smirnov test, calculated using Matlab, where h is the hypothesis test result, with 0 indicating the acceptance of the null hypothesis, and 1 the rejection of it, at a significance level of 0.05. p indicates the p-value, returned as a scalar in the range [0, 1]. p is the probability of observing a test statistic as extreme as, or more extreme than, the observed value under the null hypothesis. Small values of p discredit the validity of the null hypothesis. ksstat represents the test statistic and cv the critical values.


	


Fig. 9. CDF and empirical CDF for the first, second and third stages of the journey

In Figure 9 we represent the CDF and the empirical CDF for the different stages of the whole journey.

Encoding in Bio-PEPA
The underlying stochastic process computed by HyperStar and checked with the KS-test is straightforward to code in the Bio-PEPA stochastic process algebra [1]. We have one species for each stage in each Erlang distribution.
NB1,... NBphases1 ,
CT1,... CTphases2 ,
LR1,... LRphases3 ,
BT1

The kinetic laws are all simple and dependent on the population of one species type only, so the law of mass action does not play a role.
nbToCti = [rate1 × NBi]
ctToLri = [rate2 × CTi]
lrToBti = [rate3 × LRi]
The species reactions are simple exchanges. The reaction nbToCt1 decreases the
number of buses at stage NB1 by one and increases the number of buses at stage NB2
by one.
NB1 = nbToCt1 ↓
NB2 = nbToCt1 𝛙 +nbToCt2 ↓
Viewed as a series of reaction events, each of these is simple also. In the reaction-
centric view, we have:
nbToCt1 : NB1 → NB2
The meaning of this reaction expression is that the reaction nbToCt1 (corresponding
to the first phase of the journey between North Bridge and Cameron Toll) converts a bus stationed at the first phase of the journey (NB1) into a bus stationed at the second phase of the journey (NB2).
This is a stochastic model which can be analysed as a continuous-time Markov chain or simulated using a Monte Carlo procedure such as Gillespie’s Direct Method.

Enforcing the rule of no early departures
Early departures posed a problem for the Lothian Bus company, leading to a public enquiry and the imposition of a fine. In contrast to late departures, early departures can (in principle) be prevented, by instructing drivers not to leave the bus stop until the departure time published in the bus timetable. This seems like such an obvious simple solution to the problem that one might wonder why it has not been adopted by the operator. One problem is that early-running buses, patiently waiting for the time to depart from a timing point, can cause buses behind them to be late. It might be thought that the following bus could board passengers away from the stop, change lane, and then overtake the waiting bus. However, this is not possible because bus operators in the UK are required to board passengers at a bus stop. This requirement is in place because elderly, blind, and disabled people use buses too and asking them to board away from the bus stop may be difficult for them. Because passenger courtesy and accessibility by disabled users are important to the company, and in order to comply with safety regulations, drivers are allowed to depart from a bus stop early when it is appropriate to do so.

Experimenting with the rule of no early departures
Because we have a dynamic model of the system, we can at least experiment in the abstract with the idea of “no early departures” and see its impact on journey times




100000	100000




10000	10000




1000	1000




100	100




10	10



1
0	10	20	30	40	50
Time (in minutes)

1
0	10	20	30	40	50
Time (in minutes)



Fig. 10.	A log-scale plot of 100,000 simulations of the Bio-PEPA model with early departures allowed (left) and with no early departures allowed (right).

and arrival times. This Bio-PEPA model needs only two small changes to enforce the rule of no early departures.
First, change the kinetic law which controls departures from Cameron Toll.
Replace nbToCtphase1 = [rate1 × NBphase1 ]
by nbToCtphase1 = [H(time − 15) × rate1 × NBphase1 ]
The function H() is the Heaviside function, which effectively switches off the reac-
tion until the allowed time (one minute before sixteen simulated minutes).

H(x)= ⎧⎪⎨
⎪⎩

if x < 0,
otherwise

Second, make the corresponding change at Lasswade Road.
Replace ctToLrphase2 = [rate2 × CTphase2 ]
by ctToLrphase2 = [H(time − 23) × rate2 × CTphase2 ]
These changes are compact, and relatively easy to understand, but they have the
consequence that the model can no longer be considered to be a time-homogeneous continuous-time Markov chain because the reference to the time variable (time) in the kinetic laws means that the model is now time-inhomogeneous. This has the consequence that the model can be analysed by simulation methods which allow discrete time-dependent events, but it cannot be analysed by the procedures of numerical linear algebra which are used to analyse classical Markov chains in probabilistic model-checking.
The results of our simulations with early departures allowed and with early departures disallowed are presented in Figure 10. The ‘window of tolerance’ around a timetabled departure event (one minute early to five minutes late) is visualised on the graph for the timetabled departure from Cameron Toll at 16 minutes after the departure from North Bridge and the timetabled departure from Lasswade Road Crossroads at 24 minutes after the departure from North Bridge.

LTL Model-checking with Traviando
Traviando [5] is a post-mortem simulation trace analyser which reads a simulation trace in state/event format. Bio-PEPA models can generate traces in Traviando format, allowing these traces to be analysed. Traces are single and discrete, giving one execution of the model up to a finite time horizon.
Traviando allows the user to visualise traces, compute statistical properties, and perform LTL model-checking. Its purpose is to allow modellers to check whether their simulation has exercised all aspects of the model, and look for other problems (“dead code”, meaning parts of the model which are not exercised by the simulation, such as an action which is never taken).

Checking individual simulations of our Bio-PEPA model
We checked LTL formulae over our Bio-PEPA model.
(tt U CT)
“eventually, you reach Cameron Toll”
This was true for all our simulations.
(tt U BT)
“eventually, you reach Bonnyrigg Toll”
This was not always true, some simulations terminated too early.
(tt U CT) → (tt U NB)
“You cannot reach Cameron Toll without reaching North Bridge”
This was true for all our simulations.
(tt U LR) → (tt U CT)
“You cannot reach Lasswade Road without reaching Cameron Toll ”
This was true for all our simulations.
(tt U CT) → (tt U LR)
“You cannot reach Cameron Toll without reaching Lasswade Road ”
This was not always true, some simulations terminated too early.
Having completed these tests we had reassured ourselves that we had not made
logical errors in expressing the model in Bio-PEPA, and that the model was cap- turing our intentions. We also had determined necessary simulation time bounds for our simulations.
CSL Model-checking with PRISM
We performed probabilistic model-checking using PRISM [4], a well-known proba- bilistic model-checker. PRISM implements symbolic data structures and algorithms, and supports statistical model-checking, but our model is compact, and hence is ef- ficiently solvable without recourse to symbolic or statistical methods. The model is presented in Figure 11. The rates and number of phases for the Erlang distributions are as inferred by HyperStar previously.

ctmc
module bus31
stage : [0 .. 3] init NB; pos1 : [1 .. phases1] init 1; pos2 : [1 .. phases2] init 1; pos3 : [1 .. phases3] init 1;
[nb_to_ct](stage = NB ∧ pos1 < phases1)	→ rate1 : (pos' = pos1 + 1); [arrive_ct](stage = NB ∧ pos1 = phases1) → rate1 : (stage' = CT);
[ct_to_lr](stage = CT ∧ pos2 < phases2)	→ rate2 : (pos' = pos2 + 1); [arrive_lr](stage = CT ∧ pos2 = phases2) → rate2 : (stage' = LR);
[lr_to_bt](stage = LR ∧ pos3 < phases3)	→ rate3 : (pos' = pos3 + 1); [arrive_bt](stage = LR ∧ pos3 = phases3) → rate3 : (stage' = BT);
endmodule

Fig. 11. PRISM model encoding the CTMC representation of NB . CT . LR . BT

The overall goal of a bus punctuality improvement partnership is to improve bus punctuality. Specifically, in formal terms, this can include having a stricter definition of the window of tolerance around departure events. A narrower window corresponds to a better service, with buses departing less early, and less late.
The logic CSL provides a very convenient way to allow us to explore this question through a simple model-checking problem. We evaluate the CSL bounded Until formula Pr=?[(stage < N ) U[l,u] (stage = N )] for different values of the lower bound l and the upper bound u on the time of departure. The formula asks what is the probability that the transition to the N th stage of the journey occurs in the interval [l, u].
Figure 12 shows the results of this exploration for the three stages of the journey. The back left curve of each surface plot describes the effect of prohibiting late
departures (changing the window of tolerance from [−1, 5] to [−1, 0]). The back
(changing the window of tolerance from [−1, 5] to [0, 5]). The probability of being right curve of each surface plot describes the effect of prohibiting early departures on-time approaches zero as the window narrows towards [0, 0], of course.
From these graphs we see that early departures occur most often at the Cameron Toll stage of the journey, and least often at the Lasswade Road stage (because the back right curve falls away most steeply at Cameron Toll, and least steeply at Lasswade Road).
We note that all timing points satisfy the requirement that for an operator to have (at least) 70% of buses depart at timing points along the route within the
window of tolerance for the Scottish definition of a window of tolerance of [−1, 5].
Validating the assumption of independence
We have modelled the journey as three independent stages (NB . CT . LR . BT). This decision might seem to be overly simple, because the stages of the journey are surely not independent. After all, we are tracking the same bus across the three




Fig. 12. Computing the probability of departing within the window of tolerance, for varying sizes of window.
stages of the journey, with the same driver for all three stages, almost always. Since the driver will be aware that they have departed from a stop early (or respectively, late), it might be thought that they would try to compensate for this problem in the next stage of the journey by driving slower (or respectively, faster).
If drivers are compensating for being adrift from the timetable then we would expect to see a negative correlation between subsequent stages (as the drivers try to balance a slower stage against a faster stage, and vice versa). We decided to investigate this theory of driver compensation to see if we could find evidence for this in the data which was available to us. We used a different out-of-sample data set from the data set which was used to parameterise the model, in order to ensure that we were not resampling. Figure 13 shows the results. In the data which is available to us, we could find no strong evidence to support the theory of driver compensation and thus we felt no significant pressure to incorporate this in our model.
The optimisation problem
Clearly there is an optimisation problem to solve which is: “what would have been the optimal timetable to match the model results computed from our simulation model?” This simulation model has been parameterised by the HyperStar fitting procedure, and checked to give statistically-sound results using the Kolmogorov- Smirnov test. Thus, we are able to treat results generated by the simulation model as a credible source of samples which can be used to explore the optimisation space


	
Fig. 13. Seeking correlations in the BusTracker data between journey times (expressed in seconds) for successive stages. Strong correlation would show up as a straight line in a scatter plot. No strong correlations are seen to support the theory of driver compensation, thus justifying the independence between stages represented in the model.

of the model. The crux of our optimisation, as stated, is to find a better timetable, in the sense that it exposes the service operator to reduced financial liability than the currently published timetable.
Figure 14 shows the optimisation surfaces for combinations of arrival times at timing points. Each graph compares the arrival times at two of the timing points, asking for each point in the graph how many arrivals fell outside the window of tol- erance. There are several vertical points for each (x, y) pair because these represent the misses for the changing arrival times in the unmentioned stop of that graph. For example, the first graph plots the results against Cameron Toll and Lasswade Road and those vertical points which all have the same x and y coordinates correspond to the different possible arrival times considered for the Bonnyrigg Toll timing point.

Exploring the parameter space
Bus timetables state arrival times as whole minutes with no fractional part thus the search for an optimal timetable configuration to best fit the model results can be achieved by a parameter sweep over the integer domain. We are not seeking a solution in a dense domain.
The structure of the model remains unchanged when exploring the parameter space, so there is no risk of state-space generation problems in this phase of the work. All we are seeking to do at this stage is to investigate whether a revised timetable exposes the bus company to less risk. Crucially this will not require any operational change to the way in which the buses are driven. In particular, we are not suggesting that the drivers adjust their speed from the current regime for any part of the journey, only that the timetable is adjusted to better match what is currently being done.
We computed an ensemble of stochastic simulations with our simulation model, and counted how many departures would lie outside the window of tolerance for de- partures at timing points for each possible combination of arrival times. Figure 15 presents a visualisation of our exhaustive full factorial exploration of the credible


	


Fig. 14. Optimisation surfaces for combinations of arrival times at timing points.

Parameter sweep of possible timetable values



Fig. 15. Exploring the parameter space of different journey durations for the three stages of the journey.
arrival times at the downstream bus stops. In our visualisation, fewer misses cor- respond to larger, redder points and more misses are rendered as smaller, blacker points. Fewer misses are better. We see that the size and colour of the points diminishes as we radiate out from the centre of the box. This gives us confidence that we have explored enough of the search space to have found the optimum value. The optimal configuration of arrival times – with the fewest departures at timing points outside the window of tolerance – was (14, 24, 33). Crucially, these are not

the arrival times predicted by the timetable, which are (16, 24, 34), normalising to the hour. More problematic than this, the published timetable values over-estimate the journey times, leading to the undesirable situation that buses are likely to be running early. This is worse than running late due to the asymmetric nature of the window of tolerance, and was the situation which led to Lothian Buses being fined previously. With a journey time which is often two minutes less than the published duration, many departures after the first stage of the journey will occur earlier than the window of tolerance. In contrast, to be as late would be less problematic. Arrival times of (18, 24, 35) would lead to fewer departures outside the window of tolerance.
The observation that we would offer from this study is that for this route, based on the data which is available to us, the bus operator is exposing themselves to financial penalties by advertising the current timetable and that publishing a revised timetable with arrival times of 14, 24, and 33 minutes past the hour would lessen this risk.
Conclusions
In this paper we used open, public data to parameterise a stochastic process model of a bus service. We explored the performance of the service with respect to its mandated service-level agreement of at least 70% of buses departing at timing points along the route within the window of tolerance. We found that this level of service was being met or exceeded for the route which we studied but that the operator could achieve even higher levels of compliance with the service-level agreement by the simple expedient of updating the published timetable with arrival times which more closely match the observed arrival times of buses at stops. We conducted an optimisation study which identified the optimal values for an updated timetable, based on the data which is available to us. The change which we propose involves only a modification of the timetable, and no adjustment to the service as it operates in practice.
Acknowledgement
This work is supported by the EU project QUANTICOL: A Quantitative Approach to Management and Design of Collective and Adaptive Behaviours, 600708. The authors thank Luca Bortolussi for arranging Ludovica Luisa Vissat’s visit to the Laboratory for Foundations of Computer Science in Edinburgh where this work was done, and for his suggestion to use phase-type distributions to model the journey stages.

References
Federica Ciocchetta and Jane Hillston. Bio-PEPA: A framework for the modelling and analysis of biological systems. Theoretical Computer Science, 410(33–34):3065–3084, 2009.


Department for Transport. Bus Punctuality Partnerships: Guidance for local authorities and operators, July 2011. Revised edition.
N. Hounsell and F. McLeod. Automatic vehicle location: implementation, application and benefits in the united kingdom. Transportation Research Record, 1618:155–162, 1998.
M. Kwiatkowska, G. Norman, and D. Parker. PRISM 4.0: Verification of probabilistic real-time systems. In G. Gopalakrishnan and S. Qadeer, editors, Proc. 23rd International Conference on Computer Aided Verification (CAV’11), volume 6806 of LNCS, pages 585–591. Springer, 2011.
Peter Kemper and Carsten Tepper. Automated trace analysis of discrete-event system models. IEEE Trans. Software Eng., 35(2):195–208, 2009.
Daniël Reijsbergen, Stephen Gilmore, and Jane Hillston. Patch-based modelling of city-centre bus movement with phase-type distributions. 2014. To appear in the proceedings of PASM 2014.
Leonard Richardson. Beautiful Soup website, 2014. http://www.crummy.com/software/ BeautifulSoup/.
Philipp Reinecke, Tilman Krauß, and Katinka Wolter. Phase-type fitting using HyperStar. In Maria Simonetta Balsamo, William J. Knottenbelt, and Andrea Marin, editors, Computer Performance Engineering - 10th European Workshop, EPEW 2013, Venice, Italy, September 16-17, 2013. Proceedings, volume 8168 of Lecture Notes in Computer Science, pages 164–175. Springer, 2013.
Smarter Scotland: Scottish Government. Bus Punctuality Improvement Partnerships (BPIP), March 2009.
Vehicle and Operator Services Agency. Practice direction: standards for local bus services, November 2004. Document available from https://www.gov.uk/government/publications/ practice-direction-standards-for-local-bus-services.
