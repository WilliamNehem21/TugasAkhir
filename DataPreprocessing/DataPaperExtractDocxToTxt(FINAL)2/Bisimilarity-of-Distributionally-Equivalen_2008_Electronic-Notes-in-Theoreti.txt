Electronic Notes in Theoretical Computer Science 212 (2008) 41–53	
www.elsevier.com/locate/entcs

Bisimilarity of Distributionally Equivalent Markov Transition Systems
Ernst-Erich Doberkat1 ,2
Chair for Software Technology Dortmund University of Technology Dortmund, Germany

Abstract
Markov transition systems for interpreting a simple negation free Hennessy-Milner logic are called distribu- tionally equivalent iff for each formula the probability for its extension in one model is matched probabilis- tically in the other one. This extends in a natural way the notion of logical equivalence which is defined on the states of a transition system to its subprobability distributions. It is known that logical equivalence is equivalent to bisimilarity, i.e., the existence of a span of Borel maps that act as morphisms. We show that distributional equivalence is equivalent to bisimilarity as well, using a characterization of distributional equivalent transition systems through ergodic morphisms. As an aside, we relate bisimilar transition sys- tems to those systems, for which cospans — taken in the category of measurable maps resp. in the Kleisli category associated with the Giry monad — exist.
Keywords: Modal logic, concurrency theory, Markov transition systems, Giry monad, stochastic relations.


Introduction and Motivation
Let R be a non-deterministic or stochastic Kripke model for some modal logic, and assume that we observe R statistically, yielding μ([[φ]]R) as the probability that R is in a state that satisfies formula φ, provided the states’ distribution is given by probability μ. Here [φ]]R is as usual the extension of formula φ, i.e., the set of worlds in which φ holds; we leave issues of measurability aside for the moment. Define for formula φ, a probability μ and a rational number q with 0 ≤ q ≤ 1 the satisfaction relation |=q through R,μ |=q φ iff μ([[φ]]R) ≥ q, thus distribution μ satisfies formula φ at least with threshold probability q. We get as a special case for the Dirac measure δr on state r that R, δr |=q φ iff R,r |= φ, whenever q > 0. Now suppose that S is another Kripke model with this property: for each probability μ on R there

1 Research funded in part by Deutsche Forschungsgemeinschaft, grant DO 263/8-3, Algebraische Eigen- schaften stochastischer Relationen
2 Email: ernst-erich.doberkat@udo.edu

1571-0661 © 2008 Elsevier B.V. Open access under CC BY-NC-ND license.
doi:10.1016/j.entcs.2008.04.052

logical eq,uiv,alence

J 
bisimi,lar,ity
¸,   distibutional
equiva,le,nce
L-ergJod ic
¸, 
morphisms exist
	 w eak cospans exist


J 
strong cospans exist
Fig. 1. Relations between Markov transition systems



exists a probability ν on S such that R,μ |=q φ iff S,ν |=q φ holds for all rational q and all φ, and vice versa. Then R and S are considered to be distibutionally equivalent with respect to the distributions on the respective worlds. This appears to be a fairly natural way of comparing the behavior of two non-deterministic or stochastic systems that are so large or so inaccessible that it is difficult to observe states directly, but in which knowledge about the distributions of states can be made available. Embedded systems come to mind as examples for such such systems.
We will investigate this notion of equivalence and put it into perspective with logical equivalence and with bisimilarity for the case that the Kripke models are Markov transition systems, so that they are governed by stochastic laws themselves. For this kind of models logical and behavioral equivalence (i.e., the existence of a cospan) has been investigated quite extensively, and it is well known that logical equivalence, bisimilarity and behavioral equivalence are the same for Markov transi- tion systems. Consequently, e.g., bisimilarity is a suitable tool for the investigation of, say, behaviorally equivalent Kripke models. The question arises whether this is also true in a scenario which is governed by the consideration of distributions on the states rather than the states proper. It turns out, however, that the picture needs a finer brush for depicting the weak case. Among others, we will find some connections to the Kleisli morphisms that come with the Giry monad, which is the monad underlying the measure theoretic part of Probability Theory proposed by
M. Giry [11] and investigated in [1,12,3,7], among others.
The problem of relating different ways of describing the behavior of a probabilis- tic system is interesting for a number of reasons: first, it gives further insight into the inner workings of the Giry monad. Second, it will show that logical equivalence and distributional equivalence are unexpectedly closely related, so are both forms of behavioral equivalence. This permits a better understanding of the underlying logic and shows that the description of the system’s behavior through probability distributions is essentially no more powerful than a description that relates states directly to each other. Finally, the results will show that bisimilarity is a concept that, when discussed through distributions, does not yield results that are directly comparable to the results obtained for the familiar strong case. In fact, for reasons of space limitations we will focus on a discussion of bisimilarity and refer the reader for a full discussion to [8].

Organization.
Section 2 introduces the subprobability functor and the Giry monad with its Kleisli construction which is fundamental for the discussion. The logic, its inter- pretation through Kripke models and some important properties are discussed in Section 3. Bisimulations are defined in Section 4, and various forms of logical equiv- alence are related to bisimulations. This leads to the main result, see Figure 1. The concluding Section 5 wraps it all up and indicates where further work might be fruitful.

Acknowledgements.
The referees’ comments and Christoph Schubert’s suggestions have been appre- ciated.

The Giry Monad
We define the subprobability functor and recall some notions from topology, as far as we need them here. Based on this, we define Markov transition systems and their morphisms.

Polish and Analytic Spaces.
Given measurable spaces (X, A) and (Y, B) — thus A and B are σ-algebras on X resp. Y — a map f : X → Y is called A-B-measurable (or simply measurable, when the context is clear) whenever f −1 [B] ⊆ A, thus the inverse image f −1 [B] of every member B of B is a member of A.
A Polish space X is a second countable topological space for which a complete metric exists. The Borel sets B(X) are the smallest σ-algebra on X which contain the open sets of X. Measurability refers always to the Borel sets, unless otherwise specified.
An analytic space is a Hausdorff topological space that is the image of a Polish space under a continuous, or, what amounts to the same, under a Borel map [13]. Hence it makes sense to talk about the Borel sets of an analytic space. The σ-algebra of an analytic space will be the Borel sets, unless otherwise specified, and will usually be omitted from the notation. Analytic spaces are closed under many important operations like countable products, direct and inverse images under Borel maps, factoring under smooth relations (see below), etc. These spaces include discrete spaces as well as the reals R and in general Polish spaces. They have on one hand pleasant probabilistic properties, on the other hand they are versatile enough to incorporate nearly all interesting applications (in fact, it would be very difficult to find an application that operates on a space that is not analytic). Hence analytic spaces balance generality and applicability just in an adequate way.

The Giry monad.
S (X, A) denotes for a measurable space (X, A) the set of all subprobability measures on A; this set is endowed with the weak*-σ-algebra A•.  This is the

smallest σ-algebra that renders the evaluation map μ '→ μ(B) measurable for each set B ∈ A. If X is Polish, then S (X) is a Polish space under the weak topology as
well; this is the smallest topology making the maps μ '→• X f dμ continuous, where
f : X → R is bounded and continuous [13]. Then B(X) = B(S (X)) is folklore [7, Proposition 1.80].
S is a functor on the category of measurable spaces with measurable maps, where an A-B-measurable map f : X → Y is assigned the map S (f ): S (X, A) → S (Y, B) through S (f ) (μ)(E) := μ(f −1 [E]). It is not difficult to see that S (f ) is B(X)•- B(Y )•-measurable. If the Borel map f : X → Y is onto, so is S (f ) : S (X) → S (Y ), provided X is Polish and Y is separable metric [7, Proposition 1.30]. If
X is an analytic space, so is S (X) with B(S (X)) = B(X)•. S is the functorial part of the Giry monad [11]; since unit and multiplication are not of interest here, we do not define them here and refer for a discussion of this monad’s properties to [7]. We call K : (X, A) ~ (Y, B) a stochastic relation between the measurable spaces (X, A) and (Y, B) iff K : X → S (Y, B) is a measurable map; in Probability Theory, a stochastic relation would be called a sub-Markov kernel or a transition sub-probability. Stochastic relations are just the Kleisli morphisms of the Giry monad [7, Proposition 2.9]:
Proposition 2.1 Let (X, A) and (Y, B) be measurable spaces. Then the following statements are equivalent:
K : X → S (Y, B) is A-B•-measurable.
K : X → (B → [0, 1]) is a map such that
K(x) is a subprobability on B for all x ∈ X.
x '→ K(x)(E) is an A-measurable map for each E ∈ B.
K is a morphism in the Kleisli category associated with the Giry monad. 
This characterization will be used silently throughout. Composition L∗K of morphisms K : (X, A) ~ (Y, B) and L : (Y, B) ~ (Z, C) in the Kleisli category associated with the Giry monad is what probabilists call the convolution of sub- Markov kernels, viz.,
 L∗K (x)(E)= ∫Y L(y)(E) K(x)(dy)
We will need the following statement on uniqueness; it hides a proof principle that is applied quite often in this area. The principle is akin to mathematical induction: one shows first that a property holds for a ∩-closed generator A0 of a σ-algebra, and in a second step one establishes that the sets for which a property holds is closed under complements and countable disjoint unions. Then one can conclude that all elements of σ(A0) enjoy this property. Formally it is based on the well-known π-λ-Theorem of Measure Theory, for a discussion see [7, Theorem 1.1]. From the modal logic point of view, this observation makes us prefer conjunction over disjunction. We will return to this point below.

Lemma 2.2 Let (X, A) be a measurable space, A0 ⊆A with A = σ(A0) such that A0 is closed under intersections. Let D ⊆ A with A0 ⊆ D such that D is closed under complements and countable disjoint unions. Then A = D. In particular, if μ1, μ2 ∈ S (X, A) are subprobabilities such that μ1(A)= μ2(A) for all A ∈ A0, then μ1 = μ2. 


Markov transition systems.
Let G be an analytic space, a Markov transition system G = (G, (ga)a∈Act) has for each action a ∈ Act a stochastic relation ga : G ~ G modeling the transitions upon action a. So if G is in state x ∈ G, the probability that the next state is a member of Borel set A ∈ B(G) after action a ∈ Act is given by ga(x)(A); there are countable many actions. Note that we do not postulate that ga(x)(G)= 1 for each state x, so that after some action the system may be in no state at all, e.g., if a computation does not terminate.


Congruences.
An equivalence relation Q on a measurable space (X, A) is said to be smooth (or countably generated) iff there exists a sequence (Qn)n∈N of sets in A such that xQ x' iff x ∈ Qn ⇔ x' ∈ Qn holds for all n ∈ N. The sequence (Qn)n∈N is said to determine Q. We will construct an equivalence relation from the sets on which the formulas of the logic are valid. These sets then form a determining sequence, so that in this case two states are equivalent iff they cannot be separated by the logic. Let X be analytic, then the factor space X/Q is analytic, whenever Q is smooth, provided the factor carries the largest σ-algebra that makes the factor map ηę :
x '→ [x]ę B(X)-measurable [13, Exercise 5.1.14].	Call a set B ⊆ X Q-invariant iff
B =  {[x]ę | x ∈ B}, so that x ∈ B and xQ x implies x ∈ B. The Q-invariant
'	'
A-measurable sets
Σ (A, Q) := {C ∈A| C is Q-invariant}

form a σ-algebra for a measurable space (X, A). This σ-algebra has many interesting properties, see [7, Chapter 5.2] for a discussion.
A pair (α, β) of smooth equivalence relations α on X and β on Y (with both X and Y analytic) is called a congruence for the stochastic relation K : X ~ Y iff K(x)(B)= K(x')(B) whenever xα x' and B ⊆ Y is a β-invariant Borel set. Thus if α cannot distinguish x from x', and if β cannot discern the elements of B, then K(x) and K(x') both assign the same probability to B. Given a congruence (α, β)
for K : X ~ Y , one constructs the factor relation K(α,β) : X/α ~ Y /β upon setting

K(α,β) [x]α
 (G) := K(x) η−1 [G] = S (ηβ) ◦ K (x)(G)for x ∈ X, G ∈ B(Y /β). As

a rule, these factor spaces are usually analytic spaces, even if the base spaces are
Polish, see [10, Example 2.7] for a discussion. Note that if the spaces X and Y
coincide, and α = β, we will write down a congruence only as α rather than (α, α).

Hennessy-Milner  Logic
Hennessy-Milner logic is introduced here as a simple negation free logic that contains just the bare minimum for a modal logic to be interesting. The equivalence relation that models the separation of states through the logic is introduced and investigated, in particular we have a look at the corresponding invariant sets. We then go on and lift this relation to the set of all subprobabilities on the state space of a transition system, showing that it entails some interesting and useful structural properties of the spaces involved.
The syntax of the Hennessy-Milner logic L is given by
φ ::= T | φ1 ∧ φ2 | ⟨a⟩qφ

Here a ∈ Act is an action, and q is a rational number. Hence L is closed under conjunction and under the modal operator ⟨a⟩q for an action a, the index q indicating the degree of satisfaction after action a, as we will see. Conjunction serves not only as a representative of the Boolean operations that are usually included in a logic (here disjunction would do as well), it is also — with a view towards Lemma 2.2 — decisive for the development from a technical vantage point, and here disjunction would not do; this was first observed in [3]. Disjunction may be added, however, through a natural transformation; this technique is discussed at length in [9,10].
The set Act of labels is assumed to be at most countably infinite. The semantics of ⟨a⟩qφ says intuitively that we can make an a-move in a state x to a state that satisfies φ with probability at least q. F denotes the countable set of all formulas for this logic.
Let G = (G, (ga)a∈Act) be a Markov transition system. The logic L will be interpreted in G. Satisfaction of a state x for a formula φ is defined inductively, [[φ]]G is defined as usual as the set of all states x that satisfy formula φ, i.e. for which G,x |= φ holds. This is straightforward for T and for formulas of the form φ1 ∧ φ2 upon defining [T]]G := G resp. [φ1 ∧ φ2]]G := [φ1]]G ∩ [[φ2]]G . The more interesting case is making an a-move: G,x |= ⟨a⟩qφ holds iff ga(x)([[φ]]G ) ≥ q.
Note that the set {[[φ]]G | φ ∈ F} is closed under finite intersections. An easy induction on the structure of φ shows that the sets [φ]]G are well behaved:
Lemma 3.1 [[φ]]G is a Borel subset of G for each formula φ. 
Define the states x1, x2 to be equivalent iff they cannot be separated through a formula, thus
x1 rG x2 iff ∀φ ∈ F : [G, x1 |= φ ⇔ G, x2 |= φ]
The theory ThG (x) ofa state x is the set of all formulas that are valid in this state, thus two states cannot be separated by the logic iff their theories coincide, hence iff they are related through relation rG .
Because F is countable, the equivalence relation rG is smooth, and the factor space G/rG is analytic again. The relation rG is a congruence for each ga : G ~ G,

accordingly, the factor model G/L := (G/rG , (ga,L)a∈Act) is defined through
ga,L([x]rG ) := S ηrG ◦ ga (x).
Consequently, the probability ga,L([x]rG )(A) of making an a-move from class [x]rG to a Borel set A ∈ B(G/rG ) in the factor system G/L equals the probability ga(x)(η−1 [A]) of making an a-move in the original system from state x into the invariant Borel set η−1 [A].
The transition law ga is a stochastic relation when restricted to the rG -invariant sets. Thus the inverse image of x '→ ga(x)(A) is a member of Σ G, rG , whenever A ⊆ G is a rG -invariant Borel set. This holds in particular whenever A = [[φ]]G for some formula φ ∈ F. Denote this restriction by |ga|.
Lemma 3.2 |ga| : (G, Σ G, rG ) ~ (G, Σ G, rG ) is a stochastic relation. 
The equivalence relation
μ1 rG μ2 iff ∀A ∈ Σ G, rG : μ1(A)= μ2(A)
is defined on S (G). It is the lifting of relation rG to S (G) [6, Section 3]. Given states x1, x2 ∈ G, the relation x1 rG x2 is equivalent to δx1 rG δx2 for the corresponding Dirac measures.
Define for rational q, a formula φ ∈ F and a subprobability μ ∈ S (G) the threshold satisfiability relation |=q through G,μ |=q φ iff μ([[φ]]G ) ≥ q, so that φ is satisfied with at least probability q. Note that G, ga(x) |=q φ iff G,x |= ⟨a⟩qφ, hence
|=q may be used for modeling moves in G. In fact, there are deeper connections which are exhibited through the Choquet representation for an integral, see [8].
We will introduce different kinds of morphisms now. Recall that K∗L denotes the Kleisli composition for stochastic relations K and L.
Definition 3.3 Let G = (G, (ga)a∈Act) and H = (H, (ha)a∈Act) be Markov transi- tion systems.
A surjective map s : G → H is called a strong morphism (denoted through
s : G → H) iff S (s) ◦ ga = ha ◦ s holds for each a ∈ Act.
A stochastic relation Φ : G ~ H is called a weak morphism (G a H) iff Φ∗ga = ha∗Φ for each a ∈ Act holds.
For a strong morphism s : G → H the probability ha(s(x))(G) for H to hit a state in Borel set B from state s(x) equals the probability S (s) ◦ ga(x) (G) = ga(x)(s−1 [G]) for G to hit a state in its inverse image s−1 [G] under s from state x.
In contrast, a weak morphism Φ : G a H has the property that
(Φ∗ga) (x)(B)= ∫G Φ(t)(B) ga(x)(dt)= ∫H ha(y)(B) Φ(x)(dy)= (ha∗Φ) (x)(B)
holds for each action a, each state x ∈ G, and each Borel set B ⊆ H. A strong morphism γ : G → H hatches the weak morphism δγ(·) : G a H [6, Lemma 4.4].

Weak morphisms with a particular affinity to the logic will be called L-ergodic (Arveson [2, p. 78] proposes the name ergodic for measures that take the values 0 or 1 on the invariant Borel sets for some equivalence relation; we extend this a bit to stochastic relations).
Definition 3.4 A stochastic relation Ψ : (G, Σ G, rG ) ~ (H, Σ H, rH ) is called
L-ergodic (G aL H) iff
Ψ∗|ga| = |ha|∗Ψ for each a ∈ Act
for all φ ∈ F the map x '→ Ψ(x)([[φ]]H) takes only the values 0 and 1 with Ψ(x)([[φ]]H)=1 iff G,x |= φ.
If Ψ : G aL H is L-ergodic, we know that (Ψ∗|ga|) (x)(B) = (|ha|∗Ψ) (x)(B) holds for each action a, each state x ∈ G, and each rH-invariant Borel set B. Thus the compositional equation holds only on those Borel sets that are related to the logic. Hence L-ergodic morphisms are versions of weak morphisms that are in a specific way adapted to the logic, see [6, Section 5] for a discussion. In particular, we know for an L-ergodic morphism Φ that Φ(x)([[φ]]H)= Φ(x')([[φ]]H) for each formula φ ∈ F, whenever x rG x'. Consequently, states that cannot be separated through the logic will end up in states that satisfy the same formulas with identical probabilities. An ergodic L-morphism is further characterized through Φ(x)([[φ]]H)= 1[[φ]]G (x), 1A denoting the indicator function of the set A. Putting it less formally, we know that, whenever G,x |= φ, the state’s counterpart y in model H will satisfy H,y |= φ almost surely. Hence validity in model G is very closely tied to validity in model H, albeit on the level of distributions. Note that we do not need to impose any assumptions on the value of Φ(x)(B) whenever B is a rH-invariant Borel subset of H other than the extension for some formula. This is so since standard arguments including the π − λ-Theorem Lemma 2.2 show that Φ(x)(B) ∈ {0, 1} whenever B ∈ Σ H, rH . Because (rG , rH) is a congruence for an ergodic relation Ψ : G aL H, we may define
the factor relation ΨL : G/L ~ H/L through ΨL([x]rG ) := S (ηrH ) ◦ Ψ (x). This constitutes a weak morphism [6, Proposition 5.9]. Turning to logical equivalence, we define
Definition 3.5 Let G and H be Markov transition systems.
G and H are logical equivalent iff {ThG (x) | x ∈ G} = {ThH(y) | y ∈ H}.
G and H are distributionally equivalent iff for each μ ∈ S (G) there exists ν ∈ S (H) such that G,μ |=q φ ⇔ H,ν |=q φ for all q and all formulas φ ∈ F, and vice versa.
Thus G and H are distributionally equivalent iff each distribution on one model is matched by a distribution on the other model:
Lemma 3.6 The Markov transition systems G and H are distributionally equivalent iff these conditions hold
for all μ ∈ S (G) there exists ν ∈ S (H) with ∀φ ∈ F : μ([[φ]]G )= ν([[φ]]H),
for all ν ∈ S (H) there exists μ ∈ S (G) with ∀φ ∈ F : ν([[φ]]H)= μ([[φ]]G ). 

The definition for logical equivalence reads that given a state in one model there exists a state in the other model such that the respective theories coincide, so that given x ∈ G there exists y ∈ H with G,x |= φ ⇔ H,y |= φ for each formula φ, and vice versa. Since G,x |= φ is equivalent to x ∈ [[φ]]G which in turn is equivalent to δx([[φ]]G ) = 1 with δx as the Dirac measure on x, we can state that G and H are logical equivalent iff for each x ∈ G there exists y ∈ H such that ∀φ ∈ F : δx([[φ]]G )= δy([[φ]]H) and vice versa. Thus distributional equivalence generalizes logical equivalence, and it can be shown that logically equivalent models are distributionally equivalent [8]. This is a characterization in terms of morphisms.
Proposition 3.7 Let G and H be Markov transition systems. Then the following statements are equivalent
G and H are distributionally equivalent.
There exist L-ergodic morphisms Λ: G aL H and Ξ: H aL G. 


Bisimulations
Fix the Markov transition systems G = (G, (ga)a∈Act) and H = (H, (ha)a∈Act). G and H are called strongly bisimilar whenever we can find a Markov transition systems M as well as strong morphisms s : M→ G and t : M → H. This means that the following diagram commutes for each action a ∈ Act.

G ¸,	s	 M 	t	 H 

ga	ma	ha
J	J	J 
S (G) ¸,S(s)	S (M )	S(t)	 S (H)

M is sometimes thought of as mediating between G and H. From now on we will omit the attribute strong from morphisms.
Each ergodic morphism induces a measurable map between the factor spaces.
Lemma 4.1 Let Ψ : G aL H be L-ergodic. Then there exists a measurable map
ψ : G/rG → H/rH such that ΨL(t)= δψ(t) for all t ∈ G/rG .
Proof. 0. If a subprobability μ ∈ S (A) for an analytic space A takes only the values 0 and 1, and if μ(A) = 1, then there exists a unique point a ∈ A such that μ = δa. This is so because an analytic space is countably generated, so that [2, Lemma after Theorem 3.4.3] can be applied.
For each x ∈ G the measure Ψ([x]rG ) ∈ S (H/rH) is binary valued. Thus there exists by part 0. for each x ∈ G some y ∈ H such that ΨL([x]r ) = δ[y] . Since
H
[y]rH is uniquely determined, the map ψ([x]rG ) := [y]rH is well defined.
The map ψ is Borel measurable. One observes first that for each φ ∈ F the

identity [φ]]G = η−1 ψ−1 [ηr [[[φ]]H]] . In fact,
x ∈ [[φ]]G ⇔ Ψ(x)([[φ]]H)=1 
(q)
⇔ ΨL([x]rG )(ηrH [[[φ]]H]) = 1
⇔ ψ([x]rG ) ∈ ηrH [[[φ]]H]
⇔ x ∈ η−1 ψ−1 [ηr [[[φ]]H]] .
The equivalence (q) uses that by definition Ψ(x)(D) equals ΨL([x]rG )(ηrH [D]), when-
ever D ∈ Σ H, rH , and that for rH-invariant D the equality D = η−1 [ηr [D]]
holds.  Consequently, T  := {T  ∈ B(H/rH) | ψ−1 [T ] ∈ B(G/rG )} includes
{ηrH [[[φ]]H] | ϕ ∈ F}. The latter set is closed under intersections due to the logic being closed under conjunctions, and the former is closed under complements and disjoint countable unions. Thus it follows from the π-λ-Theorem (Lemma 2.2) that ψ−1 [T ] ∈ B(G/rG ) for all T ∈ B(H/rH), so that T = B(H/rH).	 
The map ψ constructed in this way is nearly a morphism:
Corollary 4.2 This diagram commutes, ψ being constructed according to Lemma 4.1:
G/rG	ψ	 H /rH

ga,L	ha,L
J 	  J 

S (G/rG )	S(ψ)
S (H/rH)

Consequently, ψ preserves and reflects validity: the equivalence
G/L,t |= ϕ ⇔ H/L, ψ(t) |= ϕ
is true for every t ∈ G/rG and every formula ϕ ∈ F.
Proof. Because ΨL : G/L a H/L is a weak morphism, we have for all x ∈ G, D ∈ B(H/rH)
(ha,L ◦ ψ)([x]rG )(D)= (ha,L∗ΨL)([x]rG )(D)
= (ΨL∗ga,L)([x]rG )(D)

=
G/rG
δψ(z)(D) ga,L([x]rG )(dt)

= ga,L([x]r )(ψ−1 [D])
= (S (ψ) ◦ ga,L)([x]r )(D). 


If we would be able to convince ourselves that ψ is onto, then we would have constructed a morphism. Hence it remains to search for criteria under which ψ is surjective. The observation that the equivalence classes [x] are exactly the atoms of the σ-algebra Σ G, rG is helpful for the proof.

Lemma 4.3 Deﬁne for y ∈ H, φ ∈ F the set
I(φ, y) := ⎧⎨ [[φ]]H,	H,y |= φ;
⎩ H \ [[φ]]H, otherwise,
and put J(φ, y) := {x ∈ G | Ψ(x)(I(φ, y)) = 1}. Then [y]	=	I(φ, y), and if
 φ∈F J(φ, y) /= ∅ for all y ∈ H, then ψ is onto. 
This is now applied to distributionally equivalent transition systems.
Proposition 4.4 Assume that G and H are distributionally equivalent, then
there exist strong morphisms G/L → H/L and H/L → G/L,
ga(x)([[φ]]G )= ha(y)([[φ]]H), holds for all φ ∈ F, provided x ∈ G and y ∈ H satisfy exactly the same formulas.
Proof. 1.  Construct the ergodic L-morphisms Ψ : G aL H and Ξ : H aL G
according to Proposition 3.7, and let ψ : G/rG → H/rH as well as ξ : H/rH → G/rG
be the corresponding point maps. Both ψ and ξ preserve validity by Corollary 4.2,
so we infer from Lemma 4.3 that J(φ, y) = η−1 ξ−1 [ηr  [I(φ, y]] .Since I(φ, y) is
rG -invariant, and because ηrH interchanges with countable intersections on invariant sets, we conclude that  φ∈F J(φ, y) /= ∅, provided  φ∈F I(φ, y) is not empty. Thus ψ is onto, interchanging the roˆles of G and H, the argument shows that ξ is surjective as well. Thus ψ and ξ are strong morphisms, since the crucial diagram commutes by Corollary 4.2.
2. Let φ ∈ F be an arbitrary formula, and assume that x ∈ G, y ∈ ψ([x]r ). We show that ga(x)([[φ]]G )= ha(y)([[φ]]H) holds:
ga(x)([[φ]]G )=	Ψ(x')([[φ]]H) ga(x)(dx')
G
= (Ψ∗ga)(x)([[φ]]H)
= (ha∗Ψ)(x)([[φ]]H)
= ha,L(ψ([x]rG ))(ηrH [[[φ]]H])
= ha(y)([[φ]]H),
whenever [y]rH = ψ([x]rG ), i.e., whenever y ∈ ψ([x]r ) according to the definition of
the factor relation. This proves part b.	 
Proposition 4.5 Assume that G and H are distributionally equivalent, then they are bisimilar.
Proof. Denote by TG := {[[φ]]G | ϕ ∈ F} the countable generator for the σ-algebra Σ G, rG , similarly for TH. Both generators are closed under finite intersection, since the logic is closed under finite conjunctions. Through Proposition 4.4, part b. and the representations
[[φ]]H =  {ψ([x]rG ) | x ∈ [[φ]]G }, [[φ]]G =  {ξ([y]rH ) | y ∈ [[φ]]H},

we infer bisimilarity from the general criterion [7, Proposition 5.39].	 

Summing up, this has as a consequence the following general result.
Theorem 4.6 These statements are equivalent for the Markov transition systems
G and H.
G and H are logically equivalent.
G and H are distributionally equivalent.
G and H are bisimilar.
There exist L-ergodic morphisms Ψ: G aL H and Ξ: H aL G.
Proof. i ⇔ iii is established in [5, Theorem 6.6], [8] establishes the implication i ⇔ ii, Proposition 4.5 shows ii ⇔ iii, and the equivalence ii ⇔ iv is proven in Proposition 3.7.	 

It is known that logical equivalence and the existence of a cospan of strong morphisms is equivalent for Markov transition systems [7, Theorem 6.19], and it can be shown that distributional equivalence implies the existence of a cospan of weak morphisms [8]. Figure 1 summarizes the overall situation.

Conclusion and Further Work
This paper defines distributional equivalence with respect to a simple modal logic for Markov transition systems. It argues that this is a weak form of logical equiv- alence, and it relates these characterizations for the behavior of transition systems to bisimilarity. The main tool is a general criterion on bisimilarity for stochastic relations. This is made applicable through an investigation of ergodic morphisms between the transition systems. One of the referees suggested to use the final coal- gebra and lift the morphism that maps each coalgebra to the final one; this might give the result. Alas — this is a difficult thing to do because in the category under consideration a coalgebra exists only for the probability functor [4]. Thus a direct argumentation has been used.
The discussion may be extended into two directions: First, an interplay of distri- butional equivalence and Kleisli morphisms for the Giry monad could be observed. The somewhat natural hypothesis that weak bisimilarity, distributional equivalence and the existence of a weak cospan are equivalent — carried over from the case of strong morphisms — does not seem to hold in this generality, as Figure 1 suggests. Hence it invites a careful investigation of bisimilarity in the weak case; a look at the results in [6] shows that entering the discussion of Kleisli morphisms adds consid- erable color. Second, the treatment of coalgebraic stochastic logic [9,10] should be extended to Kleisli morphisms for the Giry monad. Here some non-trivial technical obstacles need to be overcome.

References
S. Abramsky, R. Blute, and P. Panangaden. Nuclear and trace ideal in tensored *-categories. J. Pure Appl. Alg., 143(1 – 3):3 – 47, 1999.
W. Arveson. An Invitation to C*-Algebra. Graduate Texts in Mathematics. Springer-Verlag, New York, 1976.
J. Desharnais, A. Edalat, and P. Panangaden. Bisimulation of labelled Markov-processes. Information and Computation, 179(2):163 – 193, 2002.
E.-E. Doberkat. Look: simple stochastic relations are just, well, simple. In J. Fiadeiro and J. Rutten, editors, Proc. CALCO, volume 3629 of Lect. Notes Comp. Sci., pages 128 – 142, 2005.
E.-E. Doberkat. Stochastic relations: congruences, bisimulations and the Hennessy-Milner theorem.
SIAM J. Computing, 35(3):590 – 626, 2006.
E.-E. Doberkat. Kleisli morphisms and randomized congruences for the Giry monad. J. Pure Appl. Alg., 211:638–664, 2007.
E.-E. Doberkat. Stochastic Relations. Foundations for Markov Transition Systems. Chapman & Hall/CRC Press, Boca Raton, New York, 2007.
E.-E. Doberkat. Weak logical equivalence for Markov transition systems. Technical Report 167, Chair for Software-Technology, University of Dortmund, December 2007.
E.-E. Doberkat. Stochastic coalgebraic logic: Bisimilarity and behavioral equivalence. Ann. Pure Appl. Logic, in print, 2008.
E.-E. Doberkat and C. Schubert. Coalgebraic logic for stochastic right coalgebras. Technical report, Chair for Software-Technology, University of Dortmund, September 2007.
M. Giry. A categorical approach to probability theory. In Categorical Aspects of Topology and Analysis, number 915 in J. Pure Appl. Alg., pages 68 – 85, Berlin, 1981. Springer-Verlag.
P. Panangaden. The category of Markov kernels. ENTCS, 22, 1999.
S. M. Srivastava. A Course on Borel Sets. Graduate Texts in Mathematics. Springer-Verlag, Berlin, 1998.
