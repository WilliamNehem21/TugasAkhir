

Electronic Notes in Theoretical Computer Science 221 (2008) 171–179
www.elsevier.com/locate/entcs

Constructive Urysohn’s Universal Metric Space
Davorin Leˇsnik1
Institute for Mathematics, Physics and Mechanics Ljubljana, Slovenia

Abstract
A construction of the Urysohn’s universal metric space is given in the context of constructive theory of metric spaces. The space is universal in the sense that every separable metric space isometrically embeds into it. Moreover, every isometry between two finite subspaces extends to total isometry, and this determines the Urysohn space uniquely up to isometric isomorphism.
Keywords: constructive mathematics, metric space, Urysohn’s universal space.


Introduction
The classical result of Urysohn states that up to isometric isomorphism, there ex- ists a unique complete separable metric space U which contains an isometric copy of every separable metric space and which possesses the following extension prop- erty: given any separable metric space M and its finite subspace A, any isometric embedding A → U extends to an isometric embedding M → U. Such U is called Urysohn space.
Urysohn’s 1927 proof [8] was of course non-constructive, as were other authors’ subsequent ones [5,3]. Here we present a construction of Urysohn space in the context of constructive theory of metric space, as developed for example in [2]. As is customary in this setting, we assume the Axiom of Countable Choice; it is required for the definition of a completion of a metric space to work, and we also need it in the proof of Proposition 3.1.
We remark that constructive results such as the one in this paper yield corre- sponding theorems about computability when interpreted in suitable realizability topoi, as was demonstrated by, e.g., [1] and [6].

1 Email: Davorin.Lesnik@fmf.uni-lj.si

1571-0661 © 2008 Elsevier B.V. Open access under CC BY-NC-ND license.
doi:10.1016/j.entcs.2008.12.015

Urysohn’s original idea was to construct a countable metric space of which U is the completion. We adopt the same approach here.



A short glossary of constructive and metric terms used in this paper
A set is called inhabited when there exists an element of it. Classically, but not constructively, this is equivalent that the set is non-empty.
A set X is countable when there exists a surjection (an enumeration) e: N → X + 1. 2 The definition includes 1 to account for possibly non-inhabited sets, though when X is inhabited, it is countable if and only if there exists a surjection N → X.
A relation on a set is decidable when for any two elements of the set we can decide whether they are in relation or not. It is known that equality = and inequalities
<, ≤ on number sets N, Z, Q are decidable.
A subset S of a metric space M is dense in M when the intersection of S with any ball in M is inhabited.
A metric space is separable when it contains a dense countable subset.
A sequence s: N → M , where (M, d) is a metric space, is a Cauchy sequence when we are given its modulo of convergence which in this paper is taken to be some rational geometric sequence; meaning, we require rational numbers a > 0, 0 < q < 1, such that for all N, m, n ∈ N, where m, n ≥ N , the estimate d(sm, sn) ≤ a · qN holds.
A metric space is complete when its every Cauchy sequence has a limit.
A completion of a metric space (M, d) is a complete metric space (M^, d^) together
with an isometric embedding M → M^ with a dense image. A completion is
unique up to isometric isomorphism. A space M is complete if and only if it (together with its identity map) is the completion of itself.
Assuming Axiom of Countable Choice, we may construct the completion as a set of Cauchy sequences in M where we identify any two sequences (sn)n∈N, (s' )n∈N such that the distance between terms of s, s' is bound by some modulo of convergence, ie. for all N, m, n ∈ N, such that m, n ≥ N , we have d(sm, s' ) ≤ a· qN . The metric between two equivalence classes of Cauchy sequences is defined
as d^([s], [s']) = limN→∞ d(sN , s' ). The embedding M → M^ takes m ∈ M to the
equivalence class of the constant sequence with terms m.
The set of real numbers R is the completion of Q, if both sets are equipped with the standard Euclidean metric.




2 Here, N denotes the set of natural numbers, 1 = {∗} a singleton set, and + a binary coproduct (disjoint union).

Construction of UQ
We denote by UQ the “rational version” of the Urysohn space, namely a count- able rational metric space 3 which contains (isometric copies of) all countable met- ric spaces, and satisfies a certain form of the extension property, presented in Lemma 2.6 and Theorem 2.7.
In [4], Jan Hubiˇcka and Jaroslav Neˇsetˇril give a finite presentation of UQ. While their interest is classical, their proofs are essentially constructive. Our construction of UQ in this section closely follows their article, making some modifications to the definitions and proofs to ensure they work constructively.
Definition 2.1 A triplet A is a triple (A, ≤A, dA) where
A is a finite 4 set;
≤A is a decidable partial order on A;
dA: A × A → Q is a rational metric on A.
Remark 2.2 Since the set of rational numbers Q has decidable equality and the metric is by definition non-degenerate (ie. d(x, y) = 0 ⇐⇒ x = y), this implies that A itself has decidable equality. Consequently, the following two notions of finiteness agree: there exists a natural number n ∈ N and a surjection {1, 2,..., n}→ A; and the same but requiring a bijection instead of a surjection (note that the empty set
∅ is considered finite since we may take n = 0). This is furthermore equivalent to Kuratowski finiteness. When we call a set ﬁnite, we mean it satisfies any of these notions (all sets in question will have decidable equality).
Given a triplet A  =  (A, ≤A, dA) and an element a  ∈  A,  let ↓a  =
{b ∈ A | b ≤A a} denote the down set of a. Since ≤A is decidable, ↓a is finite; in fact, it is itself a triplet if we endow it with the restriction of the partial order and the metric.
Also because ≤A is decidable, we can define the height of A to be the maximal size of a chain in (A, ≤A). We denote it by h(A) ∈ N.
For a, b ∈ A, define the strict order a ≺A b by (a ≤A b) ∧ (a /= b); this is again a decidable relation.
We call A = (A, ≤A, dA) a subtriplet of B = (B, ≤B, dB) (denoted A ⊆ B) when A ⊆ B and ≤A, dA are restrictions of ≤B, dB.
We consider triplets A = (A, ≤A, dA) and B = (B, ≤B, dB) isomorphic (denoted
A ∼= B) when there exists an order-preserving isometric bijection A → B. We
want to endow triplets with additional structure which in particular ensures that isomorphic triplets are equal.
Definition 2.3 A triplet A = (A, ≤A, dA) is complete when
(A, ≤A) has both the greatest and the smallest element, denoted by maxA and minA respectively;

3 By a rational metric space we mean a metric space in which all distances are rational.
4 See Remark below.

↓a ∼= ↓a' implies a = a' for any a, a' ∈ A;
for every a, a' ∈ A there exists a'' ∈ A such that a'' ≤A a, a'' ≤A a' and
dA(a, a') = dA(a, a'')+ dA(a'', a');
for every a ∈ A, a = {(b, dA(a, b)) | b ≺A a}.
A few observations about a complete triplet A = (A, ≤A, dA):
minA = ∅; in particular, a complete triplet is inhabited;
maxA carries within it the information about the whole triplet;
for any a ∈ A, the set ↓a is itself a complete triplet with max↓a = a.
Lemma 2.4 Let A = (A, ≤A, dA) and B = (B, ≤B, dB) be complete triplets.
If A ∼= B, then A = B.
For any a ∈ A, b ∈ B, the statement a = b is decidable.
The intersection A ∩ B is an inhabited ﬁnite set.
The statements A ⊆ B and A = B are decidable.
Proof. Use induction on height for (i) and (ii). The rest follows.	 
Proposition 2.5 (construction of UQ) Complete triplets form a set; we denote it by U. There is a bijection N → U. The map dU : U × U → Q, deﬁned by


dU (A, B) =  min
x∈A∩B
{dA(maxA, x)+ dB(maxB, x)},

is a rational metric on U.
Proof. Notice that the minimum in the definition of dU (A, B) is achieved at maxA iff maxA ∈ B iff A ⊆ B, and in this case dU (A, B) = dB(maxA, maxB).
We verify only the triangular inequality; let A, B, C be complete triplets. We proceed by induction on h(A)+h(B)+h(C). Assume we already know the triangular inequality holds for complete triplets with lesser total height.
We wish to verify dU (A, B) + dU (B, C) ≥ dU (A, C). If the minimum in the definition of dU (A, B) is achieved at maxA or maxB and the minimum for dU (B, C) at maxB or maxC, then the calculation in each case yields the desired triangular inequality. Otherwise, the minimum for (without loss of generality) dU (A, B) is achieved at x ∈ A ∩ B, maxA /= x /= maxB. We have
dU (A, B) = dA(maxA, x)+ dB(maxB, x) = dU (A, ↓x)+ dU (B, ↓x).

The total height of A, ↓x, C and ↓x, B, C is strictly smaller than the total height of A, B, C, so by the induction hypothesis the following two triangular inequalities hold.
dU (A, ↓x)+ dU (↓x, C) ≥ dU (A, C)
dU (↓x, B)+ dU (B, C) ≥ dU (↓x, C)

We then have
dU (A, B)+ dU (B, C) = dU (A, ↓x)+ dU (B, ↓x)+ dU (B, C) ≥
≥ dU (A, ↓x)+ dU (↓x, C) ≥ dU (A, C),
as desired.	 
Lemma 2.6 Given X a ﬁnite subset of U and a map D: X → Q satisfying the necessary inequalities 5 to represent a distance from some new point to the points in X, we can construct a speciﬁc complete triplet M(X, D) ∈ U, such that dU (M(X, D), A) = D(A) for all A ∈ U.
Proof. Define M(X, D) = (M, ≤M(X ,D), dM(X,D)) by the following algorithm.
Let X =   {A | A = (A, ≤A, dA) ∈ X}.
For any a ∈ X, define d'(a) = minC∈X {D(C)+ dU (C, ↓a)}.
Let m = {(a, d'(a)) | a ∈ X} and M = X ∪ {m}. 6
The elements a, b ∈ M are in relation a ≤M(X ,D) b if and only if b = m or there exists A = (A, ≤A, dA) ∈X such that a, b ∈ A and a ≤A b.
For a, b ∈ X we set:
dM(X,D)(a, b) = dU (↓a, ↓b),
dM(X,D)(m, b) = d'(b),
dM(X,D)(a, m) = d'(a),
dM(X,D)(m, m) = 0.
A tedious verification shows M(X, D) is indeed a complete triplet satisfying the desired condition.	 
Define UQ to be the metric space (U, dU ), and U the completion of UQ. By inductive application of Lemma 2.6 we obtain the desired theorem.
Theorem 2.7 UQ is a countable rational metric space which contains an isometric copy of any countable rational metric space, and more generally satisﬁes the fol- lowing extension property: if M is a countable rational metric space, F its ﬁnite subspace and e: F → UQ an isometric embedding, then there exists an isometric embedding M → UQ which extends e.
Recall the following Proposition from theory of metric spaces.
Proposition 2.8 Any uniformly continuous map f : M → M' between metric spaces M, M' uniquely extends to a uniformly continuous map f : M → M ' where M^, M^' are completions of M, M'. If f is an isometry, then so is f^.
Corollary 2.9 U is a complete separable metric space which contains an isometric copy of any metric space possessing a countable dense subset with rational distances. More generally, given F ⊆ S ⊆ M where M is a separable metric space, S a

5 Meaning D(A) > 0 and |D(A) − D(B)| ≤ dU (A, B) ≤ D(A)+ D(B) for all A, B ∈ X .
6 Note that m differs from all elements of X, ie. M is in fact a disjoint union of X and {m}.

countable dense subset with rational distances and F a ﬁnite subset of S, then any isometric embedding e: F → U with image e(F ) ⊆ UQ extends to an isometric embedding M → U.
Universality of U
We finished the previous section with only a limited embedding/extension property for U. For practical purposes this often suffices, as most metric spaces of interest (those arising in analysis, say) possess a dense countable subset at rational, or at least algebraic, distances (the construction in the previous section works more generally for countable dense additive subgroups of R with decidable (in)equality). Nevertheless, we wish to improve this result by showing that any separable metric space isometrically embeds into one with a dense countable rational subspace. For this we use countable choice.
Proposition 3.1 Let (M, dM ) be an inhabited separable metric space. There exists a metric space (X, dX ) and an isometric embedding e: M → X, such that X contains a dense subset in bijection with N, and dX restricted to it is a rational metric.
Proof. That M is an inhabited separable space means there exists a map s: N → M
with the dense image in M . We write sa = s(a) for short.
Define the strict lexicographical order on N2 (which is in bijective correspondence with N) by (a, j) <lex (b, k) iff a < b or (a = b) ∧ (j < k). For any (a, j), (b, k) ∈ N2
we have (a, j) <lex (b, k) ∨ (b, k) <lex (a, j) ∨ (a, j) = (b, k).
To simplify notation, define the sum of A ⊆ R and x ∈ R by x + A =
{x + a | a ∈ A}.
For (a, j), (b, k) ∈ N2 define d((a, j), (b, k)) to be
some element of

|2−j − 2−k| +  dM (sa, sb)+ (2− min{j,k}, 2−j + 2−k)  ∩ Q
if (a, j) <lex (b, k) (it exists since 2− min{j,k} < 2−j + 2−k and any open interval contains rational numbers);
d((b, k), (a, j)) if (b, k) <lex (a, j);
0 if (a, j) = (b, k).
By countable choice this defines a map d: N2 × N2 → Q, in fact a rational metric on N2. We verify only the triangular inequality d((a, j), (b, k)) + d((b, k), (c, l)) ≥ d((a, j), (c, l)).
If any two of the points (a, j), (b, k), (c, l) are equal, the inequality certainly holds. Assume they are all pairwise distinct. Then
d((a, j), (b, k)) + d((b, k), (c, l)) ≥
≥ |2−j − 2−k| + dM (sa, sb)+ 2− min{j,k} + |2−k − 2−l| + dM (sb, sc)+ 2− min{k,l} ≥

≥ |2−j − 2−l| + dM (sa, sc)+ 2− min{j,k} + 2− min{k,l} ≥
≥ |2−j − 2−l| + dM (sa, sc)+ 2−j + 2−l ≥ d((a, j), (c, l)).
Define (X, dX ) to be the completion of (N2, d). Let m ∈ M . By countable choice there exists a sequence p: N → N such that dM (m, sp(j)) ≤ 2−j for all j ∈ N. Define e: M → X by e(m) = limj→∞(p(j), j).
Let n ∈ M and let r: N → N be a sequence such that dM (n, sr(k)) ≤ 2−k for all
k ∈ N. Then
d((p(j), j), (r(k), k)) ≤ |2−j − 2−k| + dM (sp(j), sr(k))+ 2−j + 2−k =
= 2 · 2− min{j,k} + dM (sp(j), sr(k)) ≤
≤ 2 · 2− min{j,k} + dM (sp(j), m)+ dM (m, n)+ dM (n, sr(k)) ≤
≤ 2 · 2− min{j,k} + 2−j + dM (m, n)+ 2−k ≤ 4 · 2− min{j,k} + dM (m, n) on one hand, and on the other
d((p(j), j), (r(k), k)) ≥ dM (sp(j), sr(k)) ≥ dM (m, n) − dM (m, sp(j)) − dM (sr(k), n) ≥
≥ dM (m, n) − 2−j − 2−k ≥ dM (m, n) − 2 · 2− min{j,k}.
Together:
dM (m, n) − 2− min{j,k}+1 ≤ d((p(j), j), (r(k), k)) ≤ dM (m, n)+ 2− min{j,k}+2.
The special case m = n, p = r shows (p(j), j)j∈N is a Cauchy sequence in (N2, d), and so limj→∞(p(j), j) is a well-defined element of X. Taking just m = n shows that e(m) does not depend on the choice of sequence p. In full generality, the above inequality implies e is an isometric embedding.	 
Inhabitedness of M in Proposition 3.1 is in fact not required, as any separable metric space may be embedded into an inhabited one.

Lemma 3.2 Let (M, d) be a separable metric space. There exists a metric d on M + 1, such that the inclusion M ‹→ M ‹→ M + 1 is an isometric embedding (and consequently, (M^ + 1, d) is an inhabited separable metric space).
Proof. Let S ⊆ M and let s: N → S + 1 be a surjection.  Define the metric
d': (S + 1) × (S + 1) → R for a, b ∈ S + 1 by the following rules.
If both a, b ∈ S, then d'(a, b) = d(a, b).
If both a, b ∈ 1 (ie. a = b = ∗), then d'(a, b) = 0.
If exactly one of a, b belongs to S, say (without loss of generality) a ∈ S, b ∈ 1, then let k ∈ N be such that s(k) = a. Consider s(j) for all j ≤ k and let j0 be the first index for which s(j0) ∈ S. Define d'(a, b) = 1 + d(s(j0), a).
The verification that d' is a well-defined map and a metric is straightforward. Ob- serve also that the completion of (the countable set) S + 1 is M^ + 1, and recall that

a metric is always uniformly continuous. Therefore, by Proposition 2.8, d' extends to d: (M^ + 1) × (M^ + 1) → R which is our desired metric.	 
Theorem 2.7, Proposition 3.1 and Lemma 3.2 together imply the desired theo- rem.
Theorem 3.3 (universality of U) Any separable metric space isometrically em- beds in U.
We are also interested in the uniqueness of U.
Proposition 3.4 Any complete separable metric space U' which contains a count- ably inﬁnite dense subset UQ', such that the metric restricted to UQ' is rational and UQ' satisﬁes the extension property in Lemma 2.6, is isometrically isomorphic to U.
Proof. We use back-and-forth method and Lemma 2.6 at every step to construct an isometric isomorphism between UQ and UQ'; this extends to isometric isomorphism between U and U'.
Let s: N → UQ and s': N → UQ' be bijections. We define f : UQ → UQ' and
g: UQ' → UQ. Let f (s0) = s' and g(s' ) = s0. Take the first unused element
in UQ' (s' in this first step) and extend g to it using Lemma 2.6. Extend f as
inverse. Take the first unused element in UQ, extend f to it and extend g to be the inverse. Repeat. The maps f and g, obtained by this procedure, are mutually inverse isometries.	 
Conclusion
Some concluding questions.
In Proposition 3.4 we required a dense rational metric subspace, in particular one with decidable equality. What are the minimal assumptions to ensure uniqueness of U (up to isometric isomorphism)?
In [7], Fred Richman develops theory of complete metric spaces without countable choice. Future work: Can we use it to prove our results without choice?

References
Bauer, A., “The Realizability Approach to Computable Analysis and Topology,” Ph.D. thesis, School of Computer Science, Carnegie Mellon University, Pittsburgh (2000).
Bishop, E. and D. Bridges, “Constructive Analysis,” Grundlehren der math. Wissenschaften 279, Springer-Verlag, 1985.
Holmes, M. R., The universal separable metric space of urysohn and isometric embeddings thereof in banach spaces, in: Fundamenta Mathematicae 140, 1992 pp. 199–223.
Hubiˇcka, J. and J. Neˇsetˇril, A finite presentation of the rational urysohn space, Topology and its Applications (2008).
Katˇetov, M., On universal metric spaces, in: Z. Frolik, editor, General Topology and its Relations to Modern Analysis and Algebra, VI (1988), pp. 323–330.

Lietz, P., “From Constructive Mathematics to Computable Analysis via the Realizability Interpretation,” Ph.D. thesis, Technische Universit¨at Darmstadt (2004).
Richman, F., Real numbers and other completions, Mathematical Logic Quarterly 54 (2008), pp. 98–108.
Urysohn, P., Sur un espace m´etrique universel, Bulletin des Sciences Math´ematiques 51 (1927), pp. 43– 64, 74–90.
