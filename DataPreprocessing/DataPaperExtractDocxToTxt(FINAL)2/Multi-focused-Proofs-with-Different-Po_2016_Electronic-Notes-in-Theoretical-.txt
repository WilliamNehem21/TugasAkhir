Available online at www.sciencedirect.com


Electronic Notes in Theoretical Computer Science 323 (2016) 163–179
www.elsevier.com/locate/entcs

Multi-focused Proofs with Different Polarity Assignments
Elaine Pimentel 1
DMAT, Universidade Federal do Rio Grande do Norte, Brazil.
Vivek Nigam2
DI, Universidade Federal da Para´ıba, Brazil.
Joao Neto 3
DMAT, Universidade Federal do Rio Grande do Norte, Brazil.

Abstract
In this work, we will reason on how a given focused proof, where atoms are assigned with some polarity, can be transformed into another focused proof, where the polarity assignment to atoms is changed. This will allow, in principle, transforming a proof obtained using one proof system into a proof using another proof system. More specifically, using the intuitionistic focused system LJF restricted to Harrop formulas, we define a procedure, introducing cuts, for transforming a focused proof where an atom is assigned with positive polarity into another focused proof where the same atom is assigned negative polarity and vice- versa. Then we show how to eliminate these cuts, obtaining a very interesting result: while the process of eliminating a cut on a positive atom gives rise to a proof with one smaller cut, in the negative case the number of introduced cuts grows exponentially. We end the paper by showing how to use maximal multi-focusing identify proofs in LJF , giving rise to a 1-1 translation between maximal proofs in LJF and proofs in the natural deduction system for intuitionistic logic NJ, restricted to Harrop formulas.
Keywords: Intuitionistic logic, Proof Systems, Focusing, Identity of proofs.


Introduction
In focused proof systems, such as Andreoli’s original focused proof system [1] for linear logic or Liang and Miller’s LJF and LKF focused proof systems for intu- itionistic and classical logics [13], connectives are classified as positive or negative,

1 Email: elaine.pimentel@gmail.com
2 Email: vivek.nigam@gmail.com
3 Email: joaoneto.ot@gmail.com
4 All authors are supported by CNPq. Pimentel is also supported by the project CAPES/FAPERN.

http://dx.doi.org/10.1016/j.entcs.2016.06.011
1571-0661/© 2016 The Author(s). Published by Elsevier B.V.
This is an open access article under the CC BY-NC-ND license (http://creativecommons.org/licenses/by-nc-nd/4.0/).

according to their right introduction rules: positive connectives do not have invert- ible right rules, while negative connectives are those whose right introduction rules are invertible. The polarity of a non atomic formula is then given by the polarity of its outermost connective. The interesting fact is that atomic formulas can be arbitrarily assigned as positive or negative, without affecting the completeness of the focusing discipline.
While this choice for the polarity of atomic formulas does not affect provability, it does affect the shape of the resulting focused proofs. For instance, in [16] it is shown that, depending on the polarity assignments used for the atomic formula, one can, from the same logical theory, encode sequent calculus or natural deduction proofs. Also, in [6] it has been shown that this choice of polarities can explain different proof search strategies, such as backward chaining and forward chaining. More specifically, focusing and the polarity of atoms were used in order to justify proof theoretically the derivation steps used in the inverse method proof search mechanism. The results are over atoms in Horn theories only.
In this paper we consider a more general setting. In fact, using the focused system LJF [13] for intuitionistic logic restricted to hereditary Harrop formulas [14], we define a procedure, introducing cuts, for transforming a focused proof where an atom is assigned with positive polarity into another focused proof where the same atom is assigned negative polarity and vice-versa. We then show how to eliminate these cuts. Hence, we are able to transform a proof using a forward chaining strategy into a proof using backward chaining strategy or even obtain novel translations from sequent calculus to natural deduction and vice versa.
Interestingly, while the process of eliminating a cut on a positive atom gives rise to a proof with one smaller cut, in the negative case the number of introduced cuts grows exponentially. This difference in the cut-elimination algorithm is most defi- nitely related to the different evaluation strategies according to the Curry-Howard isomorphism, where cut-elimination corresponds to computation in a functional programming setting. We plan to investigate this better in the future.
Finally, we propose a new multi-focused system for intuitionistic logic, mLJF, and show how to identify proofs in this system modulo permutations, obtaining the so called maximal multi-focused proofs [5,4]. It turns out that such maximal multi-focused proofs, when restricted to Harrop formulas, have a very interesting behavior: if atoms are restricted to the negative polarity, mLJF collapses to LJF, while if atoms are restricted to the positive polarity, for each provable sequent in LJF there is exactly one maximal proof. This means that a proof with negative atoms correspond to a proof with positive atoms and the correspondence is 1-1 up to permutation of rules. This way we provide the first correspondence between an intuitionistic focused system with positive atoms and Gentzen’s natural deduction system NJ, thus solving completely the problem of identity of proofs in intuitionistic logic in the sequent calculus setting, when restricted to Harrop formulas.
The paper is organised as follows: Section 2 presents the system LJF and the logic programming fragment based on Harrop formulas, LJFH ; Sections 3 and 4 show how to change polarities of atoms in LJFH (introducing cuts) and how to

Negative Phase

Γ; Θ, false ⇒ R
falsel
Γ; Θ ⇒ R
Γ; Θ, true ⇒ R
truel
Γ; Θ, B,C ⇒ R	+
Γ; Θ,B ∧+ C ⇒ R	l

Γ; Θ,B ⇒ C
Γ; Θ ⇒ B ⊃ C
⊃r	Γ; Θ,B ⇒ R	Γ; Θ,C ⇒ R ∨l
Γ; Θ,B ∨ C ⇒ R

Γ; Θ ⇒ B	Γ; Θ ⇒ C
∧−
 Γ; Θ, B ⇒ R 
∃
 Γ; Θ ⇒ B 
∀

Γ; Θ ⇒ B ∧− C
r	Γ; Θ, ∃yB ⇒ R	l
Positive Phase
Γ; Θ ⇒ ∀yB	r

true
Γ; ·→ [B]	Γ; ·→ [C] ∧+
Γ; ·→ [B]	Γ, [C]; ·→ Pa ⊃

Γ; ·→ [true]	r
Γ; ·→ [B ∧+ C]	r
Γ, [B ⊃ C]; ·→ Pa

	Γ, [Bi]; ·→ Pa	 ∧−		Γ; ·→ [Bi]	 ∨
Γ, [B1 ∧− B2]; ·→ Pa	li	Γ; ·→ [B1 ∨ B2]	ri

Γ; ·→ [B{t/x}]
∃r
Γ; ·→ [∃xB]
Γ, [B{t/x}]; ·→ Pa ∀
Γ, [∀xB]; ·→ Pa	l

Structural Rules

N, Γ, [N ]; ·→ Pa
N, Γ; ·⇒ Pa	Dl
Γ; ·→ [P ]
Γ; ·⇒ P  Dr
Γ; P ⇒ ·Pa	R
Γ, [P ]; ·→ Pa	l
Γ; ·⇒ N
Γ; ·→ [N ] Rr

Γ, Ω; Θ ⇒ R
Γ; Θ, Ω ⇒ R store

Il
Γ, [An]; ·→ An
Ir
Γ, Ap; ·→ [Ap]


Fig. 1. The LJF system. Here An denotes a negative atom, Ap a positive atom, P a positive formula, N a negative formula, Pa a positive formula or an atom and, Ω is a multiset of negative or atomic formulas. All other formulas are arbitrary and y is not free in Γ, Θ or R.
eliminate cuts coming back to proofs in LJFH ; Section 5 presents the multi-focused system mLJF and the notion of maximal multi-focused proofs; Section 6 relates polarities with maximality in LJFH and Section 7 discusses future work.

The focused proof system LJF for intuitionistic logic
There is a number of ways of defining a focused system from Gentzen’s sequent system LJ for intuitionistic logic [10,11,7,8,12,13]. We choose the one first presented in [12], called LJF, since it is the only one which allows positive and negative atoms in the same system.
In order to present the focused proof system LJF, we first classify the connectives
∧+, ∨, ∃, true and false as positive (their left introduction rules are invertible) and the connectives ⊃, ∧−, and ∀ as negative (their right introduction rules are invert- ible). This dichotomy must also be extended to formulas. Concerning the atomic
ones: some pre-chosen atoms are considered negative and the rest are considered positive. That is, one is free to assign as positive or negative the polarity to atoms. From this, a formula is positive if its main connective is positive or it is a positive atom and is negative if its main connective is negative or it is a negative atom.
The proof system LJF depicted in Figure 1 has four types of sequents.
The sequent Γ; ·→ [R] is a right-focusing sequent;

The sequent Γ, [R]; ·→ Pa: is a left-focusing sequent;
The sequent Γ; Θ ⇒ R is an unfocused sequent. Here, Γ contains only negative formulas and positive atoms;
The sequent Γ; ·⇒ Pa is an instance of the previous sequent where Θ is empty and the formula in the succedent is positive or atomic.
As an inspection of the inference rules of LJF reveals, the search for a focused proof is composed of two alternating phases, and these phases are governed by polarities. The negative phase applies invertible (negative) rules until exhaustion: no backtracking during this phase of search is needed. The negative phase uses the third type of sequent above (the unfocused sequents): in that case, Θ,R contains positive or negative formulas. If Θ contains positive formulas, then an introduction
rule (either ∧l, ∃l, truel, or falsel) is used to decompose it; negative formulas are
moved to the Γ context (by using the store rule); if R is negative, the rules ∧—, ⊃r
are applied until R becomes positive or atomic. The end of the negative phase is represented by the fourth type of sequent. Such a sequent turns then to a focused one by using one of the decide rules, Dr or Dl. The application of one of these rules then selects a formula for focusing and switches proof search to the positive phase or focused phase. This focused phase then proceeds by applying sequences of inference rules on focused formulas: in general, backtracking may be necessary in this phase of search. The focusing phase ends with one of the release rule Rl or Rr. As pointed out in [12], if all atoms are given negative polarity, the resulting proof system models backward chaining proof search and uniform proofs [14]. If positive atoms are permitted as well, then forward chaining steps can also be ac- commodated. Moreover, as in [16], it is possible in LJF to specify, with the same intuitionistic theory, sequent calculus proofs by using one polarity assignment and
natural deduction proofs by using another polarity assignment.

Example 2.1 It is well known that the polarity assigned to atomic formulas does not change provability. On the other hand, the shape of proofs can differ a lot when different polarities are assigned to atoms. Consider the Fibonacci program

fib(0, 0) ∧+ fib(1, 1) ∧+ ∀n, d, dj.[fib(n, d) ∧+ fib(n + 1, dj) ⊃ fib(n + 2,d + dj)]

Let Γ= fib(0, 0), fib(1, 1), ∀n, d, dj.[fib(n, d) ∧+ fib(n + 1, dj) ⊃ fib(n + 2,d + dj)]
If fib has negative bias, then the only possible proof of Γ −→ fib(12, 144) is



(Il)
π1
Γ; ·⇒ fib(10, 55)
Γ; ·→ [fib(10, 55)] Rr
π2
Γ; ·⇒ fib(11, 89)
Γ; ·→ [fib(11, 89)] Rr
(∧+)

Γ, [fib(10 + 2, 55 + 89)]; ·→ fib(12, 144)
Γ; ·→ [fib(10, 55) ∧+ fib(11, 89)]	r

Γ, [∀n, d, dj.[fib(n, d) ∧+ fib(n + 1, dj) ⊃ fib(n + 2,d + dj)]]; ·→ fib(12, 144)	(∀l, ⊃l)
Γ; ·⇒ fib(12, 144)	(Dl)
where π1 and π2 continue following the backward chaining strategy. On the other hand, if fib is positive, the only possible way to start the proof is the following

π3		 (Ir)
(Ir)

Γ, fib(0 + 2, 0 + 1); ·⇒ fib(12, 144)	Γ; ·→ [fib(0, 0)]

Γ; ·→ [fib(1, 1)] (∧+)

Γ, [fib(0 + 2, 0+ 1)]; ·→ fib(12, 144)
Γ; ·→ [fib(0, 0) ∧+ fib(1, 1)]	r

Γ, [∀n, d, dj.[fib(n, d) ∧+ fib(n + 1, dj) ⊃ fib(n + 2,d + dj)]; ·→ fib(12, 144) (∀l, ⊃l)
Γ; ·⇒ fib(12, 144)	(Dl)
where π3 can mix forward and backward chaining strategies. Note that the first derivation is exponential on size, while the smallest one in the second is linear.
The following result is trivially true, since right focused rules do not introduce left focused sequents.
Lemma 2.2 Let Γ be a set of LJF-formulas and F a LJF-formula. Let π be a proof of Γ; ·→ [F ] and let Ξ be a sub-derivation of π containing only rules from the positive phase with end sequent Γ; ·→ [F ] (we call Ξ a positive trunk). Then there is no sequent focused on the left in Ξ.
The logic programming fragment: LJFH
In Sections 3, 4 and 6 we will restrict theories used to be the D-formulas and goals to be the G-formulas both specified by the grammar
G := A | G ∧+ G | D ⊃ G | ∀xG D := A | G ⊃ A | ∀x.D
where A is an atomic formula. That is, in those Sections we will only consider sequents of the type D ▶ G, where D is a set of D-formulas and G is a goal. This is a straightforward extension of the fragment of hereditary Harrop formulas used to describe uniform proofs [14]. We will call the resulting system LJFH .
Note that restricting the language to this fragment considerably simplifies the machinery used in the following sections. In particular, it allows for a concise cut- elimination procedure involving only some cut permutations shown in Section 4, which will be used in the subsequent sections to demonstrate the connections of the polarity assignment to translation of proofs in different systems, as well as giving a hint on how the change of polarities gives rise to call-by-value and call-by-name reduction strategies. It is important to highlight that it is possible to repeat most of the results in this paper for the whole logic. Since that would require further reduction cases, we will leave it for future work.
Changing polarities
In this section, we show how to transform a focused proof where an atom is assigned with one polarity to a focused proof where this same atom is assigned the opposite polarity. For this, we may introduce inter-phase atomic cuts, that is, we may use the admissible cut rule in LJF
Γ; ·⇒ A	Γ, A; ·⇒ C

Γ; ·⇒ C	cut

The transformations below might not preserve the size of a proof. In fact, it may well happen that after a proof is transformed from one proof system to another, the proof increases exponentially. Although this is relevant in some cases, such as in Proof Carrying Code, it is not that relevant when trying to unify the library of results obtained with different proof systems.
From positive to negative polarity
In this section we demonstrate how to transform a focused proof where an atom is assigned with positive polarity into another focused proof where the same atom is assigned negative polarity.
Assume that Ξ is a proof where the atom A is assigned with positive polarity. We modify Ξ by induction from the leaves to the root on the number of reaction left and initial right rules applied on A. In particular, we perform the following operations.
In the base case, the proof ends with an initial right rule, which can only appear in positive derivations. We eliminate initial right rules by replacing the following subderivations appearing in a positive derivation:
Γ; ·→ [A] Ir
Γ; ·→ [A] Ir	and	Γ; ·⇒ A  Dr
by the following derivations, respectively (note that A ∈ Γ):
Γ, [A]; ·→ A Il

Γ; ·⇒ A	Dl
Γ; ·→ [A] Rr	and
Γ, [A]; ·→ A Il
Γ; ·⇒ A	Dl

The other possible cases are when one of the rules ⊃l, ∧— or ∀l are applied. In those cases, an instance of the cut rule is added. We illustrate the case of ⊃l, the others are similar and simpler.

Ξ2
Γ, A; · ⇒ Gj
Ξj
Γ;	1 [G]  Γ, [A]; · → A Il

Ξ1		 Rl, store	· →	⊃

Γ; · → [G]
Γ, [A]; · → Gj
Γ, [G ⊃ A]; · → A	l	Ξj

Γ, [G ⊃ A]; · → Gj	⊃l
Γ; · ⇒ A	Dl
2
Γ, A; · ⇒ Gj

Γ; · ⇒ Gj	Dl	=⇒	Γ; · ⇒ Gj	cut

Here, the derivations Ξj
and Ξj
are obtained by applying the inductive hypothe-

sis to Ξ1 and Ξ2 of smaller height and transforming all occurrences of A with positive polarity into negative polarity. Notice that, from Lemma 2.2, in the remaining of positive trunk in Ξ1 there may not be any occurrences of reaction left rules, but only of initial right rules which are handled by the base case. Hence, this operation removes all reaction left rules over all the appearances of the atomic formula A.
Finally, after applying these operations, we obtain an LJF proof with cuts. To obtain a cut-free proof, we apply the cut-elimination theorem given in Section 4.

The resulting proof is a cut-free focused proof where the polarity of the atom A is negative.

From negative to positive polarity
The method of transforming a proof where an atom A is assigned with negative polarity to a proof where the same atom appears with positive polarity is similar to the one given in the last section. For example, in the case of implication left:
Γ, A; ·→ [A] Ir
Γ, A; ·⇒ A  Dr	j
Il	Ξ		 Rl	Ξ

Γ, [A]; ·→ A
Γ; ·→ [G] ⊃
Γ, [A]; ·→ A
Γ; ·→ [G] ⊃

Γ, [G ⊃ A]; ·→ A	l	Γ, [G ⊃ A]; ·→ A	l
Γ; ·⇒ A	Dl	=⇒	Γ; ·⇒ A	Dl

The different case is when the rule Rr is applied. To eliminate all occurrences of Rr, we will make use of the cut rule. Consider the following positive derivation containing Rr rules on the negative atom A and whose last rule is Dr:
Ξi

Ξ1
Γ; ·→ [G1]	··· 
Γ; ·⇒ A
Γ; ·→ [A]
Rr	··· 
Ξn
Γ; ·→ [Gn]


Γ; ·→ [G]
Γ; ·⇒ G  Dr

It can be transformed into the following derivation, where the number of reaction rules is reduced and this occurrence of A has positive polarity.


j
1	Ir
Γ, A; ·→ [G1] ··· Γ, A; ·→ [A]
j
n
··· Γ, A; ·→ [Gn]

Ξj	Γ, A; ·→ [G]
i		

Γ; ·⇒ A
Γ, A; ·⇒ G
Γ; ·⇒ G	cut

The proofs Ξj are obtained from Ξi by applying the inductive hypothesis where A has positive polarity. The inductive hypothesis is applicable since the height of the resulting proof is smaller: the number of reaction rules is decreased by at least one.
Cut-elimination
Instead of using the cut-elimination algorithm with several intra-phase cut-rules given in [13], we exploit the fact that the theories encoding proof systems are hereditary Harrop formulas to give a simpler cut-elimination procedure, with only inter-phase cut-rules.

If the cut-formula is a positive atom
Our algorithm consists of basically two rewrite rules, depending on which decide rule is applied last on left premise of the cut rule. If it is Dr then it is necessarily the case that the atom A used in the cut is in the context Γ
Γ; ·→ [A] Ir

Γ; ·⇒ A  Dr
Ξ
Γ, A;	G

·⇒ 
Γ; ·⇒ G	cut
This derivation reduces to the following derivation, where the cut is eliminated
Ξ
Γ; ·⇒ G

For the second case, when the decide rule Dl is applied last in the left premise of the cut rule, we proceed as follows:


Γ1; · → [B1]	···	Γn; · → [Bn]
Ξ1
Γ, Aj; · ⇒ A
Γ, [Aj]; · → A Rl, store

Γ, [F ]; · → A
Γ; · ⇒ A	Dl
Ξ2
Γ, A; · ⇒ G
Γ; · ⇒ G	cut

Since our theories are hereditary Harrop formulas, once the formula F is focused on, the resulting formula focused on the left (Aj) is necessarily a (positive) atom.
We permute the atomic cut above the positive phase to the left as follows:


Ξ1
Γ, Aj; ·⇒ A
Ξ2
Γ, A, Aj; ·⇒ G


Γ1; ·→ [B1]	···	Γn; ·→ [Bn]
Γ, Aj; ·⇒ G	cut
Γ, [Aj]; ·→ G Rl, store



Γ, [F ]; ·→ G
Γ; ·⇒ G	Dl


Remark 4.1 Note that the original cut is replaced by one upper cut.

If the cut-formula is a negative atom
It turns out that the cut may not permute upwards on the left premise if A is negative. In fact, on focusing on a left formula F like in the last Section, if the resulting atom focusing on the left is negative, it has necessarily to be A and the proof finishes with an Il rule. For all other cases we could proceed as in the last Section.

There are two base cases:
Γ, A, [A]; ·→ A Il

Ξ
Γ;	A
Γ, A; ·⇒ A	Dl

·⇒ 
Γ; ·⇒ A
cut
Ξ
=⇒	Γ; ·⇒ A




Ξ
Γ;	A
Γ, A, [Aj]; ·→ Aj Il
Γ, A; ·⇒ Aj	Dl

Γ, [Aj]; ·→ Aj Il

·⇒ 
Γ, A; ·⇒ Aj	cut	=⇒
Γ; ·⇒ Aj	Dl

The inductive cases are obtained by moving the cut rule upwards.
Let be the maximum sequence of inference rules excluding decide rules ap- pearing above the sequent Γ, A; · ⇒ G (hence  has only negative rules). Let n be the minimum length of the sub-derivations of . If n > 0,
Ξj
Γj, A; ·⇒ Gj

Ξ
Γ; ·⇒ A
Γ, A; ·⇒ G

Γ; ·⇒ G	cut
where Γ ⊆ Γj. Observe that, in LJFH , negative rules have only one premise.
If, on the other hand, n = 0, the last rule applied for proving Γ, A; · ⇒ G is a decision rule. There are then two sub-cases: Dl and Dr.
In both cases, after finishing the focus phases (positive or negative) we will end up with a proof of the shape (ignoring the leaves):
Ξ1	Ξn

Ξ
Γ; ·⇒ A
Γ1, A; ·⇒ G1	·· ·	Γn, A; ·⇒ Gn
Γ, A; ·⇒ G
Γ; ·⇒ G	cut

and the cut is moved upwards as follows:
Ξ	Ξ1	Ξ	Ξn

Γ1; ·⇒ A	Γ1, A; ·⇒ G1
Γ1; ·⇒ G1	cut	··· 
Γ; ·⇒ G
Γn; ·⇒ A	Γn, A; ·⇒ Gn
Γn; ·⇒ Gn	cut

Remark 4.2 Observe that, in this case, one cut is replaced by many others, and hence the size of the proof grows exponentially.

Multi-focusing
It is well known [11,9] that the negative fragment of sequent calculus corresponds to natural deduction proofs. In what follows we will establish such a correspondence also for the positive fragment.

Example 5.1 Consider the sequent Γ; · ⇒ b ∧+ d where Γ = {a, c, a ⊃ b, c ⊃ d}). This sequent has 6 different proofs in LJF. However, if atoms have negative bias, the only possible proof is π1 :


Γ, [a]; ·→ a Il
Γ; ·→ [a]  Rr, Dl	Γ, [b]; ·→ b Il
Γ; ·⇒ b	Dl, ⊃l
Γ, [c]; ·→ c Il
Γ; ·→ [c]  Rr, Dl	Γ, [d]; ·→ d Il
Γ; ·⇒ d	Dl, ⊃l

Γ; ·⇒ b ∧+ d
Dr, ∧+R, Rr


On the other hand, if atoms are all positive, there are two possible proofs without cycles 5 , π2 :
Γ, b, d; ·→ [b] Ir	Γ, b, d; ·→ [d] Ir
∧+

Γ, b; ·→ [c] Ir
Γ, b, d; ·⇒ b ∧+ d	r
Γ, b, [d]; ·→ b ∧+ d Dr, Rl


Γ; ·→ [a] Ir
Γ, b; ·⇒ b ∧+ d	Dl, ⊃l
Γ, [b]; ·→ b ∧+ d Rl
Γ; ·⇒ b ∧+ d	Dl, ⊃l



and π3:

Γ, b, d; ·→ [b] Ir	Γ, b, d; ·→ [d] Ir

Γ, b, d; ·⇒ b ∧+ d
I

D ,R 
∧+R

Γ, d; ·→ [a]  r	Γ, d, [b]; ·→ b ∧+ d	r	l


Γ; ·→ [c] Ir
Γ, d; ·⇒ b ∧+ d	Dl, ⊃l
Γ, [d]; ·→ b ∧+ d Rl
Γ; ·⇒ b ∧+ d	Dl, ⊃l

Note that π2 and π3 differ only in the order of the application of the implication.
We will show next how to use the maximal multi-focusing approach in order to identify proofs that differ only on the permutation of rules. We start by presenting mLJF, a multi-focused system for LJF.
The system mLJF has two kinds of formulas:
P, Q  := Ap | false | true | P ∧+ Q | P ∨ Q | ∃x.P (x) |↓ N M, N := An | M ∧— N | P ⊃ N | ∀x.N (x) |↑ P
where P, Q are positive while M, N are negative formulas. The symbols ↑ and ↓

5 Observe that there are infinite proofs with cycles: one could always focus on one of the implications on the left.

Negative Phase

Γ; Θ, false ⇒ R
falsel
Γ; Θ ⇒ R
Γ; Θ, true ⇒ R
truel
Γ; Θ, B,C ⇒ R	+
Γ; Θ,B ∧+ C ⇒ R	l

Γ; Θ,B ⇒ C
Γ; Θ ⇒ B ⊃ C
⊃r	Γ; Θ,B ⇒ R	Γ; Θ,C ⇒ R ∨l
Γ; Θ,B ∨ C ⇒ R

Γ; Θ ⇒ B	Γ; Θ ⇒ C
∧—
 Γ; Θ, B ⇒ R 
∃
 Γ; Θ ⇒ B 
∀

Γ; Θ ⇒ B ∧— C
r	Γ; Θ, ∃yB ⇒ R	l
Positive Phase
Γ; Θ ⇒ ∀yB	r

true
Γ, Ψ; ·→ [B]	Γ, Ψ; ·→ [C] ∧+
Γ, Ψ, [Bi]; ·→ R
∧

Γ; ·→ [true]	r
Γ, Ψ; ·→ [B ∧+ C]
r	Γ, Ψ, [B1 ∧— B2]; ·→ R	li

Γ, Ψ1; ·→ [B]	Γ, Ψ2, [C]; ·→ R ⊃		Γ, Ψ; ·→ [Bi]	 ∨

Γ, Ψ , Ψ , [B ⊃ C]; ·→ R
l	Γ, Ψ; ·→ [B
∨ B ]	ri

1	2	1	2

Γ, Ψ; ·→ [B[t/x]]
Γ, Ψ; ·→ [∃xB]  ∃r
Γ, Ψ, [B[t/x]]; ·→ R
Γ, Ψ, [∀xB]; ·→ R  ∀l

Structural Rules

Γ, [Δ]; ·→ Pa
Γ; ·⇒ Pa	mDl
Γ, [Δ]; ·→ [P ]
Γ; · ⇒↑ P	mDr

  Γ; Θ ⇒ Pa	 mR
Γ, [↑ Θ]; ·→ Pa	l
Γ; Θ ⇒ N
Γ, [↑ Θ]; ·→ [↓ N ]
mRr

Γ, Δ, Ω; Θ ⇒ R
Γ; Θ, Ω, ↓ Δ ⇒ R
store

Il
Γ, [An]; ·→ An
Ir
Γ, Ap; ·→ [Ap]


Fig. 2. mLJF system. Here An, Ap, P and N are the same as in Figure 1, Pa represents either a formula of the kind ↑ P or an atomic formula and R is either Pa or a bracket formula. In mDl, Δ ⊆setΓ is non empty, where ⊆set denotes the set inclusion of the underlying sets of the multisets Δ and Γ.
mark the changing of polarities. The syntax for contexts is the following Δ := ·| Δ,N	Γ, Ω := Δ | Ap	Ψ := [Δ]	Θ := ·| Θ,P 
Finally, mLJF has three kinds of sequents:
the sequent Γ; Θ ⇒ R is unfocused;
the sequent Γ, Ψ; · −→ R is focused on the left, where Ψ /= ∅;
the sequent Γ, Ψ; · −→ [R] is focused on the right (and possibly on the left).
The negative phase in mLJF is the same as in LJF. The rest of the rules for mLJF are similar to the ones presented in Figure 1, only now considering possibly multi- focused contexts (Figure 2). Note that we can unfocus if and only if every focused formula is marked with arrows.
Theorem 5.2 mLJF is correct and complete with respect to LJF.
Proof. Just note that if we erase the ↑ and ↓ arrows and the context Ψ, and if we restrict Δ to a singleton in mDl and to the empty set in mDr, mLJF collapses to LJF.	2

Observe that the rule ⊃l has a “linear” flavour as the focused left context splits on the premise sequents. This is only an operational trick in order to make maxi- multi-focalization possible.
Example 5.3 If restricted to positive atoms, there are now four proofs of the se- quent presented in Example 5.1: focusing on a ⊃↑ b first, focusing on c ⊃↑ d first, or focusing on both at the same time and then applying the implication rules in the two possible orders. These two last proofs collapse to one if we consder the equivalent class of proofs modulo permutation of rules:
Γ, b, d; ·→ [b] Ir	Γ, b, d; ·→ [d] Ir

Γ, b, d; ·→ [b ∧+ d]
∧+R


Γ; ·→ [a] Ir	Γ; ·→ [c] Ir
Γ, b, d; ·⇒ b ∧+ d mRr
Γ, [↑ b, ↑ d]; ·→ b ∧+ d mRl, store

Γ, [a ⊃↑ b, c ⊃↑ d]; ·→ b ∧+ d	2 × (⊃l)
Γ; ·⇒ b ∧+ d	mDl
In this case, we say that the application of mDl rule is maximal, that is, it chooses the maximal possible set Δ for focusing. Also, it gives rise to a synthetic connec- tive [15], that is, a connective that combines the application of various rules in one. Finally, observe that this maximal proof is possible only due to the splitting of the left focused context in the rule ⊃l, since the application of Ir on proving a and c implies that we cannot have any other focused formulas.
Maximal multi-focusing
We will now formalise the notions of maximal multi-focusing and equivalence of proofs, presented intuitively in the last example.
The following definitions are adaptations from [5,4] to mLJF:
Definition 5.4 The proofs Ξ1 and Ξ2 of the same mLJF sequent are locally per- mutatively equivalent, written Ξ1 ∼ Ξ2, if each can be rewritten to the other using local permutations. Ξ1 and Ξ2 are permutatively equivalent, written Ξ1 ≈ Ξ2, if they are locally permutatively equivalent and each can be rewritten to the other using permutations.
For example,

Ξ
Γ; Θ, B, C,D ⇒ E	+
Γ; Θ,B ∧+ C, D ⇒ E	l
Ξ
Γ; Θ, B, C,D ⇒ E
Γ; Θ, B,C ⇒ D ⊃ E ⊃r

⊃r
Γ; Θ,B ∧+ C ⇒ D ⊃ E
+
~	Γ; Θ,B ∧+ C ⇒ D ⊃ E	l

In fact, since all negative rules are invertible, they are (locally) permutable. This means that the whole negative phase collapse to one step, modulo permutations.
In the positive phase, the permutability of rules depends on the polarities of formulas. We will come back to this later.

Non-locally permutatively equivalent proofs, on the other hand, require consid- ering permutations of entire phases. As in [2,5], we call a neighbouring pair of phases, with the bottom phase positive and the top phase negative, a bipole.
Definition 5.5 If a proof Ξ in mLJF ends with an instance of mDl or mDr, let foci(Ξ) be defined as the multiset of focused formulas in the premise of that in- stance. We say that this instance of mDl or mDr is maximal if and only if, for every Ξj ≈ Ξ, foci(Ξj) ⊆ foci(Ξ). A proof in mLJF is maximal if and only if every instance of mDl or mDr in it is maximal.
Theorem 5.6 Every sequent provable in mLJF has a maximal proof.
Proof. Consider two neighbouring bipoles: if the positive phase of the top bipole permutes with the negative phase of the bottom bipole, then in an unfocused form we can perform the permutation and merge the two bipoles by uniting their positive and negative phases, obtaining another (multi-)focused proof. Since this is only a re-arrangement of rules applications, this operation terminates.	2
The proof presented in Example 5.3 is maximal, while π2, π3 given in Example 5.1 are not. But they can be transformed, via non-local permutations, to the one in Example 5.3.

Maximal multi-focusing and Harrop formulas
The restriction of mLJF to Harrop formulas (here called mLJFH ) gives very inter- esting results. The first is that, when restricted to Harrop formulas and negative atoms, multi-focused proofs are the same as singly focused proofs.
Theorem 6.1 If all atoms are negative then mLJFH = LJFH.
Proof. Consider the proof
Ξ1	Ξ2
Γ, G ⊃ A, Ψ1; ·→ [G]	Γ, G ⊃ A, Ψ2, [A]; ·→ C ⊃
Γ,G ⊃ A, Ψ , Ψ , [G ⊃ A]; ·→ C	l
1	2	mD
Γ,G ⊃ A; ·⇒ C	l

If A is a negative atom, Ξ2 must be the application of the initial axiom Il and hence A = C and Ψ2 = ∅. Now, it should be the case that Ψ1 = ∅. If not, observe that it cannot exist a negative atom n ∈ Ψ1, since G is focused on the right (and focused negative atoms should finish the proof). Hence either there exists Gj ⊃ Aj or ∀x.D in Ψ1. But applying ⊃l in a sequent of the type Γ,G ⊃ A, Ψ1; ·→ [G] will produce a sequent of the form Γ,G ⊃ A, Ψj , [Aj]; ·→ [G], which is forbidden since Aj is atomic negative (hence there can be no focused formula on the right of the sequent). On the other hand, applying ∀l will substitute a focused formula ∀x.D by the focused formula D; in this case, the focused context on the left will always produce another one, and the result follows by induction.

That is, there are not non-local permutations, foci in maximal multi-focused formulas have exactly one element, hence mLJFH = LJFH . The other cases are similar and simpler.	2
Corollary 6.2 If all atomic formulas are negative, any provable sequent in mLJFH has only one possible proof.
In the positive case we also have a fascinating result.
Theorem 6.3 For each provable sequent in mLJFH, if all atoms are positive then there is only one maximal proof for it. That is, when restricted to Harrop formu- las with only positive atoms, multi-focused proofs can be equated to one maximally focused proof.
Proof. Consider the maximal proof Ξ
Ξ1	Ξ2
Γ, G ⊃↑ A, Ψ1; ·→ [G]	Γ, G ⊃↑ A, Ψ2, [↑ A]; ·→ C ⊃
Γ,G ⊃↑ A, Ψ , Ψ , [G ⊃↑ A]; ·→ C	l
1	2	mD
Γ,G ⊃↑ A; ·⇒ C	l
If G is a purely positive formula, Ψ1 should be empty and there are no rules up to permute with the rightmost premise. If G =↓ N , a number of things can happen: if Ψ1 is a (possibly empty) set of the form ↑ Δ, then focus will be lost and there will be a change of phases.  Since Ξ is maximal, there is no way of permuting these phases.  If Ξ1 ends with ⊃l or ∀l, then these rules are locally permutable with ⊃l.  For example, if Gj ⊃↑ Aj ∈ Ψ1 then

j
1
Γ,G ⊃↑ A, Ψj ; ·→ [Gj]
jj
1
Γ,G ⊃↑ A, Ψj , [↑ Aj]; ·→ [G]

	1	2	 ⊃l	Ξ2

Γ,G ⊃↑ A, Ψ1; ·→ [G]
Γ,G ⊃↑ A, Ψ2, [↑ A]; ·→ C ⊃

Γ,G ⊃↑ A, Ψ , Ψ , [G ⊃↑ A]; ·→ C	l
1	2	mD

is locally equivalent to
Γ,G ⊃↑ A; ·⇒ C	l

jj
1	2

Ξj	Γ,G ⊃↑ A, Ψj , [↑ Aj]; ·→ [G]
Γ,G ⊃↑ A, Ψ2, [↑ A]; ·→ C

1
Γ,G ⊃↑ A, Ψj ; ·→ [Gj]
	2	 ⊃l
Γ,G ⊃↑ A, Ψ2, [G ⊃↑ A, ↑ Aj]; ·→ C

	1	 ⊃l
 Γ,G ⊃↑ A, Ψj , Ψ2, [G ⊃↑ A, Gj ⊃↑ Aj]; ·→ C
mDl
Γ,G ⊃↑ A; ·⇒ C
The analysis is similar and simpler for Ψ2 or in the case that multi-focusing is also on the right (mDr).	2
Corollary 6.4 There is a 1-1 correspondence between maximal proofs in mLJFH restricted to positive atoms and proofs in mLJFH restricted to negative atoms. Hence there is a 1-1 correspondence between mLJFH restricted to positive atoms and proofs in NJ restricted to Harrop formulas.
We will finish this section by sketching how these correspondences work, using the process developed in Sections 3 and 4. The process of changing polarities of

atoms will transform a cut-free proof in mLJFH into a proof with cuts.

Ξ
π	Γ; ·⇒ A
Ξj
Γ, A; ·⇒ G
cut

Γ; ·⇒ G ⇒	Γ; ·⇒ G

From positive to negative. The cut-elimination process on negative atoms will (i) permute down the focused rule on the right premise above the cut (if any) and (ii) add a higher cut to every possible top premise appearing when the focused phase is over 6 :
Ξ	Ξ1	Ξ	Ξn

Γ1; ·⇒ A	Γ1, A; ·⇒ G1
Γ1; ·⇒ G1	cut	··· 
Γ; ·⇒ G
Γn; ·⇒ A	Γn, A; ·⇒ Gn
Γn; ·⇒ Gn	cut

Consider the proof
Ξ	Ξi

Γi; ·⇒ A	Γi, A; ·⇒ Gi
Γi; ·⇒ Gi	cut
If the last rule of Ξi is the identity on A, then Gi = A and hence the proof above is substituted by Ξ. If the last rule of Ξi is the identity on a formula other than A, then the cut is eliminated. Finally, if the last rule of Ξi is not the identity, we continue moving the cut up, together with Ξ. This will eliminate all the uppermost cuts and completely determine the order of application of rules in the negative case. As an example, if we take π2 or π3 in Example 5.1, this process will give π1, where the conjunction moves down and the implications occur in parallel branches
of the proof.
From negative to positive. The proof
Ξi

Ξ1
Γ; ·→ [G1]	··· 
Γ; ·⇒ A
Γ; ·→ [A]
Rr	··· 
Ξn
Γ; ·→ [Gn]


Γ; ·→ [G]
Γ; ·⇒ G


is transformed into
j
1
Γ, A;	[G ] ··· Γ, A; ·→ [A] Ir  ··· Γ, A;


j
n
[G ]

·→	1
Ξj

Γ, A; ·→ [G]
·→	n

i		

Γ; ·⇒ A
Γ, A; ·⇒ G
Γ; ·⇒ G	cut

The cut-elimination process on positive atoms will (i) permute down the focused rule on the left premise above the cut (if any) and (ii) move the cut up, on the left

6 Here we abuse the notation and use Ξ also for its weakened version, substituting Γ by Γi, where Γ ⊆ Γi.

premise. Depending on the choice of Ξi (and hence of the atomic formula A), we may have different but permutatively equivalent proofs. In Example 5.1, starting from the π1, we get π2 if A = a and π3 if A = c.
Conclusion and future work
We started this work by showing how to transform proofs having atoms assigned to different polarities inside the hereditarry Harrop fragment of LJF. Not surprisingly, this transformation process introduces cuts. In fact, it is related to the well known proof transformations from sequent calculus to natural deductions proof systems and vice versa. However, the approach presented is really a novelty, since we have one base system, changing only the polarities on atoms.
An interesting direction of research to pursue is the use of the proposed algorithm for uniformly describing different evaluation strategies in λ-calculus. In particular, as noted in Remarks 4.1 and 4.2, systems restricted to positive atoms have a call- by-value behavior, where one cut is substituted by another on the cut-elimination process. This has the flavor of linear reduction steps, evaluating the argument first for then passing it as a parameter. On the other hand, systems restricted to negative atoms have a call-by-name behavior, where one cut is substituted by possible many others, capturing well the notion of first passing the argument, then reducing all possible occurrences of it in the term. This is under investigation in an advanced stage. It is worthy noticing that the idea of using polarities for computation appears in [3], although with very different approach and purposes.
As the second contribution, we have proposed a multi-focused system mLJF for the focused intuitionistic system LJF [12]. We then showed how to use the notion of maximal proofs in order to identify proofs in intuitionistic logic. The same results have been established in [5] for the multiplicative-additive fragment of linear logic and in [4] for classical logic.
This is an important step towards solving the problem of identity of proofs in intuitionistic logic in the sequent calculus setting. In fact, when restricted to Harrop formulas, we have completely solved the problem (see Theorems 6.1 and 6.3). We hope to be able to expand these results for the whole intuitionistic logic.
Acknowledgment
The authors would like to thank the anonymous reviewers and Giselle Reis, for the valuable comments.

References
J-M Andreoli. Logic programming with focusing proofs in linear logic. J. of Logic and Computation, 2(3):297–347, 1992.

Jean-Marc Andreoli. Focussing and proof construction. Annals of Pure and Applied Logic, 107(1):131– 163, 2001.


Taus Brock-Nannestad, Nicolas Guenot, and Daniel Gustafsson. Computation in focused intuitionistic logic. In Moreno Falaschi and Elvira Albert, editors, Proceedings of the 17th International Symposium on Principles and Practice of Declarative Programming, Siena, Italy, July 14-16, 2015, pages 43–54. ACM, 2015.
Kaustuv Chaudhuri, Stefan Hetzl, and Dale Miller. A systematic approach to canonicity in the classical sequent calculus. In CSL’12, pages 183–197, 2012.
Kaustuv Chaudhuri, Dale Miller, and Alexis Saurin. Canonical sequent proofs via multi-focusing. In
5th Int. Conf. in TCS, volume 273 of IFIP, pages 383–396. Springer, 2008.
K. Chaudhuri, F. Pfenning, and G. Price. A logical characterization of forward and backward chaining in the inverse method. J. of Automated Reasoning, 40(2-3):133–177, 2008.
V. Danos, J.-B. Joinet, and H. Schellinx. LKT and LKQ: sequent calculi for second order logic based upon dual linear decompositions of classical implication. In Advances in Linear Logic, number 222 in London Mathematical Society Lecture Note Series, pages 211–224. Cambridge University Press, 1995.
R. Dyckhoff and S. Lengrand. LJQ: a strongly focused calculus for intuitionistic logic. In Computability in Europe 2006, volume 3988 of LNCS, pages 173–185. Springer, 2006.
C. Englander, G. Dowek, and E. Haeusler. Yet another bijection between sequent calculus and natural deduction1. ENTCS, 312:107–124, 2015.
J-Y Girard. On the unity of logic. Annals of Pure and Applied Logic, 59:201–217, 1993.
H. Herbelin. A lambda-calculus structure isomorphic to gentzen-style sequent calculus structure. In
CSL’94, pages 61–75, 1994.
C. Liang and D. Miller. Focusing and polarization in intuitionistic logic. In CSL 2007: Computer Science Logic, volume 4646 of LNCS, pages 451–465. Springer, 2007.
C. Liang and D. Miller.  Focusing and polarization in linear, intuitionistic, and classical logics.
Theoretical Computer Science, 410(46):4747–4768, 2009.
D. Miller, G. Nadathur, F. Pfenning, and A. Scedrov. Uniform proofs as a foundation for logic programming. Annals of Pure and Applied Logic, 51:125–157, 1991.
Dale Miller and Elaine Pimentel. A formal framework for specifying sequent calculus proof systems.
Theor. Comput. Sci., 474:98–116, 2013.
V. Nigam and D. Miller. A framework for proof systems. J. of Automated Reasoning, 45(2):157–188, 2010.
