Estimation of morphological traits of foliage and effective plant spacing in
NFT-based aquaponics system
R. Abbasi a, P. Martinez b, R. Ahmad a,⁎
a Aquaponics 4.0 Learning Factory (AllFactory), Department of Mechanical Engineering, University of Alberta, 9211 116 St., Edmonton, AB T6G 2G8, Canada
b Mechanical and Construction Engineering Department, Northumbria University, Newcastle upon Tyne NE7 7YT, UK
a b s t r a c t
a r t i c l e
i n f o
Article history:
Received 18 October 2022
Received in revised form 8 August 2023
Accepted 20 August 2023
Available online 23 August 2023
Deep learning and computer vision techniques have gained signiﬁcant attention in the agriculture sector due to
their non-destructive and contactless features. These techniques are also being integrated into modern farming
systems, such as aquaponics, to address the challenges hindering its commercialization and large-scale imple-
mentation. Aquaponics is a farming technology that combines a recirculating aquaculture system and soilless hy-
droponics agriculture, that promises to address food security issues. To complement the current research efforts,
a methodology is proposed to automatically measure the morphological traits of crops such as width, length and
area and estimate the effective plant spacing between grow channels. Plant spacing is one of the key design pa-
rameters that are dependent on crop type and its morphological traits and hence needs to be monitored to ensure
high crop yield and quality which can be impacted due to foliage occlusion or overlapping as the crop grows. The
proposed approach uses Mask-RCNN to estimate the size of the crops and a mathematical model to determine
plant spacing for a self-adaptive aquaponics farm. For common little gem romaine lettuce, the growth is esti-
mated within 2 cm of error for both length and width. The ﬁnal model is deployed on a cloud-based application
and integrated with an ontology model containing domain knowledge of the aquaponics system. The relevant
knowledge about crop characteristics and optimal plant spacing is extracted from ontology and compared
with results obtained from the ﬁnal model to suggest further actions. The proposed application ﬁnds its signiﬁ-
cance as a decision support system that can pave the way for intelligent system monitoring and control.
© 2023 The Authors. Publishing services by Elsevier B.V. on behalf of KeAi Communications Co., Ltd. This is an open
access article under the CC BY-NC-ND license (http://creativecommons.org/licenses/by-nc-nd/4.0/).
Keywords:
Deep learning
Ontology modeling
Crop phenotyping
Leafy crops
Aquaponics
Digital farming
Plant spacing
1. Introduction
Aquaponics is a symbiotic integration of two technologies:
i) aquaculture (ﬁsh farming) and ii) hydroponics (the cultivation of
plants in water without soil), which are combined within a closed
recirculating system. There is a growing interest in this controlled envi-
ronment farming method around the globe as it offers an environmen-
tally friendly and sustainable way of agri-food production (Abbasi et al.,
2021a). The correct design and management of the aquaponics system
are of utmost importance to witness enhanced crop quality and farm
productivity. Crop quality is evaluated by many indicators, one of
which is crop morphological traits such as length, width, area, and pe-
rimeter which are used to assess the health status as well as the market
value of the crops (“Crop Quality - An Overview|ScienceDirect Topics,”,
2021). Hence, it is vital to monitor these parameters throughout the
plantation cycle. Moreover, crop quality is directly impacted by plant
spacing which is deﬁned as the distance between growing sites of two
consecutive plants (Abbasi et al., 2021b). In traditional agriculture,
crops compete with each other for resources, such as solar radiation, nu-
trients, and moisture uptake to gain energy for their growth, for which
they require reasonable root space and vegetative space (Zaman et al.,
2021). The inadequate plant spacing may lead to several problems.
For instance, the plants sited closely produce fewer leaves, ﬂowers,
and seeds, which causes reductions in ﬁnal crop yields. Moreover,
overcrowded plants are also susceptible to potential diseases, foliage
damage as crops mature, and invasion by unwanted pathogens
(Zaman et al., 2021). Many disease agents require a humid environment
to develop and in crowded plantations, reduced airﬂow prevents mois-
ture from evaporating from leaf surfaces, increasing the likelihood of
diseases. Similarly, excessive plant spacing can also be a problem, as it
hinders the pollination process. Unlike traditional agriculture, the as-
pect of plant spacing is different in the NFT-based aquaponics system.
The crop growing area (hydroponics) in the NFT system is a combina-
tion of enclosed channels consisting of circular or squared-shaped
pockets known as plant sites where plants reside in small plastic cups
allowing their roots to access water and absorb nutrient-enriched
efﬂuent from aquaculture (Abbasi et al., 2021b). Plant spacing in NFT
Artiﬁcial Intelligence in Agriculture 9 (2023) 76–88
⁎ Corresponding author.
E-mail address: raﬁq.ahmad@ualberta.ca (R. Ahmad).
https://doi.org/10.1016/j.aiia.2023.08.004
2589-7217/© 2023 The Authors. Publishing services by Elsevier B.V. on behalf of KeAi Communications Co., Ltd. This is an open access article under the CC BY-NC-ND license (http://
creativecommons.org/licenses/by-nc-nd/4.0/).
Contents lists available at ScienceDirect
Artiﬁcial Intelligence in Agriculture
journal homepage: http://www.keaipublishing.com/en/journals/artificial-
intelligence-in-agriculture/
systems refers to either distance between two plants on the same chan-
nel or the distance between plants on adjacent channels. The plant spac-
ing attribute on the same channel is normally ﬁxed and is designed
considering the full-grown size of the plant before the actual plantation.
The plant spacing attribute between channels is also kept ﬁxed in open-
air farms but in indoor NFT-based systems, it can be varied depending
on the crop type to efﬁciently utilize the limited space. In NFT systems,
all the nutrients are directly delivered to the crops' root system and
therefore, there is no competition for resources for the root system
(Syed Abreez Gillani et al., 2022a). However, vegetative space still re-
quires special attention as crops spend the most energy on vegetation
to absorb more light (Maboko and Du Plooy, 2009). Plant spacing varies
as a function of crop species and their morphological traits such as
length, width, area, and perimeter (Singh et al., 2022). Therefore, to
achieve maximum yields, the optimum plant spacing must be main-
tained according to crop type and its morphological characteristics. Ad-
ditionally, the crop growth cycle consists of various phases from
seedling to vegetative and in each phase the area of crop foliage changes
as it grows over time — requiring different plant spacing and illumina-
tion conditions (Nakarmi and Tang, 2012).
The aforementioned challenges pose a need for a self-adaptive
aquaponics system that determines the crop morphological traits,
determines the distance between two plants and adjusts the spacing
between channels. Traditionally, manual methods that require a high
level of expertise and advanced equipment were used to determine
morphological traits. These methods produce accurate results, but
they are costly, labour-intensive, and time-consuming (Triki et al.,
2021). To accelerate plant phenotyping, numerous semi-automatic
tools are developed such as LeafJ, Easy Leaf Area, and TraitEx (Easlon
and Bloom, 2014; Gaikwad et al., 2019; Maloof and Nozue, 2013). But
these tools require pre-processing of the input images for utilizing mul-
tiple automation degrees (Triki et al., 2021). To overcome the stated
bottleneck, this study aims to propose an approach to automatically
estimate morphological traits (foliage area, length, and width), the
distance between plants and effective plant spacing between adjacent
channels. Based on this information, the aquaponics system can adapt
itself by adjusting the position of grow channels. The proposed ap-
proach is deployed on a cloud-based application and integrated with
the ontology model proposed by authors in previous work (Abbasi
et al., 2021a).
2. Related work
With developments in deep learning and computer vision tech-
niques, several methods have been developed and instantly grown in
different visual recognition tasks such as the estimation of morphologi-
cal traits of crops (Abbasi et al., 2022). A review of some of the latest and
more relevant methods is presented here. Weaver et al. have proposed a
tool ‘LeafMachine’ based on CNN (convolutional neural network) and
SVM (support vector machine) to measure the leaf morphological traits
from digitized herbarium specimen images autonomously (Weaver
et al., 2020). Triki et al. used the same dataset and proposed a new
and enhanced approach ‘Deep Leaf’ based on Mask-RCNN (region-
based convolutional neural network), to determine the length, width,
area, and perimeter of leaves (Triki et al., 2021). Hirigoyen et al. devel-
oped a machine-learning model using SVM and RF (random forest)
techniques to determine the leaf area index in Eucalyptus plantations
(Hirigoyen et al., 2021). Lu et al. proposed a Mask R-CNN-based model
to determine the growth rate of lettuce crops as a function of leaf area
and time in a hydroponics system (Lu et al., 2019). Juyal (Gillani et al.,
2022a) et al. proposed a method to estimate the length and width of
trees for calculating the overall volume using Mask-RCNN (Juyal and
Sharma, 2020). Reyes et al. proposed a methodology to determine the
size of crops (height, width, depth, side view area, top view area) for
assessing the growth rate and fresh weight of crops using Mask-RCNN
(Reyes-Yanes et al., 2020). Even though the aforementioned methods
have made a great contribution to the research community, the analysis
shows that none of the studies has focused on using these traits as a key
feature to assess plant spacing. Hence, to complement the existing ef-
forts, this study proposed a new methodology to determine morpholog-
ical traits of lettuce crops grown in aquaponics facility and assess the
plant spacing between grow channels. Additionally, based on the capa-
bility of instance segmentation, Mask-RCNN is used to estimate the
morphological attributes in this study (Kang et al., 2020; Lu et al., 2019).
3. Research methodology
An automated system is developed to monitor the morphological
traits of the lettuce crop and estimate the plant spacing in the
aquaponics facility using deep learning techniques. The overall method-
ology is divided into ﬁve sequential modules: i) dataset preparation and
pre-processing; ii) model development and parameter estimation; iii)
model training and loss function calculation, iv) ontology modeling,
and v) cloud-based application development. Fig. 1 shows the complete
pipeline of this approach and details of all stages are explained in the
following subsections.
3.1. Dataset preparation and preprocessing
3.1.1. Data acquisition
For this study, a 12MP camera is used to capture images of thirty
lettuce plants grown in NFT based aquaponics facility situated at the
University of Alberta, Canada. Fifty images of 4032 × 3024 pixels are
captured every day, half (25 images) at 9:00 am and a half at 6:00 pm
from the top while keeping the distance between camera and channel
at a constant value of 40 cm throughout the plantation cycle, i.e., ﬁve
weeks. Each image contains two plants planted in adjacent channels.
There are six grow channels, each having ﬁve plant sites. The channels
are horizontally stacked, so the total number of plants in one of the
rows of adjacent channels is six. In total, 1750 images are collected
over 5 weeks and are saved in JPG format. Fig. 2 shows an example of
some of the images of lettuce from different growth stages.
The manual measurements of morphological traits such as length,
width, and height of 30 plants are also recorded twice a day at 9:00 am
and 6:00 pm for ﬁve weeks using a calliper. For the ground truth value
of foliage area, the number of pixels is counted manually by selecting
the area of interest in Adobe Photoshop which is then converted to
cm2. The area is also recorded twice a day at the given timings for ﬁve
weeks. As the plants grow, their area, length and width also increase,
consequently reducing the distance between two plants. This distance
needs to be measured throughout the plantation cycle to determine
the effective plant spacing and adjust the spacing between plants by
adjusting the distance between channels. The distance between chan-
nels is also used to determine the plant population and crop ﬁeld in an
NFT-based aquaponics system. The actual distance between plants is re-
corded for all the plants by taking manual measurements twice a day at
9:00 am and 6:00 pm for ﬁve weeks using a scale. In total, 50 distance
values are calculated every day for 30 plants growing on adjacent chan-
nels. All the manual measurements are saved in a common excel ﬁle.
3.1.2. Data augmentation
Next, an image augmentation process is performed to increase
the dataset size, avoid overﬁtting, and enhance the reliability of the
segmentation process despite the location and orientation of objects
in the image by generating new images from existing images. In this
study, Albumentations, a Python library is used for fast and ﬂexible
image augmentation (Buslaev et al., 2020). The different augmenta-
tion techniques applied are horizontal ﬂip, vertical ﬂip, 90° rotation,
and glass noise. In total, 250 images are selected randomly for the
augmentation, which created 250 new images — increasing the size
of the dataset to 2000 images. Fig. 3 shows an example of image
augmentation.
R. Abbasi, P. Martinez and R. Ahmad
Artiﬁcial Intelligence in Agriculture 9 (2023) 76–88
77
Fig. 1. Research methodology for estimating the morphological traits and effective plant spacing.
Fig. 2. Samples images from the aquaponics facility.
Fig. 3. Example of an augmented image.
R. Abbasi, P. Martinez and R. Ahmad
Artiﬁcial Intelligence in Agriculture 9 (2023) 76–88
To reduce the computation and running time of the training and
testing of the model, the sizes of all the images were scaled to
640 × 480. A total of 2000 images are used for the model training and
parameter optimization of Mask R-CNN, with 80% as the training set
and 20% at the validation set. For test data, a new batch of plants is
grown. After the training, the performance of the trained model is eval-
uated with a new set of images captured for the test dataset.
3.1.3. Data annotation
Data annotation is one of the vital steps for the successful develop-
ment of object detection models. The process is manual and involves la-
belling the desired objects in an image with a label or tag that refers to a
particular class. The labelled data is used during the training of the
model. There are many open-source annotation tools, but in this
study, VGG Image Annotator (VIA) is used (Dutta et al., 2019). In this
study, Mask-RCNN is used. The relevant regions of the image are
labelled, and the remaining region defaults to the background. Fig. 4
shows an example of ground truth bounding boxes and masks obtained
after data annotation.
3.2. Object detection and instance segmentation
After data collection, object detection and instance segmentation are
performed on crop images to achieve class, mask, and bounding box
values for lettuce foliage. In this study, Mask R-CNN is used which is a
state-of-the-art method in the ﬁeld of object segmentation. Instance
segmentation is a computer vision task for detecting and localizing an
object in an image through the identiﬁcation of boundaries at a detailed
pixel level (Yu et al., 2019).
3.2.1. Mask-RCNN training
NVIDIA GeForce RTX 3090 is used for training the Mask-RCNN. A
total of 2000 images are split into 80% for the training set and 20% for
the validation set. The Mask-RCNN is implemented in Detectron2 —
Facebook AI Research's next-generation library written in PyTorch
that provides state-of-the-art detection and segmentation algorithms.
Since the dataset is small, the pre-trained version of Mask-CNN (trained
on the COCO dataset) from the model zoo of the Detectron21 ‘Mask-
RCNN with ResNet-101 + FPN’ is applied using the transfer learning ap-
proach (Yu et al., 2019). The model is trained for 600 iterations with the
image input batch size given as 32. The initial learning rate is kept at
0.001 for the ﬁrst 100 iterations and is then adjusted per 100 iterations
with an adjustment factor of 0.95. The category scores, bounding boxes,
and masks of lettuce foliage for each input image are then obtained as
the outputs of the model. The training process is completed in around
1 h for 600 iterations and the model loss function achieved a conver-
gence state. The total loss of the proposed approach consists of two
parts: the loss of classiﬁcation and regression operations by RPN, and
the training loss in the multi-branch predictive network, and can be cal-
culated by using the formula Lﬁnal = LRPN + L mmulti_branch) (He et al.,
2017). Where (Lﬁnal) represents the total loss, (LRPN) represents the
training loss of the RPN (anchors classiﬁcation loss (SoftMax Loss) and
bounding box regression loss (SmoothL1 Loss)), and (Lmulti_branch)
represents the training loss due to the three-branch structure (SoftMax
Loss, SmoothL1 Loss, and Mask Loss). (LRPN) and (Lmulti_branch). The loss
function value and accuracy per iteration of the model for 600
iterations are shown in Fig. 5. The loss function is showing a
downward trend during the training process as can be seen in Fig. 5,
which means that the prediction loss deviation is gradually decreasing
by updating the loss function of the small sample batches during the
optimization process. The loss function values for both the training set
and validation set are reduced to less than 0.2 and tend to be stable
when the number of iterations is more than 550. This indicates that
the training of the model runs well, with a detection accuracy of
lettuce foliage of more than 0.98.
3.3. Crop morphological traits estimation model
From the instance segmentation process, the predicted mask and
bounding box of each instance are retrieved to determine lettuce mor-
phological traits such as foliage area, length, and width. In this case,
Fig. 4. Bounding boxes and masks after data annotation.
1 https://ai.facebook.com/tools/detectron2/.
R. Abbasi, P. Martinez and R. Ahmad
Artiﬁcial Intelligence in Agriculture 9 (2023) 76–88
79
there are two masks and two bounding boxes as each image consists of
two lettuce foliage. The foliage area of two lettuce plants is calculated by
extracting features from their respective predicted masks. The masks
are a set of matrices that contain pixels belonging to the area of a seg-
mented object (area of interest) which in this case are two lettuce fo-
liage. These pixels are retrieved from the prediction and further
processing is done to give this data useful meaning.
The distance between the camera and the object affects the pixel
count of the image. The closer the camera, the greater the number of
pixels of an object in an image and vice versa. Hence, in this study, the
distance between the camera and channel is kept ﬁxed at a value of
40 cm while taking the images and is denoted by (D). As we know,
the height of the lettuce increases throughout the plantation cycle and
affects the pixel count. To calculate the foliage area (Af), the height (h)
of the crop is also taken into account. At the end of the plantation
cycle, a boxplot is created shown in Fig. A1 of appendix A for the heights
of 30 lettuce plants recorded manually and a scatter plot is created
shown in Fig. A2 of appendix A using median values of plants' heights
to derive a linear regression relationship between height (h) and the
number of days (x), which is represented in Eq. 1.
h ¼ 0:2521x þ 2:9641
ð1Þ
To adequately measure the morphological traits, the relationship be-
tween real-world metrics, such as cm (centimeter) and actual pixel
count (pc) on the image should be identiﬁed. Triki et al. used a scale
bar object to determine this relationship (Triki et al., 2021). In this
study, the width of the channel (wc) which is known to be 10 cm is
used for this purpose. Eq. 2 shows the relationship between (wc) and
(pc).At a constant distance of (D) the relationships (k) and (k′)
between pixel count (pc) and channel width (wc) are given in Eqs. 3
and 4.
wc cm
ð
Þ ≡ pc pixels
ð
Þ
ð2Þ
k ¼ pc
wc
pixels
cm
�
�
ð3Þ
k′ ¼ pc
2
wc2
pixels
cm2
�
�
ð4Þ
Let (pm) is the pixel count of the predicted mask, which is
dependent on the height (h) of the plant. The height of the plant
changes throughout the plantation cycle and hence affects the pixel
count of the predicted mask. To compute foliage area (Af), Eq. 5 is
developed.
Af ¼ pm � h
k′ � D
ð5Þ
Next, bounding boxes are retrieved from the model in the form of
coordinates of opposite rectangle corners (top left (x1, y1) and bottom
right (x2, y2). These coordinates are used to calculate the approximate
width (Wf) and length (Lf) of foliage as shown in Fig. 6 using Eqs. 6
and 7 respectively.
Wf ¼ x2 � x1 pixels
ð
Þ
ð6Þ
Lf ¼ y1 � y2 pixels
ð
Þ
ð7Þ
The Eqs. 8 and 9 are developed for measuring the width and length
of foliage in real-world metric units (centimeter).
Wr ¼ Wf � h
k � D
ðcm
Þ
ð8Þ
Lr ¼ Lf � h
k � D
ðcm
Þ
ð9Þ
The above process is performed for two lettuce foliage in a
segmented image.
3.4. Mathematical model for plant spacing calculation
The most common conﬁgurations of plant spacing used for NFT
channels along with several dimensional characteristics are shown in
Fig. 5. Training losses, validation losses and accuracy per iteration.
R. Abbasi, P. Martinez and R. Ahmad
Artiﬁcial Intelligence in Agriculture 9 (2023) 76–88
80
Fig. 7. In conﬁguration 1, the plant sites on two adjacent channels are
in-line with each other and in conﬁguration 2, the plant sites are at
an angle. In this study, conﬁguration 1 is considered for a case study
but the proposed model can also be applicable to conﬁguration 2.
The plant spacing (S) is to be maintained on individual grow channels
as well as between the channels (S′) to avoid foliage occlusions and
overlapping which limit crop growth and affect crop quality. Generally,
while designing the aquaponics system, the plant spacing on the
channel, (S) and between channels (S′) is kept constant. The latter pa-
rameter can be controlled to make a self-adaptive aquaponics. In Fig. 7,
(S′) is the distance from the center of the plant site of one channel to
the center of the plant site of the adjacent channel and is given in
Eq. 10.
S′ ¼ wc1
2 þ wc2
2 þ s
ð10Þ
Where (wc1 = wc2), (wc1) is the width of channel 1, (wc2) is the
width of channel 2 and (s) is the distance between two adjacent
channels. The width of channels is constant whereas (s) is a dynamic
parameter. By changing (s), the horizontal channel spacing i-e., the dis-
tance between channels can be changed.
To compute the distance between plants automatically, the initial
and new values of (S′) and (s) are computed. Let (Sn−1
′
) and (sn−1)
refers to initial or previous values for (S′) and (s), respectively, and
(Sn′) and (sn) refers to new values for (S′) and (s), respectively.
Eqs. 11 and 12 represent the initial and new values of (S′).
S0
n−1 ¼ wc1
2 þ wc2
2 þ sn−1
ð11Þ
S0
n ¼ wc1
2 þ wc2
2 þ sn
ð12Þ
To compute (sn), an incremental parameter (si) is deﬁned, which
determines the variation in plant spacing due to changes in foliage
morphological traits. The incremental parameter (si) is calculated
using the Euclidean distance (d) between two bounding boxes achieved
through the prediction process shown in Fig. 8 and (Sn−1
′
). The
parameter (si) will only increment if (d) will be less than (Sn−1
′
) i-e., if
d < Sn−1
′
. The value of (d), on the other hand, is dependent on the
foliage area and length, which decreases as the area (Af) and length
(Lf) of foliage increases. Eqs. 13, 14 and 15 provide the relationship for
(d), (sn), and (si).
d ¼
ﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ
ðx1 � x2
Þ2 þ y1 � y2
ð
Þ2
q
ð13Þ
sn ¼ sn � 1 þ si
ð14Þ
si ¼ S′
n � 1 � d
ð15Þ
The new values for (S′) are then obtained by incrementing the
values of (s) using the above process for all plants' pairs in images and
converted to metric units (cm) using Eq. 2 The updated values of (s)
can be used to estimate plant population (PD) using the Eq. 16 proposed
by authors in previous work (Abbasi et al., 2021b).
PD ¼
NPSC � NC
L �
ðNC � W
Þ þ
ðNC � 1
Þ � HCS
ð
Þ
ð
ð16Þ
Where (NPSC) is the number of plant sites (circular or squared-
shaped pockets) per channel, (NC) is the total number of channels, L is
the length of each channel and is equivalent to (lc) shown in Fig. 7,
(W) is the width of each channel and is equivalent to (wcj) shown in
Fig. 7 (j = 1,2,3…..n), and (HCS) is horizontal channel spacing and
equivalent to (s).
3.5. Ontology model
The complete development and details of all the concepts and
instances of the ontology model ‘AquaONT’ developed by authors
in previous work are available (Abbasi et al., 2021a). AquaONT is
a uniﬁed ontology model that represents and stores the essential
knowledge
of
an
aquaponics
4.0
system.
It
consists
of
six
concepts: Consumer_Product, Ambient_Environment, Contextual_Data,
Production_System, Product_Quality, and Production_Facility. In this
Fig. 6. Dimensional characteristics of foliage.
Fig. 7. Dimensional characteristics of grow channels with respect to two conﬁgurations.
R. Abbasi, P. Martinez and R. Ahmad
Artiﬁcial Intelligence in Agriculture 9 (2023) 76–88
81
study, two classes, ‘Consumer Product’ and ‘Production_System’ are
used for knowledge extraction. The ‘Consumer Product’ class provides
an abstract view of the type, growth status, and growth parameters of
ready-to-harvest crops in an aquaponics system. Whereas the
‘Production_System’ class provides knowledge on design parameters
of the grow channels such as width, length and depth of channel and
size of the plant site on the channel (Abbasi et al., 2021b). Fig. A3 in
appendix A shows the hierarchical architecture of the ‘Consumer
Product’ and ‘Product Quality’ classes with their instances for the
‘Basil’ crop in Protégé2 (an open-source ontology editor and framework
developed at Stanford University) environment. The length and width
of the channels can be extracted from ontology to be used to determine
the plant spacing as well as the production capacity of the aquaponics
facility using Eq. 16.
3.6. Cloud-based application
A cloud-based application is developed using Streamlit, where
the ﬁnal versions of both models developed in sections 3.3 and 3.4
are deployed. The layout of the application is shown in Fig. A4 of ap-
pendix A. It consists of three tabs: i) Select model, ii) Upload image,
and iii) Determine morphological traits and plant spacing. The ﬁrst
and second tabs are user inputs where the model is selected, and
the image is uploaded respectively. The third tab activates the crop
morphological model and plant spacing model respectively. The on-
tology model is also deployed on a cloud-based application through
the Owlready2 library. Once, the morphological traits are estimated
and effective plant spacing is determined, the length of the channel
is extracted from the ontology model to determine plant population
and overall yield. Moreover, crop quality can also be assessed by
comparing the predicted morphological traits of lettuce and standard
values stored in the ontology model. This type of application is useful
as it provides access to remotely monitor and control the production
facility.
4. Results and ﬁndings
To validate the research methodology, a new batch of plants is
grown. The experimental setup used to capture the new dataset and
validation results and ﬁndings is presented in the following subsections.
4.1. Experimental setup
The experimental setup is built in Allfactory 4.0, an NFT-based
aquaponics facility situated at the University of Alberta, Canada, which
focuses on smart indoor farming (Martinez and Ahmad, 2018). The
aquaponics system is divided into ﬁve crop growth phases which repre-
sent the complete growth cycle of the crop. For this study, only phase 1
is considered, which consists of six horizontally stacked grow channels
and each channel has ﬁve plant sites. The length and width of each
channel are 125 cm and 10 cm respectively. The distance between the
center of plant sites (circular pockets) of two consecutive channels is
12 cm. A fresh batch of lettuce crop is grown for which ﬁfty seeds of Lit-
tle gem lettuce (Lactuca sativa L.) are placed in growth chambers with an
ambient temperature of 18 °C, relative humidity of 70%, and illumina-
tion of a 12-h (12 h light / 12 h dark) photoperiod (S.A. Gillani et al.,
2022b). Twenty-one days after sowing, 30 healthy lettuce seedlings
are transplanted in Rockwool cubes and placed in the six NFT channels
in phase 1. The seedings are placed in NFT-based hydroponic
systems for a period of ﬁve weeks (plantation cycle), after which each
lettuce is harvested. A wireless sensing module (WSM) consisting
of ﬁve sensors (pH, temperature, humidity, water temperature,
electroconductivity and light) is installed on system to monitor the
system and gather the sensor data. The complete development
and working of WSM is detailed in a previous work by the authors
Fig. 8. Calculation of distance between plants using bounding boxes.
2 https://protege.stanford.edu/products.php#desktop-protege.
R. Abbasi, P. Martinez and R. Ahmad
Artiﬁcial Intelligence in Agriculture 9 (2023) 76–88
82
(Reyes-Yanes et al., 2021). Moreover, the images are captured in a sim-
ilar fashion as discussed in section 3.1.1. But this time camera module
consisting of four ELP 1080P webcams (2.8–12 mm HD Varifocal Lens)
is used. All the webcams are attached at a distance of 40 cm and are
scheduled to take one picture per day for ﬁve weeks. In total, 8 plant
samples are chosen for images and each image contains two plants.
These plants are grown on adjacent channels and each day four pictures
are taken automatically. At the end of plantation cycle, there are 140 im-
ages which are then used for testing and evaluation of the proposed
models. The actual measurements for morphological traits and distance
between plants are recorded in similar manner as discussed in section
3.1.1. The actual values of plant spacing (S′) are also computed manually
using the actual distance between plants and formulas mentioned in
section 3.4.
4.2. Evaluation of trained mask-RCNN model
To evaluate the detection accuracy of the trained Mask-RCNN model,
the intersection over union (IoU) metric is used, which compares the
predicted detection with ground truth. IoU is the ratio of the area of
overlap between ground truth and predicted bounding boxes or
masks divided by the area encompassed by both the predicted
bounding box and the ground-truth bounding box (Yu et al., 2019).
For this purpose, the test dataset consisting of 140 images is used. The
(IoU) is calculated as follows:
IoU ¼ AT ∩ AD
AT ∪ AD
ð17Þ
Where (AT) and (AD) represent the target bounding box of the
ground truth and the detected bounding box from the model,
respectively. All 140 test images have shown (IoU) coefﬁcient of 0.9 or
above, indicating that there is a signiﬁcant overlap between the two
bounding boxes. Fig. 9 shows an example of an image showing
detection with (IoU) of above 0.9. The green bounding box is the
ground truth whereas the red bounding box is predicted by the
model. All the targets in the lettuce image are aimed to be detected
and marked with target category scores, bounding boxes, and instance
segmentation masks. The detection performance of the Mask-RCNN is
shown in Fig. 10. The ﬁnal model is then used for modeling foliage mor-
phological traits and plant spacing.
Fig. 9. Object detection by Mask-RCNN with the resulting IoU metric.
R. Abbasi, P. Martinez and R. Ahmad
Artiﬁcial Intelligence in Agriculture 9 (2023) 76–88
83
4.3. Evaluation of crop morphological model
To evaluate the crop morphological model, the length, width, and
area of lettuce foliage are computed from masks predicted by the
trained model for the test dataset. The actual and the measured values
for each morphological trait are compared. The increasing trend in the
morphological traits is observed — indicating the growing behavior of
the plants (increase in size). The estimation error between manual
and masked dimensions for each trait per plant is then measured
using root mean squared error (RMSE) using the formula given below.
RMSE ¼
ﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ
1
n ∑
k
j¼0
ðxj � yjÞ2
s
ð18Þ
Where (xj) is actual value, (yj) is the predicted value, Table 1 lists the
RMSE calculated using the above equation for each measurement per
plant. The test image set refers to a set of images taken throughout the
plantation cycle for one pair of plants (Foliage 1 and Foliage 2). The
test dataset in this study consists of four plant pairs. The minimum
error is observed which demonstrates that the trained model is reliable
for the calculation of the leaf area, length, and width in real-world sce-
narios.
4.4. Evaluation of plant spacing model
To evaluate the plant spacing model, ﬁrst, the distance between
bounding boxes of two instances (two plants per image) is computed
after instance segmentation is performed on images in the test dataset.
The plant spacing is then computed following the process mentioned in
section 3.4. The predicted values are then compared with actual mea-
surements, which indicates that plant spacing increases with an
increase in foliage area and length. Table 2 presents the RMSE for each
test image set. The lower RMSE values indicate the reliability of the
proposed model.
5. Discussion and future work
The objective of this study is to automatically measure the crop mor-
phological traits from the lettuce images acquired from the aquaponics
Fig. 10. Detection and instance segmentation of lettuce foliage.
Table 1
RMSE of manual and estimated measurements of morphological traits.
Test image set
Instance
Length, Lr(cm)
Width, Wr (cm)
Area, Af (cm2)
1
Foliage 1
1.1
1.8
3.35
Foliage 2
1.3
1.1
2.9
2
Foliage 1
0.95
1.5
3.1
Foliage 2
1.05
1.3
2.79
3
Foliage 1
1.27
0.99
3.2
Foliage 2
1.37
1.21
3.12
4
Foliage 1
1.31
1.32
3.23
Foliage 2
1.18
1.27
2.87
Table 2
RMSE of manual and estimated measurements of plant spacing.
Test image set
Instance 1
Instance 2
Plant spacing, S′ (cm)
1
Foliage 1
Foliage 2
1.1
2
Foliage 1
Foliage 2
0.95
3
Foliage 1
Foliage 2
1.27
4
Foliage 1
Foliage 2
1.31
R. Abbasi, P. Martinez and R. Ahmad
Artiﬁcial Intelligence in Agriculture 9 (2023) 76–88
84
facility and determine the effective plant spacing between grow
channels. The idea is to develop an approach that can lead to a
self-adaptive aquaponics system, where based on crop morphological
attributes, the grow channels adjust their positions effectively to ensure
high crop yield and quality by avoiding occlusions and foliage overlap-
ping. The presented work has used the Mask-RCNN algorithm to enable
a ﬁne-grained detection of lettuce foliage within the images and the
generation of a pixel-wise segmentation mask for each detected
instance. The segmentation masks distinguish foliage from the back-
ground and provide a mechanism to identify non-foliage classes,
such as channel, Rockwool cubes, etc., by considering their high
heterogeneity in form and texture.
The manual measurement of morphological traits is time-
consuming and labor-intensive. Even for an experienced agriculturalist,
it would take a signiﬁcant amount of time to measure all morphological
traits. The proposed approach can automatically estimate the morpho-
logical traits of lettuce foliage that vary in size and shape. Plant spacing
is one of the key features that impact crop growth. It is dependent on
crop type as well as crop morphological traits. In this study, plant spac-
ing is automatically measured for each segmented foliage using the
mathematical model.
The ﬁnal model is deployed on a cloud-based application and inte-
grated with the ontology model. The ontology model provides informa-
tion about crop characteristics and grow bed design parameters for a
variety of crops grown in NFT-based aquaponics. The application acts
as a decision support system, which analyses the results from the
models, compares them with the relevant knowledge from the ontology
model and suggests the ﬁnal action by sending a control signal to the
aquaponics facility for automatically adjusting the grow channels
based on the value of plant spacing predicted by the proposed model.
While promising results are achieved from the proposed models,
there is still scope for improvement. For instance, only one crop is con-
sidered in this study for the estimation of morphological attributes and
assessing the plant spacing between channels. Considering that, the po-
tential solutions for estimating the morphological attributes of multiple
crops will be investigated in future work. Subsequently, the dataset will
be increased with more image variations and other leafy green crops as
well as fruits, ﬂowers, and non-ﬂowering plants. Furthermore, the im-
pact of morphological traits on other design parameters of aquaponics
facility will also be studied.
6. Conclusion
In this study, an automatic tool is developed to predict the morpho-
logical traits of lettuce crops such as foliage area, length, and width
and estimate effective plant spacing for NFT-based aquaponics facility.
The results have shown that the growth of plants is estimated within
2 cm of error for both length and width, 4 cm for the area and
1.5 cm for plant spacing. The ﬁnal model is then deployed on a
cloud-based application and an ontology model is integrated with it.
The proposed method is accurate and ﬂexible and hence can easily be
applied in real scenarios. This contribution has great signiﬁcance to
the research community as it promotes the implementation of a self-
adaptive aquaponics system that can be constantly improved using
dynamic data. Moreover, the presented methods offer the opportunity
to rely on smart technologies for the application of new concepts such
as research on complex relationships between optimal parameters, and
detection of nutrient deﬁciency in crops using computer vision which
will pave the way for large-scale implementation of aquaponics
farming technology.
Declaration of Competing Interest
The authors declare that they have no known competing ﬁnancial
interests or personal relationships that could have appeared to inﬂu-
ence the work reported in this paper.
Acknowledgements
The authors acknowledge the ﬁnancial support of this work by the
Natural Sciences and Engineering Research Council of Canada (NSERC)
(Grant File No. ALLRP 545537-19 and RGPIN-2017-04516).
Appendix A. Appendix
Fig. A1. Boxplot showing variations in the heights of thirty plants over the period of thirty days.
R. Abbasi, P. Martinez and R. Ahmad
Artiﬁcial Intelligence in Agriculture 9 (2023) 76–88
85
Fig. A2. Variations in median heights of plants.
Fig. A3. Ontology model showing the instances of ‘Consumer_Product’ and ‘Production_System’ classes.
R. Abbasi, P. Martinez and R. Ahmad
Artiﬁcial Intelligence in Agriculture 9 (2023) 76–88
86
References
Abbasi, R., Martinez, P., Ahmad, R., 2021a. An ontology model to represent aquaponics 4.0
system’s knowledge. Inf. Process. Agric. https://doi.org/10.1016/J.INPA.2021.12.001.
Abbasi, R., Martinez, P., Ahmad, R., 2021b. An ontology model to support the automated
design of aquaponic grow beds. Proc. CIRP 100, 55–60. https://doi.org/10.1016/j.
procir.2021.05.009.
Abbasi, R., Martinez, P., Ahmad, R., 2022. The digitization of agricultural industry – a sys-
tematic literature review on agriculture 4.0. Smart Agric. Technol. 2, 100042. https://
doi.org/10.1016/J.ATECH.2022.100042.
Buslaev, A., Iglovikov, V.I., Khvedchenya, E., Parinov, A., Druzhinin, M., Kalinin, A.A., 2020.
Albumentations: fast and ﬂexible image augmentations. Inf. 11. https://doi.org/10.
3390/INFO11020125.
Crop Quality - An Overview|ScienceDirect Topics [WWW Document], 2021. URL https://
www.sciencedirect.com/topics/agricultural-and-biological-sciences/crop-quality
(accessed 7.13.21).
Dutta, A., International, A.Z.-P. of the 27th A. 2019, undeﬁned, 2019. The VIA Annotation
Software for Images, Audio and Video. dl.acm.org. , pp. 2276–2279. https://doi.org/
10.1145/3343031.3350535.
Easlon, H.M., Bloom, A.J., 2014. Easy leaf area: automated digital image analysis for rapid
and accurate measurement of leaf area. Appl. Plant Sci. 2, 1400033. https://doi.org/10.
3732/APPS.1400033.
Gaikwad, J., Triki, A., Bouaziz, B., 2019. Measuring morphological functional leaf traits
from digitized herbarium specimens using TraitEx software. J. Biodiver. Inform. Sci.
Stand. 3, e37091. https://doi.org/10.3897/biss.3.37091.
Fig. A4. Cloud-based application.
R. Abbasi, P. Martinez and R. Ahmad
Artiﬁcial Intelligence in Agriculture 9 (2023) 76–88
87
Gillani, S.A., Abbasi, R., Martinez, P., Ahmad, R., 2022b. Review on energy efﬁcient artiﬁcial
illumination in aquaponics. Clean. Circ. Bioecon. 2, 100015. https://doi.org/10.1016/J.
CLCB.2022.100015.
Gillani, Syed Abreez, Abbasi, R., Martinez, P., Ahmad, R., 2022a. Ontology-based interac-
tive learning approach for transdisciplinary teaching in learning factory. SSRN Elec-
tron. J. https://doi.org/10.2139/SSRN.4071925.
He, K., Gkioxari, G., Dollar, P., Girshick, R., 2017. Mask R-CNN. https://doi.org/10.1109/
ICCV.2017.322.
Hirigoyen, A., Acosta-Muñoz, C., Salamanca, Jesús Ariza, Ángeles Varo-Martinez, M.,
Rachid-Casnati, C., Franco, J., Navarro-Cerrillo, R., Salamanca, A.A., Má, V.-M., 2021.
A machine learning approach to model leaf area index in Eucalyptus plantations
using high-resolution satellite imagery and airborne laser scanner data. Ann. For.
Res 64, 165–183. https://doi.org/10.15287/afr.2021.2073.
Juyal, P., Sharma, S., 2020. Estimation of Tree Volume Using Mask R-CNN based Deep
Learning. 2020 11th Int. Conf. Comput. Commun. Netw. Technol. ICCCNT 2020.
https://doi.org/10.1109/ICCCNT49239.2020.9225509.
Kang, B.R., Lee, H., Park, K., Ryu, H., Kim, H.Y., 2020. BshapeNet: object detection and in-
stance segmentation with bounding shape masks. Pattern Recogn. Lett. 131,
449–455. https://doi.org/10.1016/J.PATREC.2020.01.024.
Lu, J.Y., Chang, C.L., Kuo, Y.F., 2019. Monitoring growth rate of lettuce using deep
convolutional neural networks. 2019 ASABE Annu. Int. Meet. 1. Doi: 10.13031/
AIM.201900341.
Maboko, M.M., Du Plooy, C.P., 2009. Effect of plant spacing on growth and yield of lettuce
(Lactuca sativa L.) in a soilless production system. S. Afr. J. Plant Soil. https://doi.org/
10.1080/02571862.2009.10639954.
Maloof, J., Nozue, K., M.M.-J, 2013. LeafJ: an ImageJ plugin for semi-automated leaf shape
measurement. J. Vis. Exp.(71), e50028. https://doi.org/10.3791/50028.
Martinez, P., Ahmad, R., 2018. All factory: An Aquaponics 4. 0 Transdisciplinary
Educational and Applied Research Learning Factory at the University of Alberta.
pp. 5–7.
Nakarmi, A.D., Tang, L., 2012. Automatic inter-plant spacing sensing at early growth
stages using a 3D vision sensor. Comput. Electron. Agric. 82, 23–31. https://doi.org/
10.1016/J.COMPAG.2011.12.011.
Reyes-Yanes, A., Martinez, P., Ahmad, R., 2020. Real-time growth rate and fresh weight es-
timation for little gem romaine lettuce in aquaponic grow beds. Comput. Electron.
Agric. 179, 105827. https://doi.org/10.1016/j.compag.2020.105827.
Reyes-Yanes, A., Gelio, S., Martinez, P., Ahmad, R., 2021. Wireless sensing module for IoT
aquaponics database construction. Int. J. Electron. Electr. Eng. 9, 43–47. https://doi.
org/10.18178/IJEEE.9.2.43-47.
Singh, S., Kumar, S., Singh, S.P., Yadav, Shatrunjay, Yadav, Sandeep, Singh, A., Awasthi,
M.K., 2022. Plant spacing and cultivar on quality attributes in sprouting broccoli. S.
Afr. J. Bot. 148, 737–741. https://doi.org/10.1016/J.SAJB.2022.04.049.
Triki, A., Bouaziz, B., Gaikwad, J., Mahdi, W., 2021. Deep leaf: mask R-CNN based leaf de-
tection and segmentation from digitized herbarium specimen images. Pattern
Recogn. Lett. 150, 76–83. https://doi.org/10.1016/J.PATREC.2021.07.003.
Weaver, W.N., Ng, J., Laport, R.G., 2020. LeafMachine: using machine learning to automate
leaf trait extraction from digitized herbarium specimens. Appl. Plant Sci. 8. https://
doi.org/10.1002/APS3.11367.
Yu, Y., Zhang, K., Yang, L., Zhang, D., 2019. Fruit detection for strawberry harvesting robot
in non-structural environment based on mask-RCNN. Comput. Electron. Agric. 163,
104846. https://doi.org/10.1016/J.COMPAG.2019.06.001.
Zaman, I., Ali, M., Shahzad, K., Tahir, M.S., Matloob, A., Ahmad, W., Alamri, S., Khurshid,
M.R., Qureshi, M.M., Wasaya, A., Baig, K.S., Siddiqui, M.H., Fahad, S., Datta, R., 2021. Ef-
fect of plant spacings on growth, physiology, yield and ﬁber quality attributes of cot-
ton genotypes under nitrogen fertilization. Agron 11, 2589. https://doi.org/10.3390/
AGRONOMY11122589.
R. Abbasi, P. Martinez and R. Ahmad
Artiﬁcial Intelligence in Agriculture 9 (2023) 76–88
88
