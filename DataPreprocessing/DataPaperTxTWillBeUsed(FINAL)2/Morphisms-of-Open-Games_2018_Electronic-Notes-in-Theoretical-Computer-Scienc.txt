Available online at www.sciencedirect.com


Electronic Notes in Theoretical Computer Science 341 (2018) 151–177
www.elsevier.com/locate/entcs
Morphisms of Open Games
Jules Hedges1
Department of Computer Science University of Oxford
Oxford, United Kingdom

Abstract
We define a notion of morphisms between open games, exploiting a surprising connection between lenses in computer science and compositional game theory. This extends the (perhaps more intuitively obvious) definition of globular morphisms as mappings between strategy profiles that preserve best responses, and hence in particular preserve Nash equilibria. We construct a symmetric monoidal double category in which the horizontal 1-cells are open games, vertical 1-morphisms are lenses, and 2-cells are morphisms of open games. States (morphisms out of the monoidal unit game) in the vertical category give a flexible solution concept that includes both Nash and subgame perfect equilibria. Products in the vertical category give an external choice operator that is reminiscent of products in game semantics, and is useful in practical examples. We illustrate the above two features with a simple worked example from microeconomics, the market entry game.
Keywords: game theory, open games, lenses, category theory, double categories


Introduction
Open games [9,11] provide a foundation to (economic) game theory that is strongly compositional. In general open games are pieces of games, such as decisions and payoff functions, that can be composed either sequentially or in parallel. Key to achieving compositionality is the step of viewing open games as the morphisms of a symmetric monoidal category. (This is an instance of the more general research programme of categorical open systems [7].)
However, there are reasons that one might also wish to view open games as the objects of a category. Most obviously, we would like to characterise certain open games using universal properties, in order to reason about them in a more abstract way. In this paper we define a general notion of morphisms between open games, which we call contravariant lens morphisms, and explore the resulting structure and applications.

1 Email: julian.hedges@cs.ox.ac.uk

https://doi.org/10.1016/j.entcs.2018.11.008
1571-0661/© 2018 The Author(s). Published by Elsevier B.V.
This is an open access article under the CC BY license (http://creativecommons.org/licenses/by/4.0/).

For a pair of open games of the same type, there is an obvious definition of morphism between them, which we call a globular morphism: a function between the sets of strategy profiles that preserves best responses, and hence in particular takes Nash equilibria to Nash equilibria. Contravariant lens morphisms are one of several possible generalisations of this to arbitrary pairs of open games, and heavily makes use of the factorisation of open games in terms of lenses (a concept from database theory and functional programming, due to [8]), a connection introduced in [12].
An example of an open game is depicted as a string diagram in figure 1. (Since this string diagram has trivial boundary, it denotes an abstract scalar, or endomorphism of the monoidal unit, in the category of open games.) This represents a 2-player game in which the first player P1 chooses x, then the second player P2 observes f (x) and chooses y, with utilities given by q(x, y): R2. Such string diagrams are formalised by a coherence theorem in [12]. This open game specifies the same best response relation (and in particular the same Nash equilibria) as the usual game-theoretic analysis as an extensive-form game of imperfect information, but is built compositionally from the open games representing the atomic pieces (P1, P2, f,q and various structural elements) of the diagram.
We prove (theorem 6.11) that open games and contravariant lens morphisms form a symmetric monoidal pseudo double category [22], the expected structure of 2-cells between arbitrary morphisms in a symmetric monoidal category. A contravariant lens morphism α : G → H between open games can be depicted as a square of the form
G
Φ  Ψ
Σ(G)

s(α)

Φj
⇓ Σ(α)
H
Σ(H)
t(α) Ψj

where Σ(α) : Σ(G) → Σ(H) is a function from strategy profiles of G to strategy profiles of H, and s(α) and t(α) are lenses between the types of G and H (which represent the ‘boundaries’ of G, H, or the ‘interfaces’ between game and environment). Double categories allow coherently pasting together squares like this both horizontally and vertically, and a monoidal double category has an additional tensor operation.


Fig. 1. Example open game

It is expected that morphisms of open games can also be represented as surface diagrams, cobordisms between the string diagrams representing the open games, and composition of morphisms as glueing surfaces. (More foundational work in 3-dimensional algebra is needed to fully justify this, however.) The long-term aim towards which we are working is to be able to reason about game-theoretic concepts using nothing but surface diagrams. Open games and globular morphisms moreover form a bicategory, but we argue by example that the more general double-categorical structure is useful.
There are many possible inequivalent definitions of morphisms between open games, and we argue in favour of contravariant lens morphisms in particular by identifying two attractive properties, as follows.
States of open games, that is morphisms out of the monoidal unit open game, provide a fully compositional solution concept that subsumes both Nash and subgame perfect equilibria in a flexible way. States of tensor products of decisions characterise Nash equilibria of normal-form games (theorem 7.11). States of particular sequential compositions characterise Nash equilibria of extensive-form games of perfect information, and furthermore, the categorical property of ⊙-separability of states characterises those Nash equilibria which are subgame perfect (theorem 8.2).
Categorical products of open games correspond to an external choice operator that is highly reminiscent of products in game semantics, and is useful in practical examples, whenever the game tree of an extensive form game is not perfectly balanced. As well as being interpretable as an external choice, products of open games share with products in game semantics the properties that strategies compose by cartesian product, and plays by disjoint union.
This paper culminates in a worked example that illustrates both of these aspects, in which we describe the market entry game, a simple but important example of game theory as applied to microeconomics. This game has ‘dependent subgames’, where two completely different things happen depending on an initial choice, which is typically a challenging feature to model for proposed formalisations of games. The combination of states and products of open games can be used to characterise the subgame perfect equilibria of this game in an elegant way.
An alternative definition of morphisms between open games is used in [10], in order to characterise infinitely repeated games as final coalgebras of a functor prepending one additional stage. Contravariant lens morphisms are inferior for this purpose, but on the other hand, the two attractive properties of contravariant lens morphisms identified are not shared by the morphisms of [10]. This suggests that there is no single, canonical notion of morphisms between open games, but at least two with different useful properties. It is expected, however, that all ‘reasonable’ definitions of morphisms between open games will form a symmetric monoidal double category, and will agree on globular morphisms (i.e. restrict to the same symmetric monoidal bicategory).
Outline. In section 2 we recall some basic definitions of game theory that we

will use. Section 3 is an introduction to open games. In section 4 we recall the categorical structure of lenses, define contravariant lens morphisms, and give some basic properties. In section 5 we prove that they form a double category, and in section 6 we extend this to a symmetric monoidal double category. Section 7 defines states (equilibria) of open games, and characterises Nash equilibria of normal form games, and section 8 extends this to Nash and subgame perfect equilibria of certain extensive form games of perfect information. Section 9 defines external choice as a product of open games using coproducts of lenses, and also incidentally discusses limits of lenses. Finally, section 10 contains a worked example, the market entry game, that illustrates the theory from the previous sections.
Omitted proofs are routine, although sometimes long.
Normal-form and extensive-form games
In this section we recall some basic definitions and results of game theory, which can be found in any standard textbook, such as [17].
Definition 2.1 An n-player normal form game consists of the following data:
A sequence of sets X1,..., Xn of choices for each player

n
i=1
given choices by each player
Xi → Rn, giving a real-valued payoff for each player

A (pure) strategy for player i in a normal form game is simply a choice σi : Xi,
and a (pure) strategy profile σ : Qn	Xi is a choice of strategy for each player.
The adjective ‘pure’ means ‘deterministic’, in contrast with ‘mixed’ or proba- bilistic strategies. The equivalence of strategies and choices characterises a normal form game as both deterministic and simultaneous: in the probabilistic setting a strategy is a probability distribution over choices, and in a dynamic (sequential) game a strategy is a function from observations to choices.

Given a tuple x : Qn	Xi, we write xi : Xi for the ith projection, x—i : Q
j/=i Xj

for the projection onto all but the ith component, and (xj,x  ): Qn

X for the

but is both useful and standard in game theory.)
Definition 2.2 Given a normal form game ((X )n  , k), let Σ = Qn	Xi be its
set of strategy profiles. We define the best response relation B ⊆ Σ × Σ by
(σ, σj) ∈ B iff for all players 1 ≤ i ≤ n and all xi : Xi, k σj, σ—i  ≥ (k (xi, σ—i)) .
i
A pure strategy profile is called a (pure) Nash equilibrium if it is a fixpoint of the
best response relation, that is, if (σ, σ) ∈ B.
Equivalently, σ is a Nash equilibrium iff for all players 1 ≤ i ≤ n and all unilat-
eral deviations xj : X , (k(σ)) ≥ k xj,σ   . In words, a Nash equilibrium is a
strategy profile in which no player can strictly increase their payoff by unilaterally deviating to another pure strategy. (‘Unilateral’ means that the strategy profiles of all other players remain fixed.)

In general Nash equilibria are not unique, and the question of how a group of players arrives at one Nash equilibrium out of many is a very subtle and difficult one that we do not address here. Pure Nash equilibria moreover need not exist at all: an example is the 2-player normal form game of matching pennies, which has X1 = X2 = {H, T} and payoff function
k(x, y)=	(1, 0)	if x = y
(0, 1)	if x /= y

(This should not be confused with mixed Nash equilibria, which famously always exist for finite games [18].)
Definition 2.3 An n-player game extensive form game is a tree where
Each non-leaf node is labelled by a player, who makes the decision at that node
Each leaf node is labelled by an n-tuple of real payoffs
Each edge is labelled by an action, such that no two outgoing edges of a single node are labelled by the same action
The nodes of the tree are partitioned into information sets
An information set is a nonempty set of nodes which are labelled by the same player, and have the same set of actions labelling their successors.
A game of perfect information is an extensive form game whose information sets are all singletons.
Small extensive-form games are usually depicted graphically as trees. We will see an example of this in section 10.
Definition 2.4 A strategy for a player i in an extensive-form game is a map that takes each information set x owned by player i, to a choice of action available at nodes in x. A strategy profile is a tuple of strategies for each player.
A strategy profile induces a play, which is a path from the root node to a leaf node. Plays are in bijection with leaf nodes, and so each strategy profile determines a payoff for each player.
Definition 2.5 Each n-player extensive form game induces an n-player normal form game called its normalisation or strategic form as follows. The set of choices for player i in the normalisation is defined to be the set of strategies for that player in the original game. The payoffs k are determined by the play associated to the strategy profile. A Nash equilibrium of an extensive form game is a strategy profile that is a Nash equilibrium of its normalisation.
Definition 2.6 A subgame of an extensive form game G is a subtree H with the property that if x is any node in H, then any node in G in the same information set as x is also in H. The subtree H inherits the structure of an extensive form game from G.

A subgame perfect equilibrium of an extensive form game is a strategy profile that restricts to a Nash equilibrium on every subgame.
(This definition implies that the root node of a subgame must be in a singleton information set.) We will see an example illustrating these definitions in section 10.
The remainder of this section considers a simplified special case of perfect information games, adapted from [5,6].
Definition 2.7 An n-player sequential game is an extensive-form game of perfect information, whose plays all have length n, in which at level i of the tree all choices are made by player i, and in which any two nodes at the same level have the same set of actions available.
The second condition implies that the tree of a sequential game is balanced. An
n-player sequential game is equivalently defined by sets X1,..., Xn of actions, and
a payoff function k : Qn	Xi → Rn. Subgames are in bijection with partial plays
x1,..., xi—1 for 1 ≤ i ≤ n. A strategy for player i is a function σi : Qi	Xj → Xi,

and a strategy profile is a tuple σ : Qn

i j=1

Xj → Xi .

Definition 2.8 Let (X )n
be a sequence of sets for n ≥ 1. Let 1 ≤ p ≤ q ≤ n.

i i=1
Q	 Q

we define a sequence vσ : Qn


X extending x, called the strategic extension of





(vσ)
=  xi	if i < q 

	 	 

With this notation, a strategy profile σ of a sequential game is a Nash equilibrium
iff
 k vσ σ i−1 ′	σ i−1   ≥ k vσ σ i−1
	
for all players 1 ≤ i ≤ n and deviations xi : Xi. It is a subgame-perfect equilibrium
iff for all players 1 ≤ i ≤ n, all partial plays x1,..., xi—1 and all deviations xi : Xi,


σ
x1,...,xi−1	i
σ
x1,...,xi−1,xi	i

Introduction to open games
Although we refer the reader to the (mainly pedagogical) paper [9] for an introduction to open games, in this section we give a basic overview. Although this paper does contain a complete definition of the category of open games, it would take too much space to reproduce the motivation and intuition behind it in detail.
Open games are the morphisms of a symmetric monoidal category whose objects are pairs of sets. An open game G : (X, S) → (Y, R) is a game-process containing some number of players (zero or more) who may partially observe the current state in X, and perform observable actions making up Y . These actions cause the players

to receive some utility from the set R, and they act in the ﬁrst place in order to optimise the utility that they will receive. Dually, the open game specifies coutility which is passed backwards, to be the utility for some player in the past.
Formally, an open game G : (X, S) → (Y, R) is a 4-tuple (ΣG, PG, CG, BG ), where:
ΣG is the set of strategy proﬁles
PG : ΣG × X → Y is the play function
CG : ΣG × X × R → S is the coplay function
BG : X × (Y → R) → P(ΣG × ΣG ) is the best response relation
A scalar open game is an open game with type (1, 1) → (1, 1). It can be seen that a scalar open game G is defined by a set ΣG and an endo-relation BG ⊆ ΣG × ΣG . A Nash equilibrium of a scalar open game is a strategy profile σ : ΣG with the property that (σ, σ) ∈ BG .
The idea of open games is to compositionally build best response functions for
complex situations in terms of best response functions for the constituent parts. An ordinary best response relation is an endo-relation on the set of strategy profiles. These cannot be composed, but an open game specifies a best response relation relative to a context (h, k): X × (Y → R), and these turn out to be compositional. The context consists of a history h : X, which says what happened in the past, and a continuation k : Y → R, which says what will happen in the future given the choices made in the present.
The other data, namely the play and coplay functions, are used when composing best responses. Of these, the play function PG : ΣG × X → Y is directly intuitive: it takes a strategy profile and an observation, and ‘runs’ the strategy profile on the observation to produce an action. The coplay function is rather less intuitive, and can be thought of as a formal trick to obtain compositionality.
One important example of an open game is a decision D : (X, 1) → (Y, R), an open game that represents a single decision made by an agent who observes an element of X and then chooses an element of Y in order to maximise a real number. D is defined as follows:
ΣQ = X → Y
PQ (σ, x)= σ(x)
CQ (σ, x, r)= ∗
BQ (h, k)= {(σ, σj): ΣG × ΣG | σj(h) ∈ arg max(k)}
Given open games G : (X, S) → (Y, R) and H : (Y, R) → (Z, Q), they can be composed to give an open game H ◦ G : (X, S) → (Z, Q) which represents the sequential play of G followed by H. Similarly, given G1 : (X1, S1) → (Y1, R1) and G2 : (X2, S2) → (Y2, R2), they can be tensored to give an open game G1 ⊗ G2 : (X1 ×X2, S1 ×S2) → (Y1 ×Y2, R1 ×R2), representing G1 and G2 played simultaneously. The definitions of the operators ◦ and ⊗ are quite involved to give directly, and will be given later in this paper once we have built up more machinery. These operators make open games into the morphisms of a symmetric monoidal category.

As with morphisms in any monoidal category, open games can be denoted by string diagrams, a powerful but intuitive graphical syntax. The ability to define a game by its string diagram, and read information about a game’s structure from its string diagram, is one of the most interesting features of the open game formalism. However in this paper we do not need string diagrams (this paper contains two string diagrams besides the illustration in the introduction, both immediately followed by the corresponding 4-tuple definition), and so we again refer the reader to [9] or [11].

Open games and morphisms
We briefly recall ideas from [12] on lenses. Given sets X, S, Y, R a bimorphic lens λ : (X, S) → (Y, R) consists of a view function vλ : X → Y and an update function uλ : X × R → S. We call a pair (X, S) a diset, and we refer to disets by Φ, Ψ, Θ.
The term bimorphic lens is proposed here by the author to distinguish it from the more familiar cases of monomorphic and polymorphic lenses. (The definition of polymorphic lens is the same, but interpreted in a polymorphic type system [19], and a monomorphic lens satisfies X = S and Y = R.) Both monomorphic and polymorphic lenses are usually restricted to those obeying certain axioms called the lens laws, but these do not make sense in general for bimorphic lenses, and indeed in compositional game theory we need to consider arbitrary bimorphic lenses.
There is a category BLens whose objects are disets and whose morphisms are bimorphic lenses, where the composition of λ : (X, S) → (Y, R) and μ : (Y, R) → (Z, Q) has has vμ○λ = vμ◦vλ and uμ○λ(x, q)= uλ(x, uμ(vλ(x), q)). There is an obvious symmetric monoidal structure on BLens given on disets by (X, S) ⊗ (Xj, Sj) = (X × Xj,S × Sj), with monoidal unit I = (1, 1). The view functor V : BLens → Set represented by I has V(X, S) ∼= X, and the continuation functor K : BLensop → Set represented by I has K(X, S) ∼= X → S. V is additionally a strong monoidal functor (for the cartesian monoidal category Set) and a fibration, and is the fibrewise opposite of Jacobs’ simple fibration [13, section 1.3]. The context functor C : BLens × BLensop → Set is defined on disets by C(Φ, Ψ) = V(Φ) × K(Ψ).
Equivalently, the category of lenses is an (intuitionistic) dialectica category over
a trivial (1-valued) logic. This construction is implicit in de Paiva’s early work such as [3], and more explicit in her later work on lineales, for example [4], although most of the discussion is about the slightly different linear dialectica categories.


Definition 4.1 Let Φ, Ψ be disets. An open game G : Φ −→' following data:
A set Σ(G) of strategy profiles
For every σ : Σ(G), a lens G(σ):Φ → Ψ
Ψ consists of the

For every c : C(Φ, Ψ), a best response relation B(c) ⊆ Σ(G) × Σ(G)
We call a pair c = (h, k) : C(Φ, Ψ) a context for G, where h : V(Φ) is the history and k : K(Ψ) the continuation. We also write s(G)=Φ and t(G)=Ψ for the source and target of G.

The equivalence between this definition and the more concrete definition in the previous section is easy to see. If Φ = (X, S) and Ψ = (Y, R) then the family of lenses G(σ) is the same as the play and coplay functions Σ(G) → (X → Y ), Σ(G) → (X × R → S). By the isomorphisms V(Φ) ∼= X and K(Ψ) ∼= Y → R, the best response relation can equivalently be written as a function X × (Y → R) → P(Σ(G) → Σ(G)). The constructions on open games given in the next two sections also agree with the concrete definitions in [9].

We note that given a pair of open games G, Gj :Φ −→' is an obvious way to define morphisms between them.
Ψ of the same type, there



Definition 4.2 Let G, Gj : Φ
−→'
Ψ be open games.  A globular morphism

α : G → Gj is a function Σ(α): Σ(G) → Σ(Gj) such that
G(σ)= Gj(Σ(α)(σ)) for all σ : Σ(G)
If (σ, σj) ∈ BG (c) then (Σ(α)(σ), Σ(α)(σj)) ∈ B ′ (c)

It is expected that all reasonable definitions of general morphisms between open games will agree on the globular morphisms. However it is demonstrated by example, both in this paper and in [10], that the more general morphisms are necessary. The morphisms we define in this paper are very different to those in [10], but indeed have the same globular morphisms.
The following definition is the key definition of this paper.


Definition 4.3 Let G :Φ −→'
Ψ and G : Φj −→'
Ψj be open games. A contravari-

ant lens morphism α : G → Gj consists of the following data:
Lenses s(α): Φj → Φ and t(α): Ψj → Ψ
A function Σ(α): Σ(G) → Σ(Gj) satisfying the following two axioms:
For all σ : Σ(G), the following diagram in BLens commutes:
G(σ)
Φ  Ψ
s(α)	t(α)

Φj  Ψj
Gj(Σ(α)(σ))
For all contexts (h, k): C(Φj, Ψ) and all strategy profiles σ, σj : Σ(G) such that
j	j
(σ, σ ) ∈ BG (s(α) ◦ h, k), we have (Σ(α)(σ), Σ(α)(σ )) ∈ BG′ (h, k ◦ t(α))

We call a pair (h, k): C(Φj, Ψ) a context for α.
We represent a contravariant lens morphism α : G → Gj as a square

G
Φ  Ψ
Σ(G)
s(α)	⇓ Σ(α)	t(α)
Gj
Φj	Ψj
Σ(Gj)
anticipating the double category structure.
Having done the work of representing open games in terms of lenses, this definition is almost automatic, but with one crucial twist: the lenses s(α) and t(α) go in the opposite direction to α. If they were covariant then the resulting definition would be similar to that of [10] and have many features in common, including the elegant representation of repeated games. However, we will demonstrate in this paper that the alternative definition has several attractive features. We give the definition the more specific name contravariant lens morphism to distinguish it from alternatives, but since this definition is the subject of this paper, we will simply refer to it as a morphism from now.
Proposition 4.4 Open games and morphisms form a category Game1, with iden- tities and composition lifted from Set and BLens.

Proposition 4.5 Let G, Gj : Φ −→'
Ψ be open games. Then globular morphisms

G → Gj as previously deﬁned are equivalent to morphisms α : G → Gj with s(α)= idΦ
and t(α)= idΨ.
This amounts to viewing globes (the shape of 2-cells in a bicategory) as squares whose sides have been ‘pinched together’.
Proposition 4.6 s, t : Game1 → BLensop and Σ: Game1 → Set are functors.
The double category of open games
A double category [14] is defined as an internal category object in the category of large categories and functors. (Compare to 2-categories, which are defined as categories enriched over categories.) Equivalently, a double category contains four sorts of things: objects, horizontal 1-cells, vertical 1-morphisms, and 2-cells. Given

a pair of horizontal 1-cells F : X −→'
Y , G : W −→'
Z, a 2-cell α : F → G consists

of a pair of vertical 1-morphisms f : X → W , g : Y → Z between the objects, and a square
F
X  Y
f	⇓ α	g G
W  Z

(Beware that there are two different conventions in use for orienting double categories. We follow the convention of [22].)
In this paper we are concerned with pseudo double categories, in which the vertical morphisms form a category, but the horizontal morphisms form a category only up to invertible 2-cells. Hence, there is a category of vertical morphisms and a bicategory of horizontal morphisms. In this paper we mostly follow the notation of [22], which gives an explicit definition of symmetric monoidal pseudo double categories. In this section we show that there is a pseudo double category whose objects are disets, horizontal 1-cells are open games, vertical 1-morphisms are reversed lenses, and 2-cells are contravariant lens morphisms.
Definition 5.1 Let Φ be a diset. We define an open game u(Φ) : Φ −→'	Φ by
Σ(u(Φ)) = 1, u(Φ)(∗)= idΦ and Bu(Φ)(c)= {(∗, ∗)} for all contexts c : C(Φ, Φ).
Proposition 5.2 For each lens λ : Φ → Ψ there is a morphism of open games u(λ) : u(Ψ) → u(Φ) deﬁned by s(u(λ)) = t(u(λ)) = λ and Σ(u(λ)) = id1. Then u deﬁnes a functor BLensop → Game1.


Definition 5.3 Let G :Φ −→'
Ψ and H :Ψ −→'
Θ be open games. The open game

H⊙ G :Φ −→'	Θ is defined by
Σ(H⊙ G)= Σ(G) × Σ(H)
(H⊙ G)(σ, τ )= H(τ ) ◦ G(σ)
((σ, τ ), (σj,τj)) ∈ BH⊙G (h, k) holds iff both (σ, σj) ∈ BG (h, k ◦ H(τ )) and (τ, τj) ∈
BH(G(σ) ◦ h, k)


G
Proposition 5.4 Let Φ −→'
H
Ψ −→'
Θ and Φ
j G′
−→'
j H′
Ψ −→'
Θj be open games, and let

α : G → Gj and β : H → Hj be morphisms such that t(α)= s(β). Then there is a morphism β ⊙ α : H⊙ G → Hj ⊙ Gj deﬁned by s(β ⊙ α)= s(α), t(β ⊙ α)= t(β) and Σ(β ⊙ α)= Σ(α) × Σ(β).
Proposition 5.5 ⊙ deﬁnes a functor Game1 ×BLensop Game1 → Game1, where the pullback is over
Game −→s  BLensop →t− Game
Proposition 5.6 There are globular natural isomorphisms a£,H,G : (I ⊙ H) ⊙G ∼= I⊙(H⊙G), lG : u(t(G))⊙G ∼= G and rG : G⊙u(s(G)) ∼= G, each over the corresponding structure morphism of the cartesian monoidal category Set.
Proposition 5.7 The above structures form a pseudo double category whose category of objects is BLensop and whose category of morphisms is Game1.
It follows immediately that open games and globular morphisms form a bicategory. The category Game from [9] is precisely the corresponding 1-category of 1-cells modulo globular isomorphism.

Monoidal structure
Proposition 6.1 Let Φ1, Φ2 be disets. Since V is a monoidal functor, we have projections
π1	π2
V(Φ1) →− V(Φ1 ⊗ Φ2) −→ V(Φ2)
Definition 6.2 Let Φ, Φj, Ψ, Ψj be disets. We define functions
L : homBLens(Φj, Ψj) → (C(Φ ⊗ Φj, Ψ ⊗ Ψj) → C(Φ, Ψ))
R : homBLens(Φ, Ψ) → (C(Φ ⊗ Ψj, Ψ ⊗ Ψj) → C(Φj, Ψj))
by
L(λj)(h, k)= (π1(h),k ◦ (Ψ ⊗ (λj ◦ π2(h))) ◦ r—1)
R(λ)(h, k)= (π2(h),k ◦ ((λ ◦ π1(h)) ⊗ Ψj) ◦ l—1)
These continuations are, more explicitly,


r−1
Ψ⊗π (h)
Ψ⊗λ′	k

Ψ −−Ψ→ Ψ ⊗ I −−−−2−→ Ψ ⊗ Φj −−−→ Ψ ⊗ Ψj −→ I


−1	′
j	′	j π1(h)⊗Ψ
j λ⊗Ψ′	j k

Ψ −−Ψ→ I ⊗ Ψ
−−−−−−→ Φ ⊗ Ψ
μ
−−−→ Ψ ⊗ Ψ
′
−→ I
′	′

κ	λ	j κ	j λ	j μ	j
Proposition 6.3 For all lenses Ξ −→ Φ −→ Ψ −→ Θ and Ξ −→ Φ −→ Ψ −→ Θ , the
following diagram commutes:
L(μj ◦ λj ◦ κj)	R(μ ◦ λ ◦ κ)
C(Ξ, Θ)  C(Ξ ⊗ Ξj, Θ ⊗ Θj)  C(Ξj, Θj)


C(κ, μ)	C(κ ⊗ κj, μ ⊗ μj)	C(κj, μj)


C(Φ, Ψ)
L(λj)
C(Φ ⊗ Φj, Ψ ⊗ Ψj)
R(λ)
C(Φj, Ψj)

Proof. The history component is straightforward, so we check the continuation component. Let h : V(Ξ ⊗ Ξj). By chasing a continuation k : K(Θ ⊗ Θj) around the diagram
K(Θ)  K(Θ ⊗ Θj)


K(μ)
K(μ ⊗ μj)


K(Ψ)  K(Ψ ⊗ Ψj)

we see that it suffices to prove that
(Θ ⊗ (μj ◦ λj ◦ κj ◦ π2(h))) ◦ r—1 ◦ μ = (μ ⊗ μj) ◦ (Ψ ⊗ (λj ◦ π2((κ ⊗ κj) ◦ h))) ◦ r—1
Ψ	Ψ
for commutativity of the left-hand square in the statement of the proposition. (The proof for the right-hand square is symmetric.)
Consider the diagram

r—1
Ψ ⊗ π2((κ ⊗ κj) ◦ h)
Ψ ⊗ λj

Ψ
Ψ	Ψ ⊗ I

Ψ ⊗ π2(h)
Ψ ⊗ Φj
Ψ ⊗ Ψj

μ	μ ⊗ I
Ψj Ψ ⊗ Ξ
⊗ κj
μ ⊗ Φj
μ ⊗ Ψj
Θ ⊗ Θj


—1
Θ
Θ	Θ ⊗ I
Θ ⊗ π2(h)
μ ⊗ Ξj Θ ⊗ Ξj


Θ ⊗ Φj Θ ⊗ κj

Θ ⊗ λj


Θ ⊗ Ψj
Θ ⊗ μj

Commutativity of the top triangle follows by chasing h around the right-hand square of the V part. The left-hand square is naturality of r—1, and the other cells are functorality of ⊗.	2

Definition 6.4 Let G1 : Φ1 −→'
Ψ1 and G2 : Φ2 −→'
Ψ2 be open games. We define

an open game G1 ⊗ G2 : Φ1 ⊗ Φ2 −→'
Σ(G1 ⊗ G2)= Σ(G1) × Σ(G2)
Ψ1 ⊗ Ψ2 by

(G1 ⊗ G2)(σ1, σ2)= G1(σ1) ⊗ G2(σ2)
((σ1, σ2), (σj , σj )) ∈ BG ⊗G (c) iffboth (σ1, σj ) ∈ BG (L(G2(σ2))(c)) and (σ2, σj ) ∈
1	2	1	2	1	1	2
BG2 (R(G1(σ1))(c))
Proposition 6.5 Let α1 : G1 → Gj and α2 : G2 → Gj be morphisms of open games.

Then there is a morphism α1 ⊗ α2 : G1 ⊗ G2 → Gj ⊗ Gj
deﬁned by s(α1 ⊗ α2) = 

1	2
s(α1) ⊗ s(α2), t(α1 ⊗ α2)= t(α1) ⊗ t(α2), and Σ(α1 ⊗ α2)= Σ(α1) × Σ(α2).
Proposition 6.6 ⊗ deﬁnes a functor Game1 × Game1 → Game1. Proposition 6.7 There are natural isomorphisms αG,H,£ : (G⊗H)⊗I ∼= G⊗(H⊗I),
λG : u(I) ⊗G ∼= G, ρG : G⊗u(I) ∼= G and sG,H : G⊗H ∼= H⊗G, equal to the structure
morphisms of the symmetric monoidal category BLensop × Set × BLensop.
Proposition 6.8 Game1 is a symmetric monoidal category.
Proposition 6.9 s, t : Game1 → BLensop and Σ : Game1 → Set are strict symmetric monoidal functors.
Proposition 6.10 There are globular isomorphisms
UΦ1,Φ2 : u(Φ1 ⊗ Φ2) −=→ u(Φ1) ⊗ u(Φ2)

XG ,G ,H ,H  : (H ⊗ H ) ⊙ (G ⊗ G ) −=→ (H ⊙ G ) ⊗ (H ⊙ G )
Proof. We check the second of these. Take
ΣX : (Σ(G1) × Σ(G2)) × (Σ(H1) × Σ(H2)) → (Σ(G1) × Σ(H1)) × (Σ(G2) × Σ(H2)),
((σ1, σ2), (τ1, τ2)) '→ ((σ1, τ1), (σ2, τ2))
The first axiom follows from bifunctorality of ⊗ on BLens:
(H1(τ1) ⊗ H2(τ2)) ◦ (G1(σ1) ⊗ G2(σ2)) = (H1(τ1) ◦ G1(σ1)) ⊗ (H2(τ2) ◦ G2(σ2))


G1
Write Φ1 −→'

H1
Ψ1 −→'

G2
Θ1 and Φ2 −→'

H2
Ψ2 −→'
Θ2. For the second axiom we calculate:

(((σ1, σ2), (τ1, τ2)), ((σj , σj ), (τj ,τj ))) ∈ B(H ⊗H )⊙(G ⊗G )(c)

1	2	1  2
1	2	1	2

⇐⇒ ((σ1, σ2), (σj , σj )) ∈ BG ⊗G (C(Φ1 ⊗ Φ2, H1(τ1) ⊗ H2(τ2))(c))
1	2	1	2
and ((τ1, τ2), (τj ,τj )) ∈ BH ⊗H (C(G1(σ1) ⊗ G2(σ2), Θ1 ⊗ Θ2)(c))
1  2	1	2

⇐⇒ (σ1, σj ) ∈ B (L(G (σ ))(C(Φ
⊗ Φ , H (τ ) ⊗H (τ ))(c)))

1	G1	2	2
1	2	1  1	2  2

and (σ2, σj ) ∈ B (R(G (σ ))(C(Φ
⊗ Φ , H (τ ) ⊗H (τ ))(c)))

2	G2	1	1
1	2	1  1	2  2

and (τ1,τj ) ∈ B	(L(H (τ ))(C(G (σ ) ⊗G (σ ), Θ
⊗ Θ )(c)))

1	H1	2  2
1	1	2	2	1	2

and (τ2,τj ) ∈ B	(R(H (τ ))(C(G (σ ) ⊗G (σ ), Θ
⊗ Θ )(c)))

2	H2	1  1
1	1	2	2	1	2

⇐⇒ (σ1, σj ) ∈ B
(C(Φ , H (τ ))(L(H (τ ) ◦G (σ ))(c)))

1	G1
1	1  1
2  2	2	2

and (τ1,τj ) ∈ B
(C(G (σ ), Θ )(L(H (τ ) ◦G (σ ))(c)))

1	H1
1	1	1
2  2	2	2

and (σ2, σj ) ∈ B
(C(Φ , H (τ ))(R(H (τ ) ◦G (σ ))(c)))

2	G2
2	2  2
1  1	1	1

and (τ2,τj ) ∈ B
(C(G (σ ), Θ )(R(H (τ ) ◦G (σ ))(c)))

2	H2
2	2	2
1  1	1	1

⇐⇒ ((σ1, τ1), (σj ,τj )) ∈ BH ⊙G (L(H2(τ2) ◦ G2(σ2))(c))
1  1	1	1
and ((σ2, τ2), (σj ,τj )) ∈ BH ⊙G (R(H1(τ1) ◦ G1(σ1))(c))
2  2	2	2
⇐⇒ (((σ1, τ1), (σ2, τ2)), ((σj ,τj ), (σj ,τj ))) ∈ B(H ⊙G )⊗(H ⊙G )(c)

1  1	2  2
1	1	2	2

The relevant equalities between contexts, which all follow from proposition 6.3, are summarised in figure 2.	2

Theorem 6.11 Disets, open games and morphisms form a symmetric monoidal pseudo double category.
Having obtained a higher-dimensional categorical language that is fully composi- tional and has the potential to be graphical, the next step is to formalise interesting game-theoretic concepts using this language. This is the subject of the remainder of this paper.
States of open games
Definition 7.1 Let G : Φ −→'	Ψ be an open game. A state of G is a pair (σ, k)
where σ : Σ(G) and k : K(Ψ) with the property that for all h : V(Φ), (σ, σ) ∈ BG (h, k).




C(Φ1 , Ψ1 )

L(G2 (σ2 ))

C(Φ1 ⊗ Φ2 , Ψ1 ⊗ Ψ2 )
R(G1 (σ1 ))

C(Φ2 , Ψ2 )



C(Φ1 , H1 (τ1 ))
C(Φ1 ⊗ Φ2 , H1 (τ1 ) ⊗ H2 (τ2 ))
C(Φ2 , H2 (τ2 ))




C(Φ1 , Θ1 )

L(H2 (τ2 ) ◦ G2 (σ2 ))

C(Φ1 ⊗ Φ2 , Θ1 ⊗ Θ2 )
R(H1 (τ1 ) ◦ G1 (σ1 ))

C(Φ2 , Θ2 )



C(G1 (σ1 ), Θ1 )
C(G1 (σ1 ) ⊗ G2 (σ2 ), Θ1 ⊗ Θ2 )
C(G2 (σ2 ), Θ2 )




C(Ψ1 , Θ1 )

L(H2 (τ2 ))

C(Ψ1 ⊗ Ψ2 , Θ1 ⊗ Θ2 )
R(H1 (τ1 ))

C(Ψ2 , Θ2 )


Fig. 2. Instances of proposition 6.3 used in proof of proposition 6.10

We also say that σ is a state of G over k. We write S(G) for the set of states of G.
Informally, a state consists of a choice of continuation and a choice of strategy that is a Nash equilibrium for that continuation, for all histories. As we will see, this combines aspects of Nash and subgame perfect equilibria in a flexible way. The definition of states is a weakening of the definition of solution considered in [11, section 3.3], in which σ may depend on k, but not on h. The latter is more game-theoretically plausible (because many open games have interesting solutions in this stronger sense), but is incompatible with ⊗ and hence not fully compositional. The definition of state is intended as a compromise between game-theoretic usefulness and compositionality.
Proposition 7.2 Let α : G → Gj be a morphism of open games, and let σ be a state of G over k. Then Σ(α)(σ) is a state of Gj over k ◦ t(α). Thus we have a function S(α): S(G) → S(Gj).
Proof. Let h : V(s(Gj)). Since σ is a state of G over k, we have (σ, σ) ∈ BG (s(α) ◦
h, k). Since α is a morphism, it follows that (Σ(α)(σ), Σ(α)(σ)) ∈ BG′ (h, k ◦ t(α)).2
Proposition 7.3 S deﬁnes a functor Game1 → Set. Proposition 7.4 S ∼= homGame (u(I), −).
Proof. States (σ, k) of G are in bijection with morphisms α : u(I) → G, as follows. There is a unique choice s(α) = k ◦ G(σ) satisfying the first axiom. Since by definition (∗, ∗) ∈ Bu(I)(c) for the unique c : C(I, I), and all contexts for α are of the form (h, idI ) for h : V(Φ), the second axiom is equivalent to the condition that (σ, σ) ∈ BG (h, k) for all h : V(Φ).	2
This is summarised in the diagram



I

k ◦ G(σ)
u(I)
1	I
⇓ σ	k
G

Φ  Ψ
Σ(G)
Noting that u(I) is the monoidal unit of Game1, states of open games are indeed states in the more general sense of monoidal categories.
It does not appear to be possible to define states in a reasonable way using only the bicategory structure. The problem is that because the double category of open games is not a framed bicategory [21], we cannot represent a non-globular 2-cell by a globular one.
By this representation, we immediately obtain definitions of ⊙ and ⊗ for states, as described by the following two propositions.
Proposition 7.5 Let G1 and G2 be open games. Let σ1 be a state of G1 over k1, and let σ2 be a state of G2 over k2. Then (σ1, σ2) is a state of G1 ⊗ G2 over k1 ⊗ k2.
Proposition 7.6 (Backward induction) Let G and H be open games with t(G)= 
s(H). Let τ be a state of H over k, and let σ be a state of G over k ◦ H(τ ). Then
(σ, τ ) is a state of H⊙ G over k.
As its name suggests, the previous result is similar to the backward induction method of game theory, although in a far more general form. The intuition is that we first fix the strategy profile τ of H, and then players in G reason as though players in H play τ .

Definition 7.7 An open game G : Φ −→' satisfies the following two properties:
Σ(G) ∼= 1
(∗, ∗) ∈ BG (c) for all contexts c : C(Φ, Ψ)
Ψ is called strategically trivial if it

Since a strategically trivial open game G : Φ −→'	Ψ is defined up to globular
isomorphism by its lens G(∗):Φ → Ψ, the (horizontal) subcategory of strategically trivial games is isomorphic to BLens. Given a lens λ :Φ → Ψ, we abuse notation
and write λ : Φ −→'	Ψ for the corresponding strategically trivial open game. In
particular, for functions f : X → Y and g : R → S we have a strategically trivial

open game (f, g) : (X, S) −→' trivial open game ε : (X, X) −→' function uε(x, ∗)= x.
Proposition 7.8 Let G :Φ −→'
(Y, R), and for each set X there is a strategically
I corresponding to the counit lens [12] with update

Ψ be a strategically trivial game. Then for every

continuation k : K(Ψ), G has exactly one state over k. In particular, a strategically
trivial game G :Φ −→'	I has a unique state.
Note that the strategically trivial games (X, S) −→'	I are ‘internal continuations’,

and are in bijection with functions X → S. These include the utility functions of game theory. (A morphism to the monoidal unit in a monoidal category is sometimes called an effect.)
The following family of open games represents a rational agent making a choice from Y after observing an element of X. It is the main building block, besides strategically trivial open games, from which examples are built in practice.
Definition 7.9 For all sets X and Y we define an open game DX,Y : (X, 1) −→' (Y, R) (where R is the set of real numbers, interpreted as utility) called a decision, as follows:
Σ(DX,Y )= X → Y
DX,Y (σ) is the unique lens (X, 1) → (Y, R) with V(DX,Y (σ)) = σ
(σ, σj) ∈ BQ	(h, k) iff k(σj(h)) ≥ k(y) for all y : Y
(Notice that this is a constant relation, which is characteristic of 1-player open games. Best response only becomes a nontrivial relation when more than one player interacts strategically.)
Proposition 7.10 Let X, Y be sets and k : Y → R. Then there is a bijective correspondence between
States of DX,Y over k
	Functions X → arg max(k), where arg max(k) ⊆ Y is the set of maximising points of k
In particular, if Y is ﬁnite then DX,Y has at least one state over every k.
Proof. The pair (σ, k) is a state of DX,Y iff k(σ(x)) ≥ k(y) for all x : X and y : Y , which is equivalent to the range of σ being arg max(k).	2
The following theorem and its proof are essentially restatements of [11, sections
3.1.2 – 3.1.4]. This is one of the key connections between open games and classical game theory, characterising tensor products of decisions as normal form games.
Theorem 7.11 Let Y1,..., Yn be an indexed family of sets for n ≥ 1, and let

n i=1
Yi → Rn be a function. Then there is a bijective correspondence between

States of  n
D1,Yi
over k

Pure Nash equilibria of the n-player normal form game with outcome function k
Proof. We can prove by induction on n that the open game

 i=1
D1,Yi
: I −→'
n
i=1
Yi, Rn

is concretely given, up to unique natural isomorphism, as follows.

Its set of strategy profiles is

Σ

The lens


n i=1



D1,Yi


=	Yi
i=1



is the unique one with
n

i=1
D1,Yi
(σ): I →
n

i=1
Yi, Rn

V
The best response relation
n

i=1
D1,Yi
(σ)	= σ


j
n
i=1
holds iff, for all 1 ≤ j ≤ n and all yj : Yj ,


Q1,Yi
(∗, k)

(k(σj ,σ	)) ≥ (k(y ,σ	))
j	—j  j	j	—j  j

The theorem follows from this, since the set of strategy profiles of  n

D1,Yi
is the set

of pure strategy profiles of the normal form game, and fixpoints of B n
i=1
Q1,Yi
(∗, k)

are Nash equilibria by definition.	2
Note that if α1 is a state of DI,Y1 over k1 and α2 is a state of DI,Y2 over k2 then α1 ⊗ α2 is a state of DI,Y1 ⊗ DI,Y2 over k1 ⊗ k2. However, the continuation k1 ⊗ k2 corresponds to a function Y1 × Y2 → R2 that is ‘separable’, in the sense that (k1 ⊗ k2)(y1, y2) = (k1(y1), k2(y2)), and hence the ⊗-separable states can only be equilibria of these separable games. Such games are game-theoretically trivial in the sense that there is no strategic interaction between players, and so a game degenerates into a tuple of independent maximisation problems. Only the ⊗-inseparable states of tensor products of decisions correspond to nontrivial Nash equilibria. More generally, computational hardness results from algorithmic game theory, such as hardness of
computing mixed ϵ-Nash equilibria [20], intuitively suggest there are inescapable limits on what it will be possible to achieve by compositional methods.
Backward induction
The previous theorem characterised Nash equilibria of normal form games in terms of states of open games. In this section we do the same to Nash and subgame perfect equilibria of extensive form games of perfect information.
Definition 8.1 Let n ≥ 1 and let X1,..., Xn be a sequence of sets. We define an open game

X1,...,Xn :
n—1

i=1
Xi, Rn—1
−→'
n

i=1
Xi, Rn

by the algebraic expression



 Yn


!	⎛⎛nY−1	⎞

		
,	n−1 ⎞


n−1 


This expression is visualised as a string diagram in figure 3.




n—1
Xi
i=1
Rn—1






D n−1
i=1	i  n
n—1
Xi
i=1
Xn Rn—1 R

Fig. 3. Definition of QΔ
1	n
in terms of Q
Qn−1 X ,X


We now come to one of the key results of this paper: For an extensive form game, Nash equilibria correspond to states in general, and subgame perfect equilibria correspond to ⊙-separable states. Using this, we can use the category-theoretic notion of ⊙-separability (which could moreover be visible in a surface diagram as a glued boundary) to deﬁne the game-theoretic notion of subgame perfection for general open games. We state and prove the theorem for the special case of finite sequential games [6] for simplicity.
Theorem 8.2 Let X1,..., Xn be an indexed family of sets for n ≥ 1, and let

n i=1
Xi → Rn. Then there is a bijective correspondence between:

States of  n
Δ
X1,...,Xi
over k

Pure Nash equilibria of the n-player sequential game with outcome function k
Moreover there is a bijective correspondence between:

States of  n
Δ
X1,...,Xi
over k that are of the form  n
αi, where each αi
is a

Δ
X1,...,Xi
Subgame perfect equilibria of the n-player sequential game with outcome function
k


Proof. It is routine to calculate that DΔ
is concretely given as follows:

The set of strategy profiles is
 

 



n—1
	 


For σ : Qn—1 Xi → Xn, the lens



Δ
X1,...,Xn
n—1
(σ): 
i=1

Xi, Rn—1
n
→
i=1
Xi, Rn



is given by

and


v	Δ
X1,...,Xn


u QΔ

 (σ)(x)= (x, σ(x))

 (σ)(x, r)= r—n

(σ, σj) ∈ B

Δ
X1,...,Xn
X1,...,Xn
(h, k) holds iff

(k(h, σj(h)))n ≥ (k(h, xn))n

for all xn : Xn.
For 1 ≤ p ≤ q ≤ n, a sequence x : Qq—1 Xi and a sequence of functions
σ : Qn	 Qi—1 Xj → Xi , we define a sequence vσ : Qn	Xi extending x, called


(vσ)
=  xi	if i < q 

	 	 

When p = q = 1, and hence x is the empty sequence, we write vσ. This is called the
strategic play of σ.
Let

GX1,...,Xn

=
i=1
Δ
X1,...,Xi
: I −→'
n

i=1
Xi, Rn

We prove by induction on n that GX1,...,Xn is given explicitly as follows, up to globular isomorphism.
The set of strategy profiles is


n
Σ(GX1,...,Xn )= 
i=1

i—1
⎝j=1
Xj → Xi⎞⎠

For σ : Σ(GX ,...,X ), the lens GX ,...,X (σ) is the unique one with
V(GX ,...,X  (σ))(∗)= vσ

For k : Qn
Xi → Rn, the best response relation
(σ, σj) ∈ B	(∗, k)
X1,...,Xn


u(I)	u(I)









n−i−1
⎝









Xj










n−i−1








j









n	⎛j−1	⎞
k






j, R





n ⎞⎠

j=1
Y X → X


j=1
Y	⎝ Y X → X ⎠

 
j=1


Fig. 4. Inductive step of theorem 8.2
holds iff for all 1 ≤ i ≤ n and all xi : Xi,


 k vσ σ i−1 ′


σ i−1 

≥ k vσ σ i−1

The first part of the theorem follows from this.
Next we prove by induction on i that there is a bijective correspondence between:
States α of

	⎛n —i
n—i⎞
⎛ n	⎞


j=n—i+1
DX1,...,Xj : ⎝

j=1
Xj, R
⎠ −→'
⎝j=1
Xj, R ⎠

over k : Qn	Xj → Rn that are of the form





where each αj is a state of DΔ


α =	αj
j=n—i+1

Strategy profiles


(σ)n
X1,...,Xj


:	 


j—1
→ X

n—i+1	l	j
j=n—i+1	l=1
with the property that for all j ≥ n − i + 1, all partial plays x : Qj—1 Xl and all

deviations xj : Xj ,

σ
x,σj (x)

≥ k vσ
	


The second part of the theorem follows by taking i = n.
For the inductive step, a ⊙-separable state α of  n

Δ
X1,...,Xj
is of the form

α = αj ⊙ αn—i, where αn—i is a state of DΔ
and αj is a ⊙-separable state of

n j=n—i+1
Δ
X1,...,Xj
. This situation is depicted in figure 4.	2

In standard game theory, the representation of a game is typically dissociated from its analysis. On any game of a given class (for example extensive-form games)

one can define a variety of solution concepts (for example pure Nash equilibrium, subgame perfect equilibrium, mixed Nash equilibrium, ϵ-Nash equilibrium, sequential equilibrium). A curious fact about open games is that the representation of a model as an open game automatically ‘builds in’ a particular solution concept, namely pure Nash equilibrium. This is because the ⊙ and ⊗ operators make essential use of Nash-like reasoning, in which the players in each component act as though they know which strategies will be played in the other component.
In particular, it has proven to be difficult to characterise subgame perfect equi- libria, despite the fact that the representation of open games appears to be dynamic (that is, has a temporal component; subgame perfect equilibrium is specifically intended for dynamic games). A failed attempt was made in [11] by modifying the operator ⊙, there called ◦SP , but it fails to form a symmetric monoidal category with ⊗, and hence does not support a string diagram language. (See the conclusion section of [11].)
A direct solution is given in [10] by defining a ‘subgame perfection operator’ that modifies an open game’s solution concept from Nash to subgame perfect equilibrium. From a practical perspective their solution is similar to the one in this paper, offering flexibility between Nash and subgame perfect equilibrium. Ours has the specific advantage that it separates the representation of a game from its analysis, as in standard game theory, although at the expense of requiring far more mathematical machinery.

External choice

Proposition 9.1 For each set S, (−, S): Set → BLens preserves colimits.
Proof. For each set S, there is a functor FS : BLens → Set given on disets by FS (Y, R) = Y × (R → S), and on lenses λ : (X, R) → (Y, Q) by FS (λ)(x, k) = (vλ(x), kj) where kj(q) = k(uλ(x, q)). Then (−, S) E FS , since there are natural isomorphisms
homBLens((X, S), (Y, R)) = (X → Y ) × (X × R → S)
∼= X → Y × (R → S)
= homSet(X, FS (Y, R))
Since (−, S) is a left adjoint, it preserves colimits.	2
In particular, BLens has coproducts of the form i:I (Xi, S) = ( i:I Xi, S). (This construction is mentioned in [3, section 1.3].) (1, 0) is terminal in BLens. Additionally (−, −) is right adjoint to the universal functor ⟨V, K⟩ : BLens → Set × Setop, and hence preserves limits, but we do not use this fact.
Proposition 9.2 The product in Game1 of a family of open games Gi : (Xi, S) −→'

(Yi, R) is

  Gi :   Xi, S  −→'

	


   Yi, R 



given as follows. The set of strategy proﬁles is Σ (	G ) =	Σ(G ). The lenses are given by (Qi:I Gi) (σ) =  i:I Gi(σi). Noting that V (  i:I Xi, S) =  i:I Xi, the
best response relation (σ, σ ) ∈ B  i:I Gi (ιj (h), k) holds iff (σj, σj ) ∈ BGj (h, k ◦ ιj ).
The product G1 × G2 is an external choice, in which the decision of whether G1 or G2 is played is determined by the history. This is strongly reminiscent of products in categories in game semantics [1] and additive conjunction in linear logic. In particular, it is typical of products in game semantics that strategies compose by cartesian product, and plays compose by disjoint union. This analogy suggests the following correspondence between game semantics and compositional game theory: The player of game semantics corresponds to the n ≥ 0 noncooperative players in an open game, and the opponent of game semantics corresponds to the context (h, k).
Proposition 9.3 Let Gi : (Xi, R) −→'	(Yi, S) be a family of open games. Then a
state of	i:I Gi consists, up to isomorphism, of a state for each Gi.
Proof. Since S ∼= homGame (u(I), −) it preserves limits, so

S   Gi  ∼=  S(Gi)

i:I
i:I
2

Example: Market entry game
We illustrate the previous three sections by considering the market entry game, a standard example of game theory in microeconomics [16, example 9.B.3]. This game is played between two players: a prospective entrant P into a market, and an incumbent Q in that market. In the first stage, P has the choice to either enter the market R, or immediately quit L. If P chooses to quit the game ends immediately and both players receive a certain utility. If P chooses to enter, in the second stage P and Q play a subgame in which simultaneously choose to either ﬁght F or accommodate A the other (which could mean, for example, that F means setting an aggressively low price and selling at a loss, and A means setting a high price). The utilities in this subgame are an abstraction of a model of sales in a market.
The extensive form representation is depicted in figure 5. The dotted line denotes that the two connected nodes share an information set, meaning that the incumbent firm Q does not know which of the two nodes they are in; in this way, the right hand subtree represents a simultaneous game. (More precisely, the word ‘simultaneous’ means the choices are made independently.)
The feature of this game that is specifically awkward for approaches based on theoretical computer science is that the extensive-form tree is unbalanced. Other

P
(0, 2)	P
	
Q	Q
F	A	F	A
(−3, −1) (1, −2) (−2, −1)  (3, 1)

Fig. 5. Extensive form representation of the market entry game

approaches use dependent types to allow types of choices to dependent on earlier values, but can still only allow more general ‘dependent subgames’ such as in the market entry game using encoding tricks such as dummy moves, and using large negative utilities to rule out certain plays. (Examples of game theory developed in a dependent type system include [15,2].) An external choice operator solves the more general problem of dependent subgames in an elegant way.
We represent the market entry game as an open game as follows. The decision at the root node in figure 5 is modelled as a utility-maximising decision D1,1+1 : I −→' (1 + 1, R) where the choice ι1(∗) represents L and ι2(∗) represents R.
The left subgame is represented by (1, c0) : (1, R) −→'	I, where c0 : 1 → R
is the constant function with c0(∗) = 0. Notice that the utility of 2 for player
Q in the left subgame has a clear economic interpretation as the profit for the incumbent firm, but it plays no role game-theoretically, and it never appears in the open game representation. (We could however add an additional, independent utility-maximising player in the left subgame with only a single choice, which has no effect on the equilibrium analysis but is more faithful to the economic situation.) As a strategically trivial effect, (1, c0) has a unique state αL, given by the unique lenses s(αL): (1, R) → I, t(αL): I → I and function Σ(αL):1 → 1.

The right subgame is an open game G : (1, R)
−→'
I, which can be built

compositionally from a pair of utility-maximising decisions D1,X : I
−→'
(X, R)

where X = {F, A} is the set of choices to fight or accommodate, and the utility
function q : X2 → R2 given by the payoffs in the right subgame, i.e.
q(F, F )= (−3, −3)	q(F, A)= (1, −2)
q(A, F )= (−2, −1)	q(A, A)= (3, 1)
This is represented by the string diagram in figure 6.
The coherence theorem proved in [12] guarantees that this diagram defines G up to (in general non-globular) isomorphism. Concretely, G is given as follows:
Σ(G)= X2
G(σ) : (1, R) → I is the lens with uG(σ)(∗, ∗) = (q(σ))1, i.e. the utility for the



Fig. 6. String diagram for the right subgame G

entrant P given strategy profile σ for the subgame

(σ, σj) ∈ BG (∗, ∗) iff (q(σj ,σ ))
≥ (q(σj ,σ ))
and (q(σ , σj ))
≥ (q(σ , σj )) ,

1	2  1
1	2  1
1	2  2
1	2  2

where − : X → X gives the other choice ( − is the non-identity automorphism
of X), i.e. BG (∗, ∗) is the best response function for the right subgame
The right subgame has a unique Nash equilibrium (A, A) in which both players accommodate. (By the comments at the end of section 7 we must necessarily discover this fact by game-theoretic methods rather than categorical methods.) Hence G has a unique state α2 with Σ(α)(∗)= (A, A), in which the lens s(α2): (1, R) → I
has us(α2)(∗, ∗) = 3. This is the payoff (q(A, A))1 for the entrant P in the Nash equilibrium.

The product (1, c0) ×G : (1 + 1, R) −→'
Σ((1, c0) × G) ∼= X2
(1 + 1, 1) is concretely given as follows:

((1, c0) ×G)(σ) is the lens (1 + 1, R) → (1 + 1, 1) with view function v((1,c )×G)(σ) = id1+1 and update function
u	(h, ∗)=  0	if h = ι1(∗)
The best response relation (σ, σj) ∈ B(1,c )×G (h, k) holds iff either h = ι1(∗), or

(q(σj ,σ ))

≥ (q(σj ,σ ))
and (q(σ1, σj ))2

≥ (q(σ1, σj ))2

Unlike the subgames (1, c0) and G, the product (1, c0) ×G cannot be seen as directly corresponding to a game in the classical sense. (It is an external choice between a forest of game trees.) By proposition 9.3, ⟨αL, α2⟩ is the unique state of (1, c0) × G, which is over the unique lens t(⟨αL, αR⟩) : (1 + 1, 1) → I. It has Σ(⟨αL, αR⟩)(∗)= (A, A), and λ := s(⟨αL, αR⟩): (1 + 1, R) → I is the lens with

u (h, ∗)=	0	if h = ι1(∗)
3	if h = ι2(∗)

Since the previous function has a single maximising point, namely ι2(∗), by proposition 7.10 the decision D1,1+1 has a unique state α over λ. This state has Σ(α)(∗):1 → 1+1 given by Σ(α)(∗)(∗)= ι2(∗).

The open game H := ((1, c0) × G) ⊙ D1,1+1 : I
−→'
(1 + 1, 1) will be our

representation of the original market entry game. It is concretely given, up to
globular isomorphism, as follows. The set of strategy profiles is Σ(H)= (1 + 1) × X2 consisting of a strategy for E in the first round, and a strategy for both players in the subgame in which E enters in the first round. This is the same as the set of pure strategy profiles of the original extensive-form game. (As in classical game theory, player E is required to choose a contingent strategy for the second round, even if the strategy in the first round is to quit.) H can be straightforwardly made
into a scalar I −→'	I by postcomposing with the (unique) strategically trivial game
(1 + 1, 1) −→'	I.
The lens H(σ1, σ2, σ3) : I → (1 + 1, 1) has view function vH(σ1,σ2,σ3)(∗) = σ1. The best response relation BH(∗, ∗) is the same as the best response relation for the market entry game given by classical game theory. Concretely, the relation (σ, σj) ∈ BH(∗, ∗) holds iff the following three conditions hold:
If σj = ι (∗) then 0 ≥ (q(σ ,σ )) , and if σj = ι (∗) then 0 ≤ (q(σ ,σ ))
1	1	2	3  1	1	2	2	3  1
If σ1 = ι2(∗) then (q(σj , σ3))1 ≥ (q(σj , σ3))1
2	2
If σ1 = ι2(∗) then (q(σ2, σj ))2 ≥ (q(σ2, σj ))2
3	3
Even more concretely, this relation is depicted as a digraph in figure 7, where we write L and R for ι1(∗) ad ι2(∗).
By the previous reasoning H has a unique ⊙-separable state, namely α =
⟨αL, αR⟩⊙ α1. This corresponds to the unique subgame perfect equilibrium of the market entry game, namely that the entrant enters the market (choice R or ι2(∗)), and then both players accommodate (choice A).
H has two additional states that are not ⊙-separable, corresponding to the non-subgame-perfect Nash equilibria of the market entry game (or, equivalently, to the two additional fixpoints of BH(∗, ∗)). These are the strategy profiles (ι1(∗), A,F ) and (ι1(∗), F,F ), recalling that ι1(∗) represents L. In both of these Nash equilibria the strategy σ3 = F of player Q is a non-credible threat (mutually harmful contingent strategy) to fight if player P chooses R in the first round. Such strategies are often considered unrealistic, and the purpose of subgame perfect equilibrium is to rule them out.


(L, A, F )
(L, A, A)
(R, A, A)

(R, F, F )	(R, F, A)


(L, F, F )
(L, F, A)
(R, A, F )



Fig. 7. The relation BH(∗, ∗)

References
	Samson Abramsky and Guy McCusker. Game semantics. In Computational logic, volume 165 of NATO ASI Series. Springer, 1999. doi:10.1007/978-3-642-58622-4_1.
Nicola Botta, Cezar Ionescu, and Edwin Brady. Sequential decision problems, dependently typed solutions. In Proeedings of PLMMS13, 2013.
Valeria de Paiva. The dialectica categories. Technical report, University of Cambridge, 1991.
	Valeria de Paiva. Dialectica and Chu construtions: Cousins? Theory and applications of categories, 17(7):127–152, 2007.
	Martin Escard´o and Paulo Oliva. Sequential games and optimal strategies. Proceedings of the Royal Society A, 467:1519–1545, 2011. doi:10.1098/rspa.2010.0471.
	Martin Escard´o and Paulo Oliva. Computing Nash equilibria of unbounded games. Proceedings of the Turing centenary conference, 2012.
Brendan Fong. The algebra of open and interconnected systems. PhD thesis, University of Oxford, 2016.
	Nate Foster, Michael Greenwald, Jonathan Moore, Benjamin Pierce, and Alan Schmitt. Combinators for bi-directional tree transformations: A linguistic approach to the view update problem. ACM Transactions on Programming Languages and Systems, 29(3), 2007. doi:10.1145/1232420.1232424.
	Neil Ghani, Jules Hedges, Viktor Winschel, and Philipp Zahn. Compositional game theory. In Proceedings of Logic in Computer Science (LiCS) 2018. ACM, 2018. doi:10.1145/3209108.3209165.
	Neil Ghani, Clemens Kupke, Alasdair Lambert, and Fredrik Nordvall Forsberg. A compositional treatment of iterated open games. To appear in Sannellabration!, special issue of Theoretical computer science. arXiv:1711.07968, 2018.
	Jules Hedges. Towards compositional game theory. PhD thesis, Queen Mary University of London, 2016.
Jules Hedges. Coherence for lenses and open games. arXiv:1704.02230, 2017.
Bart Jacobs. Categorical logic and type theory. Studies in logic and the foundations of mathematics. Elsevier, 1999.
G. M. Kelly and Ross Street. Review of the elements of 2-categories. In Category seminar, volume 420 of Lecture notes in mathematics. Springer, 1974. doi:10.1007/BFb0063101.
Pierre Lescanne and Matthieu Perrinel. “Backward” coinduction, Nash equilibrium and the rationality of escalation. Acta Informatica, 49(3):117–137, 2012. doi:10.1007/s00236-012-0153-3.
Andreu Mas-Colell, Michael Whinston, and Jerry Green. Microeconomic theory. Oxford University Press, 1995.
Michael Maschler, Eilon Solan, and Shmuel Zamir. Game theory. Cambridge University Press, 2013.
doi:10.1017/CBO9780511794216.
John Nash. Non-cooperative games. Annals of mathematics, 54(2):286–295, 1951.
	Matthew Pickering, Jeremy Gibbons, and Nicolas Wu. Profunctor optics: Modular data accessors. The art, science and engineering of programming, 1(2), 2017. doi:10.22152/programming-journal.org/ 2017/1/7.
	Aviad Rubinstein. Inapproximability of Nash equilibrium. In Proceedings of the forty-seventh annual ACM symposium on Theory of computing (STOC’15), pages 409–418, 2015. doi:10.1145/2746539. 2746578.
	Michael Shulman. Framed bicategories and monoidal fibrations. Theory and applications of categories, 20(18):650–738, 2008.
Michael Shulman. Constructing symmetric monoidal bicategories. arXiv:1004.0993, 2010.
