Journal Pre-proof


CWGAN-GP with Residual Network Model for Lithium-ion Battery Thermal Image Data Expansion with Quantitative Metrics

Fengshuo Hu , Chaoyu Dong , Luyu Tian , Yunfei Mu , Xiaodan Yu , Hongjie Jia

PII:	S2666-5468(23)00093-9
DOI:	https://doi.org/10.1016/j.egyai.2023.100321
Reference:	EGYAI 100321

To appear in:	Energy and AI

Received date:	30 June 2023
Revised date:	5 November 2023
Accepted date:	14 November 2023

Please  cite  this  article  as:  Fengshuo Hu ,  Chaoyu Dong ,  Luyu Tian ,  Yunfei Mu , Xiaodan Yu ,  Hongjie Jia , CWGAN-GP with Residual Network Model for Lithium-ion Bat- tery Thermal Image Data Expansion with Quantitative Metrics, Energy and AI (2023), doi: https://doi.org/10.1016/j.egyai.2023.100321



This is a PDF file of an article that has undergone enhancements after acceptance, such as the addition of a cover page and metadata, and formatting for readability, but it is not yet the definitive version of record. This version will undergo additional copyediting, typesetting and review before it is published in its final form, but we are providing this version to give early visibility of the article. Please note that, during the production process, errors may be discovered which could affect the content, and all legal disclaimers that apply to the journal pertain.

 2023 Published by Elsevier Ltd.
This is an open access article under the CC BY-NC-ND license (http://creativecommons.org/licenses/by-nc-nd/4.0/)




CWGAN-GP with Residual Network Model for Lithium-ion Battery Thermal Image Data Expansion with Quantitative Metrics

Fengshuo Hu a, Chaoyu Dong b*, Luyu Tian a, Yunfei Mu a, Xiaodan Yu a, Hongjie Jiaa

a School of Electrical and Information Engineering, Tianjin University,Tianjin,300072, China
bAgency for Science, Technology and Research, Nanyang Technological University , 639798,Singapore



Abstract—Lithium batteries find extensive applications in energy storage. Temperature is a crucial indicator for assessing the state of lithium-ion batteries, and numerous experiments require thermal images of lithium-ion batteries for research purposes. However, acquiring thermal imaging samples of lithium-ion battery faults is challenging due to factors such as high experimental costs and associated risks. To address this, our study proposes the utilization of a Conditional Wasserstein Generative Adversarial Network with Gradient Penalty and Residual Network (CWGAN-GP with Residual Network) to augment the dataset of thermal images depicting lithium-ion battery faults. We employ various evaluation metrics to quantitatively analyze and compare the generated thermal images of lithium-ion batteries. Subsequently, the expanded dataset, comprising four types of thermal images depicting lithium-ion battery faults, is input into a Mask Region-based Convolutional Neural Network for training. The results demonstrate that the proposed model surpasses both traditional Generative Adversarial Network and Wasserstein Generative Adversarial Network in terms of the quality of generated thermal images of lithium-ion batteries. Moreover, the augmentation of the dataset leads to an improvement in the fault diagnosis accuracy of the Mask Region-based Convolutional Neural Network.

Keywords—Lithium-ion batteries, Generative adversarial network, CWGAN-GP.










Introduction

The prompt development of renewable energies necessitates advanced energy storage technologies, which can alleviate the intermittency of renewable energy. According to the Global Energy Storage Project Database of the China Energy Research Association Energy Storage Industry Technology Alliance (CNESA)[1], as of the end of 2022, the cumulative installed capacity of energy storage projects in operation worldwide was
237.2GW, with an annual growth rate of 15%. The cumulative installed capacity of pumped storage energy was less than 80% for the first time. Lithium-ion batteries still occupy an absolutely dominant position, with an annual growth rate of more than 85%, and their cumulative installed capacity in new energy storage has increased by 3.5% compared with 2021.
Due to its small size, high specific energy, high voltage, lengthy lifespan, and lack of memory effect, lithium-ion batteries are widely employed in multiple fields [2]. As shown in Fig. 1, energy storage systems, especially lithium-ion battery




energy storage systems, are widely used in intermittent output of renewable energy such as wind energy and solar energy, electric vehicles[3], and new power systems.


Fig.1 Applications of lithium-ion battery energy storage system

The high heat output from lithium-ion batteries during usage and potential malfunctions during storage can lead to fires, posing a significant safety risk for energy storage. The thermal safety concerns associated with lithium-ion batteries have garnered increasing attention [4]. Temperature has a significant impact on the lithium-ion battery's cycle life and safety [5]. Higher temperatures not only reduce the performance of lithium-ion batteries, but also significantly accelerate the degradation of lithium-ion batteries [6]. Lithium-ion battery internal energy balance mainly depends on three factors: external heat source, internal heat and surface heat. The external heat source often causes the initial temperature rise of the battery, which is the key factor to induce the thermal runaway of the battery. Surface heat dissipation through heat conduction, heat radiation, heat convection and the surrounding environment for heat transfer. The internal heat production mainly includes joule heat, polarization heat, and reaction heat. When the temperature gradually increases, the chemical components in the battery decompose and release heat, further accelerating the reaction rate [7]. When the critical temperature of thermal runaway is reached, the decomposition reaction inside the battery will release a large amount of heat instantaneously, eventually leading to thermal runaway accidents [8]. During the thermal runaway process, the battery's internal reactions primarily involve the breakdown of the SEI film, the reactions between the negative and positive electrodes and the electrolyte, the melting of the separator, the breakdown of the electrolyte, the breakdown of the binder, etc. This causes the battery temperature to rise quickly and the production of flammable gases like H2 and CO, which leads to combustion or explosion.
Artificial  intelligence  (AI)  is  becoming  increasingly
important for our energy industry and research, with great potential to redesign our future energy system. AI plays an important role in the field of lithium-ion batteries. It can improve the efficiency and safety of lithium-ion battery thermal management by processing large amounts of data, building models, and making predictions. [9] introduces the latest technology in battery modeling, on-board diagnostic tools, and data-driven modeling methods, and how to combine these
elements into a framework for creating battery digital twins.
[10] combines lithium-ion battery thermal behavior with machine learning to achieve real-time battery system monitoring, control and on-site diagnosis through artificial neural network.
Given the critical role temperature plays in the performance of lithium-ion batteries, the development of lithium-ion battery thermal management systems has emerged as a prominent research focus [11]. [12] combined the long and short-term memory network (LSTM) with the temporal convolution network (TCN) for the first time and established a synthetic thermal convolutional-memory network (STCMN) for lithium-ion battery behavior diagnosis against noise interruptions. This experiment uses the commercial computational fluid dynamics software FLUENT to conduct a finite element simulation of the lithium-ion battery, and uses the lithium-ion battery terminal voltage, SOC, surface thermal image and other data in the simulation results as input to STCMN. [13] uses field experiments to prove that infrared thermal imaging can estimate thermal power well, and its value is very close to thermocouple data. In addition, the infrared method can quickly scan the measurement area and is a non-invasive analysis method. In contrast, thermocouples must be placed on the cell surface with a special highly conductive adhesive, and they have more complex acquisition systems. Therefore, infrared thermography can be considered a powerful method for not only qualitative assessment of thermal behavior, but also quantitative assessment of the heat generated by lithium-ion batteries. [14] performs infrared temperature measurement on lithium-ion batteries, obtains thermal images of lithium-ion batteries, and confirms its use for online evaluation of SOC during battery operation. [15] proposed a thermal inertia prediction model for a cylindrical battery validated using IR thermography measurements.
The thermal imaging of lithium-ion batteries is primarily captured through experimental means. However, conducting temperature measurements on lithium-ion batteries entails drawbacks such as prolonged time consumption and high experimental costs. Particularly in extreme failure experiments, simulating them proves challenging due to equipment limitations. It demands specialized experimental skills, experience, and entails certain risks. Consequently, the availability of infrared thermal image samples for lithium-ion battery failures is relatively limited. Indeed, employing software to simulate thermal images of lithium-ion batteries is restricted by scene limitations and falls short in replicating various types of faults in lithium-ion battery thermal images. With intricate lithium-ion battery models and extensive-scale simulations, substantial computing resources and time may be imperative, leading to relatively high computational costs [16]. By using generative adversarial network (GAN) to generate thermal images of lithium-ion batteries, a large number of samples can be produced in a short period, thus expediting the research process. GAN possess a high degree of flexibility, allowing them to generate thermal images in various scenarios as needed to meet specific research requirements. Furthermore, GAN do not rely on extensive experimental equipment and

3


resources. Theoretically, it is an efficient, cost-effective, and safe method. This paves the way for a new approach to research in the field of lithium-ion battery thermal management, and compensates for some limitations of experimental acquisition and simulation
In the field of image generation, the current mainstream methods include the variational autoencoder (VAE)[17], deep belief network (DBN) [18], and generative adversarial network (GAN) [19]. The variational autoencoder is trained through the encoding and decoding of samples. Its primary drawback lies in producing images that may lack clarity and exhibit relatively lower quality, along with limited model generalization. The deep belief network, introduced by Geoffrey Hinton in 2006 [18], generates data based on maximum probability by training the weights between neurons. However, it faces challenges such as slow training speed, high sensitivity to parameter selection, a propensity to converge to local optima, and limited widespread application. Currently, the GAN proposed by Goodfellow et al. stands out as an algorithm with robust sample learning capabilities and finds extensive application in the field of generative modeling.
In the field of batteries, [20] uses time series GAN to generate battery parameters, such as voltage, current, state of charge (SOC), temperature and other parameters. [21] uses a complementary collaborative algorithm of generative adversarial network conditional latent space (CLS) combined with bidirectional long short-term memory (BLSTM) for improved and efficient lithium-ion rechargeable battery state prediction. [22] introduced a method called time series Wasserstein generative adversarial network (TS-WGAN) which effectively captures data distribution and characteristics to estimate battery SOC. [23] uses conditional generative adversarial network (CGAN) to enhance the feature library extracted from various characteristic curves of lithium cells. This effectively trains a classifier for the purpose of discerning inconsistent lithium-ion batteries. As of now, there is no existing literature on using GAN to augment thermal images of lithium-ion batteries. However, in other domains, there is a wealth of experimental data regarding the augmentation of image datasets using GAN. [24] uses GAN architecture to synthesize high-quality images of liver lesions for medical image data augmentation to enlarge small datasets and improve the performance of classification tasks using CNNs. [25] employs conditional generative adversarial network (CGAN) for sample augmentation of defective fruits. The results demonstrate that the generated images exhibit classifiable features such as shape, mold, and decay. Subsequently, through the use of these generated images to enhance training, a higher image classification accuracy of 88.75% was achieved. Therefore, it can be concluded that CGAN has the capability to generate new data, mitigating the issue of data scarcity. Therefore, we employ GAN to augment faulty samples of lithium-ion battery thermal images. [C 0.12] This work bridges the gap in the application of GAN in the field of thermal imaging for lithium-ion batteries.
While GAN is extensively employed, challenges persist,
including training instability and suboptimal quality of
generated images. To tackle these issues, this paper introduces a Condition Wasserstein GAN with gradient penalty and a residual network model (CWGAN-GP with ResNet). The main contributions are as follows:
	To address the challenges of unstable training and gradient disappearance in GAN, we incorporate both the WGAN structure and a residual network. The Lipschitz limit in WGAN is enforced through a more appropriate method - the gradient penalty. This leads to the development of a Wasserstein GAN with gradient penalty and a residual network (WGAN-GP with ResNet), which effectively enhances the quality of generated thermal images for lithium-ion batteries.
	Quantitative analysis of the model using the four indicators of SSIM, PSNR, MMD and 1-NN confirmed that WGAN-GP with ResNet can indeed effectively improve the quality of generated images.
	Combining CGAN to construct CWGAN-GP with ResNet to generate four types of thermal images depicting faults in lithium-ion batteries, we effectively expand the dataset of faulty samples. This augmented dataset is then fed into Mask R-CNN for training, leading to an enhancement in the accuracy of network fault diagnosis.
CWGAN-GP combined with ResNet
GAN ：Generative Adversarial Network
GAN consists of a generative model G and a discriminative model D, the generative model G that captures the data distribution, and the discriminative model D that estimates the probability that a sample came from the training data rather than G. If the input data is judged to be real data, the output is 1; if the input data is judged to be false data, the output is 0 [24]. Fig.2 depicts the generative adversarial network model.


Fig.2 GAN model

The training of GAN is divided into two stages, first training the discriminative model D and then training the generative model G. The D and G models will adjust their parameters over the course of training in order to minimize their respective loss functions.

Wasserstein Distance

Traditional GAN models use KL divergence or JS divergence as the loss function of the model. However, this loss function leads to vanishing gradients and mode collapse, which reduces training stability [26].
Wasserstein distance or the Earth-Mover (EM) distance [27] is shown in formula 1:




𝑊(P𝑟, Pg) = inf𝛾∈П(𝑃r,𝑃𝑔) 𝔼(𝑥,𝑦)~𝛾[‖ 𝑥 − 𝑦 ‖]	(1) Pr is the distribution from the real data, Pg is the distribution from the generated data. Where Π(Pr, Pg) denotes the set of all joint distribution γ(x, y) whose marginals are respectively Pr and Pg. Compared with KL divergence and JS divergence, the Wasserstein distance can still reflect their distance even if there
is no intersection between the two distributions of Pr and Pg.
function, which result in either vanishing or exploding gradients without careful tuning of the clipping threshold c.

The Lipschitz constraint requires that the gradient of the discriminator does not exceed K, and we can directly set an additional loss term to reflect this. To circumvent tractability issues, we enforce a soft version of the constraint with a penalty on the gradient norm for random samples 𝑥^ ~𝑃𝑥^ Our new
objective is:

Wasserstein GAN
𝐿 = 𝔼 [𝐷(𝑥˜ )] − 𝔼 [𝐷(𝑥)] + 𝜆 𝔼
[(‖A 𝐷(𝑥^ )‖
2
− 1) ]
(3)

𝑥˛˜ ~_𝑃_𝑔
𝑥~𝑃r
¸	˛𝑥^_~_𝑃𝑥^
𝑥^	2	¸

Since the Wasserstein distance has such a superior property, if we could define it as the loss of the generator, would not it be

Original critic loss

Our gradient penalty

possible to generate meaningful gradients to update the generator so that the generated distribution is pulled toward the real distribution? It is not that easy because the infγ∈Π(Pr,Pg )
in the Wasserstein distance definition cannot be solved directly.
But in [28], the author used an existing theorem to transform formula (1) into the following form:
𝑊(𝑃 , 𝑃 )	1
The gradient penalty only takes effect on the region of the true and false sample set and its intermediate transition zone. However, because the gradient norm of the discriminator is directly limited to 1, the gradient controllability is very strong and it is easy to adjust to the appropriate scale. The Wasserstein
Generative Adversarial Network with gradient penalty (WGAN-GP) procedure is described in Algorithm 1.

𝑟  g
= 𝐾 sup‖𝑓‖𝐿≤𝐾 𝐸𝑥~𝑝r [𝑓(𝑥)] − 𝐸𝑥~𝑝𝑔 [𝑓(𝑥)]	(2)

where the supremum is over all the k-Lipschitz functions f: X
→ R. K is a constant that represents the Lipschitz constraint on the function. In order to enforce the Lipschitz constraint, we
can ensure that the parameters of the network are bounded within a certain range after each update, a technique known as


Algorithm 1 WGAN with gradient penalty the default values
α= 0.00001, λ = 10, ND = 5,β1 = 0, β2 = 0.9.
Require: The gradient penalty coefficient λ, the number of
critic iterations per generator iteration ND, the batch
size m, Adam hyperparameters α,β , β

weight clipping.	1  2


WGAN-GP： Wasserstein GAN with gradient penalty Although Wasserstein GAN has its ingenious theoretical
analysis, simple algorithm implementation, and good experimental results, it still has problems such as training difficulties and slow convergence speed in actual experiments. In fact, the key to these problems is that the Lipschitz restriction in the original design is not applied correctly. To enforce the Lipschitz constraint on the critic, propose to clip the weights of the critic to lie within a compact space [−c, c]. The set of
functions satisfying this constraint is a subset of the k-Lipschitz
Require: w0, initial critic parameters. θ0, initial generator’s parameters.
1:	while θ has not converged do 2:	for t = 1, ..., ND do
3:	for i = 1, ..., m do
4:	Sample real data 𝑥 ~ 𝑃𝑟, latent variable 𝑧 ~ 𝑝(𝑧), a random number 𝜖 ~ 𝑈[0,1].

5:	𝑥˜ ➛ 𝐺𝜃(𝑧)
6:	𝑥^ ➛ 𝜖𝑥 + (1 − 𝜖)𝑥˜

functions for some k which depends on c and the critic
7:	𝐿(𝑖) ➛ 𝐷
(𝑥˜ ) − 𝐷
(𝑥) + 𝜆(‖A 𝐷
(𝑥^ )‖
2
− 1)

architecture. However, there are two serious problems with the implementation of weight clipping：
w	w

8:	end for
𝑥^ w	2

Capacity underuse: Implementing a k-Lipshitz constraint
9:	𝑤 ➛ Adam (A
1 ∑𝑚 𝐿(𝑖), 𝑤, 𝛼, 𝛽 , 𝛽 )

via weight clipping biases the critic towards much simpler functions. We observe that our neural network architectures try to achieve their maximal gradient norm k to end learning very simple functions. This result in
discriminator network not giving full play to the fitting
10:	end for
11:
w 𝑚
𝑖=1
1  2
{ (𝑖) 𝑚

ability.
Exploding and vanishing gradients: weight clipping can
12:
Sample a batch of latent variables 𝑧
1
}
𝑖=1
~ 𝑝(𝑧).

easily lead to gradient disappearance or gradient explosion accidentally. The reason is that the discriminator is a
𝜃 ➛ Adam (A𝜃
 ∑𝑚  − 𝐷w(𝐺𝜃(𝑧)), 𝜃, 𝛼, 𝛽1, 𝛽2)
𝑚

multi-layer network. If we set the clipping threshold slightly smaller, the gradient becomes smaller for each layer of the network, and it will decay exponentially after multiple layers. On the contrary, if set a little bit larger, each through a network, the gradient becomes a little bit larger, after multi-layer will be exponential explosion. WGAN optimization process is difficult because of interactions between the weight constraint and the cost
  13:	end while	

Residual network
A residual network is composed of a series of residual blocks. The idea behind the residual unit is to combine the neural network unit's input and output for activation. The phenomenon of gradient disappearance and network degradation with an

5


increase in network layers can be efficiently solved by residual network (ResNet).





X
the discriminant network, it is accomplished by down sampling.

convolutional2D BatchNormalization
LeakyReLU





Fig.3 Structure of residual block
Fig.3 is the structure diagram of the residual block. The input and output dimensions in the unit are consistent, and the function H of the unit fitting is divided into two parts. When the network propagates back, the loss message can be propagated directly to the lower layer without any intermediate weight matrix transformation, mitigating gradient dispersion.

WGAN-GP with residual network

Construct the residual block module. In order to convolve and normalize the shortcut, we construct three BN layers in the main channel, as seen in Fig. 4. The shortcut convolution kernel is 1*1, while the main channel convolution kernel is 3*3. This can significantly increase the fitting capability and parameter quantity. The main channel and shortcut both require a change in dimension; for the generating network, this is accomplished via UpSampling2D+Conv2D or Conv2DTransport while for
Fig.4 Residual block module
Fig.5 illustrates the overall structure of WGAN-GP with ResNet. First, input 128-dimensional random noise, then connect it to a 512*4*4-dimensional fully connected layer and instruct it to change the shape of 4*4*512. It is turned into a shape of 64*64*64 through 3 consecutive upsampling convolution (specified residual block) operations, and then converted into a shape of 64*64*3 by convolution operation, that is, the image is 64*64 in size, and there are 3 channels. The output of this layer is the image generated by the generator. In the part of the discriminator, the input is a real picture or a generated picture, the shape is 64*64*3, the shape is changed to 64*64*64 through the convolution operation, and then through three consecutive transposition convolutions (defined the residual block) converts the shape to 4*4*512, and then connects to the fully connected layer. Subsequently, scores are computed for both the real and generated images, and gradient information for the discriminator and generator is calculated. Following this, both the generator and discriminator continue training after the gradients have been updated. Ultimately, they output the D loss image and the G loss image, saving the generated   image   every   50   training   iterations.



G Loss

















Fully connected layer
D Loss


	Residual block
[C 2.3] Fig.5 Structure of WGAN-GP with ResNet








G Loss







Fig.6 Structure of CWGAN-GP with ResNet
Fully connected layer Residual block



CGAN and CWGAN-GP with residual network
c2 and c3 are constants.
𝑙(𝑥, 𝑦) =  2𝜇𝑥𝜇𝑦+𝑐1 𝑐(𝑥, 𝑦) =  2σ𝑥σ𝑦+𝑐2 𝑠(𝑥, 𝑦) =  σ𝑥𝑦+𝑐3 

(4)

Although the above model has improved the quality of image
𝜇2+𝜇2 +𝑐1
σ2+σ2+𝑐2
σ𝑥σ𝑦+𝑐3

generation, its generated images are relatively random and still belong to the category of unsupervised learning. CGAN has
SSIM(𝑥, 𝑦) =  (2𝜇𝑥𝜇𝑦+𝑐1)(2σ𝑥𝑦+𝑐2)  
(𝜇2+𝜇2 +𝑐1)(σ2+σ2+𝑐2)
(5)

greatly expanded the application field of the model by improving the method of generating images with category labels [29]. By adding category labels to the generator and discriminator respectively, the generated images can be directed according to our requirements. This also provides a basis for expanding the thermal image samples of designated fault types of lithium-ion batteries.
Fig. 6 shows the CWGAN-GP with residual network model, which is trained through label controlled generators and discriminators, and can simultaneously obtain fault thermal images of different types of lithium-ion batteries as required.

Generate image evaluation metrics
Due to the quantitative analysis of the generated lithium-ion battery thermal image to compare the image quality, we use the following four methods to compare and score the image generated by GAN, WGAN and WGAN-GP with ResNet with the real image.
The value range of SSIM is [0,1]. The larger the value, the
higher the similarity of the image, and the better the quality of the generated image.

PSNR: peak signal-to-noise ratio

PSNR is one of the objective standard indicators for evaluating image quality [31]. The performance of conditional generative adversarial Network is evaluated by comparing different PSNR values. There are two calculation methods for color images: one is to calculate the PSNR of RGB three channels and then take the mean value; second, calculate the three-channel MSE and divide by 3, and then calculate PSNR. In summary, it is clear that the PSNR value is inversely proportional to the difference between the two images, that is, the smaller the PSNR, the greater the difference between the images, the worse the generated performance and thus affect the quality of the generated image is poor. Given two m × n images I and K, the mean square error (MSE) is defined as:

𝑀𝑆𝐸 = 1
∑𝑚−1∑𝑛−1[𝐼(𝑖, j) − 𝐾(𝑖, j)]2	(6)

SSIM: structural similarity index measure

𝑚𝑛
𝑖=0	j=0

Then PSNR (dB) is defined as:

𝑀𝐴𝑋2

The design idea of SSIM [30] is to focus on three features of the image : luminance l ( x, y ), contrast c ( x, y ), structure s ( x, y ). It is an index to measure the similarity of two images x and
y. This indicator was first proposed by Laboratory for Image and Video Engineering. The calculation method is shown in Formula (4) and Formula (5). μ is expectation, σ is variance, c1,
𝑃𝑆𝑁𝑅 = 10 · 𝑙𝑜𝑔 (	𝐼 )	(7)
𝑀𝑆𝐸
The value of PSNR has no range. The larger the value, the
better the image quality.
MMD: maximum mean discrepancy
Based on the samples of two distributions, by finding the continuous function f in the sample space, the mean values of

7


the function values of the samples of different distributions on f are obtained. By subtracting the two mean values, the mean discrepancy of the two distributions corresponding to f can be obtained. Finding a f such that the mean discrepancy has a maximum, we get MMD. Finally, MMD is taken as the test statistic to determine the similarity of the two distributions [32].
The Maximum Mean Discrepancy is defined as[33]：
𝑀𝑀𝐷2(𝑃𝑟, 𝑃g) = 𝐸(𝑥 ,𝑥′ )~𝑃 ,(𝑥 ,𝑥′ )~𝑃 [𝑘(𝑥𝑟, 𝑥′ ) − 2𝑘(𝑥𝑟, 𝑥g) + 𝑘(𝑥g, 𝑥′ )]  (8)
conducting experiments to assess the effectiveness of the model. We used the commercial software FLUENT to perform finite element simulation of a 10Ah prismatic LiFePO4-Graphite battery to obtain the battery data. The battery parameters are set as follows: Nominal Cell Capacity = 10Ah; Min Stop Voltage = 3V; Max Stop Voltage = 4.3V; Initial Soc = 0.7; The cathode is LiFePO4, the anode is graphite,

r r  r
𝑔 𝑔  𝑔	𝑟
g	the positive collector is aluminum, and the negative collector is

where Pr is the real data distribution, Pg is the generated data distribution, where 𝑥𝑟 and 𝑥gare samples drawn from Pr and Pg, and k is the kernel function (generally Gaussian kernel function).
When MMD is equal to 0, it means that two probability distributions are identical, and there is no difference between them. As the MMD value increases, it indicates a greater difference between the two probability distributions.
1-NN:1-nearst neighbors classifier
The nearest neighbor remaining one method [34] is to take one sample from the total number of samples N as validation and the rest as training until all samples are used for validation The 1-NN classification accuracy is used to evaluate the similarity of the two distributions, and the accuracy is [0,1].
𝑥𝑟 ~ 𝑃𝑟 and 𝑥g ~ 𝑃g , with |𝑥𝑟| = |𝑥g|	(9) When the GAN achieves good enough results and |xr |=|xg|, the 1-NN classifier should obey a leave one out (LOO) accuracy of about 50%, similar to the discriminator's Nash equilibrium If the generated model generates over fitting, the LOO accuracy rate will be lower than 50%. Therefore, when the LOO accuracy rate is greater than 50%, the closer to 50%,
the better the image quality generated by GAN.

Results and discussion

experimental data

Lithium-ion batteries are simulated to form the dataset for
copper. And the mature multi-scale multi-dimension (MSMD) solution model and Newman, Tiedemann, Gu and Kim (NTGK) electrochemical model provided by FLUENT are used in the solution process. Then the commercial software FLUENT is used to simulate and save the thermal image of lithium-ion battery during charging, As shown in Fig.7.





Fig.7 Lithium-ion battery charging thermal image

Algorithm environment and training results

This paper uses Python keras to build the WGAN-GP model. Experimental environment configured as Windows 10 operating system, NVIDIA GeForce RTX 3060 Laptop GPU, AMD Ryzen 7 5800H with Radeon Graphics, tensorflow-gpu 1.15.0, keras 2.2.4.
Following the method outlined in Section 4.1, infrared thermal images were obtained under the charging state of lithium-ion batteries. Five hundred images were randomly selected as the dataset for training the WGAN-GP with ResNet. For comparison, the same dataset was separately used to train the GAN and WGAN models until they reached basic convergence. The loss plots for all three models are saved as shown in Fig.8.


















(a) WGAN-GP with ResNet loss	(b) GAN discriminator loss (D loss)





(c) GAN generator loss (G loss)	(d) WGAN discriminator loss (D loss)	(e) WGAN generator loss (G loss) Fig.8 Loss images of three models


From Fig. 8(b) and (c), it is evident that training with the traditional GAN is highly unstable. Fig. 8 (d) and (e), after optimizing with the WGAN structure, shows a significantly improved stability. It reaches basic convergence after 14,000 training iterations. Fig. 8(a) demonstrates that the WGAN-GP with ResNet, which incorporates the gradient penalty term and residual network, not only exhibits relatively stable training but also achieves convergence more rapidly.
Comparison and evaluation results of generated images Fig. 9 presents a comparison between the thermal images of
lithium-ion batteries generated by three models and real thermal images of lithium-ion batteries. Fig.9(a) displays randomly selected thermal images captured during the charging
process of lithium-ion batteries. Fig.9 (b) shows the thermal image of lithium-ion batteries generated by GAN. Fig.9 (c) displays the thermal image of lithium-ion batteries generated by WGAN, while Fig.9 (d) show cases the thermal image of lithium-ion batteries generated by WGAN-GP with ResNet. The three models were quantitatively analyzed based on the evaluation indicators proposed in Section 3, and the results are shown in Table Ⅰ. Overall, we observe that WGAN-GP with ResNet demonstrates a notable improvement in the quality of generated thermal images of lithium-ion batteries compared to the other two models. Particularly in the 1-NN metric, the LOO accuracy exceeds 50%, indicating that the model did not experience overfitting. Additionally, the LOO accuracy approaching 50% further confirms that WGAN-GP with ResNet  produces  higher-quality  generated  images.




















(a) real images	(b) GAN generate images



(c) WGAN generate images	(b) WGAN-GP with ResNet generate images Fig.9 Comparison of real images and various generated images

9



TABLE .I	EVALUATION SCORE
ResNet, as depicted in Fig. 6. We input the four types of lithium-ion  battery  fault  thermal  image  datasets  into

		CWGAN-GP with ResNet for targeted generation of each type

	Model	SSIM	PSNR	MMD	1-NN	


CWGAN-GP with residual network training results

Using the lithium-ion battery model described in Section 4.1, internal short circuit conditions are set at the lower-right, center, and upper-right positions of the lithium-ion battery to simulate different	positions	of	needle-puncture	faults.	The needle-puncture fault at the lower-right position of the lithium-ion battery is defined as Fault 1, as shown in Fig. 10(a). The needle-puncture fault at the center of the lithium-ion battery is defined as Fault 2, as shown in Fig.10(b). The needle-puncture fault at the upper-right position of the lithium-ion battery is defined as Fault 3, as shown in Fig.10(c). Additionally, using the lithium-ion battery model, an overheating fault under realistic conditions is simulated by implementing enhanced heat dissipation, defined as Fault 4, as shown in Fig.10(d). For each type of lithium-ion battery fault,
80 images are randomly selected and labeled to form the
dataset.


(a) Fault 1	(b) Fault 2	(c) Fault 3	(d) Fault 4 Fig.10 Thermal images of different faulty lithium-ion batteries
From Section 4.3, we can conclude that WGAN-GP with ResNet can enhance the quality of generated lithium-ion battery thermal images. Therefore, we combined CGAN and WGAN-GP with ResNet to construct the CWGAN-GP with
of lithium-ion battery fault thermal image. In comparison, we input the same dataset into CGAN, and the losses of the two models are shown in Fig. 11.
















CGAN loss



















CWGAN-GP with ResNet loss Fig.11 Comparison of loss between two models

 
(a) Fault 1		(b) Fault 2	(c) Fault 3	(d) Fault 4 Fig.12 Four types of lithium-ion battery fault thermal images generated by CGAN




 
(a) Fault 1		(b) Fault 2	(c) Fault 3	(d) Fault 4 Fig.13 Four types of lithium-ion battery fault thermal images generated by CWGAN-GP with ResNet

Fig.11 illustrates that CWGAN-GP with ResNet exhibits greater stability and faster convergence in comparison to CGAN training.
Fig.12 displays the images of four fault types generated by CGAN, while Fig.13 shows the images of the same fault types generated by CWGAN-GP with ResNet. From a visual perspective, it is evident that the images generated by CWGAN-GP with ResNet are clearer, indicating a significant improvement in image quality. This qualitative analysis aligns with the quantitative findings presented in Table Ⅱ, affirming the effectiveness of CWGAN-GP with ResNet in the targeted augmentation of thermal images depicting lithium-ion battery faults.

TABLE .II	EVALUATION SCORE


Application of extended lithium-ion battery fault thermal image dataset in Mask R-CNN [C 0.15]
The Mask Region-based Convolutional Neural Network (Mask R-CNN) is a deep learning model that extends the R-CNN model and is commonly used for tasks like object detection and fault detection[35]. By aligning features from multi-scale proposed regions, it can provide a higher level of fault feature classification.
Using the four types of lithium-ion battery fault thermal images (50 images per-class), we trained Mask R-CNN. The training set consisted of 180 lithium-ion battery fault thermal images, while the test set comprised 20 lithium-ion battery fault
thermal images. Subsequently, we utilized the four types of lithium-ion battery fault thermal images extended through CWGAN-GP with ResNet (200 images per class) as input for Mask R-CNN training. In this case, the training set consisted of 720 lithium-ion battery fault thermal images, and the test set included 80 lithium-ion battery fault thermal images. Both experiments were trained for 30 epochs under identical conditions, and the results are shown in Fig. 14.
The data shows that the second set of experiments, compared to the first set, exhibited significant improvements across all metrics, indicating a positive impact of augmenting the dataset on the model's performance. The increase in both average accuracy and average recall suggests an overall enhancement in the model's performance. The improvement in fault detection accuracy also indicates a noticeable enhancement in the model's ability to classify different types of faults. In summary, the utilization of CWGAN-GP with ResNet for data augmentation has played a positive role in enhancing the model's performance in lithium-ion battery fault detection. This may provide more accurate results for fault diagnosis in practical applications.

11

original dataset of thermal images for lithium battery faults	augmented dataset of thermal images for lithium battery faults



100.00%
98.60%	98.70%
97.20%99.00%


90.00%

80.00%

70.00%

60.00%

50.00%

40.00%

30.00%

20.00%

10.00%


0.00%

Average accuracy (AP)

Average recall (AR)

Fault 1 detection accuracy

Fault 2 detection accuracy

Fault 3 detection accuracy

Fault 4 detection accuracy

Fig.14 Mask R-CNN training results


Conclusion

This paper introduces a method for augmenting lithium-ion battery thermal image samples based on CWGAN-GP with ResNet, addressing some limitations of experimental data collection and software simulation. The proposed model tackles the challenges of unstable GAN training and subpar image generation quality. Experimental results demonstrate that WGAN-GP with ResNet outperforms traditional GAN and WGAN models across various metrics such as SSIM, PSNR, MMD, and 1-NN. Furthermore, this model, in combination with CGAN, is extended to construct CWGAN-GP with ResNet for targeted generation of four types of lithium-ion battery fault thermal images. Finally, the augmented lithium-ion battery fault thermal image dataset generated using CWGAN-GP with ResNet is fed into Mask R-CNN for training, revealing a significant improvement in model performance due to data augmentation.
Our research addresses the gap in using GAN to augment faulty samples in the field of lithium-ion battery thermal imaging. However, there is still a discernible gap in quality between the generated images and real ones. In the future, our efforts will primarily focus on two aspects: firstly, we will enhance the quality of generated lithium-ion battery thermal fault images by increasing network depth and adjusting its architecture. Secondly, we plan to conduct experiments to acquire genuine thermal images of faulty lithium-ion batteries. These images will be used as a dataset for CWGAN-GP with ResNet sample augmentation, allowing us to validate the effectiveness of this approach in practical applications.

References
Alliance CESJEO. Energy Storage Industry White Paper 2022 (Summary Version). 2021:06-29.
Huang B, Pan Z, Su X, An L. Recycling of lithium-ion batteries: Recent advances and perspectives. Journal of Power Sources. 2018;399:274-86.
Prajapati S, Upadhyay Y, Kumar Y, Singh MK. Investigation of thermal management system of a lithium-ion battery in electric vehicle. Materials Today: Proceedings. 2022;56:A1-A6.
Jingyun W, Zheng H, Pengyu G. Research progress on fre protection technology of LFP lithium-ion battery used in energy storage power station. Energy storage science and Technology. 2019;8:495.
Tang Z, Min X, Song A, Cheng J. Thermal management of a cylindrical lithium-ion battery module using a multichannel wavy tube. Journal of Energy Engineering. 2019;145:04018072.
Jiang Z, Qu Z, Zhang J, Rao Z. Rapid prediction method for thermal runaway propagation in battery pack based on lumped thermal resistance network and electric circuit analogy. Applied Energy. 2020;268:115007.
Yuan Q, Xu X, Zhu L, Tong G. Effects of Local Thermal Accumulation Conditions on the Thermal Characteristics of Lithium-Ion Batteries under High-Rate Charging. Journal of Energy Engineering. 2020;146:04020072.
Wang Q, Ping P, Zhao X, Chu G, Sun J, Chen C. Thermal runaway caused fire and explosion of lithium ion battery. Journal of Power Sources. 2012;208:210-24.
Wu B, Widanage WD, Yang S, Liu X. Battery digital twins: Perspectives on the fusion of models, data and artificial intelligence for smart battery management systems. Energy and AI. 2020;1:100016.
Legala A, Li X. Hybrid data-based modeling for the prediction and diagnostics of Li-ion battery thermal behaviors. Energy and AI. 2022;10:100194.
Zichen W, Changqing D. A comprehensive review on thermal management systems for power lithium-ion batteries. Renewable and Sustainable Energy Reviews. 2021;139:110685.
Li M, Dong C, Wang R, Yu X, Xiao Q, Jia H. Synthetic thermal convolutional ‐ memory network for the lithium ‐ ion battery behaviour diagnosis against noise interruptions. IET Energy Systems Integration.
2023;5:29-39.





Giammichele L, D’Alessandro V, Falone M, Ricci R. Thermal behaviour assessment and electrical characterisation of a cylindrical Lithium-ion battery using infrared thermography. Applied Thermal Engineering. 2022;205:117974.
Sequino L, Vaglieco BM. Potential of infrared temperature measurements for the online estimation of the state-of-charge of a Li-polymer battery. Journal of Energy Storage. 2021;44:103532.
Wang S, Li K, Tian Y, Wang J, Wu Y, Ji S. An experimental and numerical examination on the thermal inertia of a cylindrical lithium-ion power battery. Applied Thermal Engineering. 2019;154:676-85.
Franco AA. Multiscale modelling and numerical simulation of rechargeable lithium ion batteries: concepts, methods and challenges. Rsc Advances. 2013;3:13027-58.
Kingma DP, Welling M. An introduction to variational autoencoders. Foundations Trends® in Machine Learning. 2019;12:307-92.
Hinton GE, Osindero S, Teh Y-W. A fast learning algorithm for deep belief nets. Neural Computation. 2006;18:1527-54.
Goodfellow I, Pouget-Abadie J, Mirza M, Xu B, Warde-Farley D, Ozair S, et al. Generative adversarial networks. Communications of the ACM. 2020;63:139-44.
Naaz F, Herle A, Channegowda J, Raj A, Lakshminarayanan M. A generative adversarial network-based synthetic data augmentation technique for battery condition evaluation. International Journal of Energy Research. 2021;45:19120-35.
Zhang H, Tang W, Na W, Lee P-Y, Kim J. Implementation of generative adversarial network-CLS combined with bidirectional long short-term memory for lithium-ion battery state prediction. Journal of Energy Storage. 2020;31:101489.
Gu X, See K, Liu Y, Arshad B, Zhao L, Wang Y. A time-series Wasserstein GAN method for state-of-charge estimation of lithium-ion batteries. Journal of Power Sources. 2023;581:233472.
Liu C, Tan J, Wang X. A data-driven decision-making optimization approach for inconsistent lithium-ion cell screening. Journal of Intelligent Manufacturing. 2020;31:833-45.
Aggarwal A, Mittal M, Battineni G. Generative adversarial network: An overview of theory and applications. International Journal of Information Management Data Insights. 2021;1:100004.
Bird JJ, Barnes CM, Manso LJ, Ekárt A, Faria DR. Fruit quality and defect image classification with conditional GAN data augmentation. Scientia Horticulturae. 2022;293:110684.
Wang D, Yang K. A Data Generation Method for Electricity Theft Detection Using Generative Adversarial Network. Power Syst Technol. 2020;44:775-82.
Panaretos VM, Zemel Y. Statistical aspects of Wasserstein distances. Annual Review of Statistics its Application. 2019;6:405-31.
Arjovsky M, Chintala S, Bottou L. Wasserstein generative adversarial networks. International Conference on Machine Learning: PMLR; 2017. p. 214-23.
Mirza M, Osindero S. Conditional generative adversarial nets. arXiv preprint arXiv:14111784. 2014.
Setiadi DRIM. PSNR vs SSIM: imperceptibility quality assessment for image steganography. Multimedia Tools Applications. 2021;80:8423-44.
Huynh-Thu Q, Ghanbari M. Scope of validity of PSNR in image/video quality assessment. Electronics Letters. 2008;44:800-1.
Li C-L, Chang W-C, Cheng Y, Yang Y, Póczos B. Mmd gan: Towards deeper understanding of moment matching network. Advances in Neural Information Processing Systems. 2017;30.
Peng J, Kimmig A, Niu Z, Wang J, Liu X, Wang D, et al. Wind turbine failure prediction and health assessment based on adaptive maximum mean discrepancy. International Journal of Electrical Power
Energy Systems. 2022;134:107391.
Kontorovich A, Weiss R. A Bayes consistent 1-NN classifier. Artificial Intelligence and Statistics: PMLR; 2015. p. 480-8.
Bharati P, Pramanik A. Deep learning techniques—R-CNN to mask R-CNN: a survey. Computational Intelligence in Pattern Recognition: Proceedings of CIPR. 2020:657-68.


Research highlights
Generative	adversarial	network	to	expand lithium-ion battery faulty thermal image.
Quantitative analysis of generated thermal images of lithium batteries.
The expanded dataset effectively improved the accuracy of fault detection.

Graphical Abstract


G Loss




Fully connected layer Residual block
Declaration of interests

☒ The authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper.

The authors declare the following financial interests/personal relationships which may be considered as potential competing interests:
