Electronic Notes in Theoretical Computer Science 106 (2004) 3–24	
www.elsevier.com/locate/entcs


From Iterative Algebras to Iterative Theories (Extended Abstract)†

Jiˇr´ı Ada´mek1 ,2	Stefan Milius2
Institute of Theoretical Computer Science, Technical University, Braunschweig, Germany

Jiˇr´ı Velebil1 ,3
Faculty of Electrical Engineering, Technical University, Prague, Czech Republic


Abstract
Iterative theories introduced by Calvin Elgot formalize potentially infinite computations as solu- tions of recursive equations. One of the main results of Elgot and his coauthors is a description of a free iterative theory as the theory of all rational trees. Their algebraic proof of this fact is extremely complicated. In our paper we show that by starting with “iterative algebras”, i. e., alge- bras admitting a unique solution of all systems of flat recursive equations, a free iterative theory is obtained as the theory of free iterative algebras. The (coalgebraic) proof we present is dramatically simpler than the original algebraic one. And our result is, nevertheless, much more general: we describe a free iterative theory on any finitary endofunctor of every locally presentable category ffi. This allows us, e. g., to consider iterative algebras over any equationally specified class ffi of finitary algebras.
Keywords: free iterative theory, rational monad, coalgebra



† The full version of this paper containing all proofs can be found at the URL http://www.iti.cs.tu-bs.de/~milius
1 The first and the third author acknowledge the support of the Grant Agency of the Czech
Republic under the Grant No. 201/02/0148.
2 Email:{adamek,milius}@iti.cs.tu-bs.de
3 Email:velebil@math.feld.cvut.cz



1571-0661 © 2004 Elsevier B.V. Open access under CC BY-NC-ND license.
doi:10.1016/j.entcs.2004.02.033

Introduction
Iterative theories have been introduced by Calvin C. Elgot [9] as a model of computation formalized as a sequence of instantaneous descriptions of an abstract machine. He and his co-authors then proved that for every signature Σ a free iterative theory on Σ exists [7] and that it consists of all rational Σ-trees [10]. Recall that a Σ-tree (i. e., a tree, possibly infinite, labelled by operation symbols in Σ so that every node with n children is labelled by an n- ary symbol) is rational if it has up to isomorphism only finitely many subtrees, see [13].
In the present paper we introduce iterative algebras rather than iterative theories, and we show that the theory formed by all free iterative algebras is Elgot’s free iterative theory. In the classical case of Σ-algebras, iterativity has been introduced by Evelyn Nelson [16] as follows: given a Σ-algebra A, let us consider an arbitrary system of recursive equations
(1.1)	xi ≈ ti,	i = 1,...,n, 
where X = {x1, x2,... , xn} is a finite set of variables and t1, t2, ..., tn are terms over X + A, none of which is a single variable xi. The algebra A is called iterative provided that for every such system of equations there exists a unique solution. That is, there exists a unique n-tuple x1†, x2†, ..., xn† of elements of A such that each of the formal equations in (1.1) becomes an equality after the substitution x1†/x1, x2†/x2, ..., xn†/xn:
xi† = ti(x1†/x1, x2†/x2,..., xn†/xn) ,	i = 1,... , n.
Example: let Σ consist of a single binary operation symbol, ∗, then the algebra
A of all (finite and infinite) binary trees is iterative. For example, the system


(1.2)
x1 ≈ x2 ∗ t
x2 ≈ (x1 ∗ s) ∗ t

where s and t are trees in A has the unique solution x1† = ·· ·∗s)∗t)∗t)∗s)∗t)∗t, and analogously for x2†.
Every system (1.1) above can be modified to a flat system, i.e., one where each right-hand side is either a flat term
ti = σ(x1,... , xk) ,	for σ ∈ Σk, x1,... , xk ∈ X, or an element of A
ti ∈ A.
For example, the above system (1.2) has the following modification to a flat



system:

x1 ≈ x2 ∗ x3	x3 ≈ t	x5 ≈ s x2 ≈ x4 ∗ x3	x4 ≈ x1 ∗ x5

Therefore, an algebra is iterative iff every flat equation system has a unique
solution.
Now Σ-algebras are a special case of algebras for an endofunctor H : ffi −→ ffi (which are pairs consisting of an object A of ffi and a morphism α : HA −→ A): here ffi is the category of sets and H = HΣ is the polynomial functor given on objects by HΣX = Σ0 + Σ1 × X + Σ2 × X2 + ·· ·. For an algebra (A, α) observe that a flat equation system has its right-hand sides in HΣX + A, thus, it can be represented by a morphism
e : X −→ HΣX + A,	e(xi)= ti.
A solution of e is then a morphism
e† : X −→ A,	e†(xi)= xi† ,
with the property that the following diagram
X	e†	 A 

(1.3)
e
J 	 
[α,A]


commutes.
H X + A
HΣ
e†+A
HΣA + A

Definition 1.1 A Σ-algebra A is called iterative provided that for every flat equation morphism e : X −→ HΣX + A, where X is a finite set, there exists a unique solution e† : X −→ A.
“Classical” algebras are seldom iterative. But there are enough interesting iterative algebras. For example, the algebra
TΣ
of all (finite and infinite) Σ-trees is iterative. And so is its subalgebra
RΣ
of all rational Σ-trees. In fact, the full subcategory Algit Σ of Alg Σ formed by all iterative Σ-algebras is rich enough: a limit or a filtered colimit of iterative algebras is always iterative, thus Algit Σ is reflective in Alg Σ (see Reflection Theorem in [6]). From this it follows that every set generates a free iterative algebra, i. e., the forgetful functor Algit Σ −→ Set is a right-adjoint. This defines a monad RΣ on Set. We prove that
RΣ is a free iterative monad on HΣ,

and
RΣ assigns to every set X the algebra RΣX of all rational Σ-trees on X.
In this way a new proof of the result of Elgot et al. describing a free iterative monad (or theory) is achieved.
In our proof we work with an arbitrary endofunctor H of the category of sets which is ﬁnitary, i. e., preserves filtered colimits. As in Definition 1.1, an algebra α : HA −→ A is called iterative if for every flat equation morphism e : X −→ HX + A, where X is a finite set, there exists a unique solution,
i. e., a unique morphism e† : X −→ A with e† = [α, A] · (He† + A) · e, compare with (1.3). The main technical result is coalgebraic: in order to describe a free iterative algebra on a set Y , we form the diagram EqY of all coalgebras e : X −→ HX + Y of the endofunctor H(−)+ Y on finite sets X. We prove that a colimit of that diagram
RY = colim EqY
carries naturally the structure of an algebra, and that RY is a free iterative algebra on Y . From that we derive that the monad R(−) is a free iterative monad on H. In our proof the fact that H is a finitary endofunctor of Set plays no roˆle: the same result holds for finitary endofunctors of all locally finitely presentable categories. Thus, if we start with e. g. an equational class ffi of finitary algebras then, again, for every finitary endofunctor H the free iterative algebras RY are constructed as colimits of coalgebras of H(−)+ Y on finitely presentable objects of ffi, and they form a free iterative theory on H.
Related Work. In the classical setting, i. e., for polynomial endofunctors of Set, iterative algebras were introduced by Evelyn Nelson [16] to obtain a short proof of Elgot’s free iterative theories. Our paper can be seen as a categorical generalization of that paper with distinctive coalgebraic “flavour”. Also Jerzy Tiuryn introduced a concept of iterative algebra in [17] with the same aim as ours: to relate iterative theories of Elgot to properties of algebras. But the approach of [17] is fundamentally different from ours; e.g., the trivial, one-element, algebra is not iterative in the sense of Tiuryn, thus, his iterative algebras are not closed under limits.
The description of the rational monad as a colimit is also presented in [12]. The present paper is a dramatic improvement of our previous descrip- tion of the rational monad in [3], [4] where we assumed that the endofunctor preserves monomorphisms and the underlying category satisfies three rather technical conditions, and the proof was much more involved. The current ap- proach includes all equationally defined algebraic categories as base categories


(whereas in [4] we still needed strong side conditions which only hold in very few algebraic categories). All proofs have been omitted, the reader can find them in the full version of our paper [5].

Iterative Algebras
Notation 2.1 Throughout the paper all categories are assumed to have finite coproducts. We denote by inl and inr the coproduct injections of A + B.
In order to define the concept of a flat equation morphism as in the intro- duction (a morphism e : X −→ HX + A in Set where X is finite) in a general category, we need the appropriate generalization of finiteness. Recall that a functor is called ﬁnitary provided that it preserves filtered colimits. A set is finite if and only if its hom-functor is finitary. This has inspired Gabriel and Ulmer [11] to the following
Definition 2.2 An object of A a category ffi is ﬁnitely presentable if its hom- functor ffi(A, −): ffi −→ Set is finitary.
A category ffi is called locally ﬁnitely presentable provided that it has col- imits and a (small) set of finitely presentable objects whose closure under filtered colimits is all of ffi.
Examples 2.3
Set, the category of posets, and every variety of finitary algebras are locally finitely presentable.
Let H be a finitary endofunctor of a locally finitely presentable category ffi. Then the category Alg H of H-algebras and homomorphisms is also locally finitely presentable, see [6].
Definition 2.4 Given an endofunctor H : ffi −→ ffi, by a ﬁnitary flat equation morphism (later just: equation morphism) in an object A we mean a morphism e : X −→ HX + A of ffi, where X is a finitely presentable object of ffi.
Suppose that A is an underlying object of an H-algebra α : HA −→ A. Then by a solution of e in the algebra A is meant a morphism e† : X −→ A in ffi such that the square
X	e†	 A 

(2.1)
e
HX J 	 
[α,A]


commutes.
+ A	He†+A
HA + A

An H-algebra is called iterative provided that every finitary flat equation morphism has a unique solution.


Example 2.5
Groups, lattices etc. considered as Σ-algebras are seldom iterative. For example, if a group is iterative, then its unique element is the unit element 1, since the recursive equations x ≈ x · y, y ≈ 1 have a unique solution. If a lattice is iterative, then it has a unique element: consider x ≈ x ∨ x.
The algebra of addition on the set
 = { 1, 2, 3,... }∪ { ∞ }
is iterative (and “almost classical”). (Observe that 0 is not included. This is forced by the uniqueness of solutions of x = x + x.)
The algebras TΣ and RΣ (see Introduction) are iterative.
Remark 2.6 We denote by
Algit H
the category of all iterative algebras and all homomorphisms.
Proposition 2.7 Iterative algebras are closed under limits and ﬁltered colim- its in Alg H.
The proof is a rather simple calculation based on the fact that Alg H has limits and filtered colimits formed on the level of the base category. Using the Reflection Theorem of [6] we derive:
Corollary 2.8 The category Algit H is a reflective subcategory of Alg H.
Corollary 2.9 Every object of ffi generates a free iterative H-algebra.
In other words, the natural forgetful functor U : Algit H −→ ffi has a left adjoint.
Definition 2.10 The finitary monad on ffi formed by free iterative H-algebras is called the rational monad of H and is denoted by R = (R, η, µ).
Thus, R is the monad of the above adjunction
R	
Algit H 	⊥	 ffi 
U
More detailed, for every object Z of ffi we denote by RZ a free iterative H- algebra on Z with the universal arrow
ηZ : Z −→ RZ ,
and the algebra structure
ρZ : HRZ −→ RZ .


Then µZ : RRZ −→ RZ is the unique homomorphism of H-algebras with
µZ · ηRZ = id .
Proposition 2.11 An initial iterative algebra of the endofunctor H(−)+ Z
is precisely a free iterative H-algebra on Z.
Example 2.12 The rational monad of HΣ : Set −→ Set.
Recall from the introduction the algebra TΣ of all (finite and infinite) Σ-trees. This algebra is iterative — this is folklore. For every set Z the algebra TΣZ of all Σ-trees over Z (i. e., trees with nodes having n > 0 children labelled by n-ary operation symbols and leaves labelled by constant symbols

or variables from Z) is also iterative, since TΣZ = TΣ' , where Σ'
= Σ0 + Z,

and Σ' = Σi, for i > 0.
As proved in [16] the subalgebra RΣZ of all rational Σ-trees, i.e., Σ-trees over Z which have only finitely many subtrees (up to isomorphism), is a free iterative Σ-algebra on Z.
Corollary 2.13 The rational monad RΣ of the polynomial endofunctor HΣ of Set is given by the formation of the Σ-algebras RΣ(Z) of all rational Σ-trees over Z.
Example 2.14 The rational monad of Pfin : Set −→ Set, the finite power-set functor has been described in [2]: it assigns to a set X the algebra A(X)/∼, where A(X) is the algebra of all rational extensional finitely-branching trees (where “extensional” means that every pair of distinct siblings define non- isomorphic subtrees). And ∼ is the largest bisimulation of A(X) defined as follows: t ∼ s iff the cuttings at level n have the same extensional quotients, for all natural numbers n.

A Coalgebraic Construction
The aim of this section is to describe an initial iterative H-algebra as a colimit of a simple diagram Eq in the given base category ffi. We assume throughout this section that
ffi is a locally finitely presentable category, see Definition 2.2, and
H is a finitary endofunctor of ffi.
We choose a set ffifp of representatives of finitely presentable objects of ffi w.r.t. isomorphism.
The initial iterative algebra is proved to be a colimit of the diagram
Eq : EQ −→ ffi


whose objects are all H-coalgebras carried by finitely presentable objects of
ffi:
e : X −→ HX	with X in ffifp,
with the usual coalgebra homomorphisms as morphisms, and with Eq the obvious forgetful functor e '−→ X.
A colimit
R0 = colim Eq
of this diagram (with colimit morphisms e : X −→ R0 for all e : X −→ HX
in EQ) yields a canonical morphism
i : R0 −→ HR0
Namely, i is the unique morphism such that every e becomes a coalgebra homomorphism, i.e., the squares
X 	e	 H X

(3.1)
e	He 
J	 J 

R0	i	H R0
commute. (In fact, the forgetful functor Coalg H −→ ffi creates colimits.)
Theorem 3.1 R0 is the initial iterative H-algebra. More precisely, the mor- phism i is an isomorphism and i−1 : HR0 −→ R0 is an initial iterative H- algebra.
Sketch of Proof. (a) It is easy to see that the diagram Eq is filtered, and the morphisms He · e form a cocone, thus, i is well-defined. We now construct a morphism j : HR0 −→ R0 and prove that it is inverse to i. We use the fact that in a locally finitely presentable category the given object HR0 is a colimit of the diagram of all arrows p : P −→ HR0 where P is in ffifp. More precisely, let ffifp/HR0 denote the comma-category (of all these arrows p), then the forgetful functor DHR0 : ffifp/HR0 −→ ffi has, in ffi, the colimit cocone formed by all p : P −→ HR0. Thus, in order to define j we need to define morphisms jp : P −→ R0 forming a cocone of the diagram DHR0 . We know that HR0 is a filtered colimit of H · Eq and that ffi(P, −) preserves this colimit, since P is in ffifp. Therefore, p factors through one of the colimit morphisms
P ¸	p	 H R

(3.2)
¸¸¸¸
¸¸¸
,0,
Hg 

p'	¸¸¸z˛
HW


for some g : W −→ HW in EQ. We form a new object

ep' ≡ P + W
[p',g]
HW
 Hinr  H (P + W )

of EQ and define j to be the unique morphism such that the following square
P 	inl	 P + W

(3.3)
p	ep' 
J	J 

HR0	j	 R 0

commutes for every p in ffifp/HR0. To prove that this is well-defined we need to show that
ep' inl is independent of the choice of factorization (3.2), and
the morphisms ep' · inl form a cocone of ffifp/HR0. And then we verify j = i−1.
To prove that (R0, i−1) is an iterative algebra we just show existence of solutions, leaving out uniqueness. For every equation morphism
e : X −→ HX + R0 = colim(HX + Eq)
there exists, since X is finitely presentable, a factorization through the colimit morphism HX + f (for some f : V −→ HV in EQ):

X ¸¸¸
e	 H X +,,R0

(3.4)
¸¸¸¸
e0  ¸¸¸

HX+f 

¸z˛
HX + V
Recall from 2.1 that can : HX + HV −→ H(X + V ) denotes the canonical morphism. Define a new object, e, of EQ as follows:


(3.5)
e ≡ X + V [e0,inr ] H X + V HX+f H X + HV  can H (X + V )



Observe that (3.6)

f = e · inr

because inr : V −→ X + V is a coalgebra morphism (in EQ) from f to e. We define a solution of e by


(3.7)


e† ≡ X  inl  X + V	e  R .


In fact, in the following diagram



†
r~	,,,, ,¸0 ,
e	i−1,,,
,,,
J  HX+ f	[He† ,Hf ] H R ,


(3.8)	e
HX + V
HX + H¸V
¸¸¸
  ¸¸
,0,
[He† ,HR0]

[i−1,R0]


HX+f 
(i)
HX+Hf
¸¸z˛
H˛X  + HR0

,¸ H X J 
HX,+,i,,,,,,,,,
,,,,,,,,,,
He†+R0

 H R0 + R0


all inner parts commute: see (3.4) for the left-hand part, (3.1) for part (i), whereas the lower part commutes trivially (analyze the two components sep- arately) and so does the middle triangle. It remains to verify the upper part: here we use (3.1) and (3.5) to conclude that the following diagram


X 	inl	 X + V	e	 R 

[e0,V,,] ,,,,,
J ,,,,,	J 
,0 ˛

s,
HX + V
H(X + V )

can,,,,, ¸
i−1

HX+f
,,,,,
(ii)
He 

J ,,
	 J 

HX + HV
†	 H R0

[He ,Hf ]


commutes. In fact, the left-hand component of (ii) commutes by definition of e† and the right-hand one does by (3.6). Thus, (3.8) commutes, proving that e† is a solution of e.
Initiality. Let α : HA −→ A be an iterative H-algebra. We prove first that there is at most one H-algebra homomorphism from R0. Let


HR0
i−1	 R 

Hh	h
J	 J 
HA	α	A


be a homomorphism. For every object e : X −→ HX of EQ the following diagram
X	e	 R 	h	 A 
ccc ,,,
cccc
ccccα

(3.9)
J		J	
cccc
[α,A]

HX
inl
He 
 H R0 Hh H A

HX J 	 

+ A	H(he )+A
HA + A

commutes, see (3.1), which proves that he is a solution of inl e in A.
This determines h uniquely, since the e ’s form a colimit cocone of R0 = colim Eq.
Conversely, let us define a morphism h : R0 −→ A by the above rule
he = (inl e)†	for all e : X −→ HX in EQ
where (−)† is the unique solution in A. This is well-defined since the mor- phisms (inl e)† form a cocone of the diagram Eq: in fact, let
X 	e	 H X
p	Hp
J	 J 
Y	f	HY
be a morphism of EQ. We prove that (inl f )†p is a solution of inl e by consid- ering the corresponding diagram:

X 	p	 Y e			f
(inl f )†
A,,

J	Hp	 J 
[α,A]

HX
inl
HY
inl

HX J 	  J 	 


This proves
+ A	Hp+A
HY + A	†	HA + A
H(inl f ) +A

(inl e)† = (inl f )†p. 
The morphism h above is a homomorphism of algebras because the dia- gram (3.9) commutes: the outward square commutes by definition of h, the upper left-hand square by (3.1), and the lower part is obvious. This shows that the upper right-hand part commutes when precomposed with e , e in EQ. Since the e ’s form a colimit cocone, it follows that h is a homomorphism. 


Corollary 3.2 A free iterative H-algebra RZ is a colimit,
RZ = colim EqZ

of the diagram

EqZ : EQZ −→ ffi

where EQZ consists of all equation morphisms e : X −→ HX + Z, X ∈ ffifp (and the connecting morphisms are the coalgebra homomorphisms w.r.t. H(−)+ Z) and EqZ sends e to X.
In fact, this is a consequence of Proposition 2.11 and Theorem 3.1.
Remark 3.3 We denote, again, the colimit morphisms of EqZ by
e : X −→ RZ
for all e : X −→ HX + Z in EQZ. The appropriate isomorphism is denoted by
iZ : RZ −→ HRZ + Z
It is characterized by the fact that the two coproduct injections of HRZ + Z
are (in the notation of Definition 2.10)
inl = iZρZ	and	inr = iZηZ
In other words, iZ = [ρZ, ηZ]−1.

An Alternative Definition of Iterativity
In the Introduction we considered non-flat systems (1.1) of recursive equations for Σ-algebras. And we argued that, due to the possibility of flattening such a system, we will just have to consider the flat equation morphism e : X −→ HΣX + A. We are going to make that statement precise by showing that in iterative algebras (in general, not only in Set) much more general systems of recursive equations are uniquely solvable. This implies that, for polynomial endofunctors of Set, our definition of iterative algebras coincides with that presented by Evelyn Nelson [16]. And as we explain in the next section, it also implies that the rational monad is iterative in the sense of Calvin Elgot [9]. Let us first remark that the condition stated in the Introduction for (1.1), that no right-hand side be a single variable, is substantial: the equation x ≈ x has a unique solution only in the trivial terminal algebras. Systems satisfying
the above condition are called guarded.
We first consider guarded systems where the right-hand sides live in the free H-algebra (i. e., finite trees in case H = HΣ). Such systems are called ﬁnitary.

Since H is finitary we have for every object X in ffi a free algebra ϕ0 :

HFX −→ FX on X with universal arrow η0
monad F = (F, η0, µ0) where the component µ0
: X −→ FX. This defines a
is the unique homomorphism

0 : FFX −→ FX with µ0	0	= id . It is easy to see that FX is an initial
algebra of H(−)+ X; thus, by Lambek’s Lemma [14] the morphism
jX = [ϕ0 , η0 ]: HFX + X −→ FX 
X	X
is an isomorphism. For every H-algebra α : HA −→ A we have the unique homomorphism
α^ : FA −→ A	with	α^ · ηA = id
(which, in case of HΣ, is the computation of (finite) terms over A in the Σ- algebra A). This allows us to define solutions of finitary equations morphisms in A as follows:
Definition 4.1
By a ﬁnitary equation morphism in an object Y (of parameters) is meant a morphism
e : X −→ F (X + Y ),	X finitely presentable.
Given an H-algebra α : HA −→ A and a morphism f : Y −→ A (inter- preting the parameters in A), we say that the finitary equation morphism e has a solution e† : X −→ A, induced by f provided that the square
e†
X 	f	 A 


(4.1)

commutes.
e
J 
F (X + Y )


F [e† ,f ]
αb
 F A 

We call e guarded provided that it factors through the summand
HF (X + Y )+ Y of F (X + Y )= HF (X + Y )+ X + Y (see jX+Y above):
	e	 F (X + Y )
,,
[ϕ0,η0·inr ]
z˛
HF (X + Y )+ Y
Remark 4.2
The square (4.1) in Definition 4.1 means, for polynomial functors, that

the assignment e†
of variables x ∈ X to elements of A has the following


property: form the “substitution” mapping [e† ,f ]: X + Y −→ A (which interprets the variables as e† does, and the parameters as f does). Extend it to the unique homomorphism
α^ · F [e† ,f ]: F (X + Y ) −→ A
of the free algebra. Then the (formal) equations x ≈ e(x) become actual identities in A after the substitution x '−→ e† (x) for all x ∈ X.
The next result states that in an iterative algebra A every finitary guarded
equation morphism e : X −→ F (X + Y ) defines unique function e†	:
ffi(Y, A) −→ ffi(X, A) such that (4.1) commutes for every f ∈ ffi(Y, A).
Theorem 4.3 An H-algebra A is iterative if and only if every ﬁnitary guarded equation morphism has, for any interpretation of the parameters in A, a unique solution.
Remark 4.4 The proof of Theorem 4.3 follows from the next result, gener- alizing “finitary” to “rational”. That is, let α : HA −→ A be an iterative algebra. We denote (analogously to α^ above) by
α˜ : RA −→ A
the unique homomorphism of H-algebras with α˜·ηA = id . We define a rational equation morphism on an object Y as a morphism
e : X −→ R(X + Y ),	X finitely presentable.
Given a morphism f : Y −→ Z, the solution of e induced by f is a morphism
e† : X −→ A such that the square


X
e
J 
R(X + Y )
e†
f	 A 
αe
†	 R A
R[ef ,f ]

commutes. Finally, e is called guarded if it factors through the summand
HR(X + Y )+ Y of R(X + Y )= HR(X + Y )+ X + Y (see Remark 3.3).
Theorem 4.5 In an iterative algebra, for every guarded rational equation morphism e and every interpretation f of its parameters there exists a unique solution e† .


Sketch of Proof. Let α : HA −→ A be an iterative algebra. Given a guarded rational equation morphism
	e	 R (X + Y )
,,
[ρX+Y ,ηX+Y ·inr ]
z˛
HR(X + Y )+ Y

and a morphism f : Y −→ A, we will prove that e has a solution induced by f ; we leave out the proof of the uniqueness.
Recall from Corollary 3.2 that R(X + Y ) = colim EqX+Y with colimit cocone g : W −→ R(X + Y ) for all g : W −→ HW + X + Y in EQX+Y . Since this colimit is filtered and H is finitary, this implies that
HR(X + Y )+ Y = colim HEqX+Y + Y

with the colimit cocone formed by all Hg +Y . Since X is a finitely presentable object, the morphism
e0 : X −→ colim HEqX+Y + Y
factors through the colimit cocone:


X ¸¸¸
e0	 H R(X + Y )+ Y

¸¸¸¸¸
w ¸¸¸¸
,,
Hg +Y

¸¸z˛
HW + Y
for some object g : W −→ HW + X + Y of EQX+Y and some morphism w.
We define a finitary flat equation morphism as follows:


(4.2)
⟨e⟩≡W +X [g,inm ] HW +X+Y [inl ,w,inr ] HW +Y Hinl +f H( W +X)+A


where inm : X −→ HW + X + Y is the middle coproduct injection. We obtain a unique solution ⟨e⟩† : W + X −→ A and prove that the following morphism


(4.3)
e† ≡ X
 inr  W + X
⟨e⟩† 



is a solution of e induced by f .

Indeed, consider the following diagram:


†
X,¸¸¸¸¸¸

,,, ˛ A, ,,

,¸,¸¸
¸¸¸¸¸¸¸¸¸¸inr
⟨e⟩†,,,,,,,,
ccc

, ¸
,,, ¸¸¸w
¸¸¸¸¸¸¸¸¸¸¸¸
,,,,,,,,,,
cc
[α,A] c

,, ¸¸¸
W +X
ccc

,,, ¸¸¸
⟨e⟩
ccc

e0 ,,
¸¸z 	
J 	† 	cc

e	,,
Hinl +f 
H⟨e⟩ +A 

(4.4)
HW +Y
,,,
H(W +X)+A	HA+,A,	αe
(i)	Hαe+A

, Hg +Y
zJz 

	  ¸

HR(X+Y )+Y
[ρ,η·inr ,] ,,,,
J , ,,,,,
HR[e† ,f ]+f
HRA+A¸¸
¸¸¸¸z 

R(X+Y )  s	 
R[ef ,f ]
All of its parts, except, perhaps, for the square (i), commute. The right-hand component of (i) is obvious. To prove the commutativity of the left-hand component of (i), we remove H and show that the equation

(4.5)
⟨e⟩† · inl = α˜ · R[e† ,f ] · g 

holds. To this end observe first that α˜ · R[e† ,f ] : R(X + Z) −→ A is an H-algebra homomorphism between iterative algebras extending [e† ,f ]. Pre- composing this homomorphism with the colimit injection g : W −→ R(X +Z) yields the unique solution of an equation morphism g in the iterative algebra
A. Thus, to establish (4.5) it suffices to show that ⟨e⟩† · inl is a solution of g. In fact, the outward square of the following diagram

r~	W

	inl	 W + X
⟨e⟩†
A,,


J 
HW + X + Y
¸¸¸[¸in¸l ,w,inr ]
g	¸¸¸¸¸z˛




⟨e⟩




[α,A]

HW +[e† ,f ]
HW + Y

,,,,,,
,¸	J ,,,,H,W +f
¸¸¸¸¸H¸¸inl +f
¸¸¸¸¸z˛J 

 H W +
s,	 H (W + X)+ A
 H A + A

A	Hinl +A


H⟨e⟩† +A

commutes.	 

Corollary 4.6 Every rational guarded equation morphism e : X −→ R(X +
Y ) has a unique solution in the algebra RY , i. e., there exists a unique e‡ :

X −→ RY such that the square
X	e‡	 R Y

e
J 
R(X + Y )


R[e‡ ,η]
µ

 R RY

commutes.
In fact, apply Theorem 4.5 to the iterative algebra RY and the morphism
ηY : Y −→ RY .

Free Iterative Monads
Assumptions 5.1 Throughout this section H denotes a finitary endofunctor of a locally finitely presentable category ffi. We suppose, just for convenience, that coproduct injections in ffi are monomorphisms — this assumption can be avoided, see the full version [5], where we work with arbitrary finitary endofunctors H (and with idealized monads, generalizing the ideal monads below) in the last section.
We are going to prove that the rational monad R, introduced in Section 2, is iterative in the sense of C. Elgot, and that it can be characterized as a free iterative monad on H.
5.2. Iterative Monads. This is a concept that C. Elgot has introduced in [9] for the base category ffi = Set. He used the language of algebraic theories rather than monads, but we have proved in [1] that the following concepts are equivalent to those of Elgot.
Definition 5.3 By an ideal monad is understood a sixtuple
S = (S, η, µ, S', σ, µ')
consisting of a monad (S, η, µ), a subfunctor σ : S' ‹−→ S, and a natural transformation µ' : S'S −→ S' such that
S = S' + Id with coproduct injections σ and η
and
µ' is a restriction of µ, i. e., the square

S'S
σS
µ'	 ' 

σ

J	 J 
SS	µ	S


commutes.
Examples 5.4
The rational monad R = (R, η, µ) on an endofunctor H is ideal. Here we consider the subfunctor
ρ : HR ‹−→ R
expressing the H-algebra structure ρZ : HRZ −→ RZ of each RZ, see Definition 2.10. The restriction of µ here is
µ' = Hµ : HRR −→ HR .
The free-algebra monad F of Section 4 is ideal (again consider ϕ0 :
HF −→ F ).
Classical algebraic theories (groups, lattices, etc.) are usually not ideal.
Definition 5.5 Let S = (S, η, µ, S', σ, µ') be an ideal monad on ffi.
By a ﬁnitary equation morphism is meant a morphism
e : X −→ S(X + Y )
in ffi where X is a finitely presentable object (“of variables”) and Y is any object (“of parameters”).
By a solution of e is meant a morphism
e† : X −→ SY

for which the square

X	e†	 SY 




commutes.
e
J 
S(X + Y )


S[e†,ηY ]
µY

 SS Y

The equation morphism e is called guarded if it factors through the sum- mand S'(X + Y )+ Y of S(X + Y )= S'(X + Y )+ X + Y :
	e	 S( X + Y )
,,
[σX+Y ,ηX+Y inr ]
z˛

The ideal monad S is called iterative provided that every guarded finitary equation morphism has a unique solution.
Example 5.6 The rational monad of every finitary endofunctor is iterative, see Corollary 4.6.


Definition 5.7 An ideal monad morphism from an ideal monad (S, η, µ, S', σ, µ') to another one (T, ηT , µT ,T ', τ, µ'T ) is a monad mor- phism λ : (S, η, µ) −→ (T, ηT , µT ) which has a domain-codomain restriction to the ideals. That is, there is a natural transformation λ' : S' −→ T ' with λ · σ = τ · λ'.
Given a functor H, a natural transformation λ : H −→ S is called ideal
provided that it factors through σ : S' ‹−→ S.
Example 5.8 For the rational monad R, the natural transformation
κ ≡ H  Hη  H R   ρ  R 
is ideal.
Theorem 5.9 (Rational Monad as a Free Iterative Monad.) For every iterative monad S and every ideal natural transformation λ : H −→ S there exists a unique ideal monad morphism λ : R −→ S with λ = λ · κ.
Remark. Let us form the category Fin(ffi, ffi) of all finitary endofunctors and natural transformations. For the category
FIM(ffi)
of all finitary iterative monads (i.e., iterative monads (S, η, µ, S', σ, µ') with S
and S' finitary) and ideal monad morphisms we have a forgetful functor
U : FIM(ffi) −→ Fin(ffi, ffi),	S '−→ S'
The theorem states that U has a left adjoint, viz, the functor H '−→ R.
Sketch of Proof. (1) For every object Z consider SZ as an H-algebra
HSZ  λSZ  SS Z  µZ  SZ  .
It is iterative. In fact, every equation morphism e : X −→ HX + SZ, X in
ffifp, yields the following guarded equation morphism w.r.t. S:
e ≡ X 	e	 H X + SZ  λX +SZ  SX  + SZ   can	 S( X + Z) ,
and it is not difficult to prove that a morphism e† : X −→ SZ is a solution of e in the H-algebra SZ if and only if it is a solution of e w.r.t. the iterative monad S.

Denote by λZ : RZ −→ SZ the unique homomorphism of H-algebras with
λZ · ηZ = ηS. Then λ : R −→ S is a monad morphism with λ = λ · κ. And λ



is ideal:

HRZ 	ρZ	 R Z

HλZ

J 
HSZ¸¸¸¸

'
SZ
J 
S SZ σ
λSZ
¸¸¸z	λZ
 SS Z¸

SZ
'	¸µZ
Z J	¸¸¸zJ 

S'Z	σ
 SZ 


	
We see that µ'S · λ'S · Hλ : HR −→ S' is the desired restriction of λ.

Uniqueness of λ. Suppose that λ : R −→ S is an ideal monad morphism with λ·κ = λ. For any object Z, λZ is an H-algebra homomorphism extending ηS, thus the freeness of RZ as an iterative H-algebra establishes the desired uniqueness.	 
Remark 5.10 For polynomial endofunctors on Set, the freeness of R special- izes to second order substitution, see [8], i. e., substitution of rational trees for operation symbols.
For example, consider a signature Σ with a binary operation symbol b, and a unary one u, and another signature Γ with two binary operation symbols + and ∗ and a constant symbol 1. The assignment
∗,
sss ,,,	+,

(5.1)
b(x, y) '−→ 1s
+,	u(x) '−→
sss
,,,,

ssss
xs
,,,
y
xss	x

of operation symbols in Σ to rational trees over Γ gives rise to a natural transformation λ : HΣ −→ RΓ. The induced ideal monad morphism λ : RΣ −→ RΓ replaces, for any set of variables X, the operation symbols in trees of RΣX according to λ. Example:
∗,


sss
b,,
,
ss ,,
s
1	+,

λ({ h, k }): us
k	'−→
ssss
+,,
,,,
k

h	ssss ,,
h	h
The requirement that λ be an ideal transformation means that no operation


symbol of Σ is replaced by a single variable, i. e., that λ is a so-called non- erasing substitution.

Conclusions and Future Work
Our paper shows that finitary endofunctors H generate free iterative mon- ads without any restriction on H. Our proof, simpler and clearer than any presented before, is based on the concept of an iterative algebra. The main technical result is a description of an initial iterative algebra as a colimit of all H-coalgebras carried by finitely presentable objects. From this result we derived that the algebraic theory formed by all free iterative H-algebras is iterative in the sense of Calvin Elgot. In fact, that theory can be charac- terized as a free iterative theory on H. For polynomial endofunctors of the category of sets this approach has already been taken by Evelyn Nelson [16], but our proof is independent of hers. It substantially clarifies and simplifies the original proof (which occupies most of the papers [9,7,10]) as well as the coalgebraic proof we have found previously [3,4]. The freeness of the ratio- nal monad can be used to formulate clearly the “second-order substitution” described for rational Σ-trees by Bruno Courcelle [8], see Remark 5.10.
Our result can be applied to arbitrary base categories which are locally finitely presentable. For example, to the category of all finitary endofunctors of Set. In the future we intend to use this in an attempt to describe the monad of algebraic trees, see Courcelle [8], categorically.

References
P. Aczel, J. Ad´amek, S. Milius and J. Velebil, Infinite Trees and Completely Iterative Theories: A Coalgebraic View, Theoret. Comput. Sci. 300 (2003), 1–45.
J. Ad´amek, On a description of terminal coalgebras and iterative theories, Electron. Notes Theor. Comput. Sci. 82.1 (2003).
J. Ad´amek, S. Milius and J. Velebil, Free Iterative Theories — A Coalgebraic View,
Math. Structures Comput. Sci. 13 (2003), 259–320.
J. Ad´amek, S. Milius and J. Velebil, On Rational Monads and Free Iterative Theories,
Electron. Notes Theor. Comput. Sci. 69 (2003).
J. Ad´amek, S. Milius and J. Velebil, From Iterative Algebras to Iterative Theories, full version, available via http://www.iti.cs.tu-bs.de/~milius/

J. Ad´amek and J. Rosicky´, Locally presentable and accessible categories, Cambridge University Press, 1994.
S. Bloom and C. C. Elgot, The Existence and Construction of Free Iterative Theories,
J. Comput. System Sci. 12 (1974), 305–318.
B. Courcelle, Fundamental Properties of Infinite Trees, Theoret. Comput. Science 25 (1983), 95–169.


C. C. Elgot, Monadic Computation and Iterative Algebraic Theories, in: Logic Colloquium ’73
(eds: H. E. Rose and J. C. Shepherdson), North-Holland Publishers, Amsterdam, 1975.
C. C. Elgot, S. L. Bloom and R. Tindell, On the Algebraic Structure of Rooted Trees,
J. Comput. System Sci. 16 (1978), 361–399.
P. Gabriel and F. Ulmer, Lokal pra¨sentierbare Kategorien, Lecture N. Math 221, Springer- Verlag, Berlin 1971.
N. Ghani, C. Lu¨th and F. De Marchi, Electron. Notes Theor. Comput. Sci 65(1), 2002.
S. Ginali, Regular trees and the free iterative theory, J. Comput. System Sci. 18 (1979), 228– 242.
J. Lambek, A fixpoint theorem for complete categories, Math. Z. 103 (1968), 151–161.
S. Milius, On Iteratable Endofunctors, Electron. Notes Theor. Comput. Sci 69 (2003).
E. Nelson, Iterative Algebras, Theoret. Comput. Science 25 (1983), 67–94.
J. Tiuryn, Unique Fixed Points vs. Least Fixed Points, Theoret. Comput. Sci. 12 (1980), 229– 254.
