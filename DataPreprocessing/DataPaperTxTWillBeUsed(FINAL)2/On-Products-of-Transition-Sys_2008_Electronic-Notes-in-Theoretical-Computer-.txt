	Electronic Notes in Theoretical Computer Science 203 (2008) 93–107	
www.elsevier.com/locate/entcs
On Products of Transition Systems
Egbert Fohry1
Fachbereich Mathematik und Informatik Philipps-Universit¨at Marburg
Marburg, Germany


Abstract
For an arbitrary set endofunctor F we give a sufficient and necessary criterium for the existence of products of F -coalgebras. In the case of transition systems, where F = P is the covariant powerset functor, we introduce impeding paths whose existence impedes the existence of the product. Moreover we show, that the product A⊗A of a finite transition system A exists if and only if the product A⊗B for each finite transition system B exists.
Keywords: Coalgebras, transition systems, products


Introduction
Given a set functor F , it is well known that the category SetF of F -coalgebras has arbitrary colimits. In fact (see [4]) the forgetful functor U : SetF → Set creates and reflects colimits. The situation is different for limits. Even though equalizers and inverse images always exist in SetF [2] they are, in general, not created by the forgetful functor.
General products need not exist at all in SetF . In particular, the product over the empty index set, that is the terminal coalgebra need not exist, unless certain assumptions are made about the functor F . This is mainly due to Lambeks Lemma
[3] which states that the structure map of the terminal coalgebra T must be a bijection α : T → F (T ). Unless F is bounded [4], this requirement often leads to set theoretical problems.
A classical case of an unbounded functor is given by the power set functor P whose coalgebras are the familiar transition systems. Clearly, the terminal P- coalgebra, i.e. the empty product, does not exist since |X| < |P(X)| for any set X.

1 Email: fohry@mathematik.uni-marburg.de

1571-0661© 2008 Elsevier B.V. Open access under CC BY-NC-ND license.
doi:10.1016/j.entcs.2008.05.021

Still, there may be some products of transition systems existing. In [1] examples of finite transition systems were given that show the whole range of situations that may occur. In particular, Gumm and Schr¨oder exhibit pairs A and B of nonempty finite transition systems so that A⊗B does not exist, A⊗B exists and is the empty transition system or A⊗B exists and is the largest bisimulation ∼A,B.
In this paper we examine the reasons why a product of two transition system A and B might exist, or not. Analysing the critical example in [1], we study certain ”bisimilar paths” in a transition system A whose existence allows or impedes the existence of products A⊗ B.
As an interesting corollary we obtain the somewhat surprising fact that for any finite transition system A we have that A⊗A exists in SetP if and only if A⊗B exists for each finite transition system B.
Categorical products of coalgebras
Definition 2.1 (Coalgebra) Let F : Set → Set be a functor. A pair (A, α) is called F -coalgebra, if A ∈ Set and α : A → F (A). We call A the base set and α the structure of the coalgebra A.
For the remainder of this section let A = (A, α), B = (B, β) be F -coalgebras. A map ϕ : A → B is called homomorphism, if Fϕ ◦ α = β ◦ ϕ.
Definition 2.2 (Bisimilarity) A subset R ⊆ A × B is called a bisimulation be- tween A and B, if there exists a structure ρ : R → F (R), so that πA : R→ A, πB : R→B are homomorphisms. Then we say R = (R, ρ) is a bisimulation structure for A and B. Elements a ∈ A, b ∈ B are called bisimilar (a ∼ b), if there exists a bisimulation R with (a, b) ∈ R.
There always exists a largest bisimulation ∼A,B= {(a, b) | a ∈ A, b ∈ B, a ∼ b} between A and B. Note, that bisimilarity is a reflexive and symmetric relation. Moreover it is transitive if the functor F preserve weak pullbacks (see [4], theorem 5.4).
We spell out the categorical product of coalgebras.
Definition 2.3 (Product) Let Q = (Q, ξ) be an F -coalgebra and ϕA : Q → A, ϕB : Q→B homomorphisms. Then Q = (Q, ϕA, ϕB) is called an A-B-cone.
The categorical product of A and B is an A-B-cone P = (P, πA, πB), so that for all A-B-cones (Q, ϕA, ϕB) there exists exactly one homomorphism ψ : Q → P with ϕA = πA ◦ ψ and ϕB = πB ◦ ψ.

  Q ,,,

ϕA 
 j
A ¸,¸ ¸∃!ψ
π ¸¸¸¸
,ϕB
,,vz
 ¸B,
   

A	¸ J  πB
P
The base set of the categorical product of A and B need not be the cartesian

product A × B, so we write P = A⊗B for the (categorical) product of A and B.
Every bisimulation structure R together with the projections πA, πB yields an
A-B-cone.
Whenever we speak about A-B-cones Q, Q', then let Q = (Q, ϕA, ϕB), Q' = (Q', ϕ' , ϕ' ) and Q = (Q, ξ), Q' = (Q', ξ') be the associated coalgebras.  If the
A	B
product P = A⊗B exists, we denote its corresponding coalgebra by P = (P, η) and the A-B-cone by P = (P, πA, πB).
Definition 2.4 Let Q, Q' be A-B-cones and q ∈ Q, q' ∈ Q'. We write q ∼=A,B q', if there exists an F -coalgebra R = (R, ρ), homomorphisms χ : R → Q, χ' : R → Q' and r ∈ R, so that:
χ(r) = q and χ'(r) = q', i.e. q1 ∼ q2

ϕA ◦ χ = ϕ'
χ' and ϕB ◦ χ = ϕ'
χ', i.e. the following diagram commutes:


 Q, ϕA	 A¸ ,

χ 
,,,,
ccc

     
R ¸¸¸¸
,,, cccc
ϕ' cccc ,,,

' ¸¸¸	Ac	,,

χ	¸z cc
Q'
,
'	 B 
B



We say q, q' are A-B-perspective q  A,B q', if there exist n ∈ N, A-B-cones
Q1,..., Qn and qi ∈ Qi(i = 1,..., n), so that q =∼ q1 ∼= ... ∼= qn ∼= q', that is,
 A,B = (∼=A,B )∗.
The relation ∼=A,B is reflexive and symmetric, therefore the transitive closure
 A,B of ∼=A,B is an equivalence relation on the class of all elements of A-B-cones.
We introduce the equivalence classes with respect to  A,B. Let Q be an A-B- cone and q ∈ Q. We define CQ,q = {(Q', q') | Q' A-B-cone, q' ∈ Q', q' A,B q} the equivalence class of q ∈ Q.
Lemma 2.5 Assume the product A⊗B to exist. Let Q, Q' be A-B-cones, q ∈ Q, q' ∈ Q' and ψ : Q → A ⊗ B, ψ' : Q' → A ⊗ B be the unique homomorphisms. Then q ∼=A,B q' =⇒ ψ(q) = ψ'(q').

Proof The projections πA, πB are jointly mono, otherwise there would be an A-B- cone Q and homomorphisms ψ, ψ' : Q → P with ϕA = πA ◦ ψ and ϕB = πB ◦ ψ but ψ /= ψ' in contradiction to the uniqueness of the homomorphism Q→P in the definition of the product.
Let q ∼=A,B q'. There exists a coalgebra R = (R, ρ), r ∈ R and homomorphisms
χ : R→ Q, χ' : R→ Q' with χ(r) = q and χ'(r) = q'. Then R with the projections

ϕA ◦ χ = ϕ'
χ' and ϕ ◦ χ = ϕ'
χ' is an A-B-cone. We compute

πA ◦ ψ ◦ χ	=	ϕA ◦ χ
=	ϕ' ◦ χ'
=	πA ◦ ψ' ◦ χ' π ◦ ψ ◦ χ analo=gously π ◦ ψ' ◦ χ'.
Hence ψ◦χ = ψ'◦χ' since πA, πB are jointly mono. The following diagram commutes.

,,,, A,¸,,

ϕ,A,,,,,
cccc

,,,,,,,,
 Q,,¸¸¸¸ψ
ccc'
ccc ϕA	πA

χ 
,,, ¸¸¸¸¸¸ccc

,,,
ccc ¸¸¸¸¸¸

R 
¸¸¸
ψ◦χ=ψ'◦χ'
, c
ccc ,,,
z˛
,,,, A¸⊗B 

¸¸¸¸
ccc
,,,,,,,,

χ	¸¸z cc,,,,',
¸¸¸¸
,,,,
,,,ϕB

¸¸¸¸¸¸¸¸ ,,,,
B	¸¸¸¸¸,zJz 
B
Therefore ψ(q) = (ψ ◦ χ)(r) = (ψ' ◦ χ')(r) = ψ'(q).	 
Lemma 2.6 Assume the product P = A⊗B exists and let p, p' ∈ P. Then p  A,B
p' ⇒ p = p'.
Proof Assume p  A,B p'. There exists A-B-cones Qi and qi ∈ Qi(i = 1,..., n), so that p ∼=A,B q1 ∼=A,B ... ∼=A,B qn ∼=A,B p'. Let ψi : Qi → A ⊗ B be the unique homomorphisms.  Then by lemma 2.5 p = idP (p) = ψ1(q1) = ... = ψn(qn) =
idP (p') = p'.	 
Lemma 2.7 Let Q, Q' be A-B-cones, ϑ : Q → Q' a homomorphism with ϕA =
' ◦ ϑ, ϕB = ϕ' ◦ ϑ . Then q ∼=A,B ϑ(q) for all q ∈ Q.
Proof This follows immediately from the diagram.


, Q¸
ϕA	 A ,

idQ,,,,,,
,,
,, B
ccc
c

,,,,,
Q ¸¸¸¸
,,,, ccc
ϑ	ccc,c,,,

¸¸¸¸¸
cccc	,,,

ϑ  ¸¸¸
c ϕ'	,,

¸zJ˛' c  A	 z z
Q	'	B
B


Particularly with regard to the product we get for every A-B-cone Q with unique homomorphism ψ : Q → A ⊗ B that q ∼=A,B ψ(q). We can now prove the following theorem.

Theorem 2.8 The product A⊗B exists iff the class
M = {CQ,q | Q A-B-cone,q ∈ Q}
of equivalence classes of  A,B is a set.
Proof First assume the product P = A⊗B exists. We prove that M is a set by showing |M|≤ |P |. Assume there exists an equivalence class CQ,q with (P, p) /∈ CQ,q for all p ∈ P . Let ψ : Q → P be the unique homomorphism with ϕA = πA ◦ψ, ϕB =
πB ◦ ψ. From lemma 2.7 follows p = ψ(q) ∼=A,B q in contradiction to p /∈ CQ,q. Hence M = {CP,p | p ∈ P} and therefore |M|≤ |P |.
We assume now that M is a set. We shall equip M with a coalgebraic structure so that it becomes the product. For any A-B-cone Q we define a map ηQ : Q → M by ηQ(q) = CQ,q. Then we define a structure map μ : M → FM by μ(CQ,q) = (Fη ◦ ξ)(q) and denote M = (M, μ). Note, that then ηQ : Q → M is a homomorphism. We have to show that μ is well-defined. Let Q, Q' be A-B-cones, q ∈ Q, q' ∈ Q' and CQ,q = CQ',q' . We may assume q ∼=A,B q'. Then there exists an F -coalgebra R = (R, ρ), homomorphisms χ : R → Q, χ' : R → Q' and r ∈ R with ϕA ◦ χ =
' ◦ χ', ϕB ◦ χ = ϕ' ◦ χ' and q = χ(r), q' = χ'(r). Let μ(CQ,q) = (F ηQ ◦ ξ)(q). We
show μ(CQ,q) = (F ηQ' ◦ ξ')(q'):
(F ηQ' ◦ ξ')(q')= (F ηQ' ◦ ξ' ◦ χ')(r)
= (F ηQ' ◦ F χ' ◦ ρ)(r)
= (F ηQ ◦ Fχ ◦ ρ)(r)
= (F ηQ ◦ ξ ◦ χ)(r)
= (μ ◦ ηQ ◦ χ)(r)
= (μ ◦ ηQ)(q)
= μ(CQ,q).
The projections πA : M → A, πB : M → B are defined by πA(CQ,q) = ϕA(q) and
πB(CQ,q) = ϕB(q). We compute ϕA(q) = (ϕA ◦ χ)(r) = (ϕ' ◦ χ')(r) = ϕ' (q), hence
the projections are well-defined too. We show, that πA is a homomorphisms (πB analogously):
α ◦ πA = α ◦ ϕA ◦ ηQ
= FϕA ◦ ξ ◦ ηQ
= FϕA ◦ F ηQ ◦ μ
= F (ϕA ◦ ηQ) ◦ μ
= FπA ◦ μ.
The uniqueness of the homomorphism η : Q→M follows from lemma 2.7. There- fore A ⊗ B = (M, πA, πB).	 
Transition systems and trees
Theorem 2.8 gives an abstract characterisation for the existence of products. If we like to apply this characterisation to coalgebras A, B, we have to observe whether

two elements q ∈ Q, q' ∈ Q' of A-B-cones are A-B-perspective or not. In this section we will show, that in the case of transition systems we can represent the equivalence classes of A,B by roots of trees. This opportunity allows us to give another, more technical characterisation for the existence of products in section 4.
Definition 3.1 Let P be the covariant powerset functor. A P-coalgebra (A, α) is called transition system, where A is interpreted as a set of states and α : A →
P(A) is the transition function. We write a →α a' instead of a' ∈ α(a). If α is clear from the context, we write also a → a'.
A transition system (A, α) is called a tree, if there exist ωA ∈ A (root of A) with:
∀a ∈ A : ωA /∈ α(a),
∀a ∈ A : a /= ωA ⇒ ∃!v ∈ A : a ∈ α(v),
∀a ∈ A.∃n ∈ N.∃a0,..., an ∈ A : ωA = a0 → a1 → ... → an = a.
In this section let (A, α), (B, β) be transition systems. We will show, that there is a tree in any equivalence class CQ,q. Therefore we can represent the equivalence classes of A,B by trees.
Lemma 3.2 Let a ∈ A. Then ⟨a⟩ = (⟨a⟩, η) with
⟨a⟩ = a0a1 ... an ∈ A+ | a = a0, ∀i : ai → ai+1 , η(a0 ... an)= {a0 ... anan+1 | an → an+1}
is a tree with root ω⟨a⟩ = a and there exists a homomorphism ϑ : ⟨a⟩ → A with
ϑ(ω⟨a⟩) = a.
Proof It is easy to check, that ⟨a⟩ is a tree. We define ϑ(a0 ... an) = an and show, that it is a homomorphism:
(α ◦ ϑ)(a0 ... an)= α(an)
= {an+1 | an → an+1}
= Pϑ ({a0 ... anan+1 | an → an+1})
= (Pϑ ◦ η)(a0 ... an).
 
If (A, α, λ) is a labeled transition system with label λ : A → Λ and a ∈ A, we can define κ = λ ◦ ϑ : ⟨a⟩→ Λ. Then ϑ is a homomorphism of P( ) × Λ-coalgebras. Corollary 3.3 Let Q be an A-B-cone and q ∈ Q. Then (⟨q⟩, ϕA ◦ ϑ, ϕB ◦ ϑ) is an
A-B-cone and q ∼=A,B ω⟨q⟩.
Proof Lemma 3.2 shows the existence of ⟨q⟩. Moreover ϑ(ω⟨q⟩) = q and with lemma 2.7 q ∼=A,B ω⟨q⟩.	 
Corollary 3.4 Let a ∈ A, b ∈ B and a ∼ b. Then there exist a tree (T, τ ) and homomorphisms ϑA : T → A, ϑB : T → B with ϑA(ωT ) = a and ϑB(ωT ) = b.
Proof Because a, b are bisimilar, there exist a transition system (R, ρ), homomor- phisms πA : R → A, πB : R → B and r ∈ R with a = πA(r) and b = πB(r). Then

⟨r⟩ with the homomorphisms ϑA = πA ◦ ϑR and ϑB = πB ◦ ϑR is the wanted tree.

  ⟨r⟩ ¸¸¸¸

ϑA 
  
A ¸,
ϑ	¸¸ϑ¸B¸¸
J	¸¸¸¸z˛

πA	R	πB	B


Lemma 3.5 Let (T, τ ) be a tree and ϑ : T → A a homomorphism with ϑ(ωT ) = a. Then there exist a homomorphism ψ : T → ⟨a⟩ with ψ(ωT ) = ω⟨a⟩ = a.
Proof We define ψ by induction over the construction of T :

'	 ω⟨a⟩	if t' = ωT
Note, that for t /= ωT there is a unique element t' with t ∈ τ (t'), because T is a tree.
We show, that ψ is a homomorphism. Let s, t ∈ T with t ∈ τ (s). (For t = ωT
let ψ(s) = ϵ be the empty word.)
(η ◦ ψ)(t)= η (ψ(s) · ϑ(t))
=  ψ(s) · ϑ(t) · a' | a' ∈ α(ϑ(t))}
=  ψ(t) · ϑ(t') | t' ∈ τ (t)}

= (Pψ ◦ τ )(t).

Impeding paths
In this section we consider P-coalgebras A = (A, α), B = (B, β). We introduce impeding paths and prove, that the existence of such a path impedes the existence of the product A⊗ B. First we look at an example of a transition system whose
product with itself exists but is larger than one might expect.
Example 4.1 Consider the following transition system A = (A, α):
,,, a0 ¸¸¸¸

,,,,,,
b1  s
¸¸¸¸¸¸
¸
b2

The largest bisimulation ∼AA is the least equivalence relation with b1 ∼AA b2. We construct the product A⊗A = P = (P, π1, π2). For all i, j ∈ {1, 2} there is pij ∈ P with π1(pij) = bi, π2(pij) = bj and η(pij) = ∅. For every subset S ⊆
{p11, p12, p21, p22} with π1(S) = π2(S) = {b1, b2} we obtain a state pS ∈ P with

η(pS) = S and πi(pS) = a0. Note, that for every such S the set Q = {pS}∪ S with the structure η|Q and the projections π1|Q, π2|Q yields an A-B-cone. We leave it to the reader to show that for S /= S' the states pS and pS' are not A-A-perspective. Therefore we get seven states p ∈ P with π1(p) = π2(p) = a0. The following figure shows the product P:


¸p¸1,1,,¸¸¸¸¸¸, ¸,¸¸ p{p11,p22}

    ˛ p 2¸ 2,,¸,,¸,

  ss  ,,
¸¸¸ ¸ ¸ ¸ ¸ ¸ 
ee ,, ¸¸¸

ss	, , 
¸¸¸¸¸¸e¸e
,,  ¸¸¸

  s s 
,,,
eee
¸¸¸¸¸,¸, ¸	¸¸

p{p11,p1,2,p22} sss
,,,
eee
,,, p{p11,p21,p22}

,,,
sss
,,,,
eeee
,,,
sss

,,,sss
p	, ee
,,,sss

ss,,,
{p11,p12,p,21,p22}
sss,,

sss
ss
,,,
,,
eeee
eee
,,,,
,,,
ss	,,
ss	,

p{p11,p12,¸p21} ¸,,	ee
,,	ss
p{p12,p21,p22}

¸¸¸ ¸¸,,¸¸¸¸¸¸ee
,,    ss 

¸¸¸¸ ,,
eee¸¸¸¸¸¸¸ ¸ ¸ ¸ ¸   ,,,
ss 

¸z,t" ze  e	¸¸¸¸¸¸¸¸ ,z sz , rss

p12  ¸ ¸,c
p{p12,p21}
z p2# 1

If additionally there is a path an → ... → a1 → a0, then the product increases faster than exponentially with respect to n. In fact there would be 27 − 1 states
p' with π (p') = π (p') = a  and 227−1 − 1 states p'' with π (p'') = π (p'') = a
1	2	1	1	2	2
in the product. This already suggests that it would be very difficult to construct the product A⊗A if there is a loop in the added path. We will see that indeed in this case the product A⊗A does not exist. The above consideration motivates the following definition:
Definition 4.2 (Impeding path)

A bisimilar path in A×B is a sequence (a ,b ) ... (a ,b ) with a
→α a ,b	β

n  n	0  0
bi and ai ∼ bi bisimilar for all i.
A bisimilar path is called impeding, if
i+1
i  i+1 →

there exist 0 ≤ k < n with (ak, bk) = (an, bn),
there exist a /= a' ∈ α(a0),b /= b' ∈ β(b0), so that {a, a'}× {b, b'} ⊆∼A,B.
An impeding path is called reduced, if 0 ≤ i < j < n ⇒ (ai, bi) /= (aj, bj).
Let σ = (an, bn) ... (a0, b0) be an impeding path.	Concatenating any of (a, b), (a, b'), (a', b), (a', b') to σ yields bisimilar paths (an, bn) ... (a0, b0)(a, b),.. .:


(an−1, bn−1) ¸ 
(a, b)	(a, b')

,,   ¸,
     
.	(an, bn)	 (a k−1, bk−1)		 (a 0, b0)



.	,,


¸¸¸¸¸
¸¸¸¸

z_
k+1
, bk+1)
J 
(a ,b )
z)
a , b)

Lemma 4.3 If there exists an impeding path in A × B, then there exists a reduced impeding path in A × B too.
Proof Let (an, bn) ... (a0, b0) be an impeding path in A × B and j = min{j' | ∃i < j' : (ai, bi) = (aj' , bj' )}. Then (aj, bj) ... (a0, b0) is a reduced impeding path. 
Theorem 4.4 If there is an impeding path in A × B then the product A ⊗ B does not exist.
Proof We prove the theorem by contradiction. Assuming that the product A⊗B exists we construct an A-B-cone Q which contains pairwise not A-B-perspective states qi(i ∈ κ) for an ordinal number κ with |κ| > |A ⊗ B|. This would be a contradiction to theorem 2.8. The proof is structured in the following way:
Construction of Q
Showing that Q is an A-B-cone
Proof that the states qi are pairwise not A-B-perspective

Construction of Q
Assume that the product (A⊗B, η, πA, πB) exists and that there is an impeding path in A×B. By lemma 4.3 there exists a reduced impeding path (an, bn) ... (a0, b0) in A × B and
k /= n with (ak, bk) = (an, bn),
a /= a' ∈ α(a0),b /= b' ∈ β(b0) and a ∼ a' ∼ b ∼ b'. For aˆ ∈ A, ˆb ∈ B with aˆ ∼ ˆb we define
Saˆˆb = p ∈ A ⊗ B | (πA, πB)(p) ∈ α(aˆ) × β(ˆb) Taˆˆb = p ∈ A ⊗ B | (πA, πB)(p) = (aˆ, ˆb)
Let κ be an ordinal number with |κ| > |A⊗ B|. We construct an A-B-cone Q with
Q = {qi | i ∈ κ}∪{q' | 0 ≤ j < k}∪A⊗B. The projections ϕA : Q → A, ϕB : Q → B
are defined by

(πA, πB)(q)	if q ∈ A ⊗ B
(a , b )	if i < k ∧ q ∈ {q , q'}
(ϕA, ϕB)(q) =	(ai, bi)	if k ≤ i < n and for some m ∈ N. : q = qi+m(n−k)
⎪⎩	so that q = qj for some j = κ' + (i − k)+ m(n − k).
Before introducing the transition function, we define some helpful sets for all i ∈ κ
S	\ T	if 0 < i < k or k < i < n Pi =	Sakbk \ Tak−1bk−1 ∪ Tan−1bn−1	if i = k
Pj	if (ϕA, ϕB)(qj) = (ϕA, ϕB)(qi)

Ri = {qj | k ≤ j < i and (ϕA, ϕB)(qj) = (ϕA, ϕB)(qi+n−k−1)} .
Note that Pi is uniquely defined because the impeding path is reduced. We can now define the transition function ξ:

η(q)	q ∈ A ⊗ B

 



  
{qk−1, qn−1}∪ Pk	q = qk
⎪

Ri ∪ Pi	else
For the special case k = 0 we define ξ(q0) = {qn−1}∪ Sa0b0 \ (Tab' ∪ Ta'b) and ξ(qm·n) = Rm·n ∪ Sa0b0 \ (Tab ∪ Ta'b' ). The proof for this special case is very similar to the proof for k > 0, so we consider only the case k > 0. Figure 1 shows the
A-B-cone Q without the states from A⊗ B.
q3n−2k | (ak, bk)
,,,,
,,,

.J 
.
J 
,,,,
,,,,
,,,
,,	'

q2n−k | (ak, bk)
¸¸¸¸¸¸¸
,,,
,
(a, b )
  ¸,

J	¸¸¸¸¸¸¸ ,,,

z. 
z˛zz
q'	,b 
) 	 · · ·  q' | (
)  (a ', b)

.	k−1 | (ak−1
,,,,,,
k−1	0
a0, b0

J  ,,,,,,,
qn | (ak, bk)


zJ,) 
qn−1 | (an−,1,¸bn−1)

.J 
.

J 




(a, b)
  ¸,
     

qk | (ak, bk)	 qk −1 | (ak−1, bk−1)  · · ·  q0 | (a0, b0)  (a ', b')

Figure 1. Extract of the A-B-cone Q without the transitions to A⊗B 
(in addition to the states qi we give the image (ϕA, ϕB)(qi))

Q is an A-B-cone
We have to show, that ϕA, ϕB are homomorphisms. First we consider some properties:
The largest bisimulation ∼A,B between A and B with a bisimulation structure is an A-B-cone. Hence for aˆ ∼ ˆb there exists a p ∈ A⊗B with (πA, πB)(p) = (aˆ, ˆb).
Therefore, for all q ∈ Q there exists p ∈ A ⊗ B with (aˆ, ˆb) = (ϕA, ϕB)(q) = (πA, πB)(p). Moreover (PπA ◦ η)(p) = (α ◦ πA)(p) = α(aˆ), hence η(p) ⊆ Saˆˆb =
S(ϕA,ϕB)(q) and

α(aˆ) = (PπA ◦ η)(p) ⊆ PπA S(ϕA,ϕB )(q) ⊆ α(aˆ) = (α ◦ ϕA)(q).

From the definition of Taˆˆb it follows immediately that PπA(Taˆˆb) = {aˆ}, therefore PπA (Tab ∪ Ta'b' ) = PπA (Tab' ∪ Ta'b) = {a, a'} and PπA (Sa b ) =
PπA (Sa0b0 \ (Tab ∪ Ta'b' )).
For qi with i > 0 and (ϕA, ϕB)(qi) = (aj, bj) /= (ak, bk) we compute

{aj−1}∪ PϕA(Pi) = {aj−1}∪ PϕA Sajbj \ Taj−1bj−1  = α(aj) = (α ◦ ϕA)(qi).

For qi with (ϕA, ϕB)(qi) = (ak, bk) we get
{ak−1, an−1}∪ PϕA(Pi)= {ak−1, an−1}∪ PϕA  Sakbk \ Tak−1bk−1 ∪ Tan−1bn−1
= α(ak).
Let i > k and ϕA(qi) = aj for some j ∈ {k + 1,..., n}. Then ϕA(qi+n−k−1) = 
aj−1. Furthermore, j − 1 ≥ k and therefore PϕA(Ri) = {aj−1}.
We divide the proof that ϕA is a homomorphism into cases as in the definition of ξ:
q ∈ A ⊗ B: (PϕA ◦ ξ)(q) = (PπA ◦ η)(q) = (α ◦ πA)(q),
q = q0:
(PϕA ◦ ξ)(q0)= PϕA(Sa0b0 \ (Tab ∪ Ta'b' ))
i=ii PπA(S(ϕA,ϕB)(q0))
=ii (α ◦ ϕA)(q0),
q = q' : analogously
q = qi for some 0 < i < k:
(PϕA ◦ ξ)(qi)= PϕA({qi−1}∪ Pi)
= {ϕA(qi−1)}∪ PϕA(Pi)
= {ai−1}∪ PπA(Pi)
=iv (α ◦ ϕA)(qi),
q = q' for some 0 < i < k: analogously
q = qk:

(PϕA ◦ ξ)(qk)= PϕA({qk−1, qn−1}∪ Pk)
= {ak−1, an−1}∪ PπA(Pk)
=iv (α ◦ ϕA)(qk),
q = qi and i = n + m(n — k) or i = ω' + m(n — k): Then (ϕA, ϕB)(qi) = (an, bn).
(PϕA ◦ ξ)(qi)= PϕA({q'	}∪ Ri ∪ Pk)
= {ak−1}∪ PϕA(Ri) ∪ PϕA(Pk)
=v {ak−1}∪ {an−1}∪ PϕA(Pk)
=iv (α ◦ ϕA)(qi),
”else“: Then q = qi for some i > k and (ϕA, ϕB)(qi) = (aj, bj) /= (ak, bk). (PϕA ◦ ξ)(qi)= PϕA(Ri ∪ Pi)
= PϕA(Ri) ∪ PϕA(Pi)
=v {aj−1}∪ PϕA(Pi)
=iv (α ◦ ϕA)(qi).
We can prove analogously that ϕB is a homomorphism, so Q is indeed an A-У-cone.

The states qi ∈ Q are pairwise not A-У-respective
Let ψ : Q → A⊗У be the unique homomorphism. We show by contradiction, that ψ(qi) /= ψ(qj) for all i /= j, i.e. qi, qj are not A-У-respective (qi / A,B qj) by theorem 2.8. Assume ψ(qi) = ψ(qj) for some i < j. We choose i minimal, then ψ(qi' ) /= ψ(qj) for all i' < i and all j ∈ N.
First assume i < k. Since the impeding path is reduced (ϕA, ϕB)(qi) /= (ϕA, ϕB)(qj) and therefore ψ(qi) /= ψ(qj) for all j /= i.
Assume now i > k. ψ(qi) = ψ(qj) implies (ϕA, ϕB)(qi) = (ϕA, ϕB)(qj). Because j' = i+ n— k = min{j'' | (ϕA, ϕB)(qi) = (ϕA, ϕB)(qj'' )} we have qj'−1 ∈ Rj. Then we need q ∈ ξ(qi) with ψ(q) = ψ(qj'−1) since (Pψ ◦ ξ)(qi) = (η ◦ ψ)(qi) = (η ◦
ψ)(qj) = (Pψ◦ξ)(qj). Because (ϕA, ϕB)(q) = (ϕA, ϕB)(qj'−1) we get q = qi' ∈ Ri.
Then ψ(qi' ) = ψ(qj'−1) and i' < i ≤ j' — 1 in contradiction to i being minimal.
Let i = k. Then (ϕA, ϕB)(qj) = (ak, bk) and hence q'	∈ ξ(qj). We need q ∈
ξ(qk) with ψ(q) = ψ(q'	). The only possibility is q = qk−1. Then ψ(q') = ψ(qi)
for all i < k by induction. There exists a state p ∈ A⊗У with p ∈ ξ(q0) and
(ϕA, ϕB)(p) = (a, b).  Then we need p' ∈ ξ(q' ) with ψ(p') = ψ(p).  Otherwise
there is no state q' ∈ ψ(q' ) with (ϕA, ϕB)(q') = (a, b).
This proves ψ(qi) /= ψ(qj). Hence |κ| ≤ |A ⊗ У| in contradiction to the choice of κ. Consequently, the product A⊗У does not exist.	 
Example 4.5 In [1] it is shown, that the product A⊗A of the following transition

system A does not exist.
	 ,c

A =	J,¸˜¸0` ,z,¸, J,˜¸1` z,
We verify this, using theorem 4.4. (0, 0)(0, 0) is an impeding path in A× A, since we can extend it with (0, 0), (0, 1), (1, 0), (1, 1) and 0 ~ 1. Therefore the product

A⊗A does not exist.
Lemma 4.6 Let Q, Q' be A-У-cones, q ∈ Q, q' ∈ Q', so that
(ϕA, ϕB)(q) = (ϕ' , ϕ' )(q')
A	B
for all bisimilar paths (a0, b0) ... (an, bn) with (a0, b0) = (ϕA, ϕB)(q) there does not exist a /= a' ∈ α(a0) and b /= b' ∈ β(b0) with a ~ a' ~ b ~ b'.
Then q  A,B q'.
Proof  We define a tree (T, τ ) with T ⊆ (A×B)+ and projections ϑA : T → A, ϑB :
T → B recursively:
ωT = (ϕA, ϕB)(q) = (ϑA, ϑB)(ωT ),
∀t ∈ T : τ (t) = {t · (a, b) | a ∈ (α ◦ ϑA)(t),b ∈ (β ◦ ϑB)(t)} , (ϑA, ϑB)(t · (a, b)) = (a, b).
We define a map χ : ⟨q⟩→ T recursively. Note, that the definition yields ϑA ◦ χ =
ϕA, ϑB ◦ χ = ϕB.
χ(ω⟨q⟩) = ωT ,
for q2 ∈ ξ(q1):
χ(q2)= χ(q1) · ((ϕA, ϕB)(q2))
∈ {χ(q1) · (a, b) | a ∈ α(ϕA(q1)),b ∈ β(ϕB(q1))} = τ (χ(q1)).
Because (α◦ϕA)(q1) = (PϕA◦ξ)(q1) we have ϕA(q2) ∈ α(ϕA(q1)) = (α◦ϑA)(χ(q1)) ⊆
τ (χ(q1)). Therefore χ is well-defined.
The second condition in the lemma yields

∀p ∈ ⟨q⟩ : a ∈ PϕA(ξ(p)) ∧ b ∈ PϕB(ξ(p)) ∧ a ~ b ⇔ (a, b) ∈ (ϕA, ϕB)(ξ(p)).
We show, that χ is an epimorphism:
(τ ◦ χ)(q)= {χ(q) · (a, b) | a ∈ (α ◦ ϑA ◦ χ)(q),b ∈ (β ◦ ϑB ◦ χ)(q)}
= {χ(q) · (a, b) | a ∈ (α ◦ ϕA)(q),b ∈ (β ◦ ϕB)(q)}
= {χ(q) · (a, b) | a ∈ (PϕA ◦ ξ)(q),b ∈ (PϕB ◦ ξ)(q)}
= {χ(q) · (ϕA, ϕB)(p) | p ∈ ξ(q)}
= {χ(p) | p ∈ ξ(q)}
= (Pχ ◦ ξ)(q).
We show, that ϑA is a homomorphism (note, that χ is surjective): α ◦ ϑA ◦ χ =
α ◦ ϕA = PϕA ◦ ξ = PϑA ◦ Pχ ◦ ξ = PϑA ◦ τ ◦ χ. We can define χ' : ⟨q'⟩ → T analogously. Hence with the lemma 2.7 and corollary 3.3 q ~=A,B ω⟨q⟩ ~=A,B ωT ~=A,B ω⟨q'⟩ ~=A,B q'.	 
Lemma 4.7 Let Q, Q' be A-У-cones, q ∈ Q, q' ∈ Q'. Then
q ~=A,B q' ⇐⇒ ∀p ∈ ξ(q).∃p' ∈ ξ'(q') : p ~=A,B p' ∧ ∀p' ∈ ξ'(q').∃p ∈ ξ(q) : p ~=A,B p'.

Proof Let q ~=A,B q' and R = (R, ρ) be the P-coalgebra from defintion 2.4, χ : R→Q and χ' : R→ Q' homomorphisms and r ∈ R with χ(r) = q and χ'(r) = q'. Let p ∈ ξ(q), then there exists s ∈ ρ(r) with χ(s) = p and therefore p ~=A,B χ'(s).
Assume now, that the right side of the equivalence in the lemma holds. Then for all p ∈ ξ(q), p' ∈ ξ(q') there exists an A-У-cone Rpp' , homomorphisms χpp' : Rpp' →

Q, χ' ' : Rpp' → Q' and r ∈ Rpp' , so that χpp' (r) = p, χ'
' (r) = p'. We define a

pp
coalgebra
R = (R, ρ) = {r0}⊕ 
pp

Rpp' and ρ(r0) = r ∈ Rpp' | χpp' = p, χ' ' = p'} .



Then we can define homomorphisms χ : R → Q, χ' : R → Q' with χ(r0) = q, χ'(r0) = q' and χ(r) = χpp' (r) if r ∈ Rpp' . The reader is invited to check, that χ, χ' are homomorphisms and that they commute with the projections. Hence q ~=A,B q'.	 
Lemma 4.8 Let (A, α), (B, β) be ﬁnite transition systems. Assume there is no impeding path in A × B. Then the product A⊗У exists and is ﬁnite.
Proof Since A, B are finite, there exists m ∈ N, so that any bisimilar path of length at least m contains a loop. Consider a bisimilar path (a1, b1) ... (an, bn) of length
n ≥ m. Then a = a' or b = b' for all a, a' ∈ α(an), b, b' ∈ β(b0) with a ~ a' ~ b ~ b', otherwise the path would be impeding. Then the following situation is impossible:
(a, b)	(a, b')
,,	¸,
.....
(a1, b1)	 (a 2, b2)		 (a n, bn)
¸¸¸¸¸¸
J	¸¸¸¸z0
(a', b')	(a', b)

We start the construction of the product with elements (a1, b1) ∈~A,B, so that no such bisimilar path exists for any n ∈ N. Then by lemma 4.6 there is only one equivalence class C with (πA, πB)(C) = (a1, b1). Take (a1, b1) ∈ A × B, so that for
all a2 ∈ α(a1), b2 ∈ β(b1) there exist only finite many classes C with (πA, πB)(C) = (a2, b2). Then by lemma 4.7 there are only finite many classes C with (πA, πB)(C) = (a1, b1). After at most m steps we have considered all bisimilar pairs (a, b). Then for every bisimilar pair (a, b) there exist only finite many equivalence classes C with (πA, πB)(C) = (a, b). Therefore M = {CQ,q | Q A-У-cone,q ∈ Q} is finite and with theorem 2.8 the product A⊗У exists. Furthermore, M is the base set of the product and therefore A⊗У is finite.	 
Corollary 4.9 Let A = (A, α), У = (B, β) be ﬁnite transition systems. If the product A2 = A⊗A exists, then A⊗У exists too.
Proof Assume the product A⊗У does not exist. Then there exists an impeding path (an, bn) ... (a0, b0) in A× У.  Let (a, b), (a', b') with a ~ a' ~ b ~ b' be the

possible continuations of the impeding path. Then (an, an) ... (a0, a0) is a bisimilar path in A×A and (a, a), (a, a'), (a', a), (a', a') are possible continuations of this path. Hence (an, an) ... (a0, a0) is an impeding path in A×A and by lemma 4.4 A2 does not exist.	 

Conclusions and Further Work
For arbitrary F -coalgebras A, У we have introduced an equivalence relation  A,B on the class of all elements of A-У-cones. We have seen that, if the class of all equivalence classes is a set, then it is a base set of the product A⊗ У. Otherwise the product does not exists (theorem 2.8).
The invention of impeding paths led us to a more technical criterium for the existence of products of transition systems in theorem 4.4. It followed in corollary
4.9 that, if the product A⊗A exists, then A⊗У exists for any transition system
У. It would be interesting to generalise this result to arbitrary F -coalgebras.

References
H.P. Gumm, T. Schr¨oder, Products of coalgebras, Algebra universalis 46 (2001), 163–185.
H.P. Gumm, T. Schr¨oder, Types and Coalgebraic Structure, Algebra Universalis 53 (2005), 229–252.
J. Lambek, A Fixpoint Theorem for Complete Categories, Math. Zeitschrift 103 (1968), 151–161.
J.J.M.M. Rutten, Universal coalgebra: a theory of systems, Theoretical Computer Science 249 (2000), 3–80.
