We then apply our unified view concretely, constructing a model of the ASW protocol and formally analysing it using the tools we have developed in our group, the On-the-Fly Model-Checker OFMC and its abstraction-based extension OFMC-FP. Both were developed in the context of the AVISPA project (http://www.avispa-project.org), which offers a toolset for the automated analysis of security protocols and applications. Using OFMC, we can verify the protocol for finitely many sessions (that is, executions of the protocol). Beyond this, we also perform an analysis with OFMC-FP, verifying the protocol for infinitely many sessions.

The Exchange Subprotocol: If both participants are honest and in the absence of network failures or intruder intervention, after execution of the exchange subprotocol, both will be in possession of a valid standard contract. Both originator and responder generate nonces NO and NR which are called their respective secret commitments to the contract. Given these, they compute their so-called public commitments by hashing these values, yielding h(NO) and h(NR), respectively. The protocol then proceeds in two rounds: in the first, each party expresses his public commitment to the agreed-upon con- tract but does not disclose his secret commitment. In the second round, they then exchange their respective secret commitments. Each party can then hash this latter and thus verify that the purported secret commitment he receives indeed corresponds to the public commitment from the first protocol stage.

This model, though abstract, is thus a faithful representation of a real implementation of the protocol, as agents indeed protect themselves with such internal timeouts. Note that this is related to the possibility of abuse in this contract signing protocol: when the originator has made the first step, the responder has the freedom to either accept the contract by sending the second message, or to reject it by ignoring it. In particular, a dishonest responder could abuse the originator-signed part of the contract in negotiations with other agents (for instance, by soliciting more advantageous contracts from competitors). Note that, unlike for instance the similar GJM [9] protocol, the ASW protocol has no means to prevent this abuse by special cryptographic

We now want to contrast two models: on the one hand, the model with the fairness constraints described above (i.e. that the agent will eventually get the timeout and the reply from the trusted third party), and on the other hand a model without fairness constraints.

We now turn to the objective (2.), effectiveness. In the view of our model, where every honest agent will eventually reach a final state, effectiveness means that when an honest agent A receives an abort token for a session with an honest agent B, then A or B must have chosen to abort the contract. Since the abort token from the T3P contains the signature of the agent A or B according to the protocol, it contains the implicit proof that either A or B indeed wants to abort the protocol run. Effectiveness is thus an implicit guarantee due to the form of the abort token, and will therefore not be considered in the later analysis.

signatures of both parties are contained and we can thus assume that they agree with the contract text. However, we are also interested in a further analysis, namely an analysis of the authentication properties (or agreement properties in [10]) of ASW. Our analysis will include checks for replay and for confusions of nonces. Such standard authentication properties do not rely on fairness and are thus straightforward to check.

Let us conclude this section with a remark on the intruder model. Several approaches distinguish between the intruder and dishonest or corrupted agents (with various degrees of corruption). One of the reasons for this distinction is that the security properties of a protocol usually only hold for sessions between honest agents. In particular, the intruder can play, under his real name, the role of the initiator or the responder in a session with an honest agent; in such a session no security properties are ensured for this honest agent, while this session should not jeopardise the security of other sessions between honest agents.

Due to our simplified view, the main security property that we have to check for ASW, namely (1a.) that the secrecy of the valid contract once an honest agent has received an abort token, should also hold in the case that the other agent is dishonest. (But it is not necessarily ensured that this dishonest agent also has the same security guarantee.) This means that we need not distinguish between various kinds of corruption of dishonest agents.

Both OFMC and OFMC-FP were developed in the context of the AVISPA project and are based on the specification languages developed in this project. The user specifies protocols using the High-Level Protocol Specification Lan- guage (HLPSL [2]); these specifications are then automatically translated into the low-level Intermediate Format (IF [3]) which is the input language for au- tomated analysis tools. The first task is thus to specify our view of the ASW protocol in HLPSL.

Firstly, an aspect of the protocol that is difficult to model is the database of aborted and resolved contracts maintained by the T3P. Many existing pro- tocol specification languages cannot express this, however HLPSL and IF in- clude the necessary constructs (i.e. finite sets of messages) to model such a database. Moreover, the database cannot be integrated directly in infinite state verification approaches that use abstraction.

ticular message, but of a pattern of messages. Such a feature is currently not supported by HLPSL and IF (or most other protocol specification languages). As a simple way around the problem we specify an honest agent that acts as an observer and flags an error state appropriately.

OFMC discovers several authentication problems that were already iden- tified in [14]. First, the protocol does not provide strong authentication (in- jective agreement as defined by Lowe in [10]), as it has no explicit protection against replay: if the intruder listens to a session of two honest agents, he can replay the exchange protocol with the responder any number of times and obtain valid contracts, each with a fresh responder nonce. However, we think one should assume an implicit replay-protection as part of the con- tract, e.g. transactions are usually identified by unique transaction numbers. In this scenario, we thus check that the protocol provides weak authentica- tion (also called non-injective agreement, [10]). Weak authentication with respect to the contractual text and the nonces N0 and NR is also violated, and OFMC returns an attack trace resulting from the same authentication problems reported in [14]. Finally, weak authentication with respect to only the contractual text is verified by OFMC for various finite test scenarios.

There are several works (which do not focus on automated analysis) on reasoning about such protocols and their guarantees, in particular optimism and fairness [5,6]. The employed models are considerably more detailed than ours in that they explicitly use time-outs and distinguish intruder and (dif- ferent kinds of) dishonest agents. Also, here a similar view to ours is often taken, though to our knowledge not been used to reason about the protocol and its objectives.

While we have focused on ASW in our work to date, we are optimistic that the benefits offered by the adoption of such a unified view will be applicable to similar protocols as well. In general, the meta-reasoning we perform regarding security objectives can help not only to better understand the objectives of a given protocol, but, as we have seen, can also identify potential ways in which seemingly complicated objectives can be reduced to more standard no- tions such as authentication and secrecy. In this way, we hope to extend the applicability of existing methods for the formal analysis of security protocols.

