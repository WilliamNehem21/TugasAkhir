Wireless Sensor Networks (WSNs) are widely used in different kinds of environments. They may encounter lots of stochastic uncertainties and disturbances like message loss and node dynamics. Thus, it is critical to ensure the correctness of low level protocols in WSNs and evaluate their performance under different circumstances. In this paper, we propose a new method to analyze and evaluate WSN protocols based on stochastic timed automata and statistical model checking.

For modeling, the work flow of a WSN protocol can be modeled with classical timed automata. Then, to model the uncertainties such as message loss and node dynamics, which are common in realistic circum- stances, the timed automata can be extended by stochastic transitions, resulting in the stochastic timed automata. For analysis, the correctness of the protocol can be answered by classical model checking on the timed automata, while the performance of the protocol under realistic environments can be evaluated by statistical model checking on the stochastic model. To illustrate the feasibility and scalability of the mod- eling and verification method presented in this paper, Timing-sync Protocol for Sensor Networks (TPSN) will be studied completely throughout the paper.

Nowadays, Wireless Sensor Networks (WSNs) have attracted world wide attention and have been used in military operations, medical care, environmental monitoring and protection etc [1]. All high level applications in WSNs are working based on their underlying protocols. To run these applications correctly and efficiently, the low level wireless sensor network protocols must be robust and reliable. In addition, devices in WSNs are usually difficult to change once deployed, so we must ensure that the protocols work well under their target environment in the design phase.

For modeling, as WSN protocols always have intensive connections with real time behaviors, timed automaton [5] is a natural modeling language for WSN systems. Studies like [16], [17], [18] have tried to use timed automata to model the work flow of the system. But classical timed automata can only model the behaviors of a system under ideal circumstance. As WSN systems can be deployed in any kinds of environments, they may encounter many kinds of uncertainties like message loss and node dynamics. Thus, it is important to introduce stochastic behaviors into timed automata to support the modeling of uncertainty behaviors to make the model more realistic.

For verification, model checking has been widely used to check the correctness of WSN protocols [15] [16] [19]. It can explore the full state space of the model for a protocol. Nevertheless, this technique is very expensive. It faces the notorious state-explosion problem and limits the scale of the networks that can be checked. As WSN systems always consist of dozens of nodes at least, classical model checking can not handle real-case WSN networks very well.

Fortunately, Statistical Model Checking (SMC) has recently been proposed as an alternative to avoid exhaustive exploration of the state-space of a model [3]. SMC is a simulation-based solution, which is less time and memory intensive than classical model checking [13]. The procedure of SMC is to generate enough sample execution paths for the system and then use the statistical hypothesis testing to decide whether the system satisfies the given property or not. SMC techniques can also be used to estimate the probability that a system satisfies a given property [3]. By combining these techniques, in this paper, we present a new method to model and evaluate WSN protocols by stochastic timed automata and statistical model checking. First of all, we propose to model WSN protocols with timed automata, to describe there work flow in ideal environment. For network dynamics, node failures and intermittent communication links which are common in WSNs [1, 6], we ex- tend the timed automata with stochastic transitions. For example, in the extended stochastic timed automata, when a message is broadcasted, it has a probability to be lost instead of all the nodes receiving it successfully. Similarly, in real environ- ment, a node may die and leave the network at any time, and it can resurrect and

The paper is structured as follows. Section 2 gives the preliminary knowledge of this study, including the existing works in modeling and verification of WSN protocols, and a brief description to stochastic timed automata and their verifica- tion. In section 3, we present our method to model and evaluate a protocol with stochastic timed automata. The stochastic timed automata of a well-known WSN protocol and the respective evaluation are given in section 4. Section 5 describes the concluding remarks at last 1 .

In [17] and [18], Vaandrager et al also model a WSN protocol in the similar way. They verified the protocol with fully connected topology, and analyzed the counterexample given by the model checker. Nevertheless, their models does not incorporate all the features of the system neither, such as uncertain communication delays and unreliable radio communication.

To conclude, we can see that, first, most of the modeling and evaluation works still treated WSN protocols as general protocols. Only a few considered to model the uncertainty behaviors, which are very common in WSN, into the system model. Second, most of the works only checked the correctness of the protocol, only a few of them considered the evaluation of the performance of the protocol under different profile or environment. Last but not least, as the mostly used analysis technique is model checking and/or probabilistic model checking which is very expensive, the size of the system that can be analyzed are limited. As the size of deployed WSN systems are always quite large, the scalability of current analysis technique can not handle real-case system very well.

The theory of timed automata can be used to prove the correctness of real time systems [5]. Generally, two types of properties, liveness and safety, are concerned. As checking liveness is computationally expensive, the main effort of verifying a timed system focuses on checking the safety properties, which can be checked using reachability analysis by traversing the state-space of timed automata [9]. It is proved that the reachability verification of timed automata is decidable, still quite expensive though.

Timed automata can be extend to model stochastic transitions via weighted probabilistic branches, resulting in the stochastic timed automata. Recently, Sta- tistical Model Checking (SMC) [12] is proposed to answer the numerical properties of stochastic systems. It simulates the system model repeatedly based on Monte Carlo simulation to generate enough sample execution paths, then relies on statisti- cal algorithms, such as hypothesis testing [11], to get an estimate of the correctness of the entire design [8, 10].

In most of the WSN protocols, nodes/sensors may bear certain functional roles, i.e., sender and receiver, in the work progress of the protocol. For all the nodes with the same role, they basically share similar behaviors. Thus, we can use a template timed automaton to describe the work flow of these nodes in ideal environment in general. Then, each node can be assigned with a unique number as its identity. Different nodes can communicate with each other through shared variables and synchronize with each other through synchronization messages.

For a template timed automaton which describes the behaviors of a node with certain role, we propose to build the template model in a bottom-up style. By bottom-up, we mean the life cycle of a protocol can be divided into different mod- ules/phases. The fragment of timed automaton for each specific module/phase can be built independently. Then, they can be combined together in the end, which can make the modeling effort much easier and more controllable.

WSNs usually work in harsh environments. Thus they may encounter lots of uncer- tainties such as message loss and node dynamics in reality. To address these aspects and make the model more realistic, we propose to extend the timed automaton with stochastic transitions. The extension is made in two steps. First, add probability factors to the transitions where messages are received to model the message loss. Then node dynamics are described by introducing probability branches to model the scenarios where nodes may fail and resurrect.

By now, we can get both the ideal and the stochastic timed automata for a WSN protocol. After that, the correctness verification of the design of the protocol can be performed on the classical timed automaton. The performance evaluation of the protocol under different kinds of environments can be conducted on the stochastic model.

Correctness verification is conducted on the ideal timed automata by classical model checking techniques. In this phase, we can check functional properties of the pro- tocol, such as whether there are deadlocks, whether all nodes can be eventually synchronized and etc. As classical model checking for timed automata has very high complexity, the verification can only be performed on systems with small scale. By checking functional properties, we can see the correctness of its logic design, and find bugs in the early phase.

In section 4.1, we give both the ideal and stochastic timed automata of TPSN respectively. In this section, we will analysis TPSN based on these models. We verify the ideal timed automata against typical functional properties and evaluate the performance of TPSN under different environments using statistical model checking technique on the stochastic timed automata.

To illustrate the feasibility and scalability of our approach, a real-case WSN protocol TPSN is studied thoroughly in this paper. It indicates that stochastic timed automata and statistical model checking are very helpful in analyzing large WSN systems working in unreliable environments. Furthermore, as statistical model checking is much easier to conduct and less expensive than classical model checking, it is possible to examine real-case large systems, e.g. a system consists of 100 nodes by statistical model checking, while classical model checking can only able to handle system up to 6 nodes. We show that it is possible and very convenient to use statistical model checking to analyze large WSN systems numerically for many

We would like to thank the anonymous reviewers for their valuable comments and suggestions. This work is supported by the National Natural Science Foundation of China (No.61100036, No.61170066, No.61003025), the National Grand Fundamental Research 973 Program of China (No.2009CB320702), the National 863 High-Tech Programme of China (No.2011AA010103, No.2012AA0

