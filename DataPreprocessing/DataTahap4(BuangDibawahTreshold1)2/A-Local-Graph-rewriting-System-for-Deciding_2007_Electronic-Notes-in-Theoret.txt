In this paper we give a graph-based decision procedure for a calculus with sum and product types. Al- though our motivation comes from the Bird-Meertens approach to reasoning algebraically about functional programs, the language used here can be seen as the internal language of a category with binary products and coproducts. As such, the decision procedure presented has independent interest.

A node is a triple (s, I, O) where s is a symbol with arity as and co-arity cs, I is a set of input ports, and O is a set of output ports such that the number of elements of I (resp. O) is as (resp. cs).

In this section we introduce informally the graph-rewriting system and the difficul- ties involved in its definition. The system will then be formally defined in the next section, and its properties studied. Here we consider in turn the treatment of fusion and cancellation.

Note that the application of rule dupM-choice removes the ground duplicator needed to close the fusion started on the left-hand side sub-net. In fact, this is exactly the pattern of divergence that rule dupM-dupM avoids by restricting the top duplicator to be ground. This shows that indices should also restrict the application of rule dupM-choice.

A local graph-rewriting system will now be given for sum-product nets, based on the ideas discussed informally in the previous section. We first need to establish an appropriate notion of graph-rewriting rule: both the left-hand side (LHS) and the right-hand side (RHS) of the rule are finite nets, with the same sets of input and output ports (in other words the rule preserves the interface of the net). Moreover both the LHS and RHS nets are well-typed and well-formed, the rule preserves type and position labellings of the inputs and outputs, and does not introduce cycles.

Definition 6.3 Let N be a single input, n-output net and A a two-input, single- output node. We define JOIN(A, N ) as the two-input, n-output net composed of two copies of N and n copies of A (say Ai) where the inputs of the net are the inputs of each copy of N , the ith output of the first (resp. second) copy of N is connected to the first (resp. second) input of Ai, and the ith-output of the net is the output of Ai.

Proof. Indices are adjusted during reduction in accordance with well-formedness. On the other hand, rules for indexed nodes are such that they do not constrain interaction when the indices are non-zero. This means that an indexed node can only survive in a normal form if: (i) it reaches the top of the net; or (ii) it gets stuck in a commutation that is not possible. The well-formedness criterion guarantees that

For sum-product nets in general the read-back can be generalized as taking a vector of n inputs and producing a vector of m outputs (both indexed from left to right), Rx(N ) = y1, . . . , ym where x = x1, . . . , xn.

