Recent research has concentrated on specific transformations for various purposes. Reppy introduced a local continuation-passing style (CPS) transformation in a direct-style compiler to enhance the efficiency of nested loops. Meanwhile, Kim and Yi defined coercions between direct style and CPS terms, allowing arbitrary subexpressions to be transformed without any additional effects other than nontermination. These transformations facilitate interfacing to external code in both direct style and CPS. The syntax and semantics of a small, typed functional language with control effects are presented in Section 2, along with the traditional CPS transformation (non-selective). Section 3 extends the language with effect annotations verified by an effect system and defines the selective CPS transformation guided by these annotations. Section 4 proves the correctness of the selective CPS transformation using Plotkin-inspired colon translations. The paper concludes with Section 5. 

The paper distinguishes between trivial and serious expressions, where trivial expressions have no computational effects and serious expressions might have effects. The standard CPS transformation assumes that any application might have effects, which is reasonable when considering nontermination as an effect. The minimum annotations necessary for the purpose of the selective CPS transformation are outlined. Values and identifiers, traditionally considered as trivial expressions, are treated as such for the purpose of the transformation. Special consideration is given to functions and applications, particularly when a lambda abstraction is applied at an application point. In a higher-order program, all functions that can end up in a given application must be transformed in the same way, dividing the abstractions into groups that either expect a continuation or do not. Reduction rules are defined for expressions marked as non-trivial, which may reduce to those marked trivial. The concept of the colon translation is introduced, stating that in e: k, the k represents the context of e, which has been collected in a continuation in the transformed program.

The method of extending the colon translation to selective CPS transformation was initially developed in cooperation with Jung-Taek Kim and Kwangkeun Yi from KAIST in Korea, and with Olivier Danvy from BRICS in Denmark. The work of these researchers was instrumental in the development of the present work. Suggestions from Andrzej Filinski and anonymous referees were also appreciated.