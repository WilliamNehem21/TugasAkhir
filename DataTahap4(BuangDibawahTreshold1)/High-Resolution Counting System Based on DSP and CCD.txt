This paper presents a high-resolution CCD counting system based on the Texas Instruments (TI) TMS320VC5509 Digital Signal Processor (DSP). The counting system is used in pharmaceutical packaging machinery. The major advantage of the system is high in counting speed , stable and reliable in performance. The counting system meets the requirements of speed and precision for pharmaceutical packaging machinery.

In order to meet the requirements of speed and precision for pharmaceutical packaging machinery, the counting system of electronic counting-machine is designed based on DSP and linear CCD sensors [1]. Compare with the old system, the system resolution is higher; counting speed is faster, filling accuracy is much higher. Meanwhile, the system can detect tablets size and adhesion, then picks out the medicine bottle filled with crushing-pills. The counting system makes electronic counting-machine is much more efficient.

Fig.1 shows the functional blocks in the Counting System. As is shown in Figure 1, through the lens, the light shoots at the CCD sensor, and immediately the sensor converts the light into electric charge and processes it into electronic signals. When pills fills down through the detection channel, the light intensity in the detection channel will be weakened, and then the electronic signals from the CCD sensor will be changed. The Light source provides the system with stable light intensity. Through the detecting space, the pills image on photo surface of CCD sensor. TLC2543 takes the analog signal , processed by the CCD sensor, conversion for digital signal and the digital signal will be sent to the First In First Out FIFO  memory for the frequency matching factor between the ADC(TLC5510) and DSP(TMS320VC5509).The ADC and the FIFO data-in operation are also driven by the timing generator.

The TMS320VC5509 gets the commands from the HMI(Human Machine Interface), and it not only provides the timing signal to the ADC and FIFO, but also sets the counting mode of the system. In the meantime, the timing generator provide timing signal for CCD sensor. The DSP continually reads out the image data from the FIFO by the half-full flag of FIFO until all of the data from detection channel sent to the synchronous dynamic random access memory(SDRAM) by itself. After a series of data processing, the DSP send the processing results to the HMI. The touch screen (Human Machine Interface) show the results and save the results to SD card automatically.

The Altera EMP3064A is used as the timing generator of the counting system. EMP3064A is a CPLD chip with 64 micro-cells, 1250 usable gates and 66 user I/O pins.Line timing(SH),driving timing(  1and  2), reset pulse timing(RS), buffering timing(CP) are all generated by the EMP3064A chip, furthermore, EMP3064A receive the synchronous signal from DSP[5][6]. The output sequence of timing Generator is shown in Fig.3(a).

The CCD sensor converts the light into electric charge and processes it into analog signal. However the analog signal must be transformed into the digital signal so that it can be recognized and used by DSP. The Texas Instruments (TI) TLC5510 is used as the ADC. The TLC5510 is CMOS.8-bit, 20 MSPS analog-to- digital converters that utilize a semi-flash architecture [4].ALL422B is used as the FIFO, that consists of 3M- bits of DRAM, and is configured as 393,216 words. The signals were stored and then transmitted to RAM of DSP. The ADC and FIFO receive synchronous sequential signal which come from DSP. The block diagram of Data acquisition is shown in Fig.3(b)

The Texas Instruments (TI) TMS320VC5509A is used as MCU. The TMS320VC5509A of fixed-point digital signal processor (DSP) is based on the TMS320C55x DSP generation CPU processor core. With performance of 8000 million instructions per second (MIPS) at a clock rate of 200MHz, the C55x devices offer cost-effective solutions to high-performance DSP programming challenges. The block diagram of DSP module is shown in Fig.4(a)

As is shown in Fig. 4(b), the time which one of diameter 9 mm thickness of 4.5 mm pills goes through the detection channel is defined as t1. The falling height is defined as  . The equation 7 indicate the relationship of t1 and  .

The counting system is installed in the electronic counting-machine, which runs to 48 hours long, its counting speed up to 10000~12000 tablets per minute. The system error can be dropped below 4.67%. The counting system can meet the demands in practice.

