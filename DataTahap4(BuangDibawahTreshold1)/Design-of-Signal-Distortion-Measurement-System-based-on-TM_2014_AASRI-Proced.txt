TMS320F2808 DSP chip as the core, combined with signal conditioning and keyboard scan peripheral circuits, made up the hardware circuit of the measuring system. As for software,DSP as the main controller, realized the data display ,controlment and management about the whole system,Using the DSP internal integrated ADC module to achieve the data collection, while using its internal resources to complete the FFT algorithm and optimization. The field test results show that this measuring system of digital signal distortion realizes the amplitude and frequency display in time domain and frequency domain when the setting signal passed the test system, and the measuring error is less than 0.8dB.

It is using the real fast Fourier transform (RFFT) optimization algorithms for the design of digital signal distortion measurement system. The overall block diagram of digital signal distortion measurement system shown in Figure 1.The given signal into the analog channel through the test circuit, after being conditioned, signal is sampling high speed by the DSP internal ADC. Combined with the FFT algorithm , the sampled data are sent to the LCD for display by using the DSP processor.

Normally, the input sequence is pure real, but the input sequence of the FFT operation is plural, this must be form a plural sequence by replaced imaginary part with a zero manually. But the amount of its calculation will increase, computation time will be longer , memory space will increase, the system is not conducive to real-time processing. In view of this, we made some improvements about the original real number FFT algorithm, namely RFFT optimization algorithm. The specific contents are as follows:

If a finite sequence of CKH x(n) , n  0,1,...,2N 1 ,decomposed it into even items g (r)  x(2r) and odd items h(r)  x(2r 1) , the even one as the real part of the N point plural finite-length sequence, and the odd as the imaginary part of the N point plural finite-length sequence, then composed a sequence like this:

Compared to calculate the real FFT directly, RFFT optimization algorithms reduce nearly half amount of the computation, while saving memory space. Obviously, RFFT optimization algorithm is a method of saving computation, speed nearly doubled. It is the core algorithms of our design.

Using TL431 chip to design The 1.5V DC bias source ,the aim is lift the input voltage to ADC input range. Bias module shown in Figure 2. TL431 is a three-terminal programmable shunt regulator diode, whose programmable voltage is 36V,output impedance is 0.22 Ohms, and it has low output noise voltage. When it is working properly, there is a reverse current between 3-pin and 2-pin, and generate a 2.5V reference voltage at the third pin, we will obtain a 1.5V reference voltage by adjusting the variable resistor R41[3].

The output reference voltage is connected to the voltage follower that designed with integrated operational amplifier OPA2134, to achieve the function high input impedance, low output impedance. OPA2134 is the operational amplifier that applied in the audio range with the superiorities of Ultra-low distortion, low noise , unity gain stable, it can be suppled by dual power ,its bandwidth is 8MHz.It provides excellent common-mode rejection and maintain low input bias current, and minimizing distortion over a wide input voltage range[4].

ADC driver module schematic diagram shown in Figure 3.If the input signal into the ADC acquisition directly, digital signal of DSP will do interference to the input analog signal, even a serious distortion of the input signal. Therefore, we added a voltage follower before the signal into the ADC of integrated DSP to realize the function of isolate the interference signal .This module uses the integrated operational amplifier chip OPA340 on the circuit (ADC circuit) design. OPA340 is a rail to rail amplifier with CMOS technology, single power supply, 5.5MHz bandwidth. It is the characteristic of rail to rail input / output and high-speed processing that made it be the ideal chip of ADC driver[5].Because the voltage range of DSP internal integrated ADC is 0~3V,So we use a resistor divider limits the supplied voltage of operational amplifier for 0~3V,that is, the output voltage of operational amplifier is0~3V,Thereby protecting the DSP internal integrated ADC.

DSP internal integrated ADC is the bridge connected with external analog signal, the clock must be setted below 12.5MHz, or the data of ADC conversion would be unstable. In this paper, the ADC clock setted at 12.5MHz,triggered by software, controlled the sampling rate of ADC with timer 0. ADC acquisition module flowchart of Frequency domain shown in Figure 5.

It is 12 bit that the ADC integrated inside DSP, but the actual sampling number is less than 10,the sampling precision is very low. To obtain a higher sampling precision, we need to separate the digital power design and analog power design. To avoid the digital signal line we connected the ADCINxx pin, and we use external reference.

In this design, ADC sampling frequency is divided into the time domain and frequency domain. Time domain sampling rate sets as:500Hz,1KHz,5KHz,10KHz,50KHz,100KHz,500KHz and 1MHz. System works at 1KHz initially, displayed according to the graphics, adjusted the sampling frequency using the keys of instrument.

Firstly, according to the table 1,sampling the test signal in all range of the Frequency bands by ADC. Secondly, processing the sampled data by RFFT algorithm. Finally, tabulating the test results. Figure 6 is a field test pattern of the system, Table 2 is the specific test results.

From the test results of Table 2 we know that , the calculated signal amplitude of the design is relatively stable in the frequency range of 10Hz ~ 150KHz, the maximum error is -0.724dB. The flat of the design is better in the entire bandwidth range , the error is bigger when the measuring signal amplitude between 40KHz to 150KHz, and the fluctuation is more obvious . From test signal spectrum , we can see some frequency spectrum leakage of the signal .Since the design uses a reasonable set of sampling points and frequency, we can sampling the general signal periodically in theory and avoid leakage phenomenon as far as possible. After a data analysis of the test frequency in the range 40KHz ~ 150KHz, we find the error of test signal amplitude mostly comes from the systematic errors of the design.

Use the method of signal distortion measurement which proposed in this paper, design and develop the signal distortion measurement system with optimized FFT algorithm, the results show that by field test, this method is a feasible one for measuring. To some extent, it is achieved remarkable results on the inhibition of the spectrum leakage phenomenon, and improved the accuracy of measurement. At the same time, the signal distortion measuring instrument which use the proposed method has the advantages like easy to make, low cost and easy to carry, solve the inconvenience status of field test in engineering applications. This method has a good practical application prospects.

