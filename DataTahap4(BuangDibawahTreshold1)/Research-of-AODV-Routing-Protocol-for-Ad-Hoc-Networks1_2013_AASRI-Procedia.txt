Firstly, this paper describes the basic characteristic, key techniques of Ad Hoc networks, and compared with other mobile communication systems. Through analyzing and comparing with DSR, TORA, ABR, AODV, it researched on-demand routing protocol for Ad Hoc networks. It introduces AODV routing protocol in details. It presents an optimized protocol: B-AODV, based on the shortage of routing finding and routing repair of AODV. In B-AODV, first through reverse request by sending BRREQ replace of RREP, it reduces the time of routing finding. Second, two hops IP record in control messages and route table can improve the rate of routing repair and reduces the times of routing findings. And it improves the function of Ad Hoc network. This simulation experiment is based on NS2 and compared the performance of AODV and B-AODV. And it compared the differences of control packets, ratio of packets, end to end delay for AODV and B- AODV. It shows that B-AODV is better than AODV.

AODV(Ad hoc on-demand distance vector routing) is a Source drive type[3] routing protocol. When a source node sent message to a target node without the routing, it sent RREQ first. When the adjacent node received RREQ with the addresses of source node and target node, it judged if it was same with the target node’s address. If it was, sent RREP to source node, otherwise, checking the routings in the rout table that could reach the target node, then send RREP to source node, or continue to flooding send RREQ. AODV protocol can maintain routing nodes through broadcasting hello message regularly. If one link break, it sent ERROR message to nodes, meanwhile deleted broken records or repaired the routing.

AODV protocol created the routing between two nodes in the network based on route discovery and route maintenance.. In the route require process, it broadcasted RREQ message to target node in the form of flooding; In the route response process, target node preferentially chose the first-arrived RREP and sent RREP message. As the node strenuous exercise during finding routings, the route was easy to break, which would lead to the loss of RREP packet. In the routing maintaining process, the broken node would discard error packet and notice the source node to resend request message when broadcasting RERR packets, which would lead time delay of subsequent packet; in order to eliminate loopback caused by new touring, local repair may cause that the RREP sent by downstream node could be discarded, which reduced the probability of routing recovery. In addition, despite with routing maintenance mechanism, the node is mobile, the route may not be repaired timely or failed to repair, which reduced the utilization of network control information, and could increase the routing delay, thus affecting the performance of the network..

For AODV, if a node moved fast, in the reverse routing it may cause the loss of packets when RREP sent reply message through unicast, and RREP unicast back to the source node, so in the B-AODV, a control message B-RREQ similar to RREQ was devised when the reverse route was built. The source node also undertook the task of routing discovery as the target node, and after receiving RREQ it reversely sent flooding B-RREQ message to find the source node,. When the source node got first B-RREQ, it started to transmit data, and recorded the information of both front and next two-hop nodes in RREQ and B-RREQ for rapidly rebuilding routings.

The route discovery process was detailed as following. When the source node had no routing to the destination node and had to send data to the destination node, it broadcast RREQ message to neighbors. The RREQ message’s format was shown in table 1.

This format added front and next two-hop nodes addresses, that showed RREQ recorded not only the addresses of the current node's neighbours but also that of two-hop nodes. When one node broadcast RREQ control message, the counter of RREQ added 1 automatically. The source node IP address and RREQ ID could uniquely identify a RREQ control message. A node checked ID when receiving same RREQ control message, if that were the same, one of that was discard. This process was completely same with AODV. After getting RREQ, the intermediate node compared with its own routing information, and updated the related information in the routing table, thus relevant bytes were added: front and next two-hop nodes' addresses. The format of routing table is shown in table 2.

If the intermediate node had no routing to target node, it continued to sending RREQ and constructed reverse routing. When RREQ packet reached the target node, the target node created a packet B-RREQ similar to RREQ. Table 3 showed the B-RREQ message format.

Having created B-RREQ, the target node broadcast it to neighbor nodes immediately, same with the process that the source broadcast RREQ, which is to build reverse routing. When the intermediate node received the packet, it would check there was the same packet or not, if it was yes, then the same packet would be discarded. Otherwise it would be sent to neighbor nodes. The neighbor node received the packet, recorded the addresses of next and front two-hop nodes, and set the routing lifetime until it got the target node. The source node transmitted data immediately when receiving first B-RREQ. The routing reply process was shown in figure 1.

Unlike that RREP returned to the source node with one-hop and unicast, as Rĺ4ĺ3ĺ2ĺ1ĺS, in B- AODV, B-RREQ was broadcast with many routings to choose, Rĺ5ĺ6ĺ7ĺ8ĺ9ĺS,Rĺ14ĺ13ĺ12ĺ11ĺ10ĺS and so on. The source node S could transmit data in a routing with most energy. The problem that RREP often lost as the intermediate nodes moved in AODV can be solved.

Shown in figure 3, in the AODV algorithm, if the link between nodes 2 and 3 had been broken, node 2 need to repair local routing, send RREQ, and find routing to the target node R. RREQ was forwarded to node 4 through node F, until reaching node R, then R replied RREP back to node 2 along the reverse routing. Thus a new effective routing was built. If routing repair failed within certain repair time, it sent RRER message to source node, and the source node resent RREQ to find routing.

If there was no common neighbor node between node 2 and 3, shown in figure 4, node 3 could not escape next-hop range of node 2. So node 3 was likely to be one of node 2’s next two-hop nodes. In this case, after receiving RREQ from node 2, node H found that there was no node 4 but node 3 in its neighbors, then node H sent RREP to node 2, aiming to notice that it was the common neighbor node with node 3, thus node 2 would rebuild a new routing through node H and 3 to the target node.

If the node 3 and the node 4 lost efficiency, shown in figure 5, node 2 sent RREQ finding the target node R, to find new routing of broken path; if routing discovery failed, node 2 sent RRER to neighbor nodes until back to source node S, S resent RREQ to start a new round of routing discovery, which was same with AODV protocol. Due to the movement speed of nodes was limited, there will be less in reality. This reduced the cost of routing maintenance as well as routing delays.

If the case was special, node 4 was the target node, completely same with original AODV algorithm, it sent RREQ to find the next two-hop nodes, i.e. the target node. When node 3 being the target node, send RREQ do find the target node directly.

Moreover different scenes had a big impact to the routing protocol. Same routing protocols in different simulated scenarios, its routing performance also had a great deal of difference. The main factors of the ad hoc network scenes: the number of network nodes, the changing speed and the movement speed of the network. Therefore, when comparing and analyzing different routing protocols, the network scene must be taken into account.

Some of the features in the Ad Hoc network increase the difficulty of routing technology, such as ad-hoc, multi-hop as well as the variability of the network structure, so the key to designing Ad Hoc routing protocol is to solve the problem that fast node movement makes complex changes in network structure. On the basis of the comparing and analyzing AODV routing protocol, this article introduced an improved B-AODV protocol, which ameliorated the routing finding and local repair for rebuilding new routing. The new protocol improves the routing repair capacity and packet successfully-posted ratio, reduces the delay from node to node, and decreases the routing overload. Nonetheless, the nodes in the network do not only have a two-way link, the single link protocol optimization is the goal of future research.

