How to estimate the differential time of flight accurately is a challenging problem in the area of ultrasonic flow measurement. High time resolution is necessary, especially in a small inner diameter, short sound path measurement environment, since sound velocity in the liquid is quite fast and the order of magnitude is nanosecond. A newer method to obtain the differential time of flight is a Spline-Based algorithm. Although the calculation accuracy of a Spline-Based algorithm is higher than the common method, cross-correlation algorithm, the calculated quantity of this algorithm is huge. For this reason, an improved Spline-based algorithm is proposed to reduce the computational cost while keeping the accuracy. In addition, installation location of transducers is one of the most important factors affecting the measurement accuracy of ultrasonic flowmeter. This paper also analyzes the affection of the differential separation distance between transducers. Experiments have shown that the improved algorithm is effective and the separation distance affects the result seriously.

The proposed method improves the Spline-Based algorithm by combining with the cross-correlation algorithm. The improved algorithm reduces the computational cost without reducing the accuracy. This proposed method is evaluated in experiments. In addition, an important part of the installation process is the transducer separation distance previously described. If the signal received by a transducer when set up at the wrong position, the calculation result would be definitely wrong. This paper analyzes the affection of the differential separation distance between transducers to show the importance to determine the correct position. Experiments have shown that the separation distance affects the result seriously.

The differential time of flight, t, is a key parameter, and its order of magnitude is nanoseconds. Since sound velocity in the water is quite fast, so high time resolution is necessary, especially in a small inner diameter, short sound path measurement environment. Typically, the cross-correlation algorithm is the most widely used algorithm. And this method is good at restraining white noise. But simulation results show that the calculation accuracy of the Spline-Based algorithm is higher than the cross-correlation algorithm.

Assume S1 and S2 are discrete signals of reference signal and delayed signal (continuous time signal), and each group signal has 2048 points. Extract the kernel signal from S1 and S2 starts from the same point. The kernel signal is the effective part of the ultrasonic. Assume S1 [n] and S2 [n] represent the kernel signal. The length of S1 [n] is N and The length of S2 [n] is M, where M<N. As is shown in Fig.2, extracting kernel signal is depending on experience. If M and N are too big, the kernel signal will include useless points. In contrast, if M and N are too small, the useful points will be missed.

The subscript of fi(t ) is different from Eq.(3). Signal S2 [n] has only M points, so fi(t ) is the i th segment of M segments which involved in computation. First time, k=0, points of signal S2 [n] compute with the first to the M th segment of S1 [t]. Second time, k=1, points of signal S2 [n] compute with the second to the M+1 th segment of S1 [t], and so on. Finally, there are (N-M) t-values. And there must be a t lying between 0 and 1, which called global delay estimate. Differential time of flight t is calculated by Eq.(5).

Before calculating Eq.(4), we can find the maximum point ,mi, of the cross-correlation function of discrete signals S1 and S2 by Fast Fourier Transform. If mi-1<mi+1, then k=i; Else if mi-1>mi+1, k=i-1. k is the parameter we need in Eq.(5). Since k is a known parameter, we can get t by computing only once. Points of signal S2 [n] compute with the k+1 to the k+M th segment of S1 [t] by Eq.(4). It is clear that N-M-1 times calculate quantities are removed. And the speed of algorithm will be increased.

of ultrasonic flowmeter. When the wall thickness, the wall material, and the fluid medium are all known quantities and the acoustic path is determined in accordance with the V-shape, the separate distance between each transducer should be definite. Assume transducer acoustic wedge is organic glass, and the material of the wall is steel. The fluid medium is water and incidence angle of ultrasonic wave is 37 degree.

 is the incident angle when signal passes through the organic glass-steel interface.  is the refraction angle when signal passes through the organic glass-steel interface or the incident angle when signal passes through the steel-water interface.  is the refraction angle when signal passes through the steel-water interface. C1 C2 and C3 are sound velocities in organic glass, steel wall and water respectively.

=37o, and longitudinal wave velocity in organic glass is 2730m/s. If shear wave velocity in steel wall is 3230m/s, we can get =45o. Longitudinal wave velocity in water is 1480m/s at 20oC, then =19o.The differential distance between transduser X and transducer Y is calculated based these angles.

In Eq.(7), dt is wall thickness, d is inner diameter. At the same time, the value of LAB in turn affect the value of  in Eq(1). Assume the position of transducer Y shifts to the right axially 2mm from the correct position. This will cause to refraction angle, , 3 degrees bigger than the true value. As a result, the calculation error of water velocity will be up to 11% based on Eq.(1). Moreover, this impact is more pronounced to small diameter measurement environment. So it is necessary to fine tune the transducer location.

Assume each group signal has 2048 points. The kernel signal, S1 [n], is the 1000 th to the 1800 th points of reference signal, N=801; The kernel signal, S2 [n], is the 1200 th to the 1700 th points of reference signal, M=501. Compared with improved algorithm, the Spline-Based algorithm will compute M-N=300 times more.

Experiment results are shown in Fig.4. The water velocity is calculated by Eq.(1). Moving the transducer B axially to the right from the correct position will lead to increasing of , then water velocity will decrease. The velocity is in an inverse ratio of . Despite other unknown factors, we only consider the error of separate distance axially. Assume zero point is the correct position.

