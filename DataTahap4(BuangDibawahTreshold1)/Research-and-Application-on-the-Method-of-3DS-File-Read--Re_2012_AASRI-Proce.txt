OpenGL is a strong there-the graph develop tools,3DS format is a common format for saving there d model Based on OpenGL, the paper researches on the method of 3DS model file read, render and control. First it analyzes the file structure of 3DS, and abstracts the data structure of face, material, object and model by chunk structure used to read in data. The file data is read in with the method of recursion, the read data renders in screen after data disposal. The interactive control of model is accomplished by three kinds of geometric transformation, translate, rotate and scale and OpenGL select mechanism. Finally, those methods are applied into the system of the borehole operation operate simulation and drilling, and achieve better results.

OpenGL is a strong there-the graph develop tools and a software interface of graph hardware, Points, lines, polygons and these basic geometries make up of models in OpenGL[1], so it's difficult to construct complex models directly in OpenGL, such as bent or beveling objects. Compare with OpenGL, 3DS Max has strong ability to construct models with the method of lathe, lofting and so on in short time. The models in 3DS Max could be exported as .3DS file, if the complex models constructed in 3DS Max could be import into OpenGL,

3DS file is saved as chunk structure. Beginning of a chunk is 2 bytes ID, 4 bytes chunk length information, and then is the main date of the chunk. 3DS file is opened in hex format, the data is saved according to the lower is in the front, and the higher is in the back. For example, 2 bytes FF AF is integer in hex, AF is higher byte and FF is lower byte; 93 8E 06 00 is long integer, 8E 93 is lower byte and 00 06 is higher byte.

There is a basic chunk in every 3DS file, The ID of the chunk is 4D4D, the subchunks are the main edit chunk with ID 3D3D, the key chunk with ID B000. The structure of the chunk and nested relationship of every chunk is complex. Now let’s briefly describe several main chunks.

Object chunk includes object mesh chunk (0X4100) and object material chunk (0X4130). The vertex of model, the UVW of vertex, face information and edge information are saved in object chunk. The endowed material information in current object is saved in object material information. The difference between material chunk and object material chunk is that 3DS file’s material library information is saved in material chunk, compare with it, material information in current object is saved in object material chunk.

The chunk structure of 3DS is fixed and nested, we should read file in recursive rule, and the condition of return back is whether the bytes read is equal to the chunk length.Jump from father chunk to subchunk could be realized by switch statement, which subchunk branch could be enter is through the subchunk ID .If we want to skip an unused chunk, the pointer point to file could be moved forward chunk length-6 bytes, and then skip this chunk by break statement, and process next chunk.If we want to read a chunk, for example material chunk, when the ID is 0XAFFF, first self add variable numOfMat used to record material number, then distribute an empty structure to current material chunk, and then Recurs call function ProcessNextMaterialChunk() to read relative information[4]. Whole program will end after main chunk is all read. The main flow of read program is as figure 1.

The coordinate system of OpenGL is different to 3DS MAX. In this article, the reading program is designed like that, swapping the coordinate of y and z, and then saving the swapped data when reading vertex list data. Compare with processing after reading data, this method could save time and space in processing.

The render effect of the vertex- triangle 3D model depends on vertex normal vector’s setting, so we must allocate a normal vector for every vertex in model, which could be used to compute lighting effects and judge the orientation of the triangle face relative to the observer. From solid geometry knowledge, we could know that all vertex normal vector in the same face is not necessarily same, the normal vector of a point is equal to the average of all face to this point for vertex. Reading program first initializesed all model vertex normal vector as(0.0,0.0,0.0),then computed normal vector of every face separately ,and then add it to vertex normal vector of this face, finally normalized all vertex normal vector, the final compute result of the vertex normal vector will arrived.

If we want to operate the 3d object interactively in OpenGL, the first to be sure is the object operated. The method is the choice mechanism of OpenGL. The choice is an operation which the operator chick in a certain position of the window’s internal with the mouse to determine which object he chicks [6].

Create name stack. It is the object choiced by operator saved in name stack. First call function glInitNames() to initialize name stack, that is clear name stack, second call function glPushName() to press object name into the stack when sending command to render all kinds of models, call glPopName() function to push the object name from stack.

Based on those methods, we design and realize borehole operation simulation and drill system. The simulation system realizes the operation of picking the donkey head, up tube and so on, 20 kinds of operation in borehole operation process. When applying, first the borehole operation model constructed in 3DS Max could be imported into OpenGL, then translate, rotate and scale model by geometric transform, adjust the size and the position of model to meet the practical requirements. Second layout scene, the method of texture mapping is applied to Drill background, namely choose 2n size bmp picture format as the texture, and then select the suitable mapping coordinates for the texture .Finally lighting the scene, open the function of scene lighting.

The critical equipment in borehole process is pumping Wells, and its surrounding related equipment,and a beam pumping unit is composed by the donkey head, balance piece, swim beam and control box components.Based on the OpenGL interactive control mechanism, we could interactively control the critical equipment in process.In the operation simulation process, first we should click the equipment model need to be controlled in mouse left key,in the choice mode, equipment models hit records have chosen to sign, and the corresponding name is pushed into the name of the stack, second exit the choice model and return the choiced data. Enter into the rendering model after the equipment model motion events are triggered, call render function Translation(hits),Rotation(hits) or Scale(hits) to translate,rotate or zoom the corresponding equipment to realize the aim of control model.

3DS is the universal data format to save 3d model, so it’s important to research the reading and rendering. The article researches on the method of reading, rendering and interactive controlling 3DS file, first divided the 3DS file into chunk, read the chunk based on recursion call, after coordinate change and vertex normal vector processing, rendered static 3d model, realized the interactive control based on geometry of matrix and OpenGL selection mechanism. Finally, those methods are applied into the system of the borehole operation operate simulation and drilling, and achieve better results.

