To analyze consumer habits and keep good inventory in vegetables, fruits and biscuit shop, detailed transactions information should be saved. An electronic scale is designed based on MSP430 and wireless communication module PTR2000. The scale can not only measure the weight, but also exchange data and instruction with host PC. The condition circuit of strain bridge output signal, time/data circuit, memory circuit, wireless module etc. is presented. The measurement result is processed by the method of moving average filter. User interface in PC side is developed by Visual Basic language.

Electronic weigh scales have wide range of uses in industrial, commercial and consumer applications. But the traditional scale can’t save the detailed transactions information, such as date, time, types and weight of goods etc, and the commodity price can only be inputted manually. It is inconvenient to use and hard to obtain sales reports, users can’t analyze the consumption habits of customers, good inventory control is also difficult to achieve. In contrast the electronic scales in large supermarket overcome these shortcomings, but they can’t

store sales information and they are too expensive for ordinary users. A wireless electronic scale based on MSP430 microprocessor is introduced. It can download the commodity information from personal computer by wireless communication, store sales data and upload to PC, obtain commodity prices by the commodity code and so on.

MSP430F135 mixed signal microcontroller is the control core of system [1]. The output signal of strain sensor is firstly conditioned by instrument amplifier and inverting amplifier. Secondly the conditioned signal is analog-to-digital converted by ADC module which is integrated in MSP430F135.

MSP430F135 processed the AD result and memory relevant information in AT45DB081 which is flash memory. The weighing result was displayed by LED which is drive by 74HC373 chip [2]. The sales data is sent by PTR2000 which is a wireless communication module. MAX232 which is a serial port communication chip is used between PTR2000 and host computer. The receiving program is developed by VB language.

The Texas Instruments MSP430F135 is a mixed signal microcontroller configurations with two built-in 16- bit timers, a fast 12-bit A/D converter, one universal serial synchronous/ asynchronous communication interface (USART), and 48 I/O pins. The architecture, combined with five low power modes is optimized to achieve extended battery life in portable measurement applications. The device features a powerful 16-bit RISC CPU, 16-bit registers, and constant generators that attribute to maximum code efficiency. The digitally controlled oscillator (DCO) allows wake-up from low-power modes to active mode in less than 6 ȝs.

In Fig.2, the input voltage of TPS70302 chip is 6V, the output of 5V, 1A and 3.3V, 2A can be regulated by adjustable resistance R1 and R4. SEQ=0, the RESET pin of TPS70302 chip can output 5V which is followed by 3.3V, so good reset sequence is supplied for MSP430.

The OPA2234 constitutes the one-order low-pass filter. OPA2234 operates from 2.7 V to 36 V supply with excellent performance [3]. Here, it is supplied with same power source with Strain Bridge and INA326. The cutoff frequency of the filter is decided by R11 and C7 shown in Fig.3. The output signal of Strain Bridge changed very slowly, 10Hz cutoff frequency is adopted and the power interference is eliminated completely. The gain of low-pass filter can be regulated by adjustable resistance R12.

The output voltage after conditioning is 0~3.3V which is matched with ADC module in MSP430F135. The MSP430 12-bit sigma-delta ADC can operate either using a built-in reference of 1.2 V, or an externally connected reference voltage. Here, an external resistor divider is used to provide the reference voltage. With the bridge sensor powered from the same voltage source, this has the advantage of implementing a Vcc- independent, ratio metric measurement principle. If the bridge sensor would be powered from Vccand using the internal voltage reference for the ADC module, the measurement results would change as Vcc changes.

The time and data information of weight come from real-time clock/calendar chip PCF8563. The PCF8563 is a CMOS real-time clock/calendar optimized for low power consumption. A programmable clock output, interrupt output and voltage-low detector are also provided. All addresses and data are transferred serially via a two-line bidirectional I2C-bus. Maximum bus speed is 400 kbit/s. The built-in word address register is incremented automatically after each written or read data byte.

All 16 registers are designed as addressable 8-bit parallel registers although not all bits are implemented. The first two registers (memory address 00h and 01h) are used as control and/or status registers. Figure 4 shows the PCF8563 application circuit. In Fig.4, Double power sources are supplied for PCF8563. One power source which operates usually is the 3.3V output of TPS70302. The other which works when the system is power off is 3V battery. Because of the 3V battery power supply the data and time information wouldn’t be lost when system is power off.

The detailed transactions information, such as date, time, types and weight of goods etc, are saved in AT45DB081 flash memory. To do this can help users to analyze the consumer habits and keep good inventory control. The AT45DB081 is a 2.7-volt only, serial interface Flash memory suitable for in-sys-tem reprogramming. Unlike conventional Flash memories that are accessed randomly with multiple address lines and a parallel interface, the Data Flash uses a serial interface to sequentially access its data. The simple serial interface facilitates hardware layout, increases system reliability, minimizes switching noise, and reduces

package size and active pin count. The device is optimized for use in many commercial and industrial applications where high density, low pin count, low voltage, and low power are essential. Typical applications for the Data Flash are digital voice storage, image storage, and data storage. The device operates at clock frequencies up to 10 MHz with a typical active read current consumption of 4 mA. AT45DB081 application circuit is showed in Figure 5.

The wireless communication module is based on PTR2000. Two PTR2000 modules are used. One is connected with MSP430F135, the other is connected with MAX232 (see Fig.6) which is level conversion chip. The optimum voltage for PTR2000 module is 2.7~5 V, here 5 V is used. The optimum data transfer rate is 9.6 kbit/s~19.2kbit/s.

After many times of actual measurement and serials of adjustment, 0~5 kg weight is converted to 0~3.3 V voltage. Then the conditioned voltage is sampled by 12-bit sigma-delta ADC module, and 0~4096 data is obtained. In order to improve the precision, the result is processed by the method of moving average filter.

The main function of host PC side software is to receive the detailed transactions information, transmit commodity information and provide user interface. The software is developed by Visual Basic language. MSComm control object is applied to read and process the serial data. PC serial port control the wireless module how to receive and transmit data by the attribute of RTSEnable which is an control object of MSComm. RTSEnable=False, the RTS pin of serial port is high, after level conversion; PTR2000 is configured in transmission state. RTSEnable=Ture, the RTS pin of serial port is low, after level conversion, PTR2000 is configured in receiving state.

The electronic scale can not only measure weight of commodity, but also upload detailed transactions information to host PC and download commodity information from PC by wireless communication and serial port. The maximum load capacity is 5 kg with a resolution of 1g. The application of INA326 and OPA2234 has successfully solved the program that how to amplify the weak signal and restrain interface. The combination of MSP430 and PTR2000 can effectively communicate with host PC. MAX232 realizes the level conversion. User interface is convenient for user to modify commodity price and analyze consumer habits. It will be better if the whole system can include multiple slave electronic scales.

