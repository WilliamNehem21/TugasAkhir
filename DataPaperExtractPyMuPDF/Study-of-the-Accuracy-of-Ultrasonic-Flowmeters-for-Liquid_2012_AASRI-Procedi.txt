 AASRI Procedia  3 ( 2012 )  14 – 20 
2212-6716 © 2012 The Authors. Published by Elsevier B.V. 
Selection and/or peer review under responsibility of American Applied Science Research Institute
doi: 10.1016/j.aasri.2012.11.004 
 
2012 AASRI Conference on Modelling, Identification and Control 
Study of the accuracy of ultrasonic flowmeters for liquid 
Liling Maa, Jia Liua, Junzheng Wanga * 
aSchool of Automation, Beijing Institute of Technology, Beijing 100081,China 
 
Abstract 
How to estimate the differential time of flight accurately is a challenging problem in the area of ultrasonic flow 
measurement. High time resolution is necessary, especially in a small inner diameter, short sound path measurement 
environment, since sound velocity in the liquid is quite fast and the order of magnitude is nanosecond. A newer method to 
obtain the differential time of flight is a Spline-Based algorithm. Although the calculation accuracy of a Spline-Based 
algorithm is higher than the common method, cross-correlation algorithm, the calculated quantity of this algorithm is huge. 
For this reason, an improved Spline-based algorithm is proposed to reduce the computational cost while keeping the 
accuracy. In addition, installation location of transducers is one of the most important factors affecting the 
measurement accuracy of ultrasonic flowmeter. This paper also analyzes the affection of the differential 
separation distance between transducers. Experiments have shown that the improved algorithm is effective and the 
separation distance affects the result seriously. 
 
© 2012 Published by Elsevier B.V. Selection and/or peer review under responsibility of American Applied 
Science Research Institute 
 
Keywords: Ultrasonic, Time of flight, Spline, Distance; 
1. Introduction 
Ultrasonic flowmeters (USFM) have been rapidly developed in recent years. Due to the non-destructive 
testing and facilitation of installation and removal, USFMs became more and more important in fluid flow 
 
*Jia Liu. Tel.: +86-13601238491; fax: +86-010-68940761-210. 
E-mail address: Bryan_lj@163.com. 
Available online at www.sciencedirect.com
© 2012 The Authors. Published by Elsevier B.V. 
Selection and/or peer review under responsibility of American Applied Science Research Institute
Open access under CC BY-NC-ND license.
Open access under CC BY-NC-ND license.
15
 Liling Ma et al. /  AASRI Procedia  3 ( 2012 )  14 – 20 
measurement [1]. These meters can be used as a spool-piece meter or as a clamp-on meter. But the transit-time 
clamp-on USFMs are not very robust. Many papers aim to improve the accuracy of the flowmeter. The fluid 
velocity distribution in the pipe can be obtained using the computational fluid dynamic (CFD) modeling 
approach [2]. The relationships between correction factor K and Reynolds number for different ultrasound 
paths can be obtained through numerical calculation [3]. The accuracy of measuring flow rates changes with 
the incidence angles [4] and upstream installations [5]. Especially, absolute propagation time (the upstream and 
downstream transit times) always contains the delays caused by emitting and receiving circuits and the transit 
time when the signal spreads in the wall and acoustic wedge. Thus this paper attempts to address this problem.   
One of the most important parameters is the differential of transit time. We can get it by several ways. The 
first one is the cross-correlation algorithm. The peak-searching algorithm identifies the peak of the discrete 
function of the cross-correlation using Cosine interpolation algorithm [6], Gaussian interpolation algorithm [7] 
or Parabolic interpolation algorithm. The second one is the sample tracking algorithm. In this algorithm, the 
time shift of each sample in a delayed echo signal is measured with respect to a continuous, interpolated 
representation of the reference echo signal [8]. The third one is Spline-Based algorithm. The algorithm uses 
cubic splines to produce a continuous time representation of a reference signal, and then computes an 
analytical matching function between this reference and a delayed signal. This method is about 500 times 
better than normalized cross-correlation and entails a substantial computational cost [9]. 
The proposed method improves the Spline-Based algorithm by combining with the cross-correlation 
algorithm. The improved algorithm reduces the computational cost without reducing the accuracy. This 
proposed method is evaluated in experiments. In addition, an important part of the installation process is the 
transducer separation distance previously described. If the signal received by a transducer when set up at the 
wrong position, the calculation result would be definitely wrong. This paper analyzes the affection of the 
differential separation distance between transducers to show the importance to determine the correct position. 
Experiments have shown that the separation distance affects the result seriously. 
2. Proposed Method 
The flow velocity is calculated by Eq.(1)   
2
sin 2
(
) (
)
up
delay
dn
delay
D
t
v
t
t
t
t
 
 
 
 
 
 
 
 
(1) 
tdn and tup in (1) represent the downstream and upstream transit times. t denotes the differential time of  
 
Fig.1.Ultrasonic transducers are mounted in accordance with V-shape. 
16  
 Liling Ma et al. /  AASRI Procedia  3 ( 2012 )  14 – 20 
flight. tdelay is the transit time that  signal takes when it is not in the liquid. D is the diameter of the steel pipes. 
 is the refraction angle when the signal passes through the steel-water interface. 
Ultrasonic transducers are mounted in accordance with the V-shape shown in Fig.1. Transducer X emits 
ultrasonic waves, and transducer Y receive them. On the contrary, Transducer Y emits ultrasonic waves, and 
transducer X receive them. 
2.1. Improved Spline-Based Algorithm 
The differential time of flight, t, is a key parameter, and its order of magnitude is nanoseconds. Since 
sound velocity in the water is quite fast, so high time resolution is necessary, especially in a small inner 
diameter, short sound path measurement environment. Typically, the cross-correlation algorithm is the most 
widely used algorithm. And this method is good at restraining white noise. But simulation results show that 
the calculation accuracy of the Spline-Based algorithm is higher than the cross-correlation algorithm.  
Assume S1 and S2 are discrete signals of reference signal and delayed signal (continuous time signal), and 
each group signal has 2048 points.  Extract the kernel signal from S1 and S2 starts from the same point. The 
kernel signal is the effective part of the ultrasonic. Assume S1 [n] and S2 [n] represent the kernel signal. The 
length of  S1 [n] is N and The length of S2 [n] is M, where M<N. As is shown in Fig.2, extracting kernel signal 
is depending on experience. If M and N are too big, the kernel signal will include useless points. In contrast, if 
M and N are too small, the useful points will be missed. 
 
Fig.2. Kernel signal extraction 
17
 Liling Ma et al. /  AASRI Procedia  3 ( 2012 )  14 – 20 
Signal  S1 [n] is processed by cubic splines. The spline interpolant is piecewise continuous over an interval 
[0 1]
,  is sampling period, as Eq.(2). Signal S2 [n] is still discrete signal.  
3
2
1
1
1
1
1
1
1
1
3
2
1
1
( )
( /
)
( /
)
( /
)
.......................................................0
1
......
( )
( )
( /
)
( /
)
( /
)
..................................
i
i
i
i
i
i
i
f t
a
t
T
b
t
T
c
t
T
d
t
S t
f t
a
t
T
b
t
T
c
t
T
d
3
2
1
1
1
1
1
1
1
1
.............(
1)
......
( )
( /
)
( /
)
( /
)
.....(
2)
(
1)
N
N
N
N
N
N
N
N
i
t
i
f
t
a
t
T
b
t
T
c
t
T
d
N
t
N
 (2) 
fi(t) is the i-th piecewise function. There are N-1 segments in total.. If Ti=i-1 and t =t/ -Ti, the Eq.(2) 
simplifies to Eq.(3) 
'
' 3
' 2
'
'
1
1
1
1
1
'
' 3
' 2
'
'
'
' 3
' 2
'
'
1
1
1
1
1
( )
( )
( )
( )
........................0
1
......
( )
( )
( )
( )
.........................0
1
......
( )
( )
( )
( )
......0
1
i
i
i
i
i
N
N
N
N
N
f t
a
t
b
t
c
t
d
t
f t
a
t
b
t
c
t
d
t
f
t
a
t
b
t
c
t
d
t
       
 
 
 
 
(3) 
Eq.(3) shows abscissa of each segment starts from 0. The value of t obtained by Eq.(4) that minimizes the 
(t ) is called local delay estimate here.  
'
'
2
2
1
( )
(
( )
[ ])
M
i
i
t
f t
S i
          
 
 
 
 
 
 
 
(4) 
The subscript of fi(t ) is different from Eq.(3). Signal S2 [n] has only M points, so fi(t ) is the i th segment of 
M segments which involved in computation. First time, k=0, points of signal S2 [n] compute with the first to 
the M th segment of S1 [t]. Second time, k=1, points of signal S2 [n] compute with the second to the M+1 th 
segment of S1 [t], and so on. Finally, there are (N-M) t-values. And there must be a t lying between 0 and 1, 
which called global delay estimate. Differential time of flight t is calculated by Eq.(5). 
( '
)
t
t
k
 
 
 
 
 
 
 
 
 
 
(5) 
The calculated quantity of the Spline-Based algorithm is huge. The proposed method can reduce the 
running time of Spline-Based algorithm while keeping the accuracy.  
Before calculating Eq.(4), we can find the maximum point ,mi, of the cross-correlation function of discrete 
signals S1 and S2 by Fast Fourier Transform.  If mi-1<mi+1, then k=i; Else if mi-1>mi+1, k=i-1. k is the 
parameter we need in Eq.(5). Since k is a known parameter, we can get t by computing only once. Points of 
signal S2 [n] compute with the k+1 to the k+M th segment of S1 [t] by Eq.(4). It is clear that N-M-1 times 
calculate quantities are removed. And the speed of algorithm will be increased. 
2.2.  Initial position of transducers 
Installation location of transducers is one of the most important factors affecting the measurement accuracy 
18  
 Liling Ma et al. /  AASRI Procedia  3 ( 2012 )  14 – 20 
of ultrasonic flowmeter. When the wall thickness, the wall material, and the fluid medium are all known 
quantities and the acoustic path is determined in accordance with the V-shape, the separate distance between 
each transducer should be definite. Assume transducer acoustic wedge is organic glass, and the material of the 
wall is steel. The fluid medium is water and incidence angle of ultrasonic wave is 37 degree.  
The Snell law is given in Eq.(6) and is used to calculate the refraction angle in different medium. 
1
2
3
sin
/
sin
/
sin
/
C
C
C   
 
 
 
 
 
 
 
(6) 
 is the incident angle when signal passes through the organic glass-steel interface.  is the refraction angle 
when signal passes through the organic glass-steel interface or the incident angle when signal passes through 
the steel-water interface.  is the refraction angle when signal passes through the steel-water interface. C1
C2 and C3 are sound velocities in organic glass, steel wall and water respectively. 
=37o, and longitudinal wave velocity in organic glass is 2730m/s. If shear wave velocity in steel wall is 
3230m/s, we can get =45o. Longitudinal wave velocity in water is 1480m/s at 20oC, then =19o.The 
differential distance between transduser X and transducer Y is calculated based these angles. 
2
tan
2
tan
AB
t
L
d
d
  
 
 
 
 
 
 
 
(7) 
In Eq.(7), dt is wall thickness, d is inner diameter. At the same time, the value of LAB in turn affect the 
value of  in Eq(1). Assume the position of transducer Y shifts to the right axially 2mm from the correct 
position. This will cause to refraction angle, , 3 degrees bigger than the true value. As a result, the calculation 
error of water velocity will be up to 11% based on Eq.(1). Moreover, this impact is more pronounced to small 
diameter measurement environment. So it is necessary to fine tune the transducer location. 
3. Experiment results 
The experiments are carried out using the clamp-on meter mounted on a stainless-steel pipe which outer 
diameter is 23 mm and wall thickness is 3 mm. The fluid medium is water. Control chip is FPGA of 
EP2C8Q208. 
3.1. Calculating the differential time of flight by proposed method. 
Assume each group signal has 2048 points. The kernel signal, S1 [n], is the 1000 th to the 1800 th points of 
reference signal, N=801; The kernel signal, S2 [n], is the 1200 th to the 1700 th points of reference signal, 
M=501. Compared with improved algorithm, the Spline-Based algorithm will compute M-N=300 times more. 
19
 Liling Ma et al. /  AASRI Procedia  3 ( 2012 )  14 – 20 
 
Fig.3. Time consuming of Spline-Based algorithm and improved algorithm. 
In Fig.3, SSE represents the Spline-Based algorithm. Time consuming of Spline-Based algorithm is about 
130ms. Time consuming of improved algorithm is approximately 8ms. Obviously, the improved method can 
reduce the running time while keeping the accuracy. 
3.2. Effect of axial movement of transducers  
Experiment results are shown in Fig.4. The water velocity is calculated by Eq.(1). Moving the transducer B 
axially to the right from the correct position will lead to increasing of , then water velocity will decrease. The 
velocity is in an inverse ratio of . Despite other unknown factors, we only consider the error of separate 
distance axially. Assume zero point is the correct position. 
 
Fig.4. The relationship between water velocity and refraction angle when the transducer position is changed.  
20  
 Liling Ma et al. /  AASRI Procedia  3 ( 2012 )  14 – 20 
4. Conclusion 
The improved Spline-Based method can reduce the running time effectually, and its stability is slightly 
better than the cross-correlation algorithm as is shown in the environment results. Furthermore, mounting 
position of transducers should be paid more attention since it could affect the accuracy of result seriously.   
Acknowledgement 
The authors wish to acknowledge the support of members of the faculty in our laboratory, the Beijing 
University of Technology for financial support, and would also like to thank the anonymous reviewers. 
Reference 
[1] L. C. Lynnworth, Y. Liu, Ultrasonic flowmeters: Half-century progress report, 1955 2005, Ultrasonics, 
vol. 44, pp.1371 1378, 2006. 
[2]DandanZheng, PengyongZhang, TianshiXu, Study of acoustic transducer protrusion and recess effects on 
ultrasonic flow meter measurement by numerical simulation, Flow Measurement and Instrumentation, vol.22, 
pp.488-493, 2011. 
[3]H. J. Dane, Ultrasonic measurement of unsteady gas flow, Flow Measurement and Instrumentation, vol. 8, 
pp. 183-190, 1997. 
[4]Yuto Inoue, Hiroshige Kikura, Hideki Murakawa, et al, A study of ultrasonic propagation for ultrasonic 
flow rate measurement, Flow Measurement and Instrumentation, vol.19, pp 223-232,2008. 
[5]C. Ruppel, F. Peters, Effects of upstream installations on the reading of an ultrasonic flowmeter, Flow 
Measurement and Instrumentation, vol.15, pp.167-177, 2004. 
[6] S. Foster, P. Embree, W. O Brien, Flow velocity profile via time-domain correlation: Error analysis and 
computer simulation, IEEE Transactions On Ultrasonics, Ferroelectrics, And Frequency Control, vol. 37, 
pp.164-175, 1990. 
[7] P. G. de Jong, T. Arts, A. P. Hoks, R. S. Reneman, Determina-tion of tissue motion velocity by correlation 
interpolation of pulsed ultrasonic echo signals, Ultrasonic. Imaging, vol. 12, pp. 84-98, 1990. 
[8] Reza Zahiri-Azar, Septimiu E. Salcudean, Time-Delay Estimation in Ultrasound Echo Signals Using 
Individual Sample Tracking. IEEE Transactions On Ultrasonics, Ferroelectrics, And Frequency Control, vol. 
55, pp.2640-2650, 2008. 
[9] Francesco Viola, William F. Walker, Computationally Efficient Spline-Based Time Delay Estimation. 
IEEE Transactions On Ultrasonics, Ferroelectrics, And Frequency Control, vol. 55, pp.2084-2091, 2008. 
