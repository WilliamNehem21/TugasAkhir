Estimation of morphological traits of foliage and effective plant spacing inNFT-based aquaponics system
R. Abbasia, P. Martinezb,R .A h m a da,⁎
aAquaponics 4.0 Learning Factory (AllFactory), Department of Mechanical Engineering, University of Alberta, 9211 116 St., Edmonton, AB T6G 2G8, Can ada
bMechanical and Construction Engineering Department, Northumbria University, Newcastle upon Tyne NE7 7YT, UK
abstract article info
Article history:Received 18 October 2022Received in revised form 8 August 2023Accepted 20 August 2023Available online 23 August 2023Deep learning and computer vision techniques have gained signi ﬁcant attention in the agriculture sector due to their non-destructive and contactless features. These techniques are also being integrated into modern farmingsystems, such as aquaponics, to address the challenges hindering its commercialization and large-scale imple-mentation. Aquaponics is a farming technology that combines a recirculating aquaculture system and soilless hy-droponics agriculture, that promises to address food security issues. To complement the current research efforts,a methodology is proposed to automatically measure the morphological traits of crops such as width, length andarea and estimate the effective plant spacing between grow channels. Plant spacing is one of the key design pa-rameters that are dependent on crop type and its morphological traits and hence needs to be monitored to ensurehigh crop yield and quality which can be impacted due to foliage occlusion or overlapping as the crop grows. Theproposed approach uses Mask-RCNN to estimate the size of the crops and a mathematical model to determineplant spacing for a self-adaptive aquaponics farm. For common little gemromaine lettuce, the growth is esti- mated within 2 cm of error for both length and width. The ﬁnal model is deployed on a cloud-based application and integrated with an ontology model containing domain knowledge of the aquaponics system. The relevantknowledge about crop characteristics and optimal plant spacing is extracted from ontology and comparedwith results obtained from theﬁnal model to suggest further actions. The proposed application ﬁnds its signiﬁ- cance as a decision support system that can pave the way for intelligent system monitoring and control.© 2023 The Authors. Publishing servic es by Elsevier B.V. on behalf of KeAi Communications Co., Ltd. This is an openaccess article under the CC BY-NC-ND license ( http://creativecommons.org/licenses/by-nc-nd/4.0/ ).
Keywords:Deep learningOntology modelingCrop phenotypingLeafy cropsAquaponicsDigital farmingPlant spacing
1. IntroductionAquaponics is a symbiotic integration of two technologies:i) aquaculture (ﬁsh farming) and ii) hydroponics (the cultivation ofplants in water without soil), which are combined within a closedrecirculating system. There is a growing interest in this controlled envi-ronment farming method around the globe as it offers an environmen-tally friendly and sustainable way of agri-food production ( Abbasi et al., 2021a). The correct design and management of the aquaponics systemare of utmost importance to witness enhanced crop quality and farmproductivity. Crop quality is evaluated by many indicators, one ofwhich is crop morphological traits such as length, width, area, and pe-rimeter which are used to assess the health status as well as the marketvalue of the crops (“Crop Quality - An Overview|ScienceDirect Topics, ”, 2021). Hence, it is vital to monitor these parameters throughout theplantation cycle. Moreover, crop quality is directly impacted by plantspacing which is deﬁned as the distance between growing sites of twoconsecutive plants (Abbasi et al., 2021b). In traditional agriculture, crops compete with each other for resources, such as solar radiation, nu-trients, and moisture uptake to gain energy for their growth, for whichthey require reasonable root space and vegetative space ( Zaman et al., 2021). The inadequate plant spacing may lead to several problems.For instance, the plants sited closely produce fewer leaves, ﬂowers, and seeds, which causes reductions in ﬁnal crop yields. Moreover, overcrowded plants are also susceptible to potential diseases, foliagedamage as crops mature, and invasion by unwanted pathogens(Zaman et al., 2021). Many disease agents require a humid environmentto develop and in crowded plantations, reduced air ﬂow prevents mois- ture from evaporating from leaf surfaces, increasing the likelihood ofdiseases. Similarly, excessive plant spacing can also be a problem, as ithinders the pollination process. Unlike traditional agriculture, the as-pect of plant spacing is different in the NFT-based aquaponics system.The crop growing area (hydroponics) in the NFT system is a combina-tion of enclosed channels consisting of circular or squared-shapedpockets known as plant sites where plants reside in small plastic cupsallowing their roots to access water and absorb nutrient-enrichedefﬂuent from aquaculture (Abbasi et al., 2021b). Plant spacing in NFTArtiﬁcial Intelligence in Agriculture 9 (2023) 76 –88
⁎Corresponding author.E-mail address:raﬁq.ahmad@ualberta.ca(R. Ahmad).
https://doi.org/10.1016/j.aiia.2023.08.0042589-7217/© 2023 The Authors. Publishing services by Elsevier B.V. on behalf of KeAi Communications Co., Ltd. This is an open access article under the CC BY-NC-ND license (http:// creativecommons.org/licenses/by-nc-nd/4.0/ ).
Contents lists available atScienceDirect
Artiﬁcial Intelligence in Agriculture
journal homepage:http://www.keaipublishing.com/en/journals/artificial-intelligence-in-agriculture/systems refers to either distance between two plants on the same chan-nel or the distance between plants on adjacent channels. The plant spac-ing attribute on the same channel is normally ﬁxed and is designed considering the full-grown size of the plant before the actual plantation.The plant spacing attribute between channels is also kept ﬁxed in open- air farms but in indoor NFT-based systems, it can be varied dependingon the crop type to efﬁciently utilize the limited space. In NFT systems,all the nutrients are directly delivered to the crops' root system andtherefore, there is no competition for resources for the root system(Syed AbreezGillani et al., 2022a). However, vegetative space still re-quires special attention as crops spend the most energy on vegetationto absorb more light (Maboko and Du Plooy, 2009). Plant spacing varies as a function of crop species and their morphological traits such aslength, width, area, and perimeter (Singh et al., 2022). Therefore, to achieve maximum yields, the optimum plant spacing must be main-tained according to crop type and its morphological characteristics. Ad-ditionally, the crop growth cycle consists of various phases fromseedling to vegetative and in each phase the area of crop foliage changesas it grows over time—requiring different plant spacing and illumina-tion conditions (Nakarmi and Tang, 2012). The aforementioned challenges pose a need for a self-adaptiveaquaponics system that determines the crop morphological traits,determines the distance between two plants and adjusts the spacingbetween channels. Traditionally, manual methods that require a highlevel of expertise and advanced equipment were used to determinemorphological traits. These methods produce accurate results, butthey are costly, labour-intensive, and time-consuming ( Triki et al., 2021). To accelerate plant phenotyping, numerous semi-automatictools are developed such as LeafJ, Easy Leaf Area, and TraitEx ( Easlon and Bloom, 2014;Gaikwad et al., 2019;Maloof and Nozue, 2013). But these tools require pre-processing of the input images for utilizing mul-tiple automation degrees (Triki et al., 2021). To overcome the stated bottleneck, this study aims to propose an approach to automaticallyestimate morphological traits (foliage area, length, and width), thedistance between plants and effective plant spacing between adjacentchannels. Based on this information, the aquaponics system can adaptitself by adjusting the position of grow channels. The proposed ap-proach is deployed on a cloud-based application and integrated withthe ontology model proposed by authors in previous work ( Abbasi et al., 2021a).2. Related workWith developments in deep learning and computer vision tech-niques, several methods have been developed and instantly grown indifferent visual recognition tasks such as the estimation of morphologi-cal traits of crops (Abbasi et al., 2022). A review of some of the latest andmore relevant methods is presented here. Weaver et al. have proposed atool‘LeafMachine’based on CNN (convolutional neural network) andSVM (support vector machine) to measure the leaf morphological traitsfrom digitized herbarium specimen images autonomously ( Weaver et al., 2020). Triki et al. used the same dataset and proposed a newand enhanced approach‘Deep Leaf’based on Mask-RCNN (region- based convolutional neural network), to determine the length, width,area, and perimeter of leaves (Triki et al., 2021). Hirigoyen et al. devel- oped a machine-learning model using SVM and RF (random forest)techniques to determine the leaf area index in Eucalyptus plantations(Hirigoyen et al., 2021). Lu et al. proposed a Mask R-CNN-based modelto determine the growth rate of lettuce crops as a function of leaf area
and time in a hydroponics system (Lu et al., 2019). Juyal (Gillani et al., 2022a) et al. proposed a method to estimate the length and width oftrees for calculating the overall volume using Mask-RCNN ( Juyal and Sharma, 2020). Reyes et al. proposed a methodology to determine thesize of crops (height, width, depth, side view area, top view area) forassessing the growth rate and fresh weight of crops using Mask-RCNN(Reyes-Yanes et al., 2020). Even though the aforementioned methodshave made a great contribution to the research community, the analysisshows that none of the studies has focused on using these traits as a keyfeature to assess plant spacing. Hence, to complement the existing ef-forts, this study proposed a new methodology to determine morpholog-ical traits of lettuce crops grown in aquaponics facility and assess theplant spacing between grow channels. Additionally, based on the capa-bility of instance segmentation, Mask-RCNN is used to estimate themorphological attributes in this study ( Kang et al., 2020;Lu et al., 2019).3. Research methodologyAn automated system is developed to monitor the morphologicaltraits of the lettuce crop and estimate the plant spacing in theaquaponics facility using deep learning techniques. The overall method-ology is divided intoﬁve sequential modules: i) dataset preparation andpre-processing; ii) model development and parameter estimation; iii)model training and loss function calculation, iv) ontology modeling,and v) cloud-based application development. Fig. 1shows the complete pipeline of this approach and details of all stages are explained in thefollowing subsections.3.1. Dataset preparation and preprocessing3.1.1. Data acquisitionFor this study, a 12MP camera is used to capture images of thirtylettuce plants grown in NFT based aquaponics facility situated at theUniversity of Alberta, Canada. Fifty images of 4032 × 3024 pixels arecaptured every day, half (25 images) at 9:00 am and a half at 6:00 pmfrom the top while keeping the distance between camera and channelat a constant value of 40 cm throughout the plantation cycle, i.e., ﬁve weeks. Each image contains two plants planted in adjacent channels.There are six grow channels, each having ﬁve plant sites. The channels are horizontally stacked, so the total number of plants in one of therows of adjacent channels is six. In total, 1750 images are collectedover 5 weeks and are saved in JPG format. Fig. 2shows an example of some of the images of lettuce from different growth stages.The manual measurements of morphological traits such as length,width, and height of 30 plants are also recorded twice a day at 9:00 amand 6:00 pm forﬁve weeks using a calliper. For the ground truth valueof foliage area, the number of pixels is counted manually by selectingthe area of interest in Adobe Photoshop which is then converted tocm2. The area is also recorded twice a day at the given timings for ﬁve weeks. As the plants grow, their area, length and width also increase,consequently reducing the distance between two plants. This distanceneeds to be measured throughout the plantation cycle to determinethe effective plant spacing and adjust the spacing between plants byadjusting the distance between channels. The distance between chan-nels is also used to determine the plant population and crop ﬁeld in an NFT-based aquaponics system. The actual distance between plants is re-corded for all the plants by taking manual measurements twice a day at9:00 am and 6:00 pm forﬁve weeks using a scale. In total, 50 distancevalues are calculated every day for 30 plants growing on adjacent chan-nels. All the manual measurements are saved in a common excel ﬁle.3.1.2. Data augmentationNext, an image augmentation process is performed to increasethe dataset size, avoid overﬁtting, and enhance the reliability of thesegmentation process despite the location and orientation of objectsin the image by generating new images from existing images. In thisstudy, Albumentations, a Python library is used for fast and ﬂexible image augmentation (Buslaev et al., 2020). The different augmenta- tion techniques applied are horizontalﬂip, verticalﬂip, 90° rotation, and glass noise. In total, 250 images are selected randomly for theaugmentation, which created 250 new images —increasing the size of the dataset to 2000 images.Fig. 3shows an example of image augmentation.R. Abbasi, P. Martinez and R. Ahmad Artiﬁcial Intelligence in Agriculture 9 (2023) 76 –88
77Fig. 1.Research methodology for estimating the morphological traits and effective plant spacing.
Fig. 2.Samples images from the aquaponics facility.
Fig. 3.Example of an augmented image.R. Abbasi, P. Martinez and R. Ahmad Artiﬁcial Intelligence in Agriculture 9 (2023) 76 –88To reduce the computation and running time of the training andtesting of the model, the sizes of all the images were scaled to640 × 480. A total of 2000 images are used for the model training andparameter optimization of Mask R-CNN, with 80% as the training setand 20% at the validation set. For test data, a new batch of plants isgrown. After the training, the performance of the trained model is eval-uated with a new set of images captured for the test dataset.3.1.3. Data annotationData annotation is one of the vital steps for the successful develop-ment of object detection models. The process is manual and involves la-belling the desired objects in an image with a label or tag that refers to aparticular class. The labelled data is used during the training of themodel. There are many open-source annotation tools, but in thisstudy, VGG Image Annotator (VIA) is used ( Dutta et al., 2019). In this study, Mask-RCNN is used. The relevant regions of the image arelabelled, and the remaining region defaults to the background. Fig. 4 shows an example of ground truth bounding boxes and masks obtainedafter data annotation.3.2. Object detection and instance segmentationAfter data collection, object detection and instance segmentation areperformed on crop images to achieve class, mask, and bounding boxvalues for lettuce foliage. In this study, Mask R-CNN is used which is astate-of-the-art method in theﬁeld of object segmentation. Instancesegmentation is a computer vision task for detecting and localizing anobject in an image through the identiﬁcation of boundaries at a detailed pixel level (Yu et al., 2019).3.2.1. Mask-RCNN trainingNVIDIA GeForce RTX 3090 is used for training the Mask-RCNN. Atotal of 2000 images are split into 80% for the training set and 20% forthe validation set. The Mask-RCNN is implemented in Detectron2 — Facebook AI Research's next-generation library written in PyTorchthat provides state-of-the-art detection and segmentation algorithms.Since the dataset is small, the pre-trained version of Mask-CNN (trainedon the COCO dataset) from the model zoo of the Detectron21‘Mask- RCNN with ResNet-101 + FPN’is applied using the transfer learning ap-proach (Yu et al., 2019). The model is trained for 600 iterations with theimage input batch size given as 32. The initial learning rate is kept at0.001 for theﬁrst 100 iterations and is then adjusted per 100 iterationswith an adjustment factor of 0.95. The category scores, bounding boxes,and masks of lettuce foliage for each input image are then obtained asthe outputs of the model. The training process is completed in around1 h for 600 iterations and the model loss function achieved a conver-gence state. The total loss of the proposed approach consists of twoparts: the loss of classiﬁcation and regression operations by RPN, andthe training loss in the multi-branch predictive network, and can be cal-culated by using the formula L
ﬁnal=L RPN+L mmulti_branch) (He et al., 2017). Where (L
ﬁnal) represents the total loss, (L RPN) represents the training loss of the RPN (anchors classiﬁcation loss (SoftMax Loss) and bounding box regression loss (SmoothL1 Loss)), and ( L
multi_branch ) represents the training loss due to the three-branch structure (SoftMaxLoss, SmoothL1 Loss, and Mask Loss). ( L
RPN)a n d(L multi_branch ). The loss function value and accuracy per iteration of the model for 600iterations are shown inFig. 5. The loss function is showing adownward trend during the training process as can be seen in Fig. 5, which means that the prediction loss deviation is gradually decreasingby updating the loss function of the small sample batches during theoptimization process. The loss function values for both the training setand validation set are reduced to less than 0.2 and tend to be stablewhen the number of iterations is more than 550. This indicates thatthe training of the model runs well, with a detection accuracy oflettuce foliage of more than 0.98.3.3. Crop morphological traits estimation modelFrom the instance segmentation process, the predicted mask andbounding box of each instance are retrieved to determine lettuce mor-phological traits such as foliage area, length, and width. In this case,
Fig. 4.Bounding boxes and masks after data annotation.
1https://ai.facebook.com/tools/detectron2/ .R. Abbasi, P. Martinez and R. Ahmad Artiﬁcial Intelligence in Agriculture 9 (2023) 76 –88
79there are two masks and two bounding boxes as each image consists oftwo lettuce foliage. The foliage area of two lettuce plants is calculated byextracting features from their respective predicted masks. The masksare a set of matrices that contain pixels belonging to the area of a seg-mented object (area of interest) which in this case are two lettuce fo-liage. These pixels are retrieved from the prediction and furtherprocessing is done to give this data useful meaning.The distance between the camera and the object affects the pixelcount of the image. The closer the camera, the greater the number ofpixels of an object in an image and vice versa. Hence, in this study, thedistance between the camera and channel is kept ﬁxed at a value of 40 cm while taking the images and is denoted by ( D). As we know, the height of the lettuce increases throughout the plantation cycle andaffects the pixel count. To calculate the foliage area ( A
f), the height (h) of the crop is also taken into account. At the end of the plantationcycle, a boxplot is created shown in Fig. A1 of appendix A for the heightsof 30 lettuce plants recorded manually and a scatter plot is createdshown in Fig. A2 of appendix A using median values of plants' heightsto derive a linear regression relationship between height ( h) and the number of days (x), which is represented in Eq.1. h¼0:2521xþ2:9641 ð1ÞTo adequately measure the morphological traits, the relationship be-tween real-world metrics, such as cm (centimeter) and actual pixelcount (p
c) on the image should be identiﬁed. Triki et al. used a scale bar object to determine this relationship ( Triki et al., 2021). In this study, the width of the channel (w
c) which is known to be 10 cm isused for this purpose. Eq.2shows the relationship between (w
c) and (p
c).At a constant distance of (D) the relationships (k)a n d(k′) between pixel count (p
c) and channel width (w c) are given in Eqs.3 and 4.w
ccmðÞ≡pcpixelsðÞ ð 2Þk¼
pc
wcpixelscm/C18/C19 ð3Þk′¼pc2
wc2pixelscm
2/C18/C19 ð4ÞLet (p
m) is the pixel count of the predicted mask, which isdependent on the height (h) of the plant. The height of the plantchanges throughout the plantation cycle and hence affects the pixelcount of the predicted mask. To compute foliage area ( A
f), Eq.5is developed.A
f¼pm/C2hk′/C2D ð5ÞNext, bounding boxes are retrieved from the model in the form ofcoordinates of opposite rectangle corners (top left ( x
1,y1) and bottom right (x
2,y2). These coordinates are used to calculate the approximatewidth (W
f) and length (L f) of foliage as shown inFig. 6using Eqs.6 and 7respectively.W
f¼x2/C0x1pixelsðÞ ð 6ÞL
f¼y1/C0y2pixelsðÞ ð 7ÞThe Eqs.8a n d9are developed for measuring the width and lengthof foliage in real-world metric units (centimeter).W
r¼Wf/C2hk/C2DcmðÞ ð 8ÞL
r¼Lf/C2hk/C2DcmðÞ ð 9ÞThe above process is performed for two lettuce foliage in asegmented image.3.4. Mathematical model for plant spacing calculationThe most common conﬁgurations of plant spacing used for NFTchannels along with several dimensional characteristics are shown in
Fig. 5.Training losses, validation losses and accuracy per iteration.R. Abbasi, P. Martinez and R. Ahmad Artiﬁcial Intelligence in Agriculture 9 (2023) 76 –88
80Fig. 7.I nc o nﬁguration 1, the plant sites on two adjacent channels arein-line with each other and in conﬁguration 2, the plant sites are atan angle. In this study, conﬁguration 1 is considered for a case studybut the proposed model can also be applicable to con ﬁguration 2. The plant spacing (S) is to be maintained on individual grow channelsas well as between the channels ( S′) to avoid foliage occlusions andoverlapping which limit crop growth and affect crop quality. Generally,while designing the aquaponics system, the plant spacing on thechannel, (S) and between channels (S′) is kept constant. The latter pa- rameter can be controlled to make a self-adaptive aquaponics. In Fig. 7, (S′) is the distance from the center of the plant site of one channel tothe center of the plant site of the adjacent channel and is given inEq.10.S′¼wc1
2þwc2
2þs ð10ÞWhere (w
c1=w c2), (w c1) is the width of channel 1, (w c2)i st h e width of channel 2 and (s) is the distance between two adjacentchannels. The width of channels is constant whereas ( s) is a dynamic parameter. By changing (s), the horizontal channel spacing i-e., the dis-tance between channels can be changed.To compute the distance between plants automatically, the initialand new values of (S′)a n d(s) are computed. Let (S
n−1′)a n d(s n−1) refers to initial or previous values for ( S′)a n d(s), respectively, and (S
n′)a n d(s n) refers to new values for (S′)a n d(s), respectively. Eqs.11 and 12represent the initial and new values of ( S′).S
0n−1¼wc1
2þwc2
2þsn−1 ð11ÞS
0n¼wc1
2þwc2
2þsn ð12ÞTo compute (s
n), an incremental parameter (s i)i sd eﬁned, which determines the variation in plant spacing due to changes in foliagemorphological traits. The incremental parameter ( s
i) is calculated using the Euclidean distance (d) between two bounding boxes achievedthrough the prediction process shown in Fig. 8and (S
n−1′). The parameter (s
i) will only increment if (d)w i l lb el e s st h a n(S n−1′) i-e.,if d<S
n−1′. The value of (d), on the other hand, is dependent on thefoliage area and length, which decreases as the area ( A
f) and length (L
f) of foliage increases. Eqs.13, 14 and 15provide the relationship for (d), (s
n), and (s i).d¼ﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃx
1/C0x2 ðÞ2þy1/C0y2 ðÞ2q ð13Þs
n¼sn/C01þsi ð14Þs
i¼S′n/C01/C0d ð15ÞThe new values for (S′) are then obtained by incrementing thevalues of (s) using the above process for all plants' pairs in images andconverted to metric units (cm) using Eq. 2The updated values of (s) can be used to estimate plant population (PD) using the Eq. 16proposed by authors in previous work (Abbasi et al., 2021b).P
D¼NPSC/C2N C
L/C2N C/C2WðÞ þN C/C01ðÞ /C2H CS ðÞð ð16ÞWhere (N
PSC) is the number of plant sites (circular or squared-shaped pockets) per channel, (N
C) is the total number of channels,Lis the length of each channel and is equivalent to ( l
c)s h o w ni nFig. 7, (W) is the width of each channel and is equivalent to ( w
cj) shown in Fig. 7(j = 1,2,3…..n), and (H
CS) is horizontal channel spacing andequivalent to (s).3.5. Ontology modelThe complete development and details of all the concepts andinstances of the ontology model ‘AquaONT’developed by authors in previous work are available (Abbasi et al., 2021a). AquaONT is au n iﬁed ontology model that represents and stores the essentialknowledge of an aquaponics 4.0 system. It consists of sixconcepts: Consumer_Product, Ambient_Environment, Contextual_Data,Production_System, Product_Quality, and Production_Facility. In this
Fig. 6.Dimensional characteristics of foliage.
Fig. 7.Dimensional characteristics of grow channels with respect to two con ﬁgurations.R. Abbasi, P. Martinez and R. Ahmad Artiﬁcial Intelligence in Agriculture 9 (2023) 76 –88
81study, two classes,‘Consumer Product’and‘Production_System’are used for knowledge extraction. The ‘Consumer Product’class provides an abstract view of the type, growth status, and growth parameters ofready-to-harvest crops in an aquaponics system. Whereas the‘Production_System’class provides knowledge on design parametersof the grow channels such as width, length and depth of channel andsize of the plant site on the channel ( Abbasi et al., 2021b). Fig. A3 in appendix A shows the hierarchical architecture of the ‘Consumer Product’and‘Product Quality’classes with their instances for the ‘Basil’crop in Protégé
2(an open-source ontology editor and frameworkdeveloped at Stanford University) environment. The length and widthof the channels can be extracted from ontology to be used to determinethe plant spacing as well as the production capacity of the aquaponicsfacility using Eq.16.3.6. Cloud-based applicationA cloud-based application is developed using Streamlit, wheretheﬁnal versions of both models developed in sections 3.3 and 3.4 are deployed. The layout of the application is shown in Fig. A4 of ap-pendix A. It consists of three tabs: i) Select model, ii) Upload image,and iii) Determine morphological traits and plant spacing. The ﬁrst and second tabs are user inputs where the model is selected, andthe image is uploaded respectively. The third tab activates the cropmorphological model and plant spacing model respectively. The on-tology model is also deployed on a cloud-based application throughthe Owlready2 library. Once, the morphological traits are estimatedand effective plant spacing is determined, the length of the channelis extracted from the ontology model to determine plant populationand overall yield. Moreover, crop quality can also be assessed bycomparing the predicted morphological traits of lettuce and standardvalues stored in the ontology model. This type of application is usefulas it provides access to remotely monitor and control the productionfacility.4. Results andﬁndingsTo validate the research methodology, a new batch of plants isgrown. The experimental setup used to capture the new dataset andvalidation results andﬁndings is presented in the following subsections.4.1. Experimental setupThe experimental setup is built in Allfactory 4.0, an NFT-basedaquaponics facility situated at the University of Alberta, Canada, whichfocuses on smart indoor farming (Martinez and Ahmad, 2018). The aquaponics system is divided intoﬁve crop growth phases which repre-sent the complete growth cycle of the crop. For this study, only phase 1is considered, which consists of six horizontally stacked grow channelsand each channel hasﬁve plant sites. The length and width of eachchannel are 125 cm and 10 cm respectively. The distance between thecenter of plant sites (circular pockets) of two consecutive channels is12 cm. A fresh batch of lettuce crop is grown for which ﬁfty seeds of Lit- tlegemlettuce (Lactuca sativaL.) are placed in growth chambers with anambient temperature of 18 °C, relative humidity of 70%, and illumina-tion of a 12-h (12 h light / 12 h dark) photoperiod (S.A. Gillani et al., 2022b). Twenty-one days after sowing, 30 healthy lettuce seedlingsare transplanted in Rockwool cubes and placed in the six NFT channelsin phase 1. The seedings are placed in NFT-based hydroponicsystems for a period ofﬁve weeks (plantation cycle), after which eachlettuce is harvested. A wireless sensing module (WSM) consistingofﬁve sensors (pH, temperature, humidity, water temperature,electroconductivity and light) is installed on system to monitor thesystem and gather the sensor data. The complete developmentand working of WSM is detailed in a previous work by the authors
Fig. 8.Calculation of distance between plants using bounding boxes.
2https://protege.stanford.edu/products.php#desktop-protege .R. Abbasi, P. Martinez and R. Ahmad Artiﬁcial Intelligence in Agriculture 9 (2023) 76 –88
82(Reyes-Yanes et al., 2021). Moreover, the images are captured in a sim-ilar fashion as discussed insection 3.1.1. But this time camera module consisting of four ELP 1080P webcams (2.8 –12 mm HD Varifocal Lens) is used. All the webcams are attached at a distance of 40 cm and arescheduled to take one picture per day for ﬁve weeks. In total, 8 plant samples are chosen for images and each image contains two plants.These plants are grown on adjacent channels and each day four picturesare taken automatically. At the end of plantation cycle, there are 140 im-ages which are then used for testing and evaluation of the proposedmodels. The actual measurements for morphological traits and distancebetween plants are recorded in similar manner as discussed in section 3.1.1. The actual values of plant spacing (S′) are also computed manually using the actual distance between plants and formulas mentioned insection 3.4.4.2. Evaluation of trained mask-RCNN modelTo evaluate the detection accuracy of the trained Mask-RCNN model,the intersection over union (IoU) metric is used, which compares thepredicted detection with ground truth. IoUis the ratio of the area ofoverlap between ground truth and predicted bounding boxes ormasks divided by the area encompassed by both the predictedbounding box and the ground-truth bounding box ( Yu et al., 2019). For this purpose, the test dataset consisting of 140 images is used. The(IoU) is calculated as follows:IoU¼
AT∩AD
AT∪ADð17ÞWhere (A
T) and (A D) represent the target bounding box of theground truth and the detected bounding box from the model,respectively. All 140 test images have shown ( IoU)c o e fﬁcient of 0.9 or above, indicating that there is a signiﬁcant overlap between the two bounding boxes.Fig. 9shows an example of an image showingdetection with (IoU) of above 0.9. The green bounding box is theground truth whereas the red bounding box is predicted by themodel. All the targets in the lettuce image are aimed to be detectedand marked with target category scores, bounding boxes, and instancesegmentation masks. The detection performance of the Mask-RCNN isshown inFig. 10.T h eﬁnal model is then used for modeling foliage mor-phological traits and plant spacing.
Fig. 9.Object detection by Mask-RCNN with the resulting IoU metric.R. Abbasi, P. Martinez and R. Ahmad Artiﬁcial Intelligence in Agriculture 9 (2023) 76 –88
834.3. Evaluation of crop morphological modelTo evaluate the crop morphological model, the length, width, andarea of lettuce foliage are computed from masks predicted by thetrained model for the test dataset. The actual and the measured valuesfor each morphological trait are compared. The increasing trend in themorphological traits is observed —indicating the growing behavior ofthe plants (increase in size). The estimation error between manualand masked dimensions for each trait per plant is then measuredusing root mean squared error (RMSE) using the formula given below.RMSE¼ﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ
1n∑kj¼0ðxj/C0yjÞ2s ð18ÞWhere (x
j) is actual value, (y j) is the predicted value,Table 1lists the RMSE calculated using the above equation for each measurement perplant. The test image set refers to a set of images taken throughout theplantation cycle for one pair of plants (Foliage 1 and Foliage 2). Thetest dataset in this study consists of four plant pairs. The minimumerror is observed which demonstrates that the trained model is reliablefor the calculation of the leaf area, length, and width in real-world sce-narios.4.4. Evaluation of plant spacing modelTo evaluate the plant spacing model,ﬁrst, the distance between bounding boxes of two instances (two plants per image) is computedafter instance segmentation is performed on images in the test dataset.The plant spacing is then computed following the process mentioned insection 3.4. The predicted values are then compared with actual mea-surements, which indicates that plant spacing increases with anincrease in foliage area and length.Table 2presents the RMSE for each test image set. The lower RMSE values indicate the reliability of theproposed model.5. Discussion and future workThe objective of this study is to automatically measure the crop mor-phological traits from the lettuce images acquired from the aquaponics
Fig. 10.Detection and instance segmentation of lettuce foliage.
Table 1RMSE of manual and estimated measurements of morphological traits.Test image set Instance Length, L
r(cm) Width,W r(cm) Area,A f(cm2)1Foliage 1 1.1 1.8 3.35Foliage 2 1.3 1.1 2.92Foliage 1 0.95 1.5 3.1Foliage 2 1.05 1.3 2.793Foliage 1 1.27 0.99 3.2Foliage 2 1.37 1.21 3.124Foliage 1 1.31 1.32 3.23Foliage 2 1.18 1.27 2.87 Table 2RMSE of manual and estimated measurements of plant spacing.Test image set Instance 1 Instance 2 Plant spacing, S′(cm)1 Foliage 1 Foliage 2 1.12 Foliage 1 Foliage 2 0.953 Foliage 1 Foliage 2 1.274 Foliage 1 Foliage 2 1.31R. Abbasi, P. Martinez and R. Ahmad Artiﬁcial Intelligence in Agriculture 9 (2023) 76 –88
84facility and determine the effective plant spacing between growchannels. The idea is to develop an approach that can lead to aself-adaptive aquaponics system, where based on crop morphologicalattributes, the grow channels adjust their positions effectively to ensurehigh crop yield and quality by avoiding occlusions and foliage overlap-ping. The presented work has used the Mask-RCNN algorithm to enableaﬁne-grained detection of lettuce foliage within the images and thegeneration of a pixel-wise segmentation mask for each detectedinstance. The segmentation masks distinguish foliage from the back-ground and provide a mechanism to identify non-foliage classes,such as channel, Rockwool cubes, etc., by considering their highheterogeneity in form and texture.The manual measurement of morphological traits is time-consuming and labor-intensive. Even for an experienced agriculturalist,it would take a signiﬁcant amount of time to measure all morphologicaltraits. The proposed approach can automatically estimate the morpho-logical traits of lettuce foliage that vary in size and shape. Plant spacingis one of the key features that impact crop growth. It is dependent oncrop type as well as crop morphological traits. In this study, plant spac-ing is automatically measured for each segmented foliage using themathematical model.Theﬁnal model is deployed on a cloud-based application and inte-grated with the ontology model. The ontology model provides informa-tion about crop characteristics and grow bed design parameters for avariety of crops grown in NFT-based aquaponics. The application actsas a decision support system, which analyses the results from themodels, compares them with the relevant knowledge from the ontologymodel and suggests theﬁnal action by sending a control signal to theaquaponics facility for automatically adjusting the grow channelsbased on the value of plant spacing predicted by the proposed model.While promising results are achieved from the proposed models,there is still scope for improvement. For instance, only one crop is con-sidered in this study for the estimation of morphological attributes andassessing the plant spacing between channels. Considering that, the po-tential solutions for estimating the morphological attributes of multiplecrops will be investigated in future work. Subsequently, the dataset willbe increased with more image variations and other leafy green crops aswell as fruits,ﬂowers, and non-ﬂowering plants. Furthermore, the im-pact of morphological traits on other design parameters of aquaponicsfacility will also be studied.6. ConclusionIn this study, an automatic tool is developed to predict the morpho-logical traits of lettuce crops such as foliage area, length, and widthand estimate effective plant spacing for NFT-based aquaponics facility.The results have shown that the growth of plants is estimated within2 cm of error for both length and width, 4 cm for the area and1.5 cm for plant spacing. Theﬁnal model is then deployed on acloud-based application and an ontology model is integrated with it.The proposed method is accurate andﬂexible and hence can easily be applied in real scenarios. This contribution has great signi ﬁcance to the research community as it promotes the implementation of a self-adaptive aquaponics system that can be constantly improved usingdynamic data. Moreover, the presented methods offer the opportunityto rely on smart technologies for the application of new concepts suchas research on complex relationships between optimal parameters, anddetection of nutrient deﬁciency in crops using computer vision whichwill pave the way for large-scale implementation of aquaponicsfarming technology.Declaration of Competing InterestThe authors declare that they have no known competing ﬁnancial interests or personal relationships that could have appeared to in ﬂu- ence the work reported in this paper.AcknowledgementsThe authors acknowledge theﬁnancial support of this work by theNatural Sciences and Engineering Research Council of Canada (NSERC)(Grant File No. ALLRP 545537-19 and RGPIN-2017-04516).Appendix A. Appendix
Fig. A1.Boxplot showing variations in the heights of thirty plants over the period of thirty days.R. Abbasi, P. Martinez and R. Ahmad Artiﬁcial Intelligence in Agriculture 9 (2023) 76 –88
85Fig. A2.Variations in median heights of plants.
Fig. A3.Ontology model showing the instances of ‘Consumer_Product’and‘Production_System’classes.R. Abbasi, P. Martinez and R. Ahmad Artiﬁcial Intelligence in Agriculture 9 (2023) 76 –88
86References
Abbasi, R., Martinez, P., Ahmad, R., 2021a. An ontology model to represent aquaponics 4.0system’s knowledge. Inf. Process. Agric. https://doi.org/10.1016/J.INPA.2021.12.001 . Abbasi, R., Martinez, P., Ahmad, R., 2021b. An ontology model to support the automateddesign of aquaponic grow beds. Proc. CIRP 100, 55 –60.https://doi.org/10.1016/j. procir.2021.05.009.Abbasi, R., Martinez, P., Ahmad, R., 2022. The digitization of agricultural industry –a sys- tematic literature review on agriculture 4.0. Smart Agric. Technol. 2, 100042. https:// doi.org/10.1016/J.ATECH.2022.100042 . Buslaev, A., Iglovikov, V.I., Khvedchenya, E., Parinov, A., Druzhinin, M., Kalinin, A.A., 2020.Albumentations: fast andﬂexible image augmentations. Inf. 11. https://doi.org/10. 3390/INFO11020125.Crop Quality - An Overview|ScienceDirect Topics [WWW Document], 2021. URL https:// www.sciencedirect.com/topics/agricultural-and-biological-sciences/crop-quality(accessed 7.13.21).Dutta, A., International, A.Z.-P. of the 27th A. 2019, unde ﬁned, 2019. The VIA Annotation Software for Images, Audio and Video. dl.acm.org. , pp. 2276 –2279.https://doi.org/ 10.1145/3343031.3350535. Easlon, H.M., Bloom, A.J., 2014. Easy leaf area: automated digital image analysis for rapidand accurate measurement of leaf area. Appl. Plant Sci. 2, 1400033. https://doi.org/10. 3732/APPS.1400033.Gaikwad, J., Triki, A., Bouaziz, B., 2019. Measuring morphological functional leaf traitsfrom digitized herbarium specimens using TraitEx software. J. Biodiver. Inform. Sci.Stand. 3, e37091.https://doi.org/10.3897/biss.3.37091 .
Fig. A4.Cloud-based application.R. Abbasi, P. Martinez and R. Ahmad Artiﬁcial Intelligence in Agriculture 9 (2023) 76 –88
87Gillani, S.A., Abbasi, R., Martinez, P., Ahmad, R., 2022b. Review on energy ef ﬁcient artiﬁcial illumination in aquaponics. Clean. Circ. Bioecon. 2, 100015. https://doi.org/10.1016/J. CLCB.2022.100015.Gillani, Syed Abreez, Abbasi, R., Martinez, P., Ahmad, R., 2022a. Ontology-based interac-tive learning approach for transdisciplinary teaching in learning factory. SSRN Elec-tron. J.https://doi.org/10.2139/SSRN.4071925 . He, K., Gkioxari, G., Dollar, P., Girshick, R., 2017. Mask R-CNN. https://doi.org/10.1109/ ICCV.2017.322.Hirigoyen, A., Acosta-Muñoz, C., Salamanca, Jesús Ariza, Ángeles Varo-Martinez, M.,Rachid-Casnati, C., Franco, J., Navarro-Cerrillo, R., Salamanca, A.A., Má, V.-M., 2021.A machine learning approach to model leaf area index in Eucalyptus plantationsusing high-resolution satellite imagery and airborne laser scanner data. Ann. For.Res 64, 165–183.https://doi.org/10.15287/afr.2021.2073 . Juyal, P., Sharma, S., 2020. Estimation of Tree Volume Using Mask R-CNN based DeepLearning. 2020 11th Int. Conf. Comput. Commun. Netw. Technol. ICCCNT 2020.https://doi.org/10.1109/ICCCNT49239.2020.9225509 . Kang, B.R., Lee, H., Park, K., Ryu, H., Kim, H.Y., 2020. BshapeNet: object detection and in-stance segmentation with bounding shape masks. Pattern Recogn. Lett. 131,449–455.https://doi.org/10.1016/J.PATREC.2020.01.024 . Lu, J.Y., Chang, C.L., Kuo, Y.F., 2019. Monitoring growth rate of lettuce using deepconvolutional neural networks. 2019 ASABE Annu. Int. Meet. 1. Doi: 10.13031/ AIM.201900341.Maboko, M.M., Du Plooy, C.P., 2009. Effect of plant spacing on growth and yield of lettuce(Lactuca sativaL.) in a soilless production system. S. Afr. J. Plant Soil. https://doi.org/ 10.1080/02571862.2009.10639954 . Maloof, J., Nozue, K., M.M.-J, 2013. LeafJ: an ImageJ plugin for semi-automated leaf shapemeasurement. J. Vis. Exp.(71), e50028. https://doi.org/10.3791/50028 . Martinez, P., Ahmad, R., 2018. All factory: An Aquaponics 4. 0 Transdisciplinary Educational and Applied Research Learning Factory at the University of Alberta.pp. 5–7.Nakarmi, A.D., Tang, L., 2012. Automatic inter-plant spacing sensing at early growthstages using a 3D vision sensor. Comput. Electron. Agric. 82, 23 –31.https://doi.org/ 10.1016/J.COMPAG.2011.12.011 . Reyes-Yanes, A., Martinez, P., Ahmad, R., 2020. Real-time growth rate and fresh weight es-timation for little gem romaine lettuce in aquaponic grow beds. Comput. Electron.Agric. 179, 105827.https://doi.org/10.1016/j.compag.2020.105827 . Reyes-Yanes, A., Gelio, S., Martinez, P., Ahmad, R., 2021. Wireless sensing module for IoTaquaponics database construction. Int. J. Electron. Electr. Eng. 9, 43 –47.https://doi. org/10.18178/IJEEE.9.2.43-47. Singh, S., Kumar, S., Singh, S.P., Yadav, Shatrunjay, Yadav, Sandeep, Singh, A., Awasthi,M.K., 2022. Plant spacing and cultivar on quality attributes in sprouting broccoli. S.Afr. J. Bot. 148, 737–741.https://doi.org/10.1016/J.SAJB.2022.04.049 . Triki, A., Bouaziz, B., Gaikwad, J., Mahdi, W., 2021. Deep leaf: mask R-CNN based leaf de-tection and segmentation from digitized herbarium specimen images. PatternRecogn. Lett. 150, 76–83.https://doi.org/10.1016/J.PATREC.2021.07.003 . Weaver, W.N., Ng, J., Laport, R.G., 2020. LeafMachine: using machine learning to automateleaf trait extraction from digitized herbarium specimens. Appl. Plant Sci. 8. https:// doi.org/10.1002/APS3.11367. Yu, Y., Zhang, K., Yang, L., Zhang, D., 2019. Fruit detection for strawberry harvesting robotin non-structural environment based on mask-RCNN. Comput. Electron. Agric. 163,104846.https://doi.org/10.1016/J.COMPAG.2019.06.001
. Zaman, I., Ali, M., Shahzad, K., Tahir, M.S., Matloob, A., Ahmad, W., Alamri, S., Khurshid,M.R., Qureshi, M.M., Wasaya, A., Baig, K.S., Siddiqui, M.H., Fahad, S., Datta, R., 2021. Ef-fect of plant spacings on growth, physiology, yield and ﬁber quality attributes of cot- ton genotypes under nitrogen fertilization. Agron 11, 2589. https://doi.org/10.3390/ AGRONOMY11122589.R. Abbasi, P. Martinez and R. Ahmad Artiﬁcial Intelligence in Agriculture 9 (2023) 76 –88
88