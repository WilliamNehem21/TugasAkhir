Application of neural network to speed-up equilibrium calculations incompositional reservoir simulation
Wagner Q. Barros, Adolfo P. Pires*
Laborat/C19orio de Engenharia e Exploraç ~ao de Petr/C19oleo - Universidade Estadual do Norte Fluminense Darcy Ribeiro, Rodovia Amaral Peixoto, Km 163, Imboassica, Maca /C19e, 27925-310, Rio de Janeiro, Brazil
ARTICLE INFO
Keywords:Neural networkCompositional simulationArtiﬁcial intelligenceFlash calculationReservoir engineeringABSTRACT
Compositional reservoir simulation is an important tool to model ﬂuidﬂow in oil and gas reservoirs. Important investment decisions regarding oil recovery methods are based on simulation results, where hundred or eventhousand of different runs are performed. In this work, a new methodology using arti ﬁcial intelligence to learn the thermodynamic equilibrium is proposed. This algorithm is used to replace the classical equilibrium work ﬂow in reservoir simulation. The new method avoids the stability test for single-phase cells in most cases and provides anaccurate two-phaseﬂash initial estimate. The classical and the new work ﬂow are compared for a gas-oil mixing case, showing a simulation time speed-up of approximately 50%. The new method can be used in compositionalreservoir simulations.
1. IntroductionCompositional reservoir simulation is a numerical model used tosolve theﬂuid transport in porous media coupled with thermodynamicphase equilibrium (Fussell and Fussell, 1979;Coats, 1980). To describe the reservoir accurately, numerical grid may be composed of millions ofcells, and along a compositional simulation the phase equilibrium issolved for each cell every time-step. Thus, most part of computationaleffort is spent inﬂash calculations. There are cases where equilibriumcalculations reach more than 50% of simulation time ( Okuno et al., 2009; Wang et al., 2019a,b).Incipient compositional simulators used a K-value approach, wherethe thermodynamic equilibrium was calculated a priori and stored intables or correlations of K-values, where K
iis the ratio between the mole fraction of componentiin gas and in oil phases (K
i¼yi/xi)(Kniazeff and Naville, 1965;Price and Donohue, 1967;Culham et al., 1969;Roebuck et al., 1969). This approach does not require much memory or processingcapacity. The main problem of such model is that K-values may lead tophase composition errors, specially near to critical points.The increase of computers processing capacity allowed a newcompositional simulation technique, based on equations of state (EOS).In this case, the phase equilibrium is solved rigorously, using cubic EOS(Fussell and Fussell, 1979;Coats, 1980;Thele et al., 1983;Okuno et al., 2009;Moortgat and Firoozabadi, 2013;Schmall et al., 2013). Thisapproach is accurate, and does not cause numerical instability near thecritical point. However, 2Ncþ1 equations for each grid cell must besolved every time step, whereN
cis the number of components. Then, forlarge reservoir grids, computational cost becomes very expensive ( Todd and Longstaff, 1972;Wong et al., 1987;El-Banbi et al., 2000). To over- come this limitation, lumping techniques may be used to reduce thenumber of components inﬂuid description (Joergensen and Stenby, 1995;Jessen and Moghadam, 2009;Alavian et al., 2014). For every time-step, appearance and disappearance of a phase mustbe evaluated in all cells. The phase disappearance is a simple problem(Whitson and Michelsen, 1989;Li and Firoozabadi, 2012), but phase appearance check is not so trivial, and it is a computationaltime-consuming process.In the phase appearance algorithm, the stability of a single-phase cellis checked. One technique compares the saturation pressure of the ﬂuid in the cell with the cell pressure (Fussell and Yanosik, 1978;Fussell and Fussell, 1979;Coats, 1980). Modern simulators use the tangent planestability test to determine if a given single-phase composition is stable(Baker et al., 1982;Michelsen, 1982a;Sun and Seider, 1995;Firoozabadi and Pan, 2000;Li and Firoozabadi, 2012). In both cases we must solve a system of non-linear equations by iterative methods. If the phase is notstable, a two-phaseﬂash calculation is performed to determine the phasecomposition and saturations in each cell ( Fussell and Yanosik, 1978; Boston and Britt, 1978;Hirose et al., 1978;Michelsen, 1982b;Abhvani
* Corresponding author.E-mail addresses:wagnerqb@gmail.com(W.Q. Barros),puime@lenep.uenf.br(A.P. Pires).
Contents lists available atScienceDirect
Artiﬁcial Intelligence in Geosciences
journal homepage:www.keaipublishing.com/en/journals/artiﬁcial-intelligence-in-geosciences
https://doi.org/10.1016/j.aiig.2022.03.004Received 27 December 2021; Received in revised form 28 March 2022; Accepted 30 March 2022Available online 8 April 20222666-5441/©2022 The Authors. Publishing Services by Elsevier B.V. on behalf of KeAi Communications Co. Ltd. This is an open access article under the CC BY-NC-NDlicense (http://creativecommons.org/licenses/by-nc-nd/4.0/ ).Artiﬁcial Intelligence in Geosciences 2 (2021) 202–214and Beaumont, 1987;Li and Johns, 2006). A technique called Compositional Space Adaptive Tabulation (CSAT)was proposed to decrease the number of stability tests and two-phaseﬂash calculations during reservoir simulations. In this approach, ther-modynamic equilibrium data is stored in tables. During the simulation,initial estimates forﬂash calculations are obtained interpolating thestored data (Voskov and Tchelepi, 2009b,a). This approach provides accurate initial estimates forﬂash algorithms, decreasing the number ofiterations. However, the more components are used in ﬂuid description,the more computational time is spent to interpolate the data, decreasingthe method efﬁciency (Rezaveisi et al., 2014). In this work we propose a similar technique to provide initial esti-mates forﬂash calculations, using artiﬁcial neural networks instead of tie-line interpolation. A neural network model is based on the humanbrain and is applied in recognition and classi ﬁcation problems. Mathe- matically, the neural network is known as a universal function approx-imator, able to adjust any continuous multivariate function ( Ojha et al., 2017). There are many applications of artiﬁcial intelligence in thermo- dynamic equilibrium problems.Goda et al. (2003)trained a neural network to predict black-oil typeﬂuid properties with data from morethan 160 differentﬂuids from Middle East reservoirs.Neural network was also applied to predict CO
2solubility in ionic liquids (Baghban et al., 2015). Using 728 experimental data from 14different ionic liquids, a solubility model was built as a function of thecritical properties of the pure components, pressure and temperature.The network correlation coefﬁcient wasR
2¼0.9336, better than the ones obtained using PR-EOS (Robinson and Peng, 1978)(R
2¼0.7323) and the SRK-EOS (Soave, 1972)(R
2¼0.6989).Baghban et al. (2016a,b) developed several models to predict air dew point and hydrate formation
Fig. 1.Classical phase equilibrium workﬂow.
Fig. 2.Phase identiﬁcation neural network with 4 layers, where n 1,n2andn 3
are the number of neurons in layers 1, 2 and 3.
Fig. 3.Two phase initial guess estimate neural network with 4 layers, where n 1, n
2andn 3are the number of neurons in layers 1, 2 and 3.
Fig. 4.Neural network (NN) phase equilibrium work ﬂow.W.Q. Barros, A.P. Pires Artiﬁcial Intelligence in Geosciences 2 (2021) 202–214
203in different scenarios. The enthalpy of vaporization of pure substancesbased on its boiling temperature, speciﬁc gravity and the molecular weight was also modeled using neural networks ( Eghtedaei et al., 2019). Artiﬁcial intelligence can be trained with a particular numericalreservoir model generating a proxy that is much faster to evaluate. Thisproxy model is used to optimize production alternatives and to evaluateuncertainty through Monte Carlo simulations, where thousands of runsare needed to achieve satisfactory results ( Mohaghegh et al., 2012;Ala- keely and Horne, 2021b). Multiphaseﬂow rate in producing wells can be estimated using deep learning techniques ( Tian and Horne, 2017;Li et al., 2019;Alakeely and Horne, 2021a). These artiﬁcial intelligencemethods are trained using the production history, and are accurateenough to be used in real-time monitoring tools. A Physics-InformedNeural Network (PINN) can be used to create a meshless reservoirmodel that can provide accurate results in higher dimensional problemswhen compared to traditional simulation techniques ( Cheung et al., 2018;Coutinho et al., 2021,2022;Almajid and Abu-Alsaud, 2022). Wang et al. (2019a,b)created a neural network model to predict thebubble point of hydrocarbon mixtures and provide an initial guess for thetwo-phaseﬂash algorithm. The total reservoir simulation time wasreduced in 30%, mainly because the stability test algorithm was replacedby the comparison between the cell pressure and the bubble point pre-dicted by the neural network.In this work we present a neural network method to provide accurateinitial estimates forﬂash calculations instead of the phase stability test.This procedure may be applied to compositional reservoir simulationsaving computational time. The proposed method tests the phase stabilityand classiﬁes it as a liquid or vapor in the single phase case. In Section 2 we discuss the thermodynamic equilibrium routines, and compare theclassical simulation workﬂow with a new one, based on neural network.Then, in Section3the new technique is evaluated, checking the accuracyof the predicted thermodynamic calculations and comparing thecomputational time between the classical approach and the one proposedin this work. Finally, some conclusions are addressed in Section 4.2. Two-phase equilibriumThis section presents the mathematical description of the ﬂash equi- librium problem and describes how artiﬁcial intelligence can be used to improve these routines.A closed system at constant pressure, temperature and globalcomposition is at equilibrium if the total Gibbs free energy ( G)i s minimal:Table 1SPE3ﬂuid characterization.
Z!M w Pc Tc ω kCO2 kN2 kC1 kC2 kC3
(g/mol) (atm) (K) CO
2 0.0121 44.010 72.8 304.2 0.225N
2 0.0194 28.013 33.5 126.2 0.040 /C00.02000 C
1 0.6599 16.043 45.4 190.6 0.008 0.10000 0.03600C
2 0.0869 30.070 48.2 305.4 0.098 0.13000 0.05000 0.00000C
3 0.0591 44.097 41.9 369.8 0.152 0.13500 0.08000 0.00000 0.00000C
4 0.0967 58.124 37.5 425.2 0.193 0.12770 0.10020 0.09281 0.00000 0.00000C
71 0.0472 110.900 25.6 572.5 0.332 0.10000 0.10000 0.00000 0.00385 0.00385C
72 0.0153 170.900 16.7 630.2 0.495 0.10000 0.10000 0.00000 0.00630 0.00630C
73 0.0034 282.100 8.5 862.6 0.833 0.10000 0.10000 0.13920 0.00600 0.00600
Fig. 5.SPE3 phase envelopeﬁlled with vapor phase molar fraction values.
Fig. 6.SPE3 phase envelope with phase identi ﬁcation labels generated by the classical work ﬂow and by the neural network workﬂow, where the black dot marks the critical point.W.Q. Barros, A.P. Pires Artiﬁcial Intelligence in Geosciences 2 (2021) 202–214
204dG¼XNπ
π¼1"/C18
∂G
∂p/C19
T;ηc;πdpþ/C18∂G
∂T/C19
p;ηc;πdTþXNcc¼1/C18∂G
∂ηc;π/C19
T;p;ηj6¼c;πdηc;π#¼0 (1) where
ηc,πis the number of moles of component cin phase πandN candNπare the total number of components and phases.2.1. Phase identiﬁcation workﬂowIn compositional reservoir simulation, the phase stability test(Michelsen, 1982a;Firoozabadi and Pan, 2000;Li and Firoozabadi, 2012) is performed in single phase cells to evaluate if the Gibbs free
Fig. 7.Phase envelope withlogK CO2values: (a) equilibrium values, (b) estimated by the neural network, (c) estimated by Wilson correlation, (d) estimated by the stability test.
Fig. 8.Phase envelope withlogK C71values: (a) equilibrium values, (b) estimated by the neural network, (c) estimated by Wilson correlation, (d) estimated by the stability test.W.Q. Barros, A.P. Pires Artiﬁcial Intelligence in Geosciences 2 (2021) 202–214
205energy is minimal (stable) or if the phase splits in two (unstable). Thedifference of the Gibbs free energy between a two phase system and areference phase is given by:ΔG¼ðG
IþGIIÞ/C0G 0 (2)whereG
IandGIIare the Gibbs free energy of phasesIandII, andG 0is the Gibbs free energy of the reference phase with composition Z!. Consid- ering that the reference phase splits in two, where the new phase has aninﬁnitesimal mole number (ε) and compositionζ!, Equation(2)can be rewritten in molar basis as:ΔG¼
εXNc
i¼0ζi/C16
μiðp;T;ζ!Þ/C0 μi/C16p;T;Z!/C17/C17(3)in whichζ
iis the componentimole fraction and μiis the chemical po- tential of componenti, given by
μi¼/C16∂G
∂ηi/C17
p;T;ηj6¼i. DeﬁningFðp;T;ζ!Þby:Fðp;T;ζ!Þ¼X
Nc
i¼0ζi/C16
μiðP;T;ζ!Þ/C0 μi/C16p;T;Z!/C17/C17(4)it is known that ifF/C210 for any possibleζ!composition, then the reference phaseZ!is stable as a single-phase mixture. Instead of evalu-ating this equation for all possible ζ!compositions, the stability test searches for critical points, where the Gibbs free energy is a local mini-mum. A critical point can be found using a direct substitution method(Michelsen, 1982a):lnY
tþ1i¼lnZ iþlnφi/C16P;T;Z!/C17/C0lnφ
iðP;T;ζ!t
Þ(5)whereφ
iis the fugacity coefﬁcient of componenti, calculated using any
Fig. 9.Phase envelopeﬁlled withlogK C71values after convergence of stability test, where: (a) starting with liquid like composition and (b) starting with vapor like composition.
Fig. 10.Phase envelope with vapor phase mole fraction: (a) calculated by the EOS, (b) initial guess estimated by the neural network.
Table 2Swelling experiment composition of SPE3 oil and its gas.
Oil Mole Fraction Gas Mole Fractionðx!Þð y!ÞCO
2 0.0121 0.0129N
2 0.0194 0.0206C
1 0.6599 0.7016C
2 0.0869 0.0922C
3 0.0591 0.0623C
4 0.0967 0.0993C
71 0.0472 0.0110C
72 0.0153 0.0001C
73 0.0034 0.0000W.Q. Barros, A.P. Pires Artiﬁcial Intelligence in Geosciences 2 (2021) 202–214
206equation of state. The composition in step tþ1 is found byζtþ1i¼YiPNcj¼0Yj.The initial iterationζ!
0
for hydrocarbons is usually calculated usingWilson's correlation (Wilson, 1968):Ki¼pc;i
pexp/C205;37ð1þωiÞ/C181/C0Tc;i
T/C19/C21(6)wherep
c,i,Tc,iandωiare the critical pressure, critical temperature andacentric factor of componenti. The K-value relates the vapor (y
i) and liquid (x
i) molar fractions:K
i¼yi
xi(7)then, if a liquid-like phase is evaluated the initial trial composition isgiven byζ
i¼Zi
Ki, and if a vapor-like phase is tested the initial trialcomposition isζ
i¼K iZi.If the phase is stable a phase identiﬁcation algorithm to determine if it is a liquid or gas must be performed. When the system temperature Tis greater than the mixture critical temperature ( T>T
c) the phase is labeled as a vapor, otherwise as a liquid. The critical temperature depends on themixture composition and requires great computational effort. Incompositional reservoir simulation, the critical temperature is usuallyapproximated by the modiﬁed Li mixing rule (Li, 1971):T
c¼r 1PNc
i¼0xiVc;iTc;iPNc
i¼0xiVc;i(8)whereV
c,iis the critical volume of component iandr 1is an adjustable parameter used to tune this algorithm.The previously described process will be called classical phase equi-librium algorithm, which is used in EOS based compositional reservoirsimulators (Fig. 1). Note that theﬂuid is only considered single-phaseafter two stability tests, for both liquid and vapor initial estimates, andthen performing a phase identiﬁcation algorithm. Along a fullﬁeld compositional reservoir simulation, this routine is called for each gridcell every time step, making this algorithm responsible for about 50% ofprocessing time, where the stability test is the most consuming part(Wang et al., 2019a,b).2.2. Neural network applied to phase identi ﬁcationTo decrease the number of calls of the stability test and phase labelingalgorithms we developed a neural network specialized in phase identi-ﬁcation (Fig. 2). The Multi Layer Perceptron (MLP) was the networklayout chosen. InFig. 2, each circle is a perceptron neuron and each layeris directly connected with the next ( Haykin, 1999). For the phase iden- tiﬁcation network, all neurons have the same sigmoidal activationfunction, given by:Nðx!¼
11þe
/C0ðx!/C1w!/C0bÞ(9)wherex!is the neuron input vector (lines in Fig. 2),w!is the neuron weight vector andbthe constant bias. Note that the neuron output islimited by the intervalNðx!2ð0;1Þ. So, training a network is an opti- mization problem to deﬁne the values ofw!andbof each neuron that minimize the error between the network response and the output for agiven training data-set.For the phase identiﬁcation network, deﬁning as input the pressure, temperature and global composition ðp;T;Z!Þ, this algorithm returns three real numbers in the intervalð0;1Þ: liquid (L), vapor (V) or two- phase (T
PH). The phase identiﬁcation (Ph ID) is performed through a voting system, in which the neural network response is the greatest valueamong the three outputs:Ph
ID¼maxðL;V;T PHÞ (10) To check if the network response is valid we estimate the con ﬁdence ofPh
IDby:
Fig. 11.Phase envelope for different gas fractions ( αg).W.Q. Barros, A.P. Pires Artiﬁcial Intelligence in Geosciences 2 (2021) 202–214
207CðPh IDÞ¼maxðL;V;T PHÞðLþVþT
PHÞ (11)The phase identiﬁed by the neural network is accepted if its con ﬁ- dence is greater than 95%, otherwise the traditional phase identi ﬁcation workﬂow is used (Section2.1).The introduction of the conﬁdence concept and labeling it as a liquidor vapor in the single phase case are some improvements of the techniquepresented in this work when compared with other methods reported inliterature (Wang et al., 2019a,b). Its importance raises when miscibleprocesses are simulated, because theﬂuid phase may change from liquid to vapor without crossing the two phase boundary or even crossing thetwo-phase envelope. Thus, the use of the proposed method reduces thenumber of stability tests calls.2.3. Two-phaseﬂash algorithmThe phase equilibrium conditions for a two-phase system is given by(Prausnitz et al., 1998;Sandler, 2006):8>>>><>>>>:p
l¼pv
Tl¼Tv
x1φ1ðp;T;x!Þ¼y 1φ1ðp;T;y!Þ⋮⋮⋮x
NcφNcðp;T;x!Þ¼y NcφNcðp;T;y!Þ(12)whereφ
cis the fugacity coefﬁcient of a component in a mixture, calcu-lated using any equation of state and the superscripts landvrelate the liquid and vapor phases. The fugacity condition equation for eachcomponent can be rewritten in a residual form:logðφ
iðp;T;y!ÞÞ/C0logðφiðp;T;x!ÞÞþlogðK iÞ¼R i;i¼1;…;N c (13)and solved using the Newton-Raphson's method. Usually the K-valuesobtained at the end of the phase stability test (Equation (5)) are used as the initial estimate. After convergence the vapor phase mole fraction ( V) is determined solving the Rachford-Rice equation ( Rachford and Rice, 1952):XNc
i¼1ZiðKi/C01Þ1þðK
i/C01ÞV¼0 (14)and the composition of each phase is calculated through:8>>><>>>:x
i¼Zi
1þðK i/C01ÞVy
i¼ZiKi
1þðK i/C01ÞV;i¼1;…;Nc (15)2.4. Neural network to estimate initialﬂash calculationsWhen the phase identiﬁcation neural network is used to determinethe number of phases in the system, the phase stability algorithm is notrun and initial estimates for the two phase ﬂash algorithm are not available (Equation(13)). To overcome this limitation, artiﬁcial intelli- gence is used to generate initial estimates to Equation (13). For this problem, one MLP network is trained for each ﬂash variable (V, logðK
1Þ,…, logðK NcÞ)(Fig. 3). The input is the same of the stabilitytest and phase identiﬁcationðp;T;Z!Þand there is one output neuron in each network. The output neuron uses the linear activation function:Nðx!¼x!/C1w!/C0b (16)while all other neurons of the input and hidden layers use the recti ﬁed
Fig. 12.Vapor mole fraction calculated by an EOS and estimated by the neural network and by Wilson correlation for three different ( p,T) conditions and gas fractions.W.Q. Barros, A.P. Pires Artiﬁcial Intelligence in Geosciences 2 (2021) 202–214
208linear activation function:Nðx!¼maxð0;x!/C1w!/C0bÞ (17) It should be noted that a different neural network for each ﬂash variable (V, logðK
1Þ,…, logðK NcÞ) must be built. This architecture is basedon the specialization concept, where the reduction of the number ofoutput variables decreases the size of the optimization problem and in-creases its accuracy (Haykin, 1999).2.5. Improved two-phase equilibrium modelFig. 4shows the proposed phase equilibrium work ﬂow that uses artiﬁcial intelligence to replace part of the classical ﬂash calculations (Fig. 1). Theﬁrst step uses the phase identiﬁcation network to generate an estimate of the conﬁdence and identify theﬂuid phase (Equation (11)). IfCðPh
IDÞh95% the result is not considered and the usual stabilitytest is performed. Otherwise, theﬂash parameters using the estimate network for the two-phase region are generated ( Fig. 3). The proposed methodology does not replace completely the ﬂash calculation in compositional simulators. It avoids stability tests andprovides initial estimates very close to the solution of the ﬂash. As it will be discussed in the next section, the neural network work ﬂow, combined with the conﬁdence calculation, ensures that the exact solution of two-phase equilibrium will be found.3. Results and discussionThe new phase equilibrium workﬂow (Fig. 4) was compared with the classical workﬂow (Fig. 1) for the SPE3 mixture (Kenyon and Behie, 1987;Haugen and Beckner, 2013).Table 1presents the SPE3ﬂuidcharacterization andFig. 5shows its phase envelope, simulated with thePeng-Robinson equation of state (Robinson and Peng, 1978). Thekivalue is the binary interaction coefﬁcient between the row component and i component. Thisﬂuid can be characterized as a light oil with 51
/C14API and 850 sm
3/sm3solution gas-oil ratio.This section is divided in three parts: in the ﬁrst two sub-sections we check if the artiﬁcial intelligence algorithm learns two-phase thermo-dynamic equilibrium results from constant global composition calcula-tions and from a gasﬂooding recovery process. Last section compares thecomputational time between the proposed neural network work ﬂow and the classical workﬂow.3.1. Constant compositionFor the constant composition case 10,000 classical ﬂash calculations for SPE3ﬂuid (Table 1) were performed changing pressure in the intervalp2½2;27/C138MPa and temperature in the interval T2½240;620/C138K. These results were used as the training data set.3.1.1. Phase identiﬁcation networkThe best phase identiﬁcation network topology is composed by 4layers with a total of 43 neurons, whose structure is ð8;16;16;3Þ, where each number indicates the number of neurons per layer. This optimumtopology was found by testing different architectures to maximize thenetwork accuracy using the minimum number of layers and neurons.Fig. 6compares the phase identiﬁcation envelope generated by the classical workﬂow (used as training data) and the envelope obtained bythe neural network after training. Note that the uncertainty points (red)appear in the phase transition region, and are less than 5.23% of total.
Fig. 13.logK CO2and logK C73calculated by an EOS and estimated by the neural network and by Wilson correlation for three different ( p,T) conditions and gas fractions.W.Q. Barros, A.P. Pires Artiﬁcial Intelligence in Geosciences 2 (2021) 202–214
2093.1.2. Two-phaseﬂash initial estimate networkThe topology of the network that generates initial estimates for ﬂash calculations is similar to the topology of the phase identi ﬁcation network, with 41 neurons distributed in 4 layers ð8;16;16;1Þ. The Newton- Raphson method depends on the initial estimates. So, to reduce thenumber of iterations of theﬂash algorithm (Equation(13)), it is impor- tant to provide an estimate of log K
ifor each component as close as possible to the solution. As an example, we compare the log K
CO2and logK
C71obtained after equilibrium by the classical work ﬂow, and esti- mated by the proposed neural network method, the stability test(Equation(5)), and the Wilson correlation (Equation (6))(Figs. 7 and 8). The neural network can learn the K-values of all components,generating initial estimates for theﬂash problem very close to the exact solution, and reducing the number ofﬂash iterations. On the other hand Wilson correlation provides poor estimates at high pressures causingdivergence when applied directly in theﬂash algorithm. Note that there is a discontinuity in the calculations using the stability test.The discontinuous region in stability calculations is related with thelocal minima in Equation(4). Depending if the algorithm starts the testswith liquid like or vapor like composition ( Z!¼x!orZ!¼y!), the sta- bility algorithm may converge to different log K
i(Fig. 9).Fig. 9presents logK
C71after the convergence of liquid like and vapor like stability tests.Note that there is an area where both algorithms result in unstable phaseswith different compositions. Choice of vapor like composition in theregion of high liquid fractions (low temperature) can result in poor initialestimates for Newton-Raphson algorithm. Note that the unstable regionfor either liquid or vapor like stability tests are always smaller than thephase envelope region, the main reason it is necessary to run both tests inthe classical workﬂow (Fig. 1).Finally,Fig. 10compares the vapor mole fraction calculated by theEOS and the initial guess provided by the neural network. The initial
Fig. 14.logK icalculated by an EOS and estimated by the neural network and byWilson correlation forp¼5 MPa,T¼300 K and several gas fractions.
Fig. 15.Vapor mole fraction calculated by an EOS and estimated by the neural network and by Wilson correlation for three different ( αg,T) conditions and different system pressures.W.Q. Barros, A.P. Pires Artiﬁcial Intelligence in Geosciences 2 (2021) 202–214
210guess is close to theﬂash by the EOS, an excellent approximation for theﬂash calculation even in regions close to the critical point.3.2. Variable compositionGas injection is a recovery process of liquid hydrocarbons thatchanges the global composition of the reservoir ﬂuid. It increases nu- merical simulation complexity because of the mass transfer. For example,the composition and pressure variation in small cells close to injectionwell may change the phase from oil to gas in one time step. So, it isnecessary to perform the stability test every time step using liquid-likeand vapor-like estimates.To train the proposed neural network work ﬂow for gasﬂooding simulations scenario a numerical swelling test was created. This testconsists of mixing gas and oil atﬁxed ratios, and measuring the volumeand composition of each phase after equilibrium.The training data-set for the variable composition case was themixture of SPE3 oil (Table 1) with its own dissolved gas after aﬂash separation at standard conditions (Table 2). We created 11 different gas fractions (
αg), from pure oil ( αg¼0) to pure gas ( αg¼1) at constant steps of
αg¼0.1 (Fig. 11). The same pressure and temperature regions(p2½2;27/C138MPa andT2½240;620/C138K) were used for each mixture. Notethat for aﬁxed gas fraction, the global composition is calculated by:Z!¼/C01/C0
αg/C1x!þαgy! (18)wherex!andy!are the liquid and gas compositions ( Table 2). The best network topology for the swelling case is a ð9;27;27;3Þstructure for the phase identiﬁcation network andð9;27;27;1Þfor each initial estimate forﬂash calculation. These networks require more neurons whencompared with the constant composition case because of the variation ofthe global composition input.First we compare the vapor mole fraction (after the convergence oftheﬂash algorithm using an EOS) with the estimates given by the neuralnetwork and the result of the Rachford-Rice equation using Wilson cor-relation (Equations(14) and (6)) for three different pressure and tem-perature, changing the gas fraction ( Fig. 12). As the system pressure increases, Wilson correlation results are poorer, increasing the number ofiterations of the stability algorithm (Equation (5)). On the other hand, the neural network avoids the stability test and provides excelent initial es-timates for the two-phaseﬂash algorithm. The missing points in theneural network curve forαg>0.9,p¼15 MPa andT¼350 K are caused by the low conﬁdence in the phase identiﬁcation network. Fig. 13presents similar results for logK
CO2and logK C73andFig. 14 shows all logK
ivalues for a singlep,Tcondition. ForCO 2Wilson corre- lation can generate good results, however it fails for heavy components,likeC
73. The neural network provides good estimates for log K iin all temperatures and pressures for all components. In many cases the ﬂash calculations can be replaced by the neural network estimates. For
αg> 0.6 atp¼20 MPa andT¼400 K, the mixture becomes single phase.Figs. 15 and 16compareV, logK
CO2and logK C73for three different ( αg, T) conditions changing system pressure, while Figs. 17 and 18compare the same variables for three different (
αg,p) conditions changing system temperature. It is clear that Wilson correlation does not provide goodestimates for high (p,T) systems, leading to many iterations untilconvergence of stability tests in the classical work ﬂow, and slowing compositional simulations. Use of proposed technique avoids the stabil-ity test for almost 95% of the cases, and generates an initial estimate fortheﬂash algorithm very close to the solution.
Fig. 16.logK CO2and logK C73calculated by an EOS and estimated by the neural network and by Wilson correlation for three different ( αg,T) conditions and different system pressures.W.Q. Barros, A.P. Pires Artiﬁcial Intelligence in Geosciences 2 (2021) 202–214
211Fig. 17.Vapor mole fraction calculated by an EOS and estimated by the neural network and by Wilson correlation for three different ( αg,p) conditions and different system temperatures.
Fig. 18.logK CO2and logK C73calculated by an EOS and estimated by the neural network and by Wilson correlation for three different ( αg,p) conditions and different system temperatures.W.Q. Barros, A.P. Pires Artiﬁcial Intelligence in Geosciences 2 (2021) 202–214
2123.3. Speed-up resultsTheﬁrst two sections showed that it is possible to use arti ﬁcial in- telligence to learn thermodynamic equilibrium variables. As discussed,the proposed equilibrium workﬂow avoids the stability test for mostcases and provides initial estimates for the ﬂash calculation very close to the solution. For the tested cases, the computational time spent in sta-bility test is reduced by approximately 75%, and in the ﬂash algorithm by 50%.Table 3shows the number of iterations for some cases. These caseswhere generated changing system pressure and temperature (grid size)and calling both workﬂows for each one. The processing time reductionwas greater than 40% in all cases. For the ﬂash algorithm, the neural network generated initial estimates so close to the ﬁnal result that in some cases the solution was obtained after one iteration.4. ConclusionsIn this work we propose a new phase equilibrium work ﬂow using artiﬁcial intelligence to decrease the number and in most cases avoid thestability test and speed-up the traditionalﬂash algorithm. The developed technique generates initial estimates for the ﬂash calculation close to the solution. This workﬂow may be applied in compositional reservoir sim-ulators, where the classicalﬂash equilibrium calculations are performedfor each cell every time-step.It was shown that small neural networks are necessary to learn thephase equilibrium parameters, and the time spent to evaluate thisnetwork is much smaller than the reduction of the ﬂash iterations and avoiding stability calls. The neural network and the ﬁnalﬂash results are so close that in many cases theﬂash routine is not necessary. However,we built a robust workﬂow where the accuracy of equilibrium equationsis achieved in every run, avoiding error propagation in reservoir simu-lation. We compared the processing time between the classical and theneural network workﬂows, the use of artiﬁcial intelligence decreased the time around 50%.Declaration of interestsThe authors declare that they have no known competing ﬁnancial interests or personal relationships that could have appeared to in ﬂuence the work reported in this paper.AcknowledgementsThe authors acknowledge Universidade Estadual do Norte Flumi-nense (UENF) forﬁnancial support. This study was also supported in partby the Coordenaç~ao de Aperfeiçoamento de Pessoal de Nível Superior -Brasil (CAPES) - Finance Code 001.References
Abhvani, A.S., Beaumont, D.N., 1987. Development of an ef ﬁcient algorithm for the calculation of two-phaseﬂash equilibria. SPE Reservoir Eng. 2, 695–702.https:// doi.org/10.2118/13951-pa.Alakeely, A., Horne, R., 2021a. Application of deep learning methods to estimatemultiphaseﬂow rate in producing wells using surface measurements. J. Petrol. Sci.Eng. 205.https://doi.org/10.1016/j.petrol.2021.108936 . Alakeely, A.A., Horne, R.N., 2021b. Simulating multiphase ﬂow in reservoirs with generative deep learning. In: SPE Annual Technical Conference and Exhibition, SPE.https://doi.org/10.2118/206126-ms . Alavian, S.A., Whitson, C.H., Martinsen, S.O., 2014. Global component lumping for EOScalculations. In: SPE Annual Technical Conference and Exhibition. Society ofPetroleum Engineers.https://doi.org/10.2118/170912-ms . Almajid, M.M., Abu-Alsaud, M.O., 2022. Prediction of ﬂuidﬂow in porous media using physics informed neural networks. J. Petrol. Sci. Eng. 208. https://doi.org/10.1016/ j.petrol.2021.109205.Baghban, A., Ahmadi, M.A., Shahraki, B.H., 2015. Prediction carbon dioxide solubility inpresence of various ionic liquids using computational intelligence approaches.J. Supercrit. Fluids 98, 50–64.https://doi.org/10.1016/j.supﬂu.2015.01.002. Baghban, A., Bahadori, M., Rozyn, J., Lee, M., Abbas, A., Bahadori, A., Rahimali, A.,2016a. Estimation of air dew point temperature using computational intelligenceschemes. Appl. Therm. Eng. 93, 1043–1052.https://doi.org/10.1016/ j.applthermaleng.2015.10.056 . Baghban, A., Namvarrechi, S., Phung, L.T.K., Lee, M., Bahadori, A., Kashiwao, T., 2016b.Phase equilibrium modelling of natural gas hydrate formation conditions usingLSSVM approach. Petrol. Sci. Technol. 34, 1431 –1438.https://doi.org/10.1080/ 10916466.2016.1202966. Baker, L.E., Pierce, A.C., Luks, K.D., 1982. Gibbs energy analysis of phase equilibria. Soc.Petrol. Eng. J. 22, 731–742.https://doi.org/10.2118/9806-pa . Boston, J., Britt, H., 1978. A radically different formulation and solution of the single-stageﬂash problem. Comput. Chem. Eng. 2, 109–122.https://doi.org/10.1016/ 0098-1354(78)80015-5.Cheung, S.W., Chung, E.T., Efendiev, Y., Gildin, E., Wang, Y., 2018. Deep global modelreduction learning. arXiv.https://doi.org/10.48550/arXiv.1807.09335 . Coats, K.H., 1980. An equation of state compositional model. Soc. Petrol. Eng. J. 20,363–376.https://doi.org/10.2118/8284-pa . Coutinho, E.J.R., Aqua, M.J., Gildin, E., 2021. Physics-aware deep-learning-based proxyreservoir simulation model equipped with state and well output prediction. In: SPEReservoir Simulation Conference. https://doi.org/10.2118/203994-ms . SPE. Coutinho, E.J.R., Dall'Aqua, M., McClenny, L., Zhong, M., Braga-Neto, U., Gildin, E., 2022.Physics-informed neural networks with adaptive localized arti ﬁcial viscosity. arXiv. https://doi.org/10.48550/arXiv.2203.08802 . Culham, W., Ali, S.F., Stahl, C., 1969. Experimental and numerical simulation of two-phaseﬂow with interphase mass transfer in one and two dimensions. Soc. Petrol. Eng.J. 9, 323–337.https://doi.org/10.2118/2187-pa . Eghtedaei, R., Moghaddam, N.K., Sarlak, V., deldar, A.N., Baghban, A., 2019. Neuralcomputing approach for predicting vaporization enthalpy of pure hydrocarbons andpetroleum fractions. Petrol. Sci. Technol. 37, 1898 –1904.https://doi.org/10.1080/ 10916466.2017.1315727. El-Banbi, A.H., Forrest, J., Fan, L., McCain, W., 2000. Producing rich-gas-condensatereservoirs—case history and comparison between compositional and modi ﬁed black- oil approaches. In: SPE International Petroleum Conference. https://doi.org/ 10.2118/58988-ms. SPE.Firoozabadi, A., Pan, H., 2000. Fast and robust algorithm for compositional modeling:Part i - stability analysis testing. In: SPE Annual Technical Conference and Exhibition.Society of Petroleum Engineers. https://doi.org/10.2118/63083-ms . Fussell, D., Yanosik, J., 1978. An iterative sequence for phase-equilibria calculationsincorporating the redlich-kwong equation of state. Soc. Petrol. Eng. J. 18, 173 –182. https://doi.org/10.2118/6050-pa . Fussell, L., Fussell, D., 1979. An iterative technique for compositional reservoir models.Soc. Petrol. Eng. J. 19, 211–220.https://doi.org/10.2118/6891-pa . Goda, H.M., Shokir, E.M.E.M., Fattah, K.A., Sayyouh, M.H., 2003. Prediction of the PVTdata using neural network computing theory. In: Nigeria Annual InternationalConference and Exhibition. Society of Petroleum Engineers. https://doi.org/ 10.2118/85650-ms.Haugen, K.B., Beckner, B., 2013. A critical comparison of reduced and conventional EOSalgorithms. SPE J. 18, 378–388.https://doi.org/10.2118/141399-pa . Haykin, S.S., 1999. Neural Networks: A Comprehensive Foundation, Internationaledition. Prentice Hall.Hirose, Y., Kawase, Y., Kudoh, M., 1978. General ﬂash calculation by the Newton-raphson method. J. Chem. Eng. Jpn. 11, 150–152. Jessen, K., Moghadam, R.R., 2009. A ﬂow based lumping approach for compositional reservoir simulation. In: SPE Reservoir Simulation Symposium, SPE. https://doi.org/ 10.2118/119160-ms.Table 3Number of iterations for stability test and ﬂash algorithms for the classical and neural network work ﬂows, and computational time decrease.
Grid Vapor Stability Iterations Flash Iterations ExecutionSize Fraction EOS NN þEOS EOS NN þEOS Time (%)20x20
αv¼0.15 36,591 4922 4601 1716 /C057.4% 40x40
αv¼0.75 105,356 24,796 21,532 10,400 /C049.8% 100x100
αv¼0.25 1,148,991 243,202 112,588 43,375 /C054.3% 200x200
αv¼0.55 3,581,620 927,840 421,225 199,950 /C048.7% 400x400
αv¼0.35 16,936,843 3,910,518 1,844,125 786,628 /C042.0%W.Q. Barros, A.P. Pires Artiﬁcial Intelligence in Geosciences 2 (2021) 202–214
213Joergensen, M., Stenby, E., 1995. Optimization of pseudo-component selection forcompositional studies of reservoir ﬂuids. In: SPE Technical Conference, SPE. https:// doi.org/10.2118/30789-ms. Kenyon, D., Behie, G.A., 1987. Third SPE comparative solution project: gas cycling ofretrograde condensate reservoirs. J. Petrol. Technol. 39, 981 –997.https://doi.org/ 10.2118/12278-pa.Kniazeff, V., Naville, S., 1965. Two-phase ﬂow of volatile hydrocarbons. Soc. Petrol. Eng. J. 5, 37–44.https://doi.org/10.2118/962-pa . Li, C.C., 1971. Critical temperature estimation for simple mixtures. Can. J. Chem. Eng. 49,709–710.https://doi.org/10.1002/cjce.5450490529 . Li, Y., Johns, R.T., 2006. Rapidﬂash calculations for compositional simulation. SPE Reservoir Eval. Eng. 9, 521–529.https://doi.org/10.2118/95732-pa . Li, Y., Sun, R., Horne, R., 2019. Deep learning for well data history analysis. In: SPEAnnual Technical Conference and Exhibition, SPE. https://doi.org/10.2118/196011- ms.Li, Z., Firoozabadi, A., 2012. General strategy for stability testing and phase-splitcalculation in two and three phases. SPE J. 17, 1096 –1107.https://doi.org/10.2118/ 129844-pa.Michelsen, M.L., 1982a. The isothermal ﬂash problem. part i. stability. Fluid Phase Equil. 9, 1–19.https://doi.org/10.1016/0378-3812(82)85001-2 . Michelsen, M.L., 1982b. The isothermal ﬂash problem. part II. phase-split calculation. Fluid Phase Equil. 9, 21–40.https://doi.org/10.1016/0378-3812(82)85002-4 . Mohaghegh, S.D., Liu, J., Gaskari, R., Maysami, M., Olukoko, O., 2012. Application ofwell-based surrogate reservoir models (SRMs) to two offshore ﬁelds in Saudi Arabia, case study. In: SPE Western Regional Meeting. https://doi.org/10.2118/153845-ms . SPE.Moortgat, J., Firoozabadi, A., 2013. Higher-order compositional modeling of three-phaseﬂow in 3d fractured porous media based on cross- ﬂow equilibrium. J. Comput. Phys. 250, 425–445.https://doi.org/10.1016/j.jcp.2013.05.009 . Ojha, V.K., Abraham, A., Sn /C19a/C20sel, V., 2017. Metaheuristic design of feedforward neuralnetworks: a review of two decades of research. Eng. Appl. Artif. Intell. 60, 97 –116. https://doi.org/10.1016/j.engappai.2017.01.013 . Okuno, R., Johns, R.T., Sepehrnoori, K., 2009. Application of a reduced method incompositional simulation. SPE J. 15, 39–49.https://doi.org/10.2118/119657-pa . Prausnitz, J., Lichtenthaler, R., de Azevedo, E., 1998. Molecular thermodynamics of ﬂuid-
phase equilibria. In: Physical and Chemical Engineering Sciences, third ed. ed.Pearson Education.Price, H., Donohue, D., 1967. Isothermal displacement processes with interphase masstransfer. Soc. Petrol. Eng. J. 7, 205–220.https://doi.org/10.2118/1533-pa . Rachford, J., Rice, J., 1952. Procedure for use of electronic digital computers incalculatingﬂash vaporization hydrocarbon equilibrium. J. Petrol. Technol. 4. https:// doi.org/10.2118/952327-g,1 9–3. Rezaveisi, M., Sepehrnoori, K., Johns, R.T., 2014. Tie-simplex-based phase-behaviormodeling in an IMPEC reservoir simulator. SPE Journal 19, 327 –339.https:// doi.org/10.2118/163676-pa. Robinson, D., Peng, D., 1978. The Characterization of the Heptanes and Heavier Fractionsfor the GPA Peng-Robinson Programs. Volume RR-28 of Research Report (Gas Processors Association). Gas Processors Association.Roebuck, I., Henderson, G., Douglas, J., Ford, W., 1969. The compositional reservoirsimulator: case i - the linear model. Society of Petroleum Engineers Journal 9,115–130.https://doi.org/10.2118/2033-pa . Sandler, S., 2006. Chemical, Biochemical, and Engineering Thermodynamics. John Wiley&Sons.Schmall, L., Varavei, A., Sepehrnoori, K., 2013. A comparison of various formulations forcompositional reservoir simulation. In: SPE Reservoir Simulation Symposium, SPE.https://doi.org/10.2118/163630-ms . Soave, G., 1972. Equilibrium constants from a modi ﬁed Redlich-Kwong equation of state. Chemical Engineering Science 27, 1197–1203.https://doi.org/10.1016/0009- 2509(72)80096-4.Sun, A.C., Seider, W.D., 1995. Homotopy-continuation method for stability analysis in theglobal minimization of the gibbs free energy. Fluid Phase Equilibria 103, 213 –249. https://doi.org/10.1016/0378-3812(94)02579-p . Thele, K., Lake, L., Sepehrnoori, K., 1983. A comparison of three equation-of-statecompositional simulators. In: Reservior Simulation Symposium, SPE. https://doi.org/ 10.2118/12245-ms.Tian, C., Horne, R.N., 2017. Recurrent neural networks for permanent downhole gaugedata analysis. In: SPE Annual Technical Conference and Exhibition, SPE. https:// doi.org/10.2118/187181-ms. Todd, M., Longstaff, W., 1972. The development, testing, and application of a numericalsimulator for predicting miscible ﬂood performance. Journal of Petroleum Technology 24, 874–882.https://doi.org/10.2118/3484-pa . Voskov, D.V., Tchelepi, H.A., 2009a. Compositional space parameterization: multicontactmiscible displacements and extension to multiple phases. SPE Journal 14, 441 –449. https://doi.org/10.2118/113492-pa . Voskov, D.V., Tchelepi, H.A., 2009b. Compositional space parameterization: theory andapplication for immiscible displacements. SPE Journal 14, 431 –440.https://doi.org/ 10.2118/106029-pa. URL:Wang, K., Luo, J., Wei, Y., Wu, K., Li, J., Chen, Z., 2019a. Arti ﬁcial neural network assisted two-phaseﬂash calculations in isothermal and thermal compositionalsimulations. Fluid Phase Equilibria 486, 59–79.https://doi.org/10.1016/ j.ﬂuid.2019.01.002.Wang, K., Luo, J., Yan, L., Wei, Y., Wu, K., Li, J., Chen, F., Dong, X., Chen, Z., 2019b.Artiﬁcial neural network acceleratedﬂash calculation for compositional simulations. In: SPE Reservoir Simulation Conference. Society of Petroleum Engineers. https:// doi.org/10.2118/193896-ms. Whitson, C.H., Michelsen, M.L., 1989. The negative ﬂash. Fluid Phase Equilibria 53, 51–71.https://doi.org/10.1016/0378-3812(89)80072-x . Wilson, G., 1968. A Modiﬁed Redlich-Kwong Equation of State Applicable to GeneralPhysical Data Calculations. American Institute of Chemical Engineers NationalMeeting. Paper 15c.Wong, T., Firoozabadi, A., Nutakki, R., Aziz, K., 1987. A comparison of two approaches tocompositional and black oil simulation. In: SPE Symposium on Reservoir Simulation.Society of Petroleum Engineers. https://doi.org/10.2118/15999-ms .W.Q. Barros, A.P. Pires Artiﬁcial Intelligence in Geosciences 2 (2021) 202–214
214