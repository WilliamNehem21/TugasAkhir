Artiﬁcial  Intelligence  in the Life Sciences  3 (2023) 100068 
Contents  lists available  at ScienceDirect  
Artiﬁcial  Intelligence  in the Life Sciences  
journal  homepage:  www.elsevier.com/locate/ailsci  
Research  Article  
Elucidating  dynamic  cell lineages  and gene  networks  in time-course  single  
cell diﬀerentiation  
Mengrui  Zhang  c , 1 , Yongkai  Chen a , 1 , Dingyi  Yu b , Wenxuan  Zhong  a , Jingyi  Zhang  b , ∗ , Ping Ma a , ∗ 
a Department  of Statistics, University  of Georgia, Athens, GA 30602, United Stated 
b Department  of Industrial  Engineering,  Center for Statistical  Science, Tsinghua University,  Beijing, China 
c Surrozen,  Inc., South San Francisco,  CA, USA 
a r t i c l e i n f o 
Keywords:  
scRNA-seq  
Optimal Transport  
Smoothing  Spline 
Dynamic Gene Networks  a b s t r a c t 
Single cell RNA sequencing  (scRNA-seq)  technologies  provide researchers  with an unprecedented  opportunity  
to exploit cell heterogeneity.  For example,  the sequenced  cells belong to various cell lineages,  which may have 
diﬀerent  cell fates in stem and progenitor  cells. Those cells may diﬀerentiate  into various mature cell types in 
a cell diﬀerentiation  process.  To trace the behavior  of cell diﬀerentiation,  researchers  reconstruct  cell lineages  
and predict cell fates by ordering  cells chronologically  into a trajectory  with a pseudo-time.  However,  in scRNA- 
seq experiments,  there are no cell-to-cell  correspondences  along with the time to reconstruct  the cell lineages,  
which creates a signiﬁcant  challenge  for cell lineage tracing and cell fate prediction.  Therefore,  methods  that can 
accurately  reconstruct  the dynamic  cell lineages  and predict cell fates are highly desirable.  
In this article, we develop an innovative  machine-learning  framework  called Cell Smoothing  Transformation  
(CellST)  to elucidate  the dynamic  cell fate paths and construct  gene networks  in cell diﬀerentiation  processes.  
Unlike the existing methods  that construct  one single bulk cell trajectory,  CellST builds cell trajectories  and tracks 
behaviors  for each individual  cell. Additionally,  CellST can predict cell fates even for less frequent  cell types. Based 
on the individual  cell fate trajectories,  CellST can further construct  dynamic  gene networks  to model gene-gene  
relationships  along the cell diﬀerentiation  process and discover  critical genes that potentially  regulate  cells into 
various mature cell types. 
1. Introduction  
A comprehensive  understanding  of complex  biological  processes  
such as tissue development  and regeneration  requires  the investigation  
of cell diﬀerentiation  across a wide range of samples  and experimental  
time points [1] . The cell diﬀerentiation  process  includes  the diﬀeren-  
tiation of stem cells into diﬀerent  mature cell types [2,3] . Such a pro- 
cess is dynamic  and continuous,  including  rapid changes  in gene expres-  
sions and cell types over time. To proﬁle such cell diﬀerentiation  behav- 
iors, single cell RNA-seq  sequencing  (scRNA-seq)  technology  has been 
developed  rapidly  [4–7] . In particular,  scRNA-seq  enables  researchers  
to observe  the gene expressions  of all cells simultaneously  ( Fig. 1 a) in 
both static or time-course  experiments  ( Fig. 1 b). The static scRNA-seq  
experiment  takes a snapshot  of all cells and their gene expressions  at 
one time [8,9] , whereas  the time-course  scRNA-seq  experiments  take 
snapshots  at multiple  time points. Using scRNA-seq,  researchers  can ob- 
serve the behavior  of individual  cells in cell diﬀerentiation  processes  
∗ Corresponding  authors.  
E-mail addresses:  mengrui@surrozen.com  (M. Zhang), yongkaichen@uga.edu  (Y. Chen), yudy21@mails.tsinghua.edu.cn  (D. Yu), wenxuan@uga.edu  (W. Zhong), 
jingyizhang@tsinghua.edu.cn  (J. Zhang), pingma@uga.edu  (P. Ma) . 
1 Mengrui  Zhang and Yongkai  Chen contributed  equally.  over time. Cell lineage  tracing has been widely used to predict dynamic  
cell fates by indicating  the ancestor  and posterity  cells in cell diﬀerenti-  
ation processes.  For example,  during a stem cell diﬀerentiation  process,  
the multipotent  stem cells can develop  into multiple  cell lineage  end- 
points ( Fig. 1 c). Despite  the eﬀectiveness,  quantifying  the dynamic  cel- 
lular changes  of cell development  is still challenging  due to the following  
technical  limitations  [10] . In time-course  scRNA-seq  experiments,  cells 
are sacriﬁced  and sequenced  at each time point. Thus there is no cell- 
to-cell correspondence  information  for cells between  two time points, 
which creates a signiﬁcant  challenge  in constructing  cell lineages  and 
elucidating  the dynamic  cell behaviors  in the diﬀerentiation  process.  
Moreover,  it is very challenging  to align diﬀerent  cells sequenced  in 
two adjacent  time points since expressions  of cells are high-dimensional  
and noisy, and the number  of cells in each time point is large. Such a 
large sample and high-dimensional  and noisy data problem  render many 
classical  methods,  such as Euclidean  distance  or Pearson  correlation,  
invalid [11,12]  . 
https://doi.org/10.1016/j.ailsci.2023.100068  
Received  21 December  2022; Received  in revised form 17 March 2023; Accepted  22 March 2023 
Available  online 25 March 2023 
2667-3185/©2023  The Authors.  Published  by Elsevier B.V. This is an open access article under the CC BY-NC-ND  license 
( http://creativecommons.org/licenses/by-nc-nd/4.0/  ) M. Zhang, Y. Chen, D. Yu et al. Artiﬁcial Intelligence in the Life Sciences 3 (2023) 100068 
Fig. 1. Single cell analysis  and cell smoothing  transformation  (CellST)  overview:  a : The advantage  of scRNA-seq  analysis  over bulk RNA-seq  analysis.  b : Data 
structures  for static scRNA-seq  experiments  and time-course  scRNA-seq  experiments.  Cells in time-course  experiments  have been marked with experimental  time 
points. c : The multipotent  stem cells can develop into multiple  cell lineage endpoints.  d : Cell lineages  are constructed  by connecting  individual  cells over time. Cell 
fate trajectories  are constructed  by smoothing  the connected  cell lineages.  e : Dynamic  gene networks  are constructed  based on the calculated  dynamic  relationship  
between  genes. 
One natural  approach  to surmount  the challenges  is to order cells 
into a continuous  cell trajectory.  Many methods  have been proposed  to 
achieve  this goal in static scRNA-seq  experiments.  In these methods,  re- 
searchers  construct  a pseudotime  to order cells chronologically  [13–19]  . 
Despite  their eﬀectiveness,  such methods  may fail in the following  cir- 
cumstances  [20] . First of all, most existing  trajectory  inference  methods  
construct  a bulk cell trajectory,  i.e., the mean trajectory  of the popula-  
tion cells across time rather than that of individual  cells. 
However,  some individual  cells’ behaviors  may oscillate  up and 
down around their mean expressions  or severely  deviate  from them. Cell 
diﬀerentiation  behaviors  are dominated  by cells with major cell types, 
and patterns  with less frequent  might be hidden in the dataset.  Sec- 
ond, individual  cell developing  trajectories  may follow diﬀerent  com- 
plex topologies,  including  loops or alternative  paths during the devel- 
opment.  For example,  analysis  approaches  in [21] , and [22] used dimen- 
sion reduction  methods  to identify  a low-dimensional  space of the gene 
expression  space before constructing  cell trajectories  [23,24]  . Those 
methods  may introduce  a signiﬁcant  bias and are hard to validate,  as 
cells are ordered  based only on the selected  reduced  dimensions.  Fi- 
nally, the cells may not be synchronized  at the same developing  time 
points. Cells within the same time point can be expressed  at diﬀerent  
developing  stages. In this situation,  the bulk cell trajectory  that takes 
the average  pattern  of cells at diﬀerent  stages might result in unreliable  
scientiﬁc  discovery.  In this article, we propose  a novel analysis  framework  named Cell 
Smoothing  Transformation  (CellST)  to overcome  the aforementioned  
limitations.  The CellST framework  elucidates  dynamic  cell fates and con- 
structs gene networks  in the cell diﬀerentiation  process.  In the CellST 
framework,  we propose  a cell lineage  tracing method,  which aligns two 
individual  cells between  any adjacent  two time points via the optimal  
transport  technique.  The optimal  transport  technique  is a mathemati-  
cal tool initially  developed  to identify  the transport  map between  two 
probability  measures  with the minimum  transport  cost [25] . Recently,  
this technique  has gained increasing  importance  in various  applications  
such as subsampling  [61] , suﬃcient  dimension  reduction  [59] , feature 
screening  [57] , and graph comparison  [55] . Consequently,  it has be- 
come a powerful  tool for modeling  cell dynamics  [27–29]  . See Zhang 
et al. [29,60]  for recent reviews.  Those aligned  cells can potentially  rep- 
resent individual  cell lineages,  tracing cell diﬀerentiation  behaviors  by 
constructing  cell-to-cell  trajectories  ( Fig. 1 d). We then use a smoothing  
spline model to predict cell fate trajectories  and reduce both cell-cell  
variations.  The smoothing  spline method  models the gene expression  
patterns  in the aligned  cell lineages  from the previous  step and builds 
the estimated  individual  cell fate trajectories.  Lastly, we narrow  down 
our focus to utilize the gene expression  patterns  from those cell fate 
trajectories  to construct  dynamic  gene networks  ( Fig. 1 e). The dynamic  
gene networks  are constructed  by estimating  the dynamic  relationship  of 
pairwise  gene expression  patterns  using the functional  concurrent  mod- 
2 M. Zhang, Y. Chen, D. Yu et al. Artiﬁcial Intelligence  in the Life Sciences 3 (2023) 100068 
Fig. 2. Example  of cell-to-cell  linking: a : Cell diﬀerentiation  over time (x-axis) reﬂects an increasing  trend in average cell expressions  (y-axis).  b : The individual  cell 
correspondences  at diﬀerent  time points reﬂect a decreasing  trend in average cell expression  (y-axis).  
els [30] and smoothing  spline models [31] . The dynamic  gene networks  
can be used to ﬁnd critical genes by proﬁling  genes with signiﬁcantly  
diﬀerent  patterns  from other genes. 
Our major contribution  is developing  the ﬁrst analysis  framework  
(CellST)  to construct  cell lineages  and predict dynamic  cell fates at the 
individual  cell level, which can help researchers  better observe  cell be- 
haviors  in the diﬀerentiation  process.  In contrast,  the existing  methods  
only estimate  the bulk trajectory  in scRNA-seq  experiments.  Those anal- 
ysis methods  may overlook  the hidden patterns  in the cell diﬀerentiation  
process  to create a spurious  cell diﬀerentiation  trajectory.  We illustrate  
this problem  by using a simulated  time-course  cell dataset indicating  
the disadvantage  of bulk cell trajectories  ( Fig. 2 ). The cell-to-cell  tra- 
jectories  are able to overcome  the disadvantage  and identify  the real 
gene expression  patterns  in cell development.  Under some cell develop-  
ment and diﬀerentiation  circumstances,  cells’ average  expressions  show 
an increasing  pattern  if we only construct  one average  cell trajectory  
to order cells ( Fig. 2 a). However,  when individual  cells are aligned  at 
diﬀerent  time points, the individual  cell lineages’  average  expressions  
reﬂect unique decreasing  patterns,  which are in contrast  to the bulk tra- 
jectory ( Fig. 2 b). This means some cells start at a lower expression  level, 
and the expression  keeps going down over time. Those cell development  
patterns  can be easily misled by the average  cell trajectory  and thus re- 
ﬂect spurious  cell diﬀerentiation  behaviors.  Furthermore,  we propose  
the dynamic  gene networks  based on the individual  cell fate trajecto-  
ries to estimate  the dynamic  gene-gene  relationship  and critical genes 
in the diﬀerentiation  process.  The empirical  performance  of the pro- 
posed framework  is evaluated  by several simulated  and real experiment  
studies.  
2. Method  
In this section,  we introduce  the Cell Smooth  Transformation  
(CellST)  method,  which constructs  the cell fate trajectories  and dynamic  
gene networks  for time-course  scRNA-seq  data. 
2.1. Cell lineage & Individual  cell fate trajectories  
To construct  the cell fate trajectories,  we ﬁrst align the cells at dif- 
ferent time points to construct  the cells’ lineages  information  between  
time points. We then smooth  the gene expression  pattern  for each gene 
over time and extract the ”mean curve ”o f all individual  gene expres-  
sion patterns  in single cell fate trajectories  to obtain the general  gene 
expression  pattern.  
2.1.1. Cell-to-cell  lineages  by optimal transport  
Regarding  cells at diﬀerent  time points as cells with genes of diﬀerent  
domain  spaces, we transform  the problem  of aligning  cells at diﬀerent  
time points into a problem  of domain  adaptation.  Speciﬁcally,  we denote 
the normalized  gene expression  for cell 𝑖 at time 𝑡 by a 𝑑-dimensional  vector 𝐱 𝑡 
𝑖 ; each dimension  of 𝐱 𝑡 
𝑖 represents  a gene expression  1 . We write 
𝐗 𝑡 = {𝐱 𝑡 
𝑖 }𝑛 𝑡 
𝑖 =1 , where 𝑛 𝑡 indicates  the number  of cells at time 𝑡 in single 
cell RNA-seq  dataset.  Our goal is to learn the transformation  between  
the domain  spaces by aligning  the distribution  of 𝐗 𝑡 to 𝐗 𝑡 +1 . 
As a powerful  tool to learn the transformation  from one probabil-  
ity measure  to another,  optimal  transport  has been applied  to solve the 
domain  adaptation  problem  [32] . We thus apply optimal  transport  to 
obtain the domain  adaptive  coupling  between  𝐗 𝑡 and 𝐗 𝑡 +1 . In other 
words, we transform  the cell alignment  problem  into an optimal  trans- 
port problem.  In particular,  we formulate  the problem  as a Monge opti- 
mal transport  by minimizing  the cost for transporting  a gene expression  
distribution  𝜇𝑡 and 𝜇𝑡 +1 using a map 𝐓 𝑡 : 
min 
𝐓 𝑡 ∫𝑡 𝑐( 𝑥, 𝐓 𝑡 ( 𝑥 ))d 𝜇𝑡 ( 𝑥 ) , (1) 
where 𝐓 𝑡 # 𝜇𝑡 = 𝜇𝑡 +1 , # represents  the push-forward  operator,  such that 
for any measurable  𝑥 , 𝐓 𝑡 # 𝜇𝑡 ( 𝑥 ) = 𝜇𝑡 ( 𝐓 −1 
𝑡 ( 𝑥 )) , 𝜇𝑡 and 𝜇𝑡 +1 are probability  
distribution  of 𝐗 𝑡 and 𝐗 𝑡 +1 in ℝ 𝑑 , where 𝑑is the dimension.  We deﬁne 
the optimal  transport  map 𝐓 𝑡 ∶ ℝ 𝑑 →ℝ 𝑑 , where ℝ 𝑑 can be interpreted  
as the domain  space for 𝐱 𝑡 
𝑖 or 𝐱 𝑡 +1 
𝑖 . In this optimal  transport  problem,  one 
constraint  for the transportation  map 𝐓 𝑡 from a measure  𝜇𝑡 to a measure  
𝜇𝑡 +1 is the so-called  measurement-preserving,  i.e., 𝐓 𝑡 # 𝜇𝑡 = 𝜇𝑡 +1 . Among  
all the measurement-preserving  maps, the optimal  𝐓 𝑡 is the one that 
minimizes  the transportation  cost. 
Since we can only observe  gene expressions  for sample cells at each 
time point, we focus on the case where the probability  distributions  are 
discrete.  The distributions  𝜇𝑡 and 𝜇𝑡 +1 for gene features  at time points 𝑡 
and 𝑡 + 1 are deﬁned  as: 
𝜇𝑡 = 1 
𝑛 𝑡 𝑛 𝑡 ∑
𝑖 =1 𝛿𝑡 𝑖 and 𝜇𝑡 +1 = 1 
𝑛 𝑡 +1 𝑛 𝑡 +1 ∑
𝑗=1 𝛿𝑡 +1 𝑗 , (2) 
where 𝛿𝑡 𝑖 and 𝛿𝑡 +1 𝑗 are the Dirac measures  at location  𝐱 𝑡 𝑖 and 
𝐱 𝑡 +1 𝑗 respectively.  Denote the positions  of the supporting  points 𝐗 𝑡 = 
( 𝐱 𝑡 1 , 𝐱 𝑡 2 , …, 𝐱 𝑡 𝑛 𝑡 ) 𝑇 . In discrete  cases, the transport  𝐓 𝑡 from 𝜇𝑡 to 𝜇𝑡 +1 can 
be denoted  as 𝐓 𝑡 ( 𝐗 𝑡 ) = Σ𝐗 𝑡 , where Σis an 𝑛 𝑡 +1 ×𝑛 𝑡 matrix.  For simplic-  
ity, we ﬁrst consider  the equal-size  mapping,  i.e., 𝑛 𝑡 = 𝑛 𝑡 +1 = 𝑛 . Notice 
that in this case, the transport  between  𝐗 𝑡 and 𝐗 𝑡 +1 is a one-to-one  as- 
signment  with permutation,  Σthen can be regarded  as a permutation  
matrix with the ( 𝑖, 𝑗) th element:  
Σ𝑖,𝑗 = { 
1 if 𝐓 𝑡 ( 𝐱 𝑡 𝑗 ) = 𝐱 𝑡 +1 𝑖 , 
0 otherwise,  (3) 
1 For 𝐱 𝑡 
𝑖 , we (1) use all available  genes, (2) select highly expressed  genes, or (3) 
apply dimension  reduction  methods  such as the principal  component  analysis  
(PCA). In the ﬁrst two cases, each gene expression  represents  an individual  gene; 
while in the last case, each gene feature represents  a combination  of all genes. 
3 M. Zhang, Y. Chen, D. Yu et al. Artiﬁcial Intelligence in the Life Sciences 3 (2023) 100068 
Furthermore,  the transportation  cost 𝐶( 𝐓 𝑡 ) deﬁned  in (1) can be calcu- 
lated as: 
𝐶( 𝐓 𝑡 ) = 𝑛 ∑
𝑖 =1 𝑛 ∑
𝑗=1 𝑐 (𝐱
 𝑡 𝑗 , 𝐱 𝑡 +1 𝑖 )Σ
𝑖,𝑗 , (4) 
where 𝑐( 𝐱 𝑡 𝑗 , 𝐱 𝑡 +1 𝑗 ) can be interpreted  as the energy required  to transform  
an individual  cell from the stage as 𝐱 𝑡 
𝑗 to the stage as 𝐱 𝑡 +1 
𝑖 . The optimal  
transport  map 𝐓 𝑡 then can be calculated  through:  
min 
Σ𝑛 ∑
𝑖 =1 𝑛 ∑
𝑗=1 𝑐( 𝐱 𝑡 𝑗 , 𝐱 𝑡 +1 𝑖 )Σ𝑖,𝑗 . (5) 
where 𝑐( 𝐱 𝑡 𝑗 , 𝐱 𝑡 +1 𝑖 ) = ‖‖‖𝐱 𝑡 𝑗 − 𝐱 𝑡 +1 𝑖 ‖‖‖𝛼and ‖⋅‖is the Euclidean  norm in ℝ 𝑑 . 
We set 𝛼= 2 in this paper. The minimum  of the optimization  problem  
(5) is called the 𝐿 𝛼-Wasserstein  distance  (to the power 𝛼) and is denoted  
by 𝑊 𝛼(𝜇
𝑡 , 𝜇𝑡 +1 )𝛼. The 𝑊 𝛼deﬁnes a distance  on the set of distributions  
(cells) that have moments  of order 𝛼. In general,  the cell lineage  con- 
struction  by optimal  transport  can be summarized  as three steps: Esti- 
mating empirical  gene feature distributions  𝜇𝑡 and 𝜇𝑡 +1 as in (2) . Finding  
an optimal  transport  map 𝐓 𝑡 from 𝜇𝑡 to 𝜇𝑡 +1 through  (5) . Applying  𝐓 𝑡 to 
obtain the cell-to-cell  coupling  from 𝐗 𝑡 to 𝐗 𝑡 +1 . 
When dealing  with large-scale  studies involving  numerous  se- 
quenced  cells or measured  genes, several more eﬃcient  algorithms  can 
be used to calculate  the optimal  transport  map, including  the Sinkhorn  
algorithm  (Cutur.,  2013), sliced-Wasserstein  methods  [26,54]  , Hilbert 
curve-based  method  [56] , fast Sinkhorn  method  [58] . 
It’s important  to note that the optimal  transport  map discussed  above 
could be unsuitable  in some cases when the one-to-one  cell diﬀerentia-  
tion assumption  does not hold. However,  our optimal  transport  frame- 
work can be modiﬁed  to account  for more general  cell-to-cell  relation-  
ships. Speciﬁcally,  we consider  the following  two general  scenarios.  
First, the number  of cells may vary at diﬀerent  time points, and as a 
result, some cells may need to be reused when constructing  cell-to-cell  
lineages.  This can lead to multiple  lineages  passing  through  a single cell 
at speciﬁc  time points. Second,  cells may exhibit diﬀerent  proliferation  
rates at the same time points, i.e., the numbers  of new cells produced  
by two cells at the same time point could be signiﬁcantly  diﬀerent.  This 
could result in the varying  proportions  of cell groups across time. To ad- 
dress these general  assumptions,  we present  a comprehensive  discussion  
of our generalized  methods  and experimental  results in the supplemen-  
tary materials.  
2.1.2. Individual  cell fate trajectories  by smoothing  spline model 
After we align the cells from diﬀerent  time points, we can obtain 
the individual  cell lineages  at time points 𝑡 and 𝑡 + 1 . We then align 
cells for all time points based on the cell couplings  to construct  each 
cells coarse cell fate trajectories  across the timeline.  Those cell fate tra- 
jectories  are smoothed  to reduce the estimation  variance  in CellST by 
utilizing  the smoothing  spline models.  The smoothing  spline model is a 
versatile  family of smoothing  methods  that are suitable  for both univari-  
ate and multivariate  problems  [33] . To construct  the proposed  smoothed  
cell trajectories,  we use equation  6 to model the behavior  patterns  of the 
gene expression  along the cell fate trajectories.  Let 𝑡 represent  the time 
points in the time-course  dataset,  and 𝑔 𝑖 represent  the gene expression  
for each gene within an aligned  cell fate trajectory.  For co-expressed  
genes, we model the gene expression  patterns  using a smoothing  spline 
mix-eﬀect  model with { 𝑔 𝑖 , 𝑡 𝑖 } 𝑛 
𝑖 =1 as the observations  [31] : 
𝑔 𝑖 = 𝜂(𝑡 𝑖 )+
 𝐳 𝑇 
𝑖 𝐛 + 𝜀 𝑖 (6) 
𝑖 = 1 , …, 𝑛 , where the regression  function  𝜂(𝑡 𝑖 )is assumed  to be a smooth  
function  on the genes domain  space in a cell. 𝜂(𝑡 𝑖 )are the ﬁxed eﬀects 
and 𝐳 𝑇 
𝑖 𝐛 are the random  eﬀects with 𝐛 ∼𝑁( 𝟎 , 𝐵) and 𝜀 𝑖 ∼𝑁 (0
 , 𝜎2 ). The 
random  eﬀects are used to account  for the co-expressed  genes in one 
individual  cell trajectory.  The model terms 𝜂( 𝑡 ) or 𝜂( 𝑡 ) + 𝐳 𝑇 𝐛 will be esti- 
mated using the penalized  (unweighted)  least squares  method  through  the minimization  of 
1 
𝑛 𝑛 ∑
𝑖 =1 (𝑔
 𝑖 − 𝜂(𝑡 𝑖 )−
 𝐳 𝑇 
𝑖 𝐛 )2 + 1 
𝑛 𝐛 𝑇 Σ𝐛 + 𝜆𝐽( 𝜂) , (7) 
where the ﬁrst term measures  the goodness-of-ﬁt,  𝐽( 𝜂) = ∫( 𝜂′′( 𝑡 )) 2 𝑑𝑡 
quantiﬁes  the smoothness  of 𝜂, and 𝜆is the smoothing  parameter  con- 
trolling  the trade-oﬀ between  the goodness-of-ﬁt  and the smoothness  
of 𝜂[33,34]  . Consider  the minimization  of the least squares  estimation  
( equation  7 ) in a space with basis {𝜉
1 , …, 𝜉𝑞 }, function  𝜂can be ex- 
pressed  as 
𝜂( 𝑡 ) = 𝑑 ∑
𝑗=1 𝑐 𝑗 𝜉𝑗 ( 𝑡 ) = 𝝃𝑇 ( 𝑡 ) 𝐜 . (8) 
Plugging  equation  8 into equation  7 , thus 𝜂can be estimated  by mini- 
mizing:  
( 𝐠 − 𝑅 𝐜 − 𝑍𝐛 ) 𝑇 ( 𝐠 − 𝑅 𝐜 − 𝑍𝐛 ) + 𝐛 𝑇 Σ𝐛 + 𝑛𝜆𝐜 𝑇 𝑄 𝐜 . (9) 
With the standard  formulation  of penalized  least squares  regres- 
sion, the minimization  of equation  7 is performed  in a so-called  
reproducing  kernel Hilbert space  ⊆{ 𝜂∶ 𝐽( 𝜂) < ∞} in which 𝐽( 𝜂) 
is a square seminorm,  and the solution  resides in the space  𝐽 ⊕ span
 {𝑅
 𝐽 (𝑡
 𝑖 , ⋅), 𝑖 = 1 , …, 𝑛 }, where  𝐽 = { 𝜂∶ 𝐽( 𝜂) = 0} is the null space 
of 𝐽( 𝜂) and 𝑅 𝐽 ( ⋅, ⋅) is the so-called  reproducing  kernel in  ⊖ 𝐽 . The 
solution  has an expression:  
𝜂( 𝑡 ) = 𝑚 ∑
𝑖 =1 𝑑 𝜈𝜙𝜈( 𝑡 ) + 𝑛 ∑
𝑖 =1 ̃𝑐 𝑖 𝑅 𝐽 (𝑡
 𝑖 , 𝑡 ) (10)
 
where {𝜙
𝜈}𝑚 
𝜈=1 is a basis of  𝐽 . It follows  that 𝑅 = ( 𝑆 , ̃𝑄 ) , where 𝑆 is 
𝑛 ×𝑚 with the ( 𝑖, 𝜈) th entry 𝜙𝜈(𝑡
 𝑖 )and ̃𝑄 is 𝑛 ×𝑛 with the ( 𝑖, 𝑗) th entry 
𝑅 𝐽 (𝑡
 𝑖 , 𝑡 𝑗 ).
 In the smoothing  spline model, the estimation  of 𝜂is highly 
related to the choosing  of the smoothing  parameter  𝜆. We choose the 
smoothing  parameter  𝜆and estimate  random  eﬀect 𝐛 by Generalized  
Cross-Validation  (GCV) [31,34]  . Since there are 𝑑gene expression  pat- 
terns over 𝑡 time points for the cell fate trajectories,  the smoothing  spline 
model estimates  one expression  pattern  for individual  cells and smooths  
the expression  patterns.  
2.1.3. Dynamic  gene networks  
We consider  the connection  of two genes to be dynamic  and the rela- 
tionship  may smoothly  change.  Suppose  we want to study the dynamic  
relationship  of the 𝑙th gene and 𝑠 th gene, where 1 ≤ 𝑙, 𝑠 ≤ 𝑝, 𝑙 ≠𝑠 . Denote 
𝑋 ⟨𝑙 ⟩
𝑖 ( 𝑡 ) and 𝑋 ⟨𝑠 ⟩
𝑖 ( 𝑡 ) as the 𝑙th gene and 𝑠 th gene’s expression  values of cell 
fate trajectories  𝑖 , and 𝑖 = 1 , ⋯ , 𝑛 . By taking 𝑙th gene as the response  and 
𝑠 th gene as the covariate,  we consider  the functional  concurrent  linear 
model, 
𝑋 ⟨𝑙 ⟩
𝑖 ( 𝑡 ) = 𝛽⟨𝑙,𝑠 ⟩( 𝑡 ) 𝑋 ⟨𝑠 ⟩
𝑖 ( 𝑡 ) + 𝜀 ⟨𝑙,𝑠 ⟩
𝑖,𝑡 , (11) 
where 𝛽⟨𝑙,𝑠 ⟩( 𝑡 ) models the dynamic  linear relationship  between  two 
genes, 𝜀 ⟨𝑙,𝑠 ⟩
𝑖,𝑡 s are i.i.d. random  errors with mean zero and constant  vari- 
ance. We estimate  𝛽⟨𝑙,𝑠 ⟩( 𝑡 ) by minimizing  the following  penalized  least 
squares  function,  
1 
𝑛𝐾 𝑛 ∑
𝑖 =1 𝐾 ∑
𝑘 =1 (𝑋
 ⟨𝑙 ⟩𝑖
 (𝑡
 𝑖𝑘 )−
 𝛽⟨𝑙,𝑠 ⟩(𝑡
 𝑖𝑘 )𝑋
 ⟨𝑠 ⟩𝑖
 (𝑡
 𝑖𝑘 ))2 
+ 𝜆𝐽( 𝛽⟨𝑙,𝑠 ⟩) . (12) 
With the representer  theorem  [34] , the optimizer  of 12 can be written  
as 
̂𝛽⟨𝑙,𝑠 ⟩
𝜆( 𝑡 ) = 𝑚 ∑
𝑣 =1 𝑑 𝑣 𝜓 𝑣 ( 𝑡 ) + 𝑛 ∑
𝑖 =1 𝐾 ∑
𝑘 =1 𝑐 𝑖𝑘 𝑅 1 (𝑡
 𝑖𝑘 , 𝑡 ) (13)
 
where { 𝜓 𝑣 } 𝑚 
𝑣 =1 is the basis function  of the 𝑚 -dimensional  null space  0 , 
and 𝑅 𝐽 ( ⋅, ⋅) is the reproducing  kernel of  1 . Moreover,  𝑑 𝑣 and 𝑐 𝑖𝑘 are the 
coeﬃcients  to be estimated.  By Plugging  equation  13 to equation  12 , 
we can yield the estimations  of 𝒄 = ( 𝑐 1 , ⋯ , 𝑐 1 𝐾 , ⋯ , 𝑐 𝑛 1 , ⋯ , 𝑐 𝑛𝐾 ) 𝑇 and 𝒅 = 
( 𝑑 1 , ⋯ , 𝑑 1 𝐾 , ⋯ , 𝑑 𝑛 1 , ⋯ , 𝑑 𝑛𝑘 ) 𝑇 , which follow 
𝒄 = (𝐌
 −1 − 𝐌 −1 𝐒 (𝐒
 𝑇 𝐌 −1 𝐒 )−1 𝐒 𝑇 𝐌 −1 )𝐗
 ⟨𝑠 ⟩𝑿 ⟨𝑙 ⟩
𝒅 = (𝐒
 𝑇 𝐌 −1 𝐒 )−1 𝐒 𝑇 𝐌 −1 𝑿 ⟨𝑙 ⟩(14) 
4 M. Zhang, Y. Chen, D. Yu et al. Artiﬁcial Intelligence in the Life Sciences 3 (2023) 100068 
where 𝐗 ⟨𝑠 ⟩= 𝑑𝑖𝑎𝑔(( 𝑿 ⟨𝑠 ⟩𝑇 
1 , ⋯ , 𝑿 ⟨𝑠 ⟩𝑇 
𝑛 )) with the vector 𝑿 ⟨𝑠 ⟩𝑇 
𝑖 = 
( 𝑋 ⟨𝑠 ⟩
𝑖 ( 𝑡 𝑖 1 ) , ⋯ , 𝑋 ⟨𝑠 ⟩
𝑖 ( 𝑡 𝑖𝐾 )) 𝑇 , 𝑿 ⟨𝑙 ⟩= ( 𝑿 ⟨𝑙 ⟩𝑇 
1 , ⋯ , 𝑿 ⟨𝑙 ⟩𝑇 
𝑛 )) 𝑇 with the vector 
𝑿 ⟨𝑙 ⟩
𝑖 = ( 𝑋 ⟨𝑙 ⟩
𝑖 ( 𝑡 𝑖 1 ) , ⋯ , 𝑋 ⟨𝑙 ⟩
𝑖 ( 𝑡 𝑖𝐾 )) 𝑇 , 𝐒 = ( 𝐒 𝑇 
1 , ⋯ , 𝐒 𝑇 
𝑛 ) 𝑇 with the ( 𝑘, 𝑣 ) th entry 
of the 𝐾 ×𝑚 matrix 𝐒 𝑖 equals to 𝜓 𝑣 ( 𝑡 𝑖𝑘 ) 𝑋 ⟨𝑠 ⟩
𝑖 ( 𝑡 𝑖𝑘 ) , 𝐌 = 𝐗 ⟨𝑠 ⟩𝐐𝐗 ⟨𝑠 ⟩+ 𝑛𝜆𝐈 
and 𝐐 is the 𝑛𝐾 ×𝑛𝐾block matrix with the ( 𝑖, 𝑗) th block is the 𝐾 ×𝐾
matrix with the ( 𝑘, 𝑢 ) th entry equals to 𝑅 1 ( 𝑡 𝑖𝑘 , 𝑡 𝑗𝑢 ) . Thus, the estimation  
of 𝛽⟨𝑙,𝑠 ⟩( 𝑡 ) can be written  as 
̂𝛽⟨𝑙,𝑠 ⟩( 𝑡 ) = 𝝍 𝑇 𝒅 + 𝝃𝑇 𝒄 (15) 
where 𝝍 = ( 𝜓 1 ( 𝑡 ) , ⋯ , 𝜓 𝑚 ( 𝑡 )) 𝑇 and 𝝃= ( 𝑅 1 ( 𝑡 11 , 𝑡 ) , ⋯ , 𝑅 1 ( 𝑡 1 𝐾 , 𝑡 ) , 
⋯ , 𝑅 1 ( 𝑡 𝑛 1 , 𝑡 ) , ⋯ , 𝑅 1 ( 𝑡 𝑛𝐾 , 𝑡 )) 𝑇 . Note that 𝛽⟨𝑙,𝑠 ⟩( 𝑡 ) models the dynamic  
linear relationship  between  𝑙th gene and 𝑠 th gene, and 𝛽⟨𝑙,𝑠 ⟩( 𝑡 0 ) = 0 
means the correlation  between  gene 𝑙and gene 𝑠 to be 0 at the time 
point 𝑡 0 . We then derive the 100(1 − 𝛼)% conﬁdence  band of 𝛽⟨𝑙,𝑠 ⟩( 𝑡 ) . We 
adopt the Bayes model in [33] and get the posterior  variance  of 𝛽⟨𝑙,𝑠 ⟩( 𝑡 ) 
satisﬁes  
Var [𝛽
⟨𝑙,𝑠 ⟩( 𝑡 ) ∣𝐗 , 𝐗 ⟨𝑙 ⟩]=
 𝜎2 
𝑛𝐾𝜆(𝑅 1 ( 𝑡, 𝑡 ) + 𝝍 𝑇 (𝐒
 𝑇 𝐌 −1 𝐒 )−1 𝝍 − 2 𝝍 𝑇 𝒅 𝜉− 𝝃𝑇 𝒄 𝜉)(16)
 
where 
𝒄 𝜉= (𝐌
 −1 − 𝐌 −1 𝐒 (𝐒
 𝑇 𝐌 −1 𝐒 )−1 𝐒 𝑇 𝐌 −1 )𝐗
 ⟨𝑠 ⟩𝝃 𝒅
 𝜉= (𝐒
 𝑇 𝐌 −1 𝐒 )−1 𝐒 𝑇 𝐌 −1 𝐗 ⟨𝑠 ⟩𝝃 (17) 
Using equation  (16) , we can estimate  the posterior  variance  of 𝛽⟨𝑙,𝑠 ⟩( 𝑡 0 ) 
and write as 𝛾⟨𝑙,𝑠 ⟩( 𝑡 0 ) . We then construct  the 100(1 − 𝛼%) Bayesian  con- 
ﬁdence  interval  (BCI) of 𝛽⟨𝑙,𝑠 ⟩( 𝑡 ) : 𝐵𝐶𝐼 ⟨𝑙,𝑠 ⟩( 𝑡 ) ∶= ̂𝛽⟨𝑙,𝑠 ⟩( 𝑡 ) ± 𝑧 𝛼∕2 √
𝛾⟨𝑙,𝑠 ⟩( 𝑡 ) , 
where 𝑧 𝛼∕2 is the 1 − 𝛼∕2 quantile  for standard  normal  distribution.  
We use Bayesian  conﬁdence  intervals  to construct  the dynamic  
graph, where a node represents  a gene, and an edge between  two nodes 
exists if the two corresponding  genes follow the model (11) with non- 
zero coeﬃcient  𝛽⟨𝑙,𝑠 ⟩( 𝑡 ) . 
2.2. Test diﬀerentially  expressed  genes 
We integrate  a functional  ANOVA  test method  [35] in our frame- 
work to estimate  deferentially  expressed  genes based on the con- 
structed  cell fate trajectories.  For each gene in those cell fate tra- 
jectories,  we consider  independent  vectors  of the random  function  
𝐗 𝑘𝑖 ( 𝑡 ) = (𝑋
 𝑘𝑖 1 ( 𝑡 ) , …, 𝑋 𝑘𝑖𝑑 ( 𝑡 ) )⊤, where 𝑘 indicates  the number  of trajec- 
tory groups,  𝑖 indicates  cells and 𝑑indicates  the number  of genes in one 
individual  cell trajectory,  deﬁned  over the interval  𝐼. In the multivariate  
analysis  of variance  problem  for functional  data (FMANOVA),  we test 
the following  hypothesis  
𝐻 0 ∶ 𝝁1 ( 𝑡 ) = ⋯ = 𝝁𝑘 ( 𝑡 ) , 𝑡 ∈𝐼, 
𝐻 𝐴 ∶ 𝝁1 ( 𝑡 ) ≠⋯ ≠𝝁𝑘 ( 𝑡 ) , 𝑡 ∈𝐼. (18) 
Wilks lambda  test statistics  for testing signiﬁcantly  diﬀerent  genes 
are approximated  using the fdANOVA  method  [35] . The null distribu-  
tions of test statistics  are approximated  by 𝐹 ( 𝑙 −1) 𝜅, ( 𝑛 − 𝑙 ) 𝜅-distribution,  𝜅
are estimated  by the naive and biased-reduced  methods  [36] . The 𝑝 - 
value is given by 𝑃 (𝐹
 ( 𝑙 −1) 𝜅, ( 𝑛 − 𝑙 ) 𝜅> 𝐹 𝑛 ), where 𝐹 𝑛 denotes  the test statis- 
tic. P-values  for all genes tested are corrected  by Benjamini  & Yekutieli  
method  [37] . 
3. Results  
We evaluated  the performance  of the CellST framework  on cell lin- 
eage tracing and cell fate prediction  in both simulated  and real scRNA-  
seq experiments.  The simulation  analysis  was conducted  in two sce- 
narios: Firstly, we simulated  scRNA-seq  datasets  with cells at two time 
points to only investigate  the accuracy  of constructed  cell-to-cell  corre- 
spondence  between  time points. Secondly,  we simulated  a time-course  
scRNA-seq  dataset with multiple  time points to examine  individual  cell 
diﬀerentiation  patterns  in the cell fate trajectories.  For real scRNA-seq  experiments,  we conducted  cell lineage  tracing in a single-cell  mouse 
hematopoietic  system experiment  [38] . Moreover,  we evaluated  the en- 
tire proposed  framework  on a scRNA-seq  experiment  for zebraﬁsh  cell 
embryogenesis  [39] . 
3.1. Simulation  
3.1.1. Reconstruct  cell-to-cell  correspondence  along time points 
To investigate  the accuracy  of cell aligning,  we simulated  scRNA-seq  
experiments  with only two diﬀerent  time points. The simulated  datasets,  
which contain  the same number  of cells and cell types, were generated  
independently  for each time point. These simulation  datasets  contain  
ﬁve same cell types in both time points. In the simulation  setting,  the 
number  of cells ranges from 200 to 600, and the number  of genes in one 
cell ranges from 100 to 500. The cell alignment  and cell-to-cell  corre- 
spondences  were constructed  using the CellST based only on the gene 
expression  information  of cells at each time point and no information  
on the benchmark  labels of cell types. Speciﬁcally,  we estimated  an em- 
pirical transportation  cost for the individual  cell alignment  between  two 
time points using the gene expressions  in cells. We aligned  cells by se- 
lecting pairs with the smallest  transportation  cost. Since cell dynamics  
is a continuous  development  process  and cells within the same cell type 
tend to have similar gene expression  proﬁles,  the cell aligning  accuracy  
can be validated  by counting  the number  of aligned  cell pairs with the 
same cell type ( Fig. 3 b). 
We noticed  that the accuracy  of the cell aligning  method  has an in- 
creasing  trend as we added more genes in cells for the simulated  data. 
This observation  is due to the fact that the CellST gets more information  
to learn the patterns  of genes when more genes are simulated  in each 
cell. Similarly,  increasing  cell numbers  will also increase  the aligning  
accuracy  since cells can be treated as information  replicates  to enhance  
the accuracy.  We also compared  the accuracy  of coupled  cells with the 
Euclidean  distance  and Pearson’s  correlation.  Those two methods  are 
the most commonly  used distances  or similarity  measures  for gene ex- 
pression  analysis.  [40–42]  . The accuracy  comparison  results ( Fig. 3 b) 
show the CellST method  achieves  the best cell aligning  accuracy  in the 
simulation  settings.  In summary,  the cell aligning  method  achieves  high 
accuracy  and captures  the signiﬁcant  gene expressions  when aligning  
cells and constructing  individual  cell correspondences  at two diﬀerent  
time points. Accurate  cell alignment  is crucial for the down-streaming  
individual  cell fate prediction  when aligned  cells are transformed  into a 
trajectory  over time. 
3.1.2. CellST estimate  cell fates in two simulated  pathways  
To investigate  the eﬀectiveness  in predicting  the individual  cell fates, 
we simulated  a time-course  scRNA-seq  data with 13 experimental  time 
stamps,  and 160 cells were simulated  at each time stamp. This simu- 
lation dataset has two pathways  with distinct  development  expression  
patterns,  and each pathway  contains  100 genes. The ﬁrst pathway  was 
created  using the contact  inhibition  genes that keep cells growing  into 
only a layer one cell thick (mono-layer)  [43,44]  . The growth  of cells’ av- 
erage expression  in this simulated  pathway  diminishes  and approaches  
an equilibrium  expression  over time. We simulated  the second pathway  
according  to the cellular  division  process,  which is more active in cells 
under mitosis and less active in cells in interphase  [45] . Eighty cells con- 
tain only the contact  inhibition  pathway  at each time point, and eighty 
cells contain  only the cellular  division  pathway.  
To observe  and predict the dynamic  cell fates, we utilized  cells’ 
experimental  time information  and built individual  cell fate trajecto-  
ries using CellST. The cell lineages  between  adjacent  time points were 
constructed  using cell lineage  tracing in CellST ( Fig. 4 a). Those con- 
nected cells were then smoothed  using the smoothing  spline technique  
in CellST to estimate  the cell fate trajectories.  Fig. 4 b illustrates  the es- 
timated  individual  cell fate trajectories  (red curves).  Based on the two 
distinct  pathways,  the two types of cells are automatically  well sepa- 
rated by CellST. The expressions  of cell fate trajectories  were compared  
5 M. Zhang, Y. Chen, D. Yu et al. Artiﬁcial Intelligence in the Life Sciences 3 (2023) 100068 
Fig. 3. A simulation  example  of cell aligning  process at two time points. a : Cell-to-cell  alignment  with ﬁve (right) cell types in both time points. b : Accuracy  
comparison  of the cell aligning  process (red) with other gene similarity  measurements  (Pearson  correlation  (blue) and Euclidean  distance  (green)).  
Fig. 4. a : Cell couplings  through  all time points constructed  by the CellST method.  The cells are classiﬁed  by the pathway  they contain.  b : The cell fate trajectories  
(red curves) built by CellST and Benchmark  average expression  cell trajectory(black  curve). c : Development  expression  patterns  for a simulated  gene (m _ 67). The 
red and black curves estimated  by the CellST method indicate  the gene expression  in two diﬀerent  pathways.  The dotted two curves are constructed  by the tradeseq  
method.  
with the benchmark  pathway  expression  patterns  (black curves).  The 
expression  of cell fate trajectories  illustrates  consistent  patterns  with 
the benchmark  expression  of the two simulated  pathways  over time. In 
addition  to the consistency,  we observed  that cells have unique behav- 
iors over time from the cell fate trajectories.  Some cells grow slower 
and have lower expression  values, while others grow faster and have 
higher expression  values than the simulated  average  development  pat- 
terns. The cell fate trajectories  predict the unique cell development  be- 
haviors  by smoothing  the constructed  cell lineages  to reduce cell-cell  
variance.  
Next, we performed  a comparative  analysis  of CellST with the ex- 
isting trajectories  analysis  method  “tradeseq  ”[46] . The “tradeseq  ”i s 
a trajectory-based  method  to estimate  the dynamic  expressions  of dif- 
ferentially  expressed  genes. By comparing  the gene expression  patterns  
constructed  by CellST and tradeseq  ( Fig. 4 c), we notice that the tradeseq  
method  constructed  two similar expression  patterns  for a simulated  gene 
expression  (dotted  curves),  while the CellST method  built two distinct  
expression  patterns  (black and red curves).  Those constructed  dynamic  
gene expression  curves by CellST are also consistent  with the simulated  
benchmark  expressions  by showing  distinct  expression  patterns.  When 
constructing  the cell fate trajectories,  the CellST method  can automati-  
cally classify  cells that contain  diﬀerent  pathway  expressions  and con- 
struct cell correspondences  within the same pathway.  
3.2. Real scRNA-Seq  Experiments  
3.2.1. CellST construct  accurate  cell lineages  
We applied  the proposed  method  on a single cell mouse hematopoi-  
etic system experiment  to evaluate  the eﬀectiveness  of constructing  cell 
lineages  [47] . The dataset includes  three experimental  time points and 
the cells deﬁned  a continuous  state map spanning  from multipotent  progenitors  (MPPs)  to nine mature cell types, including  erythrocytes  
(Er), megakaryocytes  (Mk), basophils  (Ba), mast cells (Ma), eosinophils  
(Eos), neutrophils  (Neu), monocytes  (Mo), plasmacytoid  dendritic  cells 
(pDCs),  Ccr7+ migratory  DCs (migDCs),  and lymphoid  precursors  (Ly) 
( Fig. 5 a). We constructed  the cell developing  lineages  for neutrophils  
(Neu) cell type and compared  the results with the benchmark  cell 
pseudo-time  from the original  experiment  ( Fig. 5 a). CellST connected  
cells through  the three experimental  time points to represent  the de- 
veloping  process’s  penitential  cell lineages.  Speciﬁcally,  we estimated  
an empirical  transportation  cost for the individual  cell correspondence  
between  two time points using the gene expressions  in cells and then 
aligned  cells by selecting  pairs with the smallest  transportation  cost. 
Since cell development  is a gradual  process  and cells within the adja- 
cent time points tend to have similar gene expression  proﬁles,  we mea- 
sured the diﬀerences  from cell pseudo-time  in all constructed  cell lin- 
eages. We compared  the distribution  of cell pseudo-time  with Pearson’s  
correlation  method,  which has been widely used to measure  similar-  
ity between  two cells [40–42]  . Comparing  with Pearson’s  correlation  
method,  we observed  that CellST constructs  cell lineages  with higher 
cell similarities,  in which the changes  in pseudo-time  of connected  cells 
are gathering  near zero ( Fig. 5 b and c). The results indicate  that CellST 
can observe  the gradually  step-wise  developing  behaviors  of cells at 
each time point. CellST constructed  cell lineages  based on the cell-cell  
correspondence  connection  to represent  the cell-developing  behaviors  
throughout  the time points. 
3.3. Discover  critical genes in zebraﬁsh  cell embryogenesis  
To further investigate  individual  cell diﬀerentiation  behaviors  and 
gene-gene  relationships,  we performed  CellST on a zebraﬁsh  embryoge-  
nesis scRNA-seq  dataset.  This dataset contains  38,731 cells and 11,588 
6 M. Zhang, Y. Chen, D. Yu et al. Artiﬁcial Intelligence in the Life Sciences 3 (2023) 100068 
Fig. 5. Constructing  individual  cell lineages  with mouse hematopoietic  system. a : scRNA-seq  dataset for hematopoietic  stem cell diﬀerentiation.  We speciﬁcally  
focus on the cell diﬀerentiation  of neutrophils  (Neu) mature cell types. b : The distribution  pseudo time diﬀerence  between  aligned individual  cells between  two 
time points. The distribution  has been compared  with the Pearson Correlation  method,  which measures  the similarities  between  cells. c : Boxplot comparison  for the 
pseudo time diﬀerence  between  CellST and Pearson correlation  method.  
genes of early zebraﬁsh  development  using Drop-seq  [39] . Samples  in 
the dataset are from the high blastula  stage (3.3 hours post-fertilization)  
when most cells are pluripotent,  to the six-somite  stage (12 hours post- 
fertilization),  when many cells have diﬀerentiated  into diﬀerent  cell 
types. We observed  that cells were clustered  together  at the beginning  
high blastula  stage and diﬀerentiated  into diﬀerent  cell types in later 
development  stages. Since we are constructing  cell trajectories  for mul- 
tiple cell types simultaneously,  the proliferation  rates potentially  vary 
across cells. To address  this, we utilize our generalized  CellST method  
to construct  cell fate trajectories  ( Fig. 6 a), which capture  the unique 
individual  cell development  behaviors  under more general  scenarios.  
This method  also enables  us to estimate  the proliferation  rate for each 
individual  cell. The histograms  of the normalized  proliferation  rates at 
diﬀerent  time points are presented  in Fig. 6 b. Note that the mean of 
the normalized  proliferation  rates at each time point equals 1, while 
the variance  indicates  the heterogeneity  level of the proliferation  rates 
among cells at the corresponding  time point. We notice that this hetero- 
geneity  is signiﬁcantly  high in the early stages of the cell diﬀerentiation  
process  and decreases  gradually  over time. 
Unlike the bulk cell trajectory,  the CellST cell fate trajectories  
achieved  full cell development  coverage  for all cells. The full coverage  
indicates  that the cell fate trajectories  can reveal less frequent  cell de- 
velopment  patterns  overlooked  by the bulk cell trajectory.  The CellST constructed  cell fate trajectories  throughout  the stages and illustrated  
the unique individual  cell development  behaviors.  The cell fate trajec- 
tories return each cell’s potential  cell fate paths into diﬀerent  cell types 
throughout  the 12 developmental  stages. 
Furthermore,  as cells developed  into multiple  cell types at the 12.0- 
6-somite  stage (last developmental  stage), we built trajectory  groups 
to those cell fate paths by CellST according  to the cell types in the 
last developmental  stage. We constructed  the dynamic  gene networks  
( Fig. 6 c) for each group of cell fate trajectories.  In those dynamic  net- 
works, we observed  some genes that behave signiﬁcantly  diﬀerently  
from other genes ( Fig. 6 c) as cells developed  into diﬀerent  cell types. 
For instance,  MYF5, MYOD1,  and KRT18 genes appeared  to behave dif- 
ferently  in two of the trajectory  groups in later developmental  stages. 
The MYF5 is a protein  with a key role in regulating  muscle diﬀeren-  
tiation or myogenesis,  speciﬁcally  the development  of skeletal  muscle 
[48,49]  , and MyoD1  is a key regulator  that orchestrates  skeletal  mus- 
cle diﬀerentiation  through  the regulation  of gene expression  [50,51]  . 
Moreover,  KRT18 regulates  the epithelial  cell diﬀerentiation  process  
[52,53]  . 
We then visualized  and validated  the expressions  of those critical 
genes ( Fig. 6 d and Fig. 6 e). The expressions  of MYF5 and MYOD1  genes 
are signiﬁcantly  higher in trajectory  group 5 versus in other trajectory  
groups,  which is consistent  with the discovery  in the CellST dynamic  
7 M. Zhang, Y. Chen, D. Yu et al. Artiﬁcial Intelligence  in the Life Sciences 3 (2023) 100068 
Fig. 6. a : We constructed  the individual  cell fate trajectories  by connecting  cells through  the 12 developing  stages. b : Histograms  of the distribution  of the cell 
proliferation  rates at diﬀerent  time points. c : Illustration  of identifying  multiple  cell trajectory  groups based on the cell types at the 12.0-6-somite  stage (last 
developmental  stage). d : Example  of critical genes identiﬁed  using CellST dynamic  gene network.  e : Dynamic  gene networks  constructed  by CellST for the cell 
trajectory  groups. 
Table 1 
Top ﬁve gene functional  annotation  groups. 
Gene Ontology  (GO) annotations  Count P-value 
Multicellular  organism  development  133 2.100393e-45  
Cell Diﬀerentiation  86 4.8e-25 
Diﬀerentiation  36 8.6e-10 
Cell fate speciﬁcation  13 1.3e-5 
Cell fate commitment  12 6.1e-5 
networks.  KRT18 is highly expressed  in trajectory  group 15, which is 
also consistent  with the CellST dynamic  network  results.  Additionally,  
we performed  functional  deferentially  expressed  gene tests based on the 
CellST cell fate trajectories.  We discovered  a total of 268 diﬀerentially  
expressed  genes in this zebraﬁsh  cell development  process  dataset.  We 
performed  gene ontology  annotations  to those genes ( Table 1 ), and the 
function  of those genes is highly related to regulating  the cell develop-  
ment/diﬀerentiation  process.  
Those results proved that the cell fate trajectories  and dynamic  gene 
networks  in the CellST method  can be used to discover  critical genes 
in a cell diﬀerentiation  process.  We also demonstrated  the CellST cell 
fate trajectories  have full coverage  on diﬀerent  cell lineages  even in 
some rare cell types since the trajectories  track individual  cell behav- 
iors. Lastly, those individual  cell fate trajectories  reﬂect unique gene 
expression  patterns  when cells develop  into diﬀerent  mature cell types. 
4. Discussion  
Understanding  the dynamic  of cell diﬀerentiation  throughout  a pe- 
riod is crucial for future research  in scRNA-Seq  analysis.  We devel- 
oped a novel machine  learning  analysis  framework,  CellST, to build cell 
fate trajectories  and dynamic  gene networks  for time-course  scRNA-seq  
datasets.  The cell fate trajectories  enabled  researchers  to observe  the 
individual  cell development  behaviors  and better use the beneﬁt of the 
single cell sequencing  technology.  Compared  to the existing  bulk single- 
cell trajectory,  we brought  the cell development  analysis  into a more precise and unprecedented  resolution.  The dynamic  gene networks  esti- 
mated the dynamic  relationship  of genes and discovered  potential  criti- 
cal genes during cell diﬀerentiation  processes.  
There are three major advantages  of the CellST analysis  frame- 
work. Firstly, the cell lineages  were constructed  with high accuracy  and 
provides  unique individual  cell diﬀerentiation  behaviors  between  time 
points. Secondly,  since the trajectory  tracks individual  cells, the cell 
fate trajectories  will have full coverage  on diﬀerent  cell lineages  even 
in some rare cell types ( Fig. 6 a). Thirdly,  the dynamic  gene networks  
analysis  in the CellST framework  can accurately  estimate  gene-gene  re- 
lationships  and discover  critical genes in the cell diﬀerentiation  process.  
Through  the simulation  and real dataset analysis,  We constructed  cell 
fate trajectories  in single cell RNA-seq  experiment  and various  dynamic  
cell diﬀerentiation  behaviors  were observed.  
Code availability  
The CellST R package  and example  for constructing  the cell fate tra- 
jectories  and dynamic  gene networks  analysis  can be found on GitHub  
( https://github.com/zhanzmr/CellST  ). 
Author  information  
Corresponding  authors:  Correspondence  to Jingyi Zhang and Ping 
Ma. 
Co-ﬁrst  author:  Mengrui  Zhang, Yongkai  Chen 
Declaration  of Competing  Interest  
The authors  declare  that they have no known competing  ﬁnancial  
interests  or personal  relationships  that could have appeared  to inﬂuence  
the work reported  in this paper. 
Data availability  
All data used in this paper are publicly  available  datasets.  The 
mouse hematopoietic  system experiment  dataset can be found on 
8 M. Zhang, Y. Chen, D. Yu et al. Artiﬁcial Intelligence in the Life Sciences 3 (2023) 100068 
GitHub  ( https://github.com/AllonKleinLab/paper-data  ). The zebraﬁsh  
embryogenesis  dataset from the original  paper [24] can be found in the 
NCBI database  with accession  number  GSE106587.  
Acknowledgements  
This work was supported  by National  Science  Foundation  grants 
DMS-1903226  , DMS-1925066  , DMS-2124493  and NIH grants 
R01GM1222080.  The authors  acknowledge  the contribution  of Dr. 
Jingyi Zhang for the grant “National  Key R&D Program  of China (No. 
2021YFA1001300)  ”. 
Supplementary  material  
Supplementary  material  associated  with this article can be found, in 
the online version,  at doi:10.1016/j.ailsci.2023.100068  . 
References  
[1] Spiller DG, Wood CD, Rand DA, White MR. Measurement of single-cell dynamics. Nature 2010;465(7299):736–45 
. 
[2] Guo J, Grow EJ, Yi C, Mlcochova H, Maher GJ, Lindskog C, Murphy PJ, Wike CL, Carrell DT, Goriely A, et al. Chromatin and single-cell rna-seq proﬁling reveal dy- namic signaling and metabolic transitions during human spermatogonial stem cell development. Cell Stem Cell 2017;21(4):533–46 
. 
[3] Burrows N, Bashford-Rogers RJ, Bhute VJ, Peñalver A, Ferdinand JR, Stewart BJ, Smith JE, Deobagkar-Lele M, Giudice G, Connor TM, et al. Dynamic regulation of hypoxia-inducible factor-1 
𝛼activity is essential for normal b cell development. Na- ture Immunol 2020;21(11):1408–20 
. 
[4] Nawy T. Single-cell sequencing. Nature Methods 2013;11(1):18 . 
[5] Shapiro E, Biezuner T, Linnarsson S. Single-cell sequencing-based technologies will revolutionize whole-organism science. Nature Rev Genet 2013;14(9):618–30 
. 
[6] Grün D, Oudenaarden A. Design and analysis of single-cell sequencing experiments. Cell 2015;163(4):799–810 
. 
[7] Tanay A, Regev A. Scaling single-cell genomics from phenomenology to mechanism. Nature 2017;541(7637):331–8 
. 
[8] Lawson DA, Bhakta NR, Kessenbrock K, Prummel KD, Yu Y, Takai K, Zhou A, Eyob H, Balakrishnan S, Wang C-Y, et al. Single-cell analysis reveals a stem-cell program in human metastatic breast cancer cells. Nature 2015;526(7571):131–5 
. 
[9] Hrvatin S, Hochbaum DR, Nagy MA, Cicconet M, Robertson K, Cheadle L, Zilio- nis R, Ratner A, Borges-Monroy R, Klein AM, et al. Single-cell analysis of experi- ence-dependent transcriptomic states in the mouse visual cortex. Nature Neurosci 2018;21(1):120–9 
. 
[10] Stegle O, Teichmann SA, Marioni JC. Computational and analytical challenges in single-cell transcriptomics. Nature Rev Genet 2015;16(3):133–45 
. 
[11] Alonge M, Wang X, Benoit M, Soyk S, Pereira L, Zhang L, Suresh H, Ramakrishnan S, Maumus F, Ciren D, et al. Major impacts of widespread structural variation on gene expression and crop improvement in tomato. Cell 2020;182(1):145–61 
. 
[12] Ren G, Jin W, Cui K, Rodrigez J, Hu G, Zhang Z, Larson DR, Zhao K. Ctcf-mediated enhancer-promoter interaction is a critical regulator of cell-to-cell variation of gene expression. Mol Cell 2017;67(6):1049–58 
. 
[13] Qiu X, Hill A, Packer J, Lin D, Ma Y-A, Trapnell C. Single-cell mrna quantiﬁcation and diﬀerential analysis with census. Nature Method 2017;14(3):309 
. 
[14] Cannoodt R, Saelens W, Saeys Y. Computational methods for trajectory inference from single-cell transcriptomics. Eur J Immunol 2016;46(11):2496–506 
. 
[15] Trapnell C. Deﬁning cell types and states with single-cell genomics. Genome Res 2015;25(10):1491–8 
. 
[16] Ji Z, Ji H. Tscan: pseudo-time reconstruction and evaluation in single-cell rna-seq analysis. Nucl Acid Res 2016;44(13) 
. e117–e117 
[17] Chen H, Albergante L, Hsu JY, Lareau CA, Bosco GL, Guan J, Zhou S, Gorban AN, Bauer DE, Aryee MJ, et al. Single-cell trajectories reconstruction, exploration and mapping of omics data with stream. Nature Commun 2019;10(1):1–14 
. 
[18] Trapnell C, Cacchiarelli D, Grimsby J, Pokharel P, Li S, Morse M, Lennon NJ, Li- vak KJ, Mikkelsen TS, Rinn JL. The dynamics and regulators of cell fate deci- sions are revealed by pseudotemporal ordering of single cells. Nature Biotechnol 2014;32(4):381 
. 
[19] Liu Z, Lou H, Xie K, Wang H, Chen N, Aparicio OM, Zhang MQ, Jiang R, Chen T. Re- constructing cell cycle pseudo time-series via single-cell transcriptome data. Nature Commun 2017;8(1):1–9 
. 
[20] Tritschler S, Büttner M, Fischer DS, Lange M, Bergen V, Lickert H, Theis FJ. Concepts and limitations for learning developmental trajectories from single cell genomics. Development 2019;146(12) 
. 
[21] Moon KR, Stanley III JS, Burkhardt D, van Dijk D, Wolf G, Krishnaswamy S. Manifold learning-based methods for analyzing single-cell rna-sequencing data. Curr Opin Syst Biol 2018;7:36–46 
. 
[22] Dai K, Damodaran K, Venkatachalapathy S, Soylemezoglu AC, Shivashankar G, Uh- ler C. Predicting cell lineages using autoencoders and optimal transport. PLoS Com- put Biol 2020;16(4):e1007828 
. 
[23] Saelens W, Cannoodt R, Todorov H, Saeys Y. A comparison of single-cell trajectory inference methods. Nature Biotechnol 2019;37(5):547–54 
. [24] Wagner DE, Weinreb C, Collins ZM, Briggs JA, Megason SG, Klein AM. Single-cell mapping of gene expression landscapes and lineage in the zebraﬁsh embryo. Science 2018;360(6392):981–7 
. 
[25] Villani C. Topics in optimal transportation. American Mathematical Soc; 2003 . 
[26] Meng C, Ke Y, Zhang J, Zhang M, Zhong W, Ma P. Large-scale optimal transport map estimation using projection pursuit. In: Advances in Neural Information Processing Systems; 2019. p. 8116–27 
. 
[27] Schiebinger G, Shu J, Tabaka M, Cleary B, Subramanian V, Solomon A, Gould J, Liu S, Lin S, Berube P, et al. Optimal-transport analysis of single-cell gene expression identiﬁes developmental trajectories in reprogramming. Cell 2019;176(4):928–43 
. 
[28] Tong A, Huang J, Wolf G, van Dijk D, Krishnaswamy S. Trajectorynet: a dy- namic optimal transport network for modeling cellular dynamics. arXiv Preprint arXiv:200204461 2020 
. 
[29] Zhang J, Zhong W, Ma P. A review on modern computational optimal transport methods with applications in biomedical research. arXiv preprint arXiv:200802995 2020 
. 
[30] Wang J-L, Chiou J-M, Müller H-G. Functional data analysis. Annual Rev Stat Appl 2016;3:257–95 
. 
[31] Gu C, Ma P. Optimal smoothing in nonparametric mixed-eﬀect models. Annal Stat 2005;33(3):1357–79 
. 
[32] Courty N, Flamary R, Tuia D. Domain adaptation with regularized optimal transport. In: Joint European conference on machine learning and knowledge discovery in databases. Springer; 2014. p. 274–89 
. 
[33] Gu C. Smoothing spline ANOVA models, vol 297. Springer Science & Business Media; 2013 
. 
[34] Wahba G. Spline models for observational data. CBMS-NSF Regional Conference Series in Applied Mathematics, vol. 59. Philadelphia: SIAM; 1990 
. 
[35] Górecki T, Smaga Ł . fdanova: an r software package for analysis of variance for univariate and multivariate functional data. Comput Stat 2019;34(2):571–97 
. 
[36] Zhang J. Analysis of variance for functional data. Monograph Stat Appl Probab 2014;127:127 
. 
[37] Benjamini Y, Yekutieli D. The control of the false discovery rate in multiple testing under dependency. Annal Stat 2001:1165–88 
. 
[38] Weinreb C, Wolock S, Tusi BK, Socolovsky M, Klein AM. Fundamental lim- its on dynamic inference from single-cell snapshots. Proc Natl Acad Sci 2018;115(10):E2467–76 
. 
[39] Macosko EZ, Basu A, Satija R, Nemesh J, Shekhar K, Goldman M, Tirosh I, Bialas AR, Kamitaki N, Martersteck EM, et al. Highly parallel genome-wide expression proﬁling of individual cells using nanoliter droplets. Cell 2015;161(5):1202–14 
. 
[40] Angermueller C, Clark SJ, Lee HJ, Macaulay IC, Teng MJ, Hu TX, Krueger F, Small- wood SA, Ponting CP, Voet T, et al. Parallel single-cell sequencing links transcrip- tional and epigenetic heterogeneity. Nature Method 2016;13(3):229–32 
. 
[41] Klimovskaia A, Lopez-Paz D, Bottou L, Nickel M. Poincarémaps for analyzing com- plex hierarchies in single-cell data. Nature Commun 2020;11(1):1–9 
. 
[42] Skinnider MA, Squair JW, Foster LJ. Evaluating measures of association for single– cell transcriptomics. Nature Method 2019;16(5):381–6 
. 
[43] Pavel M, Renna M, Park SJ, Menzies FM, Ricketts T, Füllgrabe J, Ashkenazi A, Frake RA, Lombarte AC, Bento CF, et al. Contact inhibition controls cell survival and proliferation via yap/taz-autophagy axis. Nature Commun 2018;9(1):1–18 
. 
[44] Mendonsa AM, Na T-Y, Gumbiner BM. E-cadherin in contact inhibition and cancer. Oncogene 2018;37(35):4769–80 
. 
[45] Tomasetti C, Durrett R, Kimmel M, Lambert A, Parmigiani G, Zauber A, Vogelstein B. Role of stem-cell divisions in cancer risk. Nature 2017;548(7666):E13–14 
. 
[46] Van den Berge K, De Bezieux HR, Street K, Saelens W, Cannoodt R, Saeys Y, Du- doit S, Clement L. Trajectory-based diﬀerential expression analysis for single-cell sequencing data. Nature Commun 2020;11(1):1–13 
. 
[47] Weinreb C, Rodriguez-Fraticelli A, Camargo FD, Klein AM. Lineage tracing on transcriptional landscapes links state to fate during diﬀerentiation. Science 2020;367(6479):eaaw3381 
. 
[48] Esteves de Lima J, Relaix F. Master regulators of skeletal muscle lineage development and pluripotent stem cells diﬀerentiation. Cell Regenerat 2021;10:1–13 
. 
[49] Agarwal M, Bharadwaj A, Mathew SJ. Tle4 regulates muscle stem cell quiescence and skeletal muscle diﬀerentiation. J Cell Sci 2022;135(4):jcs256008 
. 
[50] Blum R, Vethantham V, Bowman C, Rudnicki M, Dynlacht BD. Genome-wide identiﬁcation of enhancers in skeletal muscle: the role of myod1. Genes Dev. 2012;26(24):2763–79 
. 
[51] Agaram NP, LaQuaglia MP, Alaggio R, Zhang L, Fujisawa Y, Ladanyi M, Wexler LH, Antonescu CR. Myod1-mutant spindle cell and sclerosing rhabdomyosarcoma: an aggressive subtype irrespective of age. a reappraisal for molecular classiﬁcation and risk stratiﬁcation. Modern Pathol 2019;32(1):27–36 
. 
[52] Jiang P, Gil de Rubio R, Hrycaj SM, Gurczynski SJ, Riemondy KA, Moore BB, Omary MB, Ridge KM, Zemans RL. Ineﬀectual type 2–to–type 1 alveolar epithe- lial cell diﬀerentiation in idiopathic pulmonary ﬁbrosis: persistence of the krt8hi transitional state. Am J Respirat Crit Care Med 2020;201(11):1443–7 
. 
[53] Liu Y, Li J, Yao B, Wang Y, Wang R, Yang S, Li Z, Zhang Y, Huang S, Fu X. The stiﬀness of hydrogel-based bioink impacts mesenchymal stem cells diﬀeren- tiation toward sweat glands in 3d-bioprinted matrix. Mater Sci Eng: C 2021;118: 111387 
. 
[54] Bonneel Nicolas, Rabin Julien, Peyré Gabriel, Pﬁster Hanspeter. Sliced and radon wasserstein barycenters of measures. Journal of Mathematical Imaging and Vision 2015;51:22–45 
. 
[55] Li Mengyu, Yu Jun, Xu Hongteng, Meng Cheng. Eﬃcient approximation of gro- mov-wasserstein distance using importance sparsiﬁcation. Journal of Computational and Graphical Statistics 2023a:1–25 just-accepted 
. 
[56] Tao Li, Cheng Meng, Jun Yu, and Hongteng Xu. Hilbert curve projection distance for distribution comparison. arXiv preprint 
arXiv:2205.15059 , 2022. 
9 M. Zhang, Y. Chen, D. Yu et al. Artiﬁcial Intelligence in the Life Sciences 3 (2023) 100068 
[57] Li Tao, Yu Jun, Meng Cheng. Scalable model-free feature screening via sliced-wasser- stein dependency. Journal of Computational and Graphical Statistics 2023b:1–24 just-accepted 
. 
[58] Liao Qichen, Chen Jing, Wang Zihao, Bai Bo, Shi Jin, Wu Hao. arXiv preprint; 2022 . 
[59] Meng Cheng, Yu Jun, Zhang Jingyi, Ma Ping, Zhong Wenxuan. Suﬃcient dimension reduction for classiﬁcation using principal optimal transport direction. Advances in Neural Information Processing Systems 2020;33:4015–28 
. [60] Zhang Jingyi, Ma Ping, Zhong Wenxuan, Meng Cheng. Projection-based techniques for highdimensional optimal transport problems. Wiley Interdisciplinary Reviews: Computational Statistics 2022:e1587 page 
. 
[61] Zhang Jingyi, Meng Cheng, Yu Jun, Zhang Mengrui, Zhong Wenxuan, Ma Ping. An optimal transport approach for selecting a representative subsample with applica- tion in eﬃcient kernel density estimation. Journal of Computational and Graphical Statistics 2023;32(1):329–39 
. 
10 