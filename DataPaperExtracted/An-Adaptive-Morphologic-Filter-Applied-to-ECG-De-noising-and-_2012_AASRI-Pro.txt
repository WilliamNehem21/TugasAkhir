 AASRI Procedia   1  ( 2012 )  474 ‚Äì 479 
2212-6716 ¬© 2012 Published by Elsevier Ltd. doi: 10.1016/j.aasri.2012.06.074 
 2012 AASRI Conference on Computational Intelligence and Bioinformatics 
An Adaptive Morphologic Filter Applied to ECG De-noising and Extraction of R Peak at Real-time 
Wang An-donga*, Liu  Lanb ,Wei Qina,b 
a School of Information engineering Wuhan University of Technology, Wuhan 430070,China 
bSchool of Information engineering Wuhan University of Technology, Wuhan 430070,China 
Abstract 
Electrocardiogram (ECG) is an electrical signal detected by the particular device and method. It is very important to analyze and measure ECG for diagnosis of various heart diseases. However, it is often disturbed by different types of noise. In this paper, an adaptive morphological filter is presented to remove the power line interference from ECG signals, by which the drawbacks of previous morphological method are overcome. Moreover, the extraction of R peak in ECG is also feasible by this filter for further study on ECG. Due to the high speed of our method, the ECG de-nosing and R Peak extracting could be both realized at real time, which is an effective method to monitoring patients undergoing surgeries. 
2012 Published by Elsevier B.V. Selection and/or  peer review under responsibility of American Applied Science Research Institute 
Keywords: Electrocardiogram; Mathematical Mor phology; LMS algorithm; Noise suppression 
1.Introduction The electrocardiogram (ECG) is a recording of the heart‚Äôs electrical potentials which has been always applied to the diagnosis of kinds of heart diseases. The noises disturbing ECG involve generally the power- line interference, baseline drift, electrode polar ization noise and the amplifier noise[1]. The most useful 
* Corresponding author.Tel:15871685606 E-mail address:942569665@qq.comKey Lab.of Broadband wireless communications and Sensor networ ks, Wuhan University of Technology, Wuhan, Hubei 430070,China 
AASRI
Procedia
www.elsevier.com/locate/procediaAvailable online at www.sciencedirect.com
Open access under CC BY-NC-ND license.
Open access under CC BY-NC-ND license.475  Wang An-dong et al.  /  AASRI Procedia   1  ( 2012 )  474 ‚Äì 479 
clinical information in ECG is to find the intervals and amplitudes, for exa mple, the R-R interval detection is a major factor in determining the heart rate, and several related arrhythmias such as Tachycardia, Bradycardia[2]. Many approaches have been applied to the enhancement of filtering ECG, such as FIR filter[3],EMD method[4],Morphology[5]. The primary drawbacks of FIR filter is that it can only filter the interference of fixed frequency, while the spectra of the ECG signal and the interference overlaps. However, EMD method, which is able to effectively rem ove noise from ECG signal, but requires considerable computational time which is not suitable for real-time processing. In recent years, mathematical morphology has become one of the effective approaches for the processing and analysis of the ECG signals. Although this approach is promising in terms of robustness and computational effici ency, it introduces distortions to the QRS waves [6], which causes the difficulty in extract ion of ECG features. In this paper, we modify the morphologic filter to combine it with the adaptive filter algorithm and extracting R pear in ECG. The previous morphologic filter, the adaptive filter, and our method are illustrated in next section. And in the third section, experimental results of clinical ECG recording collected during kinds of surgeries are given. Finally, the discussion and conclusion are in the last part. 2.Methods2.1. Mathematical morphology Mathematical morphology(MM) is a branch of mathematics which is based on set theory, topology and random functions. Structuring elements are the basic concept of mathematical morphology, which has a certain form (such as point, line, circle, etc). Erosion and d ilation are two basic morphological operators. Open and close can be defined through the transform  of them. The morphology operations are defined as follows: The discrete signal f is defined on f(n),n=0,1‚Ä¶N-1, the discrete structure-element g is defined on g(m),m=0,1‚Ä¶M-1,and N>M, Erosion is a ‚Äúshrinking‚Äù operator while the dilation operation is an ‚Äúexpansion‚Äù operation. Erosion operation:      
0,1... 10,1...() m i n { ( ) ( ) }
mMnN Mfgn f n m gm
  4                                                                (1) Dilation operation:    
0,1... 11, ... 1() m a x { ( ) ( ) }
mMnM M Nfgn f n m gm
   ¬Ü                                                               (2) After eroded and dilation operation, the signal is cut down by M length. In order to obtain the whole results, we need to expand the original signal from the begi nning and end respectively M length. The open operation and close operation built on eroded operation and dilated operation are defined as follow: Open operation :         
()fg fg g 4¬ÜD                                                                                                  (3)Close operation:         
()fg f g g ¬Ü 4<                                                                                                    (4) In most applications, opening is used to suppress peaks, while closing is used to suppress pits. Opening is a shrinking operator while closing is a expansion operator. So the two filters combine in order to suppress one-way migration[7]. The morphology method used in our paper is mainly based on the following equation.[8].Figure1 illustrates the structure of morphology used in morphology filter.                           
OC_CO(f , g)=() / 2fg g f g g D< <D                                                                       (5)
Opening
AverageClosing
Closing OpeningData expansionInput Output476   Wang An-dong et al.  /  AASRI Procedia   1  ( 2012 )  474 ‚Äì 479 
Fig.1. morphology filter structure used in ECG processing
2.2. Adaptive Filter for Noise Removal The adaptive filter extracts the signal, or eliminates the noise, by iteratively minimizing the MSE between the primary and the reference inputs [9].By adjusting its coefficients continuously, the filter output unlimitedly close to the reference, so that it can achieve the purpose of eliminating interference. This is why the adaptive filter is superior than the fixed parameter filters.Figture2 shows a typical self-adaptive filter structure used for suppress power-line interference [10]. 
Fig.2. self-adaptive filter structure used in ECG processing 
signal d is composed of the desired signal s and noise signal 0n  , which is additive and not correlated with s.  
1nis the reference signal ,which is uncorrelated with desired signal, but correlated with noise n. Since the signal s and noise  
0n is uncorrelated, when  20[( ) ]Eny  reach the min value, The adaptive filter extracts the signal best. 3.  An Novel Adaptive Morphologic Filter and Extraction of R PeakIn this paper, we combined mathematical morphology and adaptive filter to suppress the 60Hz power-line interference and baseline wander in ECG signals. Theoretically, if morphological filtering has width of the structuring element larger than the width of noise aimed to  suppress, morphology can separate the useful signal from noise. But in fact the high amplitude QRS wa ve and the peaks and pits of its adjacent regions will also be removed during simulation process, resulting in the distortion of corrected ECG signal. Our method is designed to solve this problem perfectly. The overall system diagram is showed in Figure3. 
Fig. 3. Block diagram for removing noise and extracting R peaks 
(1) Firstly, OC-CO operation in morphology filter introduced in part II is used to suppress the power-line 90¬∞w1
+
w2
LMSAlgorithm+1()xn
2()xn-+y1 sin(120 )nA tSI  d=s+0n
H
+1f
p
Adaptive Filtere2f
MMO ƒâ
De-noised SignalR peakMMO ƒä
¬¶-
¬¶MMO ƒã477  Wang An-dong et al.  /  AASRI Procedia   1  ( 2012 )  474 ‚Äì 479 
interference in noisy ECG signal0f.1g is a triangular structure element which width is 0.02Fs. Signal1f
is obtained from the noisy ECG signal after OC_CO operation, and the noise has been removed from it ,as well as the peaks and pits in high amplitude QRS wave. Signal
pcontains the important peaks and pits cut down in the operation of morphology, however, there is a lot of noise too. (2) Secondly, signal
pis processed through adaptive filter to remove the noise. Figure 2 shows the structure of this self-adaptive filter structures. (3) Applying the structure element 
2g to filter baseline wander. (4) Reconstruct the signals with e to get the de-noised ECG
3f. (5)Lastly, apply the structure element 
3g to extract QRS wave.3gis a linear structure element which width is 0.09Fs.                                                                          4. Experimental Results To prove whether our algorithm is appropriate for the ECG signal, we use the real ECG signal getting from the process of operations of Taiwan hospital. The sample rate is 300Hz, and the noise signal was obtained by adding 60Hz noise into the pure signal. We use the the signal-to-noise ratio (SNR) and root-meansquare error (RMSE) to measure the performance of our methods. 
210 21()10 log ()[( ) ( ) ]Ni xiSNR
xiy i  ¬¶  (6)
211[( ) ( ) ]NiRMSE x i y iN
  ¬¶  (7)
In the above two equations , x(i) is the original ECG signal, y(i) is the signal after filtered. Our experiment is composed of two parts. We chose the record 1 from a 78 years man in experiment1, because it captures normal sinus rhythms and is reasonably free of noise, and record 2 from a 56 years man in experiment 2 is corrupted with synthetic PLI with frequency and baseline wander. Figure 4 show the results of experiment 1. 
Fig4 .The experimental results by several filtering methods. (a) The pure ECG signal. (b)baseline wander (c) ECG signal corrupt ed with power line interference and baseline wander. (d)baseline wander extracted from morphology operator (e) The result of adaptive morphologic filter (f)The result of previous morphologic filter.  Table1 The result of SNR and RMSE in the experiment1 0 1 2 3 4 5 6 7 8 9 10-2-1012
Time / s(a)Voltage / mV
0 1 2 3 4 5 6 7 8 9 10-1-0.500.51
Time / s(b)Voltage / mV
0 1 2 3 4 5 6 7 8 9 10-2-1012
Time / s(c)Voltage / mV
0 1 2 3 4 5 6 7 8 9 10-1-0.500.51
Time / s(d)Voltage / mV
0 1 2 3 4 5 6 7 8 9 10-2-1012
Time / s(e)Voltage / mV
0 1 2 3 4 5 6 7 8 9 10-2-1012
Time / s(f)Voltage / mV478   Wang An-dong et al.  /  AASRI Procedia   1  ( 2012 )  474 ‚Äì 479 
Method SNR/db RMSE Time of computation (s)
Adaptive morphologic filter 11.6620 0.0018 0.3606 
Previous morphology 10.0172 0.0021 0.3541 
From Figure 4 and Table1, our method has the bette r performance with the improved SNR and RMSE between the pure signal and the filtered ECG was reduced. The morphology method alone can suppress the noise and cut down the peak of R wave at the same time. Although our method will take a little more time to process, it can keep the important features in noisy ECG signal unchanged, which has an important effect on real-time ECG processing. 
Fig5 .The result of experimental 2(a) The corrupted ECG signal. (b)baseline wander extracted from morphology operator (c) The r esult of adaptive morphologic filter  

Fig6.QRS wave extracted from morphology and R peak (a) QRS wave obtained from morphology method (b) Detected R peaks (c) R peak detected from another patient  
Figure5 proves that the adaptive morphologic filter is very effective in processing real-time ECG signals.Figure6 shows that the R peak calculated fr om QRS wave which was extracted from morphology filter2, morphology method keeps the ECG signal unchanged and it is very effective in real-time processing in R-R interval. 5. Discussion and Conclusion 0 5 10 15 20 25 30-3-2-1012
Time / s(a)Voltage / mV
0 5 10 15 20 25 30-0.500.51
Time / s(b)Voltage / mV
0 5 10 15 20 25 30-2-1012
Time / s(c)Voltage / mV
0 1 2 3 4 5 6 7 8 9 10-1012
Time / s(a)Voltage / mVQRS wave
0 1 2 3 4 5 6 7 8 9 10-1012
Time / s(b)Voltage / mVR peak
0 1 2 3 4 5 6 7 8 9 10-1012
Time / s(c)Voltage / mVR peak detected from another patient479  Wang An-dong et al.  /  AASRI Procedia   1  ( 2012 )  474 ‚Äì 479 
In this paper, a new ECG de-noising method which combines morphology with adaptive filter with LMS algorithm is proposed. This new method overcomes the disadvantage that the morphology will cut down the R peaks in ECG signals. It not only suppress the power line interference effectively, but also minimally the losses of the useful information in ECG signal. In addition, our method applies LMS algorithm to reduce the noise in R peaks obtains from morphology. At last , we applied morphology method to extract the QRS wave from the de-noised signal, which can benefit for processing R-R interval in real-time effectively. However, how to select a appropriate structuring elements to adapt to indivi dual differences is the most difficult part in future work. Acknowledgements This paper was supported by the Natural Science Foundation of Hubei Province under Grant 51175389 References [1]Lihuang She, Zhongqiang Xu, De-noisng Of  ECG Based On EMD Improved thresholding And Mathematical Morphology Operation. Interna tional Conference on Biomedical Engineering and Informatics ,BMEI 2010. [2] S.Z.Mahmoodabadi, A.Ahmadian, ECG FEATURE EXTRACTION USING DAUBECHIES WAVELETS, Proceedings of the Fifth IASTED International Conference, VISUALIZATION,IMAGING,AND INMAGING,AND IMAGE PROCESSING, September 7-9,2005 Benidorm, Spain. [3]Chavan,Mahesh.S,Design and implementation of digital FIR equiripple notch filter on ECG signal for removal of power line interference, WSEAS Transactions on Signal Processing, v 4, n 4, p 221-230, April 2008. [4] Chang, Kang-Ming, Ensemble empirical mode decomposition for high frequency ECG noise reduction, Biomedizinische Technik, v 55, n 4, p 193-201, August 1, 2010 [5]CHEE-HUNG HENRY CHU,EDWARD J.DELP.Impulsive Noise Suppression and Background Normalization of Electrocardiogram Signals Us ing Morphological Operators[J].IEEE Trans.on BME,1989,36(2)Àñ262√º273. [6] P. Sun, Q. H. Wu, A. M. Weindling, An Improved Morp hological Approach to Background Normalization of ECG Signals, IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 50, NO. 1, JANUARY 2003. [7]Lihuang She, Zhongqiang Xu, De-noisng Of ECG Based On EMD Improvedthresholding And Mathematical Morphology Operation, 2010 3rd International Conference on Bi omedical Engineering and Informatics (BMEI 2010) [8] Zhongguo LiuÀàECG Signal Denoising Based on Morphological Flitering, 5th International Conference on Bioinformatics and Biomedical Engineering, iCBBE 2011. [9] Mohammad Zia Ur Rahman, Adaptive Noise Removal in the ECG usin g the Block LMS Algorithm, 2009 2nd International Conference on Adaptive Science & Technology [10] Yuan Weiting, An Improved Self-Adaptive Filter Based on LMS Algorithm for Filtering 50Hz Interference in ECG Signals. The Eighth International Conference on Electronic Measurement and Instruments, ICEMI2007. 