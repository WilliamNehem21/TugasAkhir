 AASRI Procedia   1  ( 2012 )  311 ‚Äì 317 
2212-6716 ¬© 2012 Published by Elsevier Ltd. doi: 10.1016/j.aasri.2012.06.048 
 
2012 AASRI Conference on Computational Intelligence and Bioinformatics 
Portfolio Optimization with Cardinality Constraints Based on Hybrid Differential Evolution 
Xiaohua Ma ,Yuelin Gao a ,Bo Wang 
Institute of Information and System Science, Beifang University of Nationalities, Yinchuan 750021  
Abstract 
A portfolio optimal model with cardinality constraints is researched, in which the minimum of Value-at-Risk is taken as the objective function. We give a hybrid differential evolut ion algorithm to solve the model and make the case study with sixteen alternative stocks from Shanghai and Shenzhen stock market. The numerical results show that the given model is reasonable and the given algorithm is effective. 
 ¬© 2012 Published by Elsevier B.V. Selection and/or peer review under responsibility of  American Applied Science Research Institute  
Keywords:Portfolio optimization, Value-at-Risk(VaR), Cardinality constraints, hybrid differential evolution 
1. Introduction 
Since 1970s, financial risk has emerged increasing ly due to the economic globalization, the rapid development of the modern information technology and financial system innovation. How to control financial 
risks effectively becomes the focus to financial regulators and investors. Therefore, how to measure risk has been a very important research subject. In 1952, Markowitz
[1] proposed  the mean-variance model in which the variance is risk measure. Markowitz
[2] and Mao[3] discussed the mean semi-variance portfolio model in which the semi-variance is 
 
 
aCorresponding author. Tel.: +86-0951-2066579; fax: +86-0951-2066602. E-mail address: gaoyuelin@263.net 
AASRI
Procedia
www.elsevier.com/locate/procediaAvailable online at www.sciencedirect.com
Open access under CC BY-NC-ND license.
Open access under CC BY-NC-ND license.312   Xiaohua Ma et al.  /  AASRI Procedia   1  ( 2012 )  311 ‚Äì 317 
risk measure. In 1991, Konna and Yamazaki[4] adopted mean semi-absolute deviation as the risk measure and proposed a linear programming model of portfolio, whic h is called as the mean - absolute deviation model. 
This model can be solved effectively by linear pr ogramming method. But the study only measured the 
deviation level of future returns and expected returns, and didn‚Äôt make comprehensive accurate quantitative calculation to risk of loss. Consequently, the Group of Thirty proposed a new risk measure tool named VaR
[5] in 1993. VaR reflects a potential biggest loss of an asset or portfolio in a certain period and at the 
confidence level. But VaR does not satisfy subadditivity , so it is not a coherent risk measure. Uryasev and 
Rockafellar[6] proposed Conditional Value-at-Risk (CVaR)  portfolio model and obtained approximate conclusion with VaR.  
In recent years, there has been much research on portfolio model based on VaR and CVaR which consider 
the actual market friction, such as transaction costs. But,  research on portfolio with cardinality constraints is 
still not enough, for it is a mixed integer programming problem and difficult to solve by traditional methods. 
Paper[7] proposed heuristic algorithm for the portfolio optimization problem. Then, Paper[8] used local 
hybrid search algorithm to solve portfolio optimization problems with ca rdinality constraints.Yi Wang and 
Zhiping Chen[9] studied portfolio problem with cardinality constraints under multivariate distribution. 
We apply differential evolution algorithm to solve the problem in order to obtain reasonable results which ensured the feasibility of our solution. The numerical re sults show that the model is reasonable and the  given 
hybrid algorithm is effective. That is to say, this paper provides an effective method for the portfolio optimization model with cardinality constraints. 2. M-VaR model with cardinality constraints  
2.1. Value-at-Risk Description 
Suppose (, )fx y  is a loss function of decision vector, x is the vector of portfolio weights, 
12[, , , ]n xx x x " , where n is the number of available assets,ix( 1, 2, ,in" ) is the portfolio weight of the 
ith asset, and 01ixdd ,
11niix
  ¬¶ .y is the vector of market factor, such as market price, ratio of return. For 
any x, the loss (, )fx y  caused by Vector y is a random variable and follows a distribution in R.Suppose probability density function of
yis ()py, then the probability of (, )fx y  doesn‚Äôt exceed p' is:           
(,)(, ) ()
fx y pxp p y d y\
'' ¬≥                                                                                                                   (1) As a function of
p', when xis fixed, (, )xp\' is a cumulative distribution function of x.It is right 
continuous and non-decreasing with respect to p'. Then VaR can be denoted by VaRD,D is the confidence 
level. In our setting they are given by: 
min{ : ( , ) }VaR p R x pD \D  ' ¬è ' t  313  Xiaohua Ma et al.  /  AASRI Procedia   1  ( 2012 )  311 ‚Äì 317 
2.2. Portfolio optimization model  Let us consider the following variables:         
n: the number of available assets 
ir: the return ratio of the ith asset, 1, 2, ,in"  
l: the minimum investment ratio allowed in the ith asset( 1, 2, ,in" ) 
u: the maximum investment ratio allowed in the ith asset( 1, 2, ,in" ) 
1k: the minimum stock amount hold by the investor 
2k: the maximum stock amount hold by the investor 
1 if the -th asset is chosen0o t h e r w i s e
iiZ¬£¬¶¬¶¬§¬¶¬¶¬•
 Then, the return of portfolio is 
y x rTx , the loss of portfolio is y x y x fT  ) , ( . 
Suppose V yCovy E  ) ( , ) ( P , we can infer return and variance of portfolio: 
22() ( ) , () ( )TTxxEr x x r x xV xPP V V     
In this paper, we assume risky asset return is normally distributed, suppose market factor ) , ( ~V N yP , so loss function 
(, ) ~ ( , )TT Tfx y x N x x V x PP   .  
According to definition of VaR , we can obtain  
()(( ) ) (( ) )()() ()pf pfx p xpxxDPPDVV' t ' t
 
Set (( ) )()fxZx
DPV , ZD is lower quantile of standard normal distribution under D confidence level, then 
()()pxZx
DPV' , () ()pZ x xDVP'  , so  
() ()VaR Z x xDVP                                                                                                                                  (2) Set 
()()txYxPV ,   where
) (xV  is the standard deviation of ) (xP , TxVxx ) (V ,and ) (xP  is the expected return of portfolio, 
(.)M  is a probability density function of standard normal distribution. To sum up, our model with cardinality constraints is given by:             
m i n   () ()  VaR Z x xDVP                                                                                                           (3)              
s.t.   ( )TxEr x sP t                                                                                                                     (4)             
ii iZl x Zubb                                                                                                                               (5) 314   Xiaohua Ma et al.  /  AASRI Procedia   1  ( 2012 )  311 ‚Äì 317 
121niikZ k
bb¬ú                                                                                                                                      (6)      
11niix
¬ú                                                                                                                                            (7)   
0ixp                                                                                                                                                     (8) 
Here, (3) is return constraint, (5) and (6) are cardinality constraints, (7), (8) are weight constraint and non-
short selling, respectively. 3. Hybrid Algorithm  3.1.  Differential evolution algorithm   
Differential evolution (DE) is a simple but powerfu l evolutionary algorithm for global optimization 
introduced by Price and Storn[11 12]. The DE algorithm has gradually become more popular and has been 
used in many practical cases. This is mainly becaus e it has good convergence properties and is principally 
easy to understand. The individual of DE is a real vector, D is dimension of individual, NP is Population 
scaleÀàThe adaptive differential evolution algorithm of solving integer programming works as follow: 1) Mutation  
For each target vector, a mutant vector 1tiu is generated by 
112 3( _m a x ( _m a x _m i n )* / )*( )tt t t ir r rux F F F t T x x                                              (9) 
(with 123rrrizzz ). Note that indexes have to be different from each other and from the running index, so 
NP must be at least four. 0F! is a real parameter, called mutation constant, and that _m a xF  is upper 
bound of F,_m i nF  is lower bound of F.t is current iteration, and T is the maximum iteration. 
2) Crossover 
The target vector is mixed with the mutated vector, using the following scheme to generate the trial vector          
11if (rand(0,1) ) ( =rand(1, ))otherwisetitijtijuCRj Dvx¬≠d¬∞ ¬Æ¬∞¬Ø·ü™
                                                                              (10) 
CR is the crossover constant, which has to be determined by the user. 
3) Selection 
A greedy selection scheme is used 
111if ( ) ( )otherwisett tii ititivv xvx\\¬≠¬∞ ¬Æ¬∞¬Ø
                                                                                                               (11) Here 
()xM  is the adaptive value of function. 
3.2. Hybrid algorithm description 
First of all, for restraint ()TxEr x sP t Ààwe set ()Tgx x sP   and use penalty function method, then it 315  Xiaohua Ma et al.  /  AASRI Procedia   1  ( 2012 )  311 ‚Äì 317 
will be transformed into the unconstrained optimization that is expressed as () () * ()F x f x signa H x  , where 
()fxis the object function of formula (3),and  2( ) (min{0, ( )}) ,i H x g x signa  is a penalty factor from 
510 to 810 in general ,which depends on the practical problem. Other constraints‚Äô processing is given in the following algorithm. Our problem is solved by using di fferential evolution algorithm. Then we give a hybrid 
which is produced by combining penalty function meth od and differential evolution. Parameters are set as 
follows: Population scale 80,N  Maximum iteration 500gen , Scaling factor is _m i n 0 . 4F , 
_ max 0.8,F respectively, mutation rate 0.6CR , penalty factor 610sigma . The algorithm concrete steps are: Step1. Define particle number and dimension of differential evolution algorithm. 
Step2. Set value of the mutation probability and upper bound and lower bound of scaling factor. Step3. Generate a matrix 
A, in every row of which the sum of 1 is between 1k and 2k. Step4. Generate a matrix 
B whose elements are between l and u. Step5. Matrix
A dot product matrix B, in this way, we obtain matrix C.This is satisfied constraints (5) and (6) in this progress. 
Step6. The rows of matrix C are normalized to get matrix D, if nonzero elements of row of matrix D 
are between l and u, we will save this row in E; if not, return step 3, until row of matrix E reach to N. 
Step7. According to (10) and (11), we execute crossover operation and produce a new trial individual, if this trial individual is between 
l and u, it will be set () * ( )l u l rand . Step8. If the amount of the nonzero elements of trial is not between 
1k and 2k, we can produce a new trail according to Step 3 and Step 4. If elements of trial are between 
l andu, break; else, return step 7 and go on. 
Step9. For the current iteration Ààaccording to formula (11), we proceed selection and renew the best value of individual. Step10. By means of selection, we can find the best individual and corresponding value. 
Step11. Update individual continually until meet the terminal condition of the program (maximum 
iterations), output the results. 4. Empirical Analysis 
4.1. Assets selection  
In order to disperse risk, we choose different in dustry and circulation stock market. 16 stocks from 
Shanghai and Shenzhen stock market are illustrated. They are respectively: CCGX(000661),XDL(000997), FYDA(000026),SSSH(600688),DFDQ(600875),SQGF600623),MSYH(600016),CCJK(600215),SFZA(000001),SGGF(600303),LCRJ(600756),JGHX(600307),LPGK(000998),ZSDC(000024),HXYH(600015),ZHGJ(600500). 
4.2. Data pretreatment and Algorithm parameter Settings 
A set of week data  from 5,sep,2008 to 5,Jun,2009 of the 16 stocks are selected as our experimental data 
and the returns of stocks are calculated using formula ) /ln(, 1 ,,t i t it ip p r , where 1 ,t ip ,t ip, are week closed price of the 
thi stock at time 1lim
xt
of and t, 1,2, ,16i ! . 
4.3. Analysis of experimental results 
ÀÑ1ÀÖSet 124, 7kk  , 0.1, 0.3lu  . Firstly, we set expected return threshold 0.018s Ààin table 1, 316   Xiaohua Ma et al.  /  AASRI Procedia   1  ( 2012 )  311 ‚Äì 317 
under different confidence level, we have different portfolio weights and corresponding risks. From loss value, 
high confidence level states that investors are more di slike risk. This also reflects conservative investors will 
select bigger confidence level. The portfolio weights of the stocks are satisfied the constraints condition of our 
model. Figure 1 shows the results of algorithm oper ation for 500 generation under differential level, and in 200 generation algorithm convergence stabilize wh ich shows that the algorithm is feasible. 
Table 1. Results under different confidential level 
alpha Stock CCGX SSSH MSYH LCRJ ZSYH VaR 
0.90 weight 0.2415 0.3000 0.2411 0.1170 0.1004 0.0830 
0.95 weight 0.2294 0.2998 0.2432 0.1250 0.1025 0.1002 
0.99 weight 0.2134 0.3000 0.2443 0.1333 0.1091 0.1353 
 
(2)When alpha =0.95, Table 2 gives the risk value and portfolio weight as return threshold increased from 0.018 to 0.026. With the increasing of return threshold, the value of risk is increasing, this also meet high-risk 
and high-income principle. In this progress, if invest ment tends to focus on several stocks, it goes against 
dispersive risk, so the corresponding risk loss will increase in value. 
Table 2 Results under different return threshold 
Return threshold stock CCGX SSSH LCRJ ZSYH VaR 
s=0.018 weight 0.1584 0.3000 0.1500 0.1500 0.1007 
s=0.020 weight 0.2235   0.2794 0.1705 0.1762 0.1039 
s=0.022 weight 0.2927 0.3000 0.1500 0.2573 0.1069 
s=0.024 weight 0.2867 0.2030 0.2631 0.2471 0.1134 
s=0.026 weight 0.3000   0.3000   0.1500 0.1500 0.1355 
(3)Under different confidence level, Table 3 gives th e corresponding value of VaR when return threshold 
increased from 0.018 to 0.026. Then, we can map out the return and risk efficient frontier, see Figure 2. From 
Figure 2, the smaller confidence level, the closer the effici ent frontier of portfolio to graphic top left. This is 
because higher confidence level corresponds to higher de gree of risk aversion. In the same expected yield, the lower confidence level of corresponding risk is smaller, this also accord with theoretical results. 
Table 3 Results under different confidential level and return threshold  
Return threshold S confidence level 0.0180 0.0200 0.0220 0.0240 0.0260 317  Xiaohua Ma et al.  /  AASRI Procedia   1  ( 2012 )  311 ‚Äì 317 
 VaR lphaD =0.90 0.0839 0.0860 0.0902 0.0997 0.1123 
lphaD =0.95 0.1017 0.1046 0.1099 0.1163 0.1355 
lphaD =0.99 0.1367 0.1410 0.1485 0.1639 0.1809 
               According to above analysis, we can conclude that model and operation results are reasonable, hybrid difference algorithm proposed to solve the mixed integer programming model is effective. Acknowledgements The work is supported by the Foundation of Nation al Natural Science China under Grant No. 60962006. References [1] Markowitz H M. Portfolio selection. Journal of Finance, 1952, 7: 77-91. [2]Markowitz HM. Portfolio Selection: Efficient Diversification of Investment. New York: John Wiley&Sons, 1959. [3]Mao J C T. Models of capital budgeting, E-Vversu s E-S. Journal of Financial and Quantitative Analysis, 1970, 5: 657-675. [4]Konno H, Yamazaki H. Mean-absolute deviation portfolio optimization model and its application to Tokyo stock market. Man-agement Science, 1991, 37: 519-531. [5]Philippe J. Value at Risk:The New Benchm ark for Controlling Market Risk. Chicago:Irwn Prefessional,1996. [6]Rockafellar R T. Uryasev S. Optimization of Conditional Value-at-Risk. The Journal of Risk, 2000,2(3)21-24. [7] Chang T J, Meade N, Beasley J E, Sharaiha Y M.  Heuristics for cardinality constrained portfolio optimization.Computer and Operations Research.2000(27):1271-1302. [8]Hans Kellerer, Dietmar Maringer. Optimization of Cardinality  Constrained Portfolios with an Hybrid Local Search Algorithm.MIC‚Äô2001-4-th Metaheuristics International Conference,2001,July,585-589. [9]Yi Wang, Zhiping Chen, Kecun Zhang.A chance-c onstrained portfolio selection problem under t- distribution.Asia-Pacific Journal of  Operational Research,2007,24(4):535-556. [10] Storn R, PriceK. Differential evolution-a simple and efficient adaptive scheme for global optimization over continuous spaces.Technical Report, Intern ational Computer Seience Institute,1995,(8):22-25. [11] Storn R, PriceK. Differential evolution-a simple and efficient adaptive scheme for global optimization over continuous spaces. Journal of Global Optimization,1997,11(4):344-359.   . 