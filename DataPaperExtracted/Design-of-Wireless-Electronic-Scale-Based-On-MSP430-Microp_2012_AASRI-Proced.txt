 AASRI Procedia   1  ( 2012 )  581 – 587 
2212-6716 © 2012 Published by Elsevier Ltd. doi: 10.1016/j.aasri.2012.06.090 
 2012 AASRI Conference on Computational Intelligence and Bioinformatics 
Design of Wireless Electronic Scale Based On MSP430 Microprocessor 
Pinwei Zhu*, Chunhua Hu  
Inst of Electricity and Information Engineering Jiangsu Teachers University of Technology Changzhou, Jiangsu Province, 213001,China  
Abstract 
To analyze consumer habits and keep good inventory in vegetables, fruits and biscuit shop, detailed transactions information should be saved. An electronic scale is designed based on MSP430 and wireless communication module PTR2000. The scale can not only measure th e weight, but also exchange data and instruction with host PC. The condition circuit of strain bridge output signal, time/data circuit, memory circuit, wireless module etc. is presented. The measurement result is processed by the method of moving average filter. User interface in PC side is developed by Visual Basic language. 
 2012 Published by Elsevier B.V. Selection and/or peer review under responsibility of American Applied Science Research Institute  
Keywords: MSP430; PTR2000; Condition circuit; Wireless communication 
1. Introduction Electronic weigh scales have wide range of uses in industrial, commercial and consumer applications. But the traditional scale can’t save the detailed transactions i nformation, such as date, time, types and weight of goods etc, and the commodity price can only be inputted manually. It is inconvenient to use and hard to obtain sales reports, users can’t analyze the consumption habits of customers, good inventory control is also difficult to achieve. In contrast the electronic scales in large supermarket overcome these shortcomings, but they can’t 
 * Corresponding author. Tel.: 13861038275;  E-mail address: dxzpw@jstu.edu.cn 
AASRI
Procedia
www.elsevier.com/locate/procediaAvailable online at www.sciencedirect.com
Open access under CC BY-NC-ND license.
Open access under CC BY-NC-ND license.582   Pinwei Zhu and Chunhua Hu  /  AASRI Procedia   1  ( 2012 )  581 – 587 
 store sales information and they are too expensive for ordinary users. A wireless electronic scale based on MSP430 microprocessor is introduced. It can download the commodity information from personal computer by wireless communication, store sales data and uplo ad to PC, obtain commodity prices by the commodity code and so on. 2. System Architecture The system consists of six parts: MSP430 microprocessor module, sensor detection module, real-time clock module, data storage module, wireless communication module, and host computer . System architecture is shown as Fig.1. 
 
Fig.1 System architecture 
MSP430F135 mixed signal microcontroller is the control core of system [1]. The output signal of strain sensor is firstly conditioned by instrument amplifier and inverting amplifier. Secondly the conditioned signal is analog-to-digital converted by ADC module which is integrated in MSP430F135. MSP430F135 processed the AD result and memory relevant information in AT45DB081 which is flash memory. The weighing result was displayed by LED which is drive by 74HC373 chip [2]. The sales data is sent by PTR2000 which is a wireless communication module. MAX232 which is a serial port communication chip is used between PTR2000 and host computer. The receiving program is developed by VB language. 2.1.MSP430 Circuit The Texas Instruments MSP430F135 is a mixed signal microcontroller configurations with two built-in 16- bit timers, a fast 12-bit A/D converter, one universal  serial synchronous/ asynchronous communication interface (USART), and 48 I/O pins. The architecture, comb ined with five low power modes is optimized to achieve extended battery life in portable measurement applications. The device features a powerful 16-bit RISC CPU, 16-bit registers, and constant generators that attribute to maximum code efficiency. The digitally controlled oscillator (DCO) allows wake-up from low-power modes to active mode in less than 6 ȝs. Good power supply and reset sequence is necessary for MSP430F135. 5V and 3.3V double power source which is based on TPS70302 chip are applied as Fig.2.  583  Pinwei Zhu and Chunhua Hu  /  AASRI Procedia   1  ( 2012 )  581 – 587 
 GND1
Vi n12
Vi n13
NC4
MR25
MR16
EN7
SEQ8
GND9
Vi n210
Vi n211
GND12 GND13Vout 214Vout 215VS2/ FB216NC17RESET18PG119NC20VS1/ FB121Vout 122Vout 123GND24
TPS70302A1 C122uF
C322uFC222uF
C422uFR1100K
R4100KR330KR230K+6V
R547K+5V
+3.3VRST
 
Fig.2 Power supply and reset sequence circuit based on TPS70302 
 In Fig.2, the input voltage of TPS70302 chip is 6V, the output of 5V, 1A and 3.3V, 2A can be regulated by adjustable resistance R1 and R4. SEQ=0, the 
RESET  pin of TPS70302 chip can output 5V which is followed by 3.3V, so good reset sequence is supplied for MSP430. 2.2.Strain Sensor Signal Acquisition Circuit The system adopts type YZC-1B strain sensor; maximum load capacity is about 5 kg. The particular full-bridge sensor that is used has a rated full-scale out put voltage of 2.0±0.002mV/V when loaded with its maximum load capacity of about 5 kg. The goal is to resolve the sensor signal with a resolution of 1g, resulting in a total of 10,000 counts, and show it by LED. If the bridge sensor gets excited with 5 V, it delivers a full-scale output voltage of 5V * 2mV/V = 10 mV. Because the output voltage of strain sensor is very tiny, it should be amplified in thousand times before AD conve rsion. The conditioning circuit consists of instrument amplifier and one-order low-pass filter. The INA326 is  high-performance, low-cost, precision instrumentation amplifiers with rail-to-rail input and output [3]. It is true single-supply instrumentation amplifiers with very low DC errors and input common-mode ranges that ex tend beyond the positive and negative rails. These features make it suitable for applications with high-accuracy. The gain is calculated using (1).  Gain=2R
2/R1 =1000                                                                           (1) The stability and temperature drift of the external gain-s etting resistors will affect gain by an amount that can be directly inferred from the gain equation (1). So R
1 and R 2 should be low temperature drift resistance. The OPA2234 constitutes the one-order low-pass filter. OPA2234 operates from 2.7 V to 36 V supply with excellent performance [3]. Here, it is supplied with same power source with Strain Bridge and INA326. The cutoff frequency of the filter is decided by R
11 and C 7 shown in Fig.3. The output signal of Strain Bridge changed very slowly, 10Hz cutoff frequency is adopted and the power interference is eliminated completely. The gain of low-pass filter can be regulated by adjustable resistance R
12.  The output voltage after conditioning is 0~3.3V wh ich is matched with ADC module in MSP430F135. The MSP430 12-bit sigma-delta ADC can operate either using a built-in reference of 1.2 V, or an externally connected reference voltage. Here, an external resistor divider is used to provide the reference voltage. With the bridge sensor powered from the same voltage source, this has the advantage of implementing a Vcc-independent, ratio metric measurement principle. If the bridge sensor would be powered from Vccand using the internal voltage reference for the ADC module, the measurement results would change as Vcc changes.   584   Pinwei Zhu and Chunhua Hu  /  AASRI Procedia   1  ( 2012 )  581 – 587 
 R6 350 1
7 564
IN A326-2
8
+3R9 2KR8 350
R13350 R14350R7 50+5VAR1
OPA2234
R1110K
C72uFR1010K
R12 100 K+5V
C50.1uF
C60.1nFR151MA/D IN
 
Fig.3 Strain sensor signal acquisition circuit 
2.3.PCF8563 Real-time Clock/Calendar The time and data information of weight come from real-time clock/calendar chip PCF8563. The PCF8563 is a CMOS real-time clock/calendar optimized for low power consumption. A programmable clock output, interrupt output and voltage-low detector are also provided. All addresses and data are transferred serially via a two-line bidirectional I
2C-bus. Maximum bus speed is 400 kbit/s. The built-in word ad dress register is incremented automatically after each written or read data byte.  All 16 registers are designed as addressable 8-bit paralle l registers although not all bits are implemented. The first two registers (memory address 00h and 01h) are used as control and/or status registers. Figure 4 shows the PCF8563 application circuit. In Fig.4, Doubl e power sources are supplied for PCF8563. One power source which operates usually is the 3.3V output of TPS70302. The other which works when the system is power off is 3V battery. Because of the 3V battery po wer supply the data and time information wouldn’t be lost when system is power off. 
Y2
32.768KR2610K
R2820KR2710K C1815P C1915P
C200.1uF 3VBT1D1
1N4148D2
1N4148
D3
1N418+3.3V
+EC6100uF/16VSDA SCLCO7
IN T3
SDA5
SCL6OSCI1
OSCO2
VDD8
VSS4U5
PCF8563+3.3V
 
Fig.4 PCF8563 application circuit 
2.4.AT45DB081 Flash Memory The detailed transactions information, such as date, time, types and weight of goods etc, are saved in AT45DB081 flash memory. To do this can help users to analyze the consumer habits and keep good inventory control. The AT45DB081 is a 2.7-volt only, serial interface Flash memory suitable for in-sys-tem reprogramming. Unlike conventional Flash memories that are accessed randomly with multiple address lines and a parallel interface, the Data Flash uses a serial interface to sequentially access its data. The simple serial interface facilitates hardware layout, increases system reliability, minimizes switching noise, and reduces 585  Pinwei Zhu and Chunhua Hu  /  AASRI Procedia   1  ( 2012 )  581 – 587 
 package size and active pin count. The device is optimized for use in many commercial and industrial applications where high density, low pin count, low voltage, and low power are essential. Typical applications for the Data Flash are digital voice storage, image storage, and data storage. The device operates at clock frequencies up to 10 MHz with a typical active read cu rrent consumption of 4 mA. AT45DB081 application circuit is showed in Figure 5. 
SI6SCLK5
RST24WP25CS4VCC28
SO7RDY/BUSY23
GND1U3
AT45DB081+3.3V
FRDYFCSSPISCKMISOMOSIR1110K
C144.7uF
 
Fig.5 AT45DB081 application circuit 
2.5.Wireless Communication Module The wireless communication module is based on PTR2000. Two PTR2000 modules are used. One is connected with MSP430F135, the other is connected with MAX232 (see Fig.6) which is level conversion chip. The optimum voltage for PTR2000 module is 2.7~5 V, here 5 V is used. The optimum data transfer rate is 9.6 kbit/s~19.2kbit/s. 
1
6
2
7
3
8
4
9
5
DB9
C11 1uFC121uF +5VR1 IN13R2 IN8
T1 I N11T2 I N10
R1 OUT12
R2 OUT9T1 OUT14
T2 OUT7C1+1
C1 -3C2+4
C2 -5
v+2
v-6GND15
VCC16U4 MAX232
+5VVcc1
CS2
DO3
DI4
GND5
PWR6
TXEN7C8 PTR20 00+5V
+5VC4 0.1uF
C220.1uF
C710uF+5V
C91uF
C211uF
 
Fig.6 PTR2000 connected with MAX232 
MSP430F135 uploads detailed transactions informati on to host computer and downloads commodity information to weigh scale by PTR2000 modules and RS232 bus interface. 3. III. Software design 3.1.MSP430 data acquisition program The main function of MSP430 program is to initial system, scan keyboard, drive LED, receive commodity information, read and write PCF8563 current clock/data parameter, store detailed transactions in AT45DB081 flash memory and send it to host PC by wireless communi cation etc. The software workflow of MSP430 is to distinguish the semantic of instruction code and modify system flag, configure internal register, call related I2C/SPI subroutine to read and write external device according to the semantic. 586   Pinwei Zhu and Chunhua Hu  /  AASRI Procedia   1  ( 2012 )  581 – 587 
 3.2.Calibration After many times of actual measurement and serials of adjustment, 0~5 kg weight is converted to 0~3.3 V voltage. Then the conditioned voltage is sampled by 12-bit sigma-delta ADC module, and 0~4096 data is obtained. In order to improve the precision, the result is processed by the method of moving average filter.  Assuming 
()un is the AD result at n time, Lis the length of moving window average filter, so the output of filter at n time is 
()xn calculated using (2). 
1111() (+ ) m a x( ) m i n ( )2LiLiLixnu n i u n i u n iL
bbbb£²¦¦¦¦  ¤»¦¦¦¦¥¼                                       (2) In equation (2), 
max ( )un i represents the maximum, min ( )un i   represents the minimum.  According (2), 
L number of AD results is got firstly, when a new AD result is obtained, the first one of 
Lnumber of AD results is moved out, the others move forward by one position and the new one is inserted into last position. The maximum and minimum result is deleted from the sequence, and then the average mean of the left 
2L number of AD results can be calculated out. The average mean ()xn is just the output of filter. The value of 
L is decided by AD rate and the time needed by weighing. After many times of actual measurement, 
8L is used.  A weight of 20 g is used for calibration. Table 1 sho ws the relationship of weight and AD result. Because of good linear and measurement precision is satisfied, compensation is no need, Scale transformation is shown in Fig.7. 
xis AD result and yis the weight. 
 
Weight(g) AD result Weight(g) AD result Weight(g) AD result
20 4 80 18 140 31 
40 9 100 22 160 36 
60 13 120 26 180 40 
200 44 260 58 320 72 
220 49 280 63 340 77 
240 54 300 67   
 Table 1 Weight and AD result
 
 
Fig.7 Scale transformation 
3.3.Host PC side software The main function of host PC side software is to receive the detailed transactions information, transmit commodity information and provide user interface. The software is developed by Visual Basic language. MSComm control object is applied to read and process the serial data. PC serial port control the wireless module how to receive and transmit data by the attribute of RTSEnable which is an control object of MSComm. RTSEnable=False, the RTS pin of serial port is high, after level conversion; PTR2000 is configured in transmission state. RTSEnable=Ture, the RTS pin of serial port is low, after level conversion, PTR2000 is configured in receiving state.  587  Pinwei Zhu and Chunhua Hu  /  AASRI Procedia   1  ( 2012 )  581 – 587 
 4. Conclusions The electronic scale can not only measure weight of  commodity, but also upload detailed transactions information to host PC and download commodity information from PC by wirele ss communication and serial port. The maximum load capacity is 5 kg with a resolution of 1g. The application of INA326 and OPA2234 has successfully solved the program that how to amplify the weak signal and restrain interface. The combination of MSP430 and PTR2000 can effectively communicate with host PC. MAX232 realizes the level conversion. User interface is convenient for user to modify commodity price and analyze consumer habits. It will be better if the whole system can include multiple slave electronic scales. Acknowledgements This paper was written with financial support of research project 11KJD520005. References [1] Texas Instruments Incorporated. (2010): 'MSP430x13x, MSP430x14x, MSPx14x1 mixed signal microcontroller', Datasheet SLAS272F.Rev. G, pp. 1-3. [2] Andreas Dannenberg. (2004): 'MSP430F42x single chip weigh scale,   Application Report '. Datasheet SLAA220.pp. 2-5. [3] Burr-Brown from Texas Instruments Incorporated. (2005): Precision, rail-to-rail I/O instrumentation amplifier'. Datasheet SBOS222D.pp. 1-3. 